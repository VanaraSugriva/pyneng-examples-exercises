

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ru" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ru" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Документация Python для сетевых инженеров 3.0</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/_static/css/theme.css" type="text/css" />
    <link rel="author" title="Об этих документах" href="contents.html#document-about" />
    <link rel="index" title="Алфавитный указатель" href="genindex.html" />
    <link rel="search" title="Поиск" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="contents.html#document-contents" class="icon icon-home"> Python для сетевых инженеров
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-intro_index">Введение</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-about">О книге</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-faq">Часто задаваемые вопросы (FAQ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-acknowledgments">Благодарности</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-book_links">Ресурсы для обучения по книге</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id2">Подготовка рабочего окружения</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id3">Задания</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id5">Дополнительные материалы</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-book/Part_I">I. Основы Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/01_intro/index">1. Подготовка к работе</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/02_git_github/index">2. Использование Git и GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/03_start/index">3. Начало работы с Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/04_data_structures/index">4. Типы данных в Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/05_basic_scripts/index">5. Создание базовых скриптов</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/06_control_structures/index">6. Контроль хода программы</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/07_files/index">7. Работа с файлами</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/08_python_basic_examples/index">8. Примеры использования основ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-book/Part_II">II. Повторное использование кода</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/09_functions/index">9. Функции</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/10_useful_functions/index">10. Полезные функции</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/11_modules/index">11. Модули</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/12_useful_modules/index">12. Полезные модули</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/13_iterator_generator/index">13. Итераторы, итерируемые объекты и генераторы</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-book/Part_III">III. Регулярные выражения</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/14_regex/index">14. Синтаксис регулярных выражений</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/15_module_re/index">15. Модуль re</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-book/Part_IV">IV. Запись и передача данных</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/16_unicode/index">16. Unicode</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/17_serialization/index">17. Работа с файлами в формате CSV, JSON, YAML</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-book/Part_V">V. Работа с сетевым оборудованием</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/18_ssh_telnet/index">18. Подключение к оборудованию</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/19_concurrent_connections/index">19. Одновременное подключение к нескольким устройствам</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/20_jinja2/index">20. Шаблоны конфигураций с Jinja2</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/21_textfsm/index">21. Обработка вывода команд TextFSM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-book/Part_VI">VI.  Основы объектно-ориентированного программирования</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/22_oop_basics/index">22. Основы ООП</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/23_oop_special_methods/index">23. Специальные методы</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/24_oop_inheritance/index">24. Наследование</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-book/Part_VII">VII. Работа с базами данных</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/25_db/index">25. Работа с базами данных</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-book/Part_VIII">VIII. Дополнительная информация</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/additional_info/argparse">Модуль argparse</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/additional_info/old_str_formatting">Форматирование строк с оператором <code class="docutils literal notranslate"><span class="pre">%</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/additional_info/naming_conventions/README">Соглашение об именах</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/additional_info/naming_conventions/underscore_names">Подчеркивание в именах</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/additional_info/py2_vs_py3">Отличия Python 2.7 и Python 3.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/additional_info/pyneng">Проверка заданий с помощью утилиты pyneng</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#document-book/additional_info/pytest">Проверка заданий с помощью pytest</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-resources/README">Продолжение обучения</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id2">Написание скриптов для автоматизации рабочих процессов</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#python">Python для автоматизации работы с сетевым оборудованием</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id3">Python без привязки к сетевому оборудованию</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-testimonials">Отзывы читателей книги и слушателей курса</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id2">Ян Коробов</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id3">Сергей Забабурин</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id4">Александр Романов</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id5">Денис Карпушин</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id6">Евгений Овчинников</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id7">Олег Востриков</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id8">Эмиль Гарипов</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id9">Илья про книгу</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id10">Алексей Кириллов про онлайн курс</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id11">Слава Скороход про онлайн курс</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id12">Марат Сибгатулин про онлайн курс</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id13">Кирилл Плетнёв про книгу</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html#id14">Алексей про книгу</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contents.html#document-download">Скачать PDF/Epub</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="contents.html#document-contents">Python для сетевых инженеров</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="contents.html#document-contents">Docs</a> &raquo;</li>
        
      <li>Документация Python для сетевых инженеров 3.0</li>
    
    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="python">
<h1>Python для сетевых инженеров<a class="headerlink" href="#python" title="Ссылка на этот заголовок">¶</a></h1>
<p>В книге рассматриваются основы Python с примерами и заданиями построенными на сетевой тематике.</p>
<p>С одной стороны, книга достаточно базовая, чтобы её мог одолеть любой желающий, а с другой стороны, в книге рассматриваются все основные темы, которые позволят дальше расти самостоятельно. Книга не ставит своей целью глубокое рассмотрение Python. Задача книги – объяснить понятным языком основы Python и дать понимание необходимых инструментов для его практического использования. Всё, что рассматривается в книге, ориентировано на сетевое оборудование и работу с ним. Это даёт возможность сразу использовать в работе сетевого инженера то, что было изучено на курсе. Все примеры показываются на примере оборудования Cisco, но, конечно же, они применимы и для любого другого оборудования.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В книге используется Python 3.7.</p>
</div>
<p>При желании, вы можете <a class="reference external" href="https://natenka.github.io/thanks/">сказать «спасибо» автору книги</a>.</p>
<div class="toctree-wrapper compound">
<span id="document-intro_index"></span><div class="section" id="id1">
<h2>Введение<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-about"></span><div class="section" id="id1">
<h3>О книге<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h3>
<p>Если «в двух словах», то это такой CCNA по Python. С одной стороны,
книга достаточно базовая, чтобы её мог одолеть любой желающий, а с
другой стороны, в книге рассматриваются все основные темы, которые
позволят дальше расти самостоятельно. Книга не ставит своей целью
глубокое рассмотрение Python. Задача книги – объяснить понятным языком
основы Python и дать понимание необходимых инструментов для его
практического использования. Всё, что рассматривается в книге,
ориентировано на сетевое оборудование и работу с ним. Это даёт
возможность сразу использовать в работе сетевого инженера то, что было
изучено на курсе. Все примеры показываются на примере оборудования
Cisco, но, конечно же, они применимы и для любого другого оборудования.</p>
<div class="section" id="id2">
<h4>Для кого эта книга<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для сетевых инженеров с опытом программирования и без. Все примеры и
домашние задания будут построены с уклоном на сетевое оборудование. Эта
книга будет полезна сетевым инженерам, которые хотят автоматизировать
задачи, с которыми сталкиваются каждый день и хотели заняться
программированием, но не знали, с какой стороны подойти.</p>
<p>Ещё не решили, нужно ли читать книгу? Почитайте
<a class="reference internal" href="contents.html#testimonials"><span class="std std-ref">отзывы</span></a>.</p>
</div>
<div class="section" id="id3">
<h4>Зачем Вам учиться программировать?<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Знание программирования для сетевого инженера сравнимо со знанием
английского. Если вы знаете английский хотя бы на уровне, который
позволяет читать техническую документацию, вы сразу же расширяете свои
возможности:</p>
<ul class="simple">
<li>доступно в несколько раз больше литературы, форумов и блогов;</li>
<li>практически для любого вопроса или проблемы достаточно быстро
находится решение, если вы ввели запрос в Google.</li>
</ul>
<p>Знание программирования в этом очень похоже. Если вы знаете, например,
Python хотя бы на базовом уровне, вы уже открываете массу новых
возможностей для себя. Аналогия с английским подходит ещё и потому, что
можно работать сетевым инженером и быть хорошим специалистом без знания
английского. Английский просто даёт возможности, но он не является
обязательным требованием.</p>
</div>
<div class="section" id="python">
<h4>Требуемые версии ОС и Python<a class="headerlink" href="#python" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все примеры и выводы терминала в книге показываются на Debian Linux. В
книге используется Python 3.7, но для большинства примеров подойдет и
Python 3.x. Только в некоторых примерах требуется версия 3.6 или
выше чем 3.5. Это всегда явно указано и, как правило, касается
дополнительных возможностей.</p>
</div>
<div class="section" id="id4">
<h4>Примеры<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все примеры, которые используются в книге, располагаются в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises">репозитории</a>.
Примеры, которые рассматриваются в разделах книги, являются обучающими.
Это значит, что они не обязательно показывают лучший вариант решения
задачи, так как они основаны только на той информации, которая
рассматривалась в предыдущих главах книги. Кроме того, довольно часто
примеры, которые давались в разделах, развиваются в заданиях. То есть, в
заданиях вам нужно будет сделать лучшую, более универсальную, и, в
целом, более правильную версию кода. Если есть возможность, лучше
набирать код, который используется в книге, самостоятельно, или, как
минимум, скачать примеры и попробовать что-то в них изменить – так
информация будет лучше запоминаться. Если такой возможности нет,
например, когда вы читаете книгу в дороге, лучше повторить примеры
самостоятельно позже. В любом случае, обязательно нужно делать задания
вручную.</p>
</div>
<div class="section" id="id5">
<h4>Задания<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises">репозитории</a>,
том же, где располагаются примеры кода. Если в заданиях раздела есть
задания с буквами (например, 5.2a), то нужно выполнить сначала задания
без букв, а затем с буквами. Задания с буквами, как правило, немного
сложнее заданий без букв и развивают идею в соответствующем задании без
буквы. Если получается, лучше делать задания по порядку. В книге
специально не приведены ответы на задания, так как, к сожалению, когда
есть ответы, очень часто вместо того, чтобы попытаться решить сложное
задание самостоятельно, подглядывают в них. Конечно, иногда возникает
ситуация, когда никак не получается решить задание – попробуйте отложить
его, задать вопрос в <a class="reference external" href="https://join.slack.com/t/pyneng/shared_invite/enQtNzkyNTYwOTU5Njk5LWE4OGNjMmM1ZTlkNWQ0N2RhODExZDA0OTNhNDJjZDZlOTZhOGRiMzIyZjBhZWYzYzc3MTg3ZmQzODllYmQ4OWU">Slack</a> и
сделать какое-либо другое.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">На <a class="reference external" href="https://stackoverflow.com">Stack Overflow</a> есть ответы
практически на любые вопросы. Так что, если Google отправил Вас на
него, это, с большой вероятностью значит, что ответ найден. Запросы,
конечно же, лучше писать на английском – по Python очень много
материалов и, как правило, подсказку найти легко</p>
</div>
<p>Ответы могли бы показать, как ещё можно выполнить задание или же как
лучше это сделать. Но на этот счёт не следует переживать, так как,
скорее всего, в следующих разделах встретится пример, в котором будет
показано, как писать такой код.</p>
</div>
<div class="section" id="id6">
<h4>Вопросы<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для части тем книги созданы вопросы:</p>
<ul class="simple">
<li><a class="reference external" href="https://goo.gl/forms/xKHX5xNM8Pv5sQDf2">Типы данных. Часть 1</a></li>
<li><a class="reference external" href="https://goo.gl/forms/igxR3ub3tQg3ycX53">Типы данных. Часть 2</a></li>
<li><a class="reference external" href="https://goo.gl/forms/2TmGcrhG11h2SdLn1">Контроль хода программы. Часть
1</a></li>
<li><a class="reference external" href="https://goo.gl/forms/KZGaDquGlUmOz2kG3">Контроль хода программы. Часть
2</a></li>
<li><a class="reference external" href="https://goo.gl/forms/M1DpbdD0brVbdp1G3">Функции и модули. Часть
1</a></li>
<li><a class="reference external" href="https://goo.gl/forms/rNvdX9bHw8wLajJp2">Функции и модули. Часть
2</a></li>
<li><a class="reference external" href="https://goo.gl/forms/5UpkJbm1dORqs4bP2">Регулярные выражения. Часть
1</a></li>
<li><a class="reference external" href="https://goo.gl/forms/ltuOAO62yLlZkEmm1">Регулярные выражения. Часть
2</a></li>
<li><a class="reference external" href="https://goo.gl/forms/wtGgmWg0vow1Cyqo1">Базы данных</a></li>
</ul>
<p>Эти вопросы можно использовать как для проверки знаний, так и в роли
заданий. Очень полезно поотвечать на вопросы после прочтения соответствующей темы.
Они позволят вам вспомнить материал темы, а также увидеть на практике
разные аспекты работы с Python. Постарайтесь сначала ответить
самостоятельно, а затем подсмотреть ответы в IPython по тем вопросам, в
которых вы сомневаетесь.</p>
</div>
<div class="section" id="id7">
<h4>Презентации<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для всех тем книги есть презентации в
<a class="reference external" href="https://github.com/natenka/pyneng-slides">репозитории</a>. По ним
удобно быстро просматривать информацию и повторять. Если вы знаете
основы Python, то стоит их пролистать.</p>
<p>Скачать все презентации в формате PDF можно в специальном
<a class="reference external" href="https://github.com/natenka/pyneng-slides/tree/py3-pdf">репозитории</a></p>
</div>
<div class="section" id="id8">
<h4>Форматы файлов книги<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h4>
<p>Книгу можно скачать в двух форматах: PDF, Epub.
Они автоматически обновляются, поэтому всегда содержат одинаковую
информацию.</p>
</div>
<div class="section" id="id9">
<h4>Обсуждение<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для обсуждения книги, заданий, а также связанных вопросов используется
<a class="reference external" href="https://pyneng-slack.herokuapp.com">Slack</a>. Все вопросы, предложения
и замечания по книге также пишите в
<a class="reference external" href="https://pyneng-slack.herokuapp.com">Slack</a>.</p>
</div>
</div>
<span id="document-faq"></span><div class="section" id="faq">
<h3>Часто задаваемые вопросы (FAQ)<a class="headerlink" href="#faq" title="Ссылка на этот заголовок">¶</a></h3>
<p>Здесь собраны вопросы, которые наиболее часто возникают при чтении
книги.</p>
<div class="section" id="id1">
<h4>Будет ли печатная версия книги?<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Нет. Книга существует в каком-то виде с 2015 года. Все это время книга
менялась. Мне нравится эта возможность менять книгу, писать что-то
по-другому.</p>
</div>
<div class="section" id="x">
<h4>Почему в книге нет темы X?<a class="headerlink" href="#x" title="Ссылка на этот заголовок">¶</a></h4>
<p>Полезных тем еще огромное количество и просто невозможно все их вместить в одну
книгу. Конечно, у каждого читателя есть приоритеты и кажется именно этот
модуль очень нужен всем, но таких тем/модулей очень много.
Глобально в книге уже ничего не будет менятся, новые темы добавляться не будут.</p>
</div>
<div class="section" id="python">
<h4>Чем это отличается от обычного вводного курса по Python?<a class="headerlink" href="#python" title="Ссылка на этот заголовок">¶</a></h4>
<p>Основных отличий три:</p>
<ul class="simple">
<li>основы даются достаточно коротко;</li>
<li>подразумевается определённая предметная область знаний (сетевое
оборудование);</li>
<li>все примеры, по возможности, ориентированы на сетевое оборудование.</li>
</ul>
</div>
<div class="section" id="id2">
<h4>Я сетевик. Для чего мне нужна эта книга?<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>В первую очередь – для автоматизации рутинных задач. Автоматизация даёт
несколько преимуществ:</p>
<ul class="simple">
<li>высокоуровневое мышление – проще подняться над всем, когда вы
свободны от рутинной работы. У Вас появится время и возможность
думать об улучшениях;</li>
<li>доверие – вы не будете бояться делать изменения, которые, как
правило, сопряжены с риском, так как сеть это основа работы всех
приложений и цена ошибки высока;</li>
<li>консистентная конфигурация – вы сможете автоматизированно создавать
файлы настроек сетевого оборудования, от пользователей и подписей
интерфейсов до функционала безопасности, и будете меньше переживать о
том, забыли ли вы нечто.</li>
</ul>
<p>Конечно, не будет такого, что после прочтения книги, вы «всё
автоматизируете и наступит счастье», но это шаг в данном направлении. Я
ни в коем случае не агитирую за то, чтобы автоматизация выполнялась
кучей самописных скриптов. Если есть софт, который решает нужные Вам
задачи, это отлично, используйте его. Но если его нет, или если вы
просто ещё о таком не думали, попробуйте начать с простого – Ansible,
например, позволит выполнять многие задачи практически «из коробки».</p>
<p>Зачем тогда учить Python? Дело в том, что тот же Ansible не решит все
вопросы. И, возможно, вам понадобится добавить какой-то функционал
самостоятельно. Кроме непосредственной настройки оборудования, есть
ежедневные рутинные задачи, которые можно автоматизировать с помощью
Python. Скажем так, если вы не хотите разбираться с Python, но хотите
автоматизировать процесс настройки и работы с оборудованием, обратите
своё внимание на Ansible. Даже «из коробки» он будет очень полезен. Если
же вы потом войдете во вкус и захотите добавить своё, чего нет в
Ansible, возвращайтесь :-)</p>
<p>И ещё, этот курс не только о том, как использовать Python для
подключения к оборудованию и его настройке. Он и о том, как решать
задачи, которые не касаются подключения к оборудованию, например,
изменить что-то в нескольких файлах конфигурации, или обработать
log-файл – Python поможет вам решать в том числе и подобные задачи.</p>
</div>
<div class="section" id="id3">
<h4>Почему книга именно для сетевых инженеров?<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Есть несколько причин:</p>
<ul class="simple">
<li>сетевые инженеры уже обладают опытом работы в ИТ, и часть концепций
им знакома, и, скорее всего, какие-то основы программирования
большинству уже будут знакомы. Это означает, что будет гораздо проще
разобраться с Python;</li>
<li>работа в командной строке и написание скриптов вряд ли испугает их;</li>
<li>у сетевых инженеров есть знакомая им предметная область, на которую
можно опираться при составлении примеров и заданий.</li>
</ul>
<p>Если рассказывать на абстрактных примерах «о котиках и зайчиках», это
одно. Но когда в примерах есть возможность использовать идеи из
предметной области, всё становится проще, рождаются конкретные идеи, как
улучшить какую-либо программу, скрипт. А когда человек пытается её
улучшить, он начинает разбираться с новым - это очень сильно помогает
продвигаться вперёд.</p>
</div>
<div class="section" id="id4">
<h4>Почему именно Python?<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Причины следующие:</p>
<ul class="simple">
<li>в контексте работы с сетевым оборудованием, сейчас часто используется
именно Python;</li>
<li>на некотором оборудовании Python встроен или есть API, который
поддерживает Python;</li>
<li>Python достаточно прост для изучения (конечно, это относительно, и
более простым может казаться другой язык, но, скорее, это будет из-за
имеющегося опыта работы с языком, а не потому, что Python сложный);</li>
<li>с Python вы вряд ли быстро дойдете до границ возможностей языка;</li>
<li>Python может использоваться не только для написания скриптов, но и
для разработки приложений. Разумеется, это не является задачей этой
книги, но, по крайней мере, вы потратите время на язык, который
позволит вам легко шагнуть дальше, чем написание простых скриптов;</li>
<li>из программ, связанных с сетями, на Python написан, например,
<a class="reference external" href="https://github.com/GNS3/">GNS3</a>.</li>
</ul>
<p>И еще один момент – в контексте книги, Python нужно рассматривать не как
единственно правильный вариант, и не как «правильный» язык. Нет, Python
это просто инструмент, как отвёртка например, и мы учимся им
пользоваться для конкретных задач. То есть, никакой идеологической
подоплеки здесь нет, никакого «только Python» и никакого поклонения тем
более. Странно поклоняться отвертке :-) Всё просто - есть хороший и
удобный инструмент, который подойдет к разным задачам. Он не лучший во
всём и далеко не единственный язык в принципе. Начните с него, и потом
вы сможете самостоятельно выбрать нечто другое, если захотите – эти
знания всё равно не пропадут.</p>
</div>
<div class="section" id="python-3">
<h4>Нужный мне модуль не поддерживает Python 3<a class="headerlink" href="#python-3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Есть несколько вариантов решения:</p>
<ul class="simple">
<li>попробуйте найти альтернативный модуль, который поддерживает Python 3
(не обязательно последней версии языка);</li>
<li>попробуйте найти community-версию этого модуля для Python 3.
Возможно, официальной версии нет, но сообщество могло перевести его
самостоятельно на версию 3, особенно если этот модуль популярен;</li>
<li>используйте Python 2.7, ничего страшного не произойдет. Если вы не
собираетесь писать огромное приложение, а просто используете Python
для автоматизации своих задач, Python 2.7 совершенно точно подойдет.</li>
</ul>
</div>
<div class="section" id="id5">
<h4>Я не знаю, нужно ли мне это.<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<p>Я, конечно же, считаю, что нужно :-) Иначе я бы не писала эту книгу.
Совсем не факт, что вам захочется погружаться во всё это, поэтому для
начала попробуйте разобраться с <a class="reference external" href="book/Part_VI.md">Ansible</a>. Возможно,
вам хватит надолго его возможностей. Начните с простых команд show,
попробуйте подключиться сначала к тестовому оборудованию (виртуальным
машинам), затем попробуйте выполнить команду show на реальной сети, на
2-3 устройствах, потом на большем количестве. Если вам этого будет
достаточно, можно остановиться на этом. Следующим шагом я бы попробовала
использование Ansible для генерации шаблонов конфигурации.</p>
</div>
<div class="section" id="id6">
<h4>Зачем сетевому инженеру программирование?<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h4>
<p>На мой взгляд, для сетевого инженера умение программировать очень важно,
и не потому, что сейчас все об этом говорят, или пугают SDN, потерей
работы или чем-то подобным, а потому, что сетевой инженер постоянно
сталкивается с:</p>
<ul class="simple">
<li>рутинными задачами;</li>
<li>проблемами и решениями, которые надо протестировать;</li>
<li>большим объёмом однотипных и повторяющихся задач;</li>
<li>большим количеством оборудования;</li>
</ul>
<p>На текущий момент большое количество оборудования по-прежнему предлагает
нам только интерфейс командной строки и неструктурированный вывод
команд. Управляющий софт часто ограничен вендором, дорого стоит и имеет
урезанные возможности – в итоге мы вручную снова и снова делаем одно и
то же. Даже такие банальные вещи, как отправить одну и ту же команду
show на 20 устройств, не всегда просто сделать. Допустим, ваш SSH-клиент
поддерживает эту возможность. А если вам теперь надо проанализировать
вывод? Мы ограничены теми средствами, которые нам дали, а знание
программирования, даже самое базовое, позволяет нам расширить наши
средства и даже создавать новые. Я не считаю, что всем надо торопиться
учиться программировать, но для инженера это очень важный навык. Именно
для инженера, а не для всех на свете.</p>
<p>Сейчас явно наблюдается тенденция, которую можно описать фразой «все
учимся программировать», и это, в целом, хорошо. Но программирование это
не что-то элементарное, это сложно, в это нужно вкладывать много
времени, особенно если вы никогда не имели отношения к техническому
миру. Может сложиться впечатление, что достаточно пройти «вот эти вот
курсы» и через 3 месяца вы крутой программист с высокой зарплатой. Нет,
этот книга не об этом :-) Мы не говорим в ней о программировании как
профессии и не ставим такую цель, мы говорим о программировании как
инструменте, таком как, например, знание CLI Linux. Дело не в том, что
инженеры какие-то особенные, просто, как правило:</p>
<ul class="simple">
<li>они уже имеют техническое образование;</li>
<li>многие работают, так или иначе, с командной строкой;</li>
<li>они сталкивались, как минимум, с одним языком программирования;</li>
<li>у них «инженерный склад ума».</li>
</ul>
<p>Это не значит, что всем остальным «не дано». Просто инженерам это будет
проще.</p>
</div>
<div class="section" id="id7">
<h4>Книга будет когда-то платной?<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h4>
<p>Нет, эта книга всегда будет бесплатной. Я читаю платно <a class="reference external" href="https://natenka.github.io/pyneng-online/">онлайн курс
«Python для сетевых
инженеров»</a>, но это не
будет влиять на эту книгу - она всегда будет бесплатной.</p>
</div>
</div>
<span id="document-acknowledgments"></span><div class="section" id="id1">
<h3>Благодарности<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h3>
<p>Спасибо всем, кто проявил интерес к первому анонсу курса – ваш интерес
подтвердил, что это будет кому-то нужно.</p>
<p>Павел Пасынок, спасибо тебе за то, что согласился на курс.
С вами было интересно работать, и это добавило мне мотивации завершить
курс, и я особенно рада, что знания,
которые вы получили на курсе, нашли практическое применение.</p>
<p>Алексей Кириллов, самое большое спасибо тебе :-) Я всегда могла обсудить с тобой
любой вопрос по курсу. Ты помогал мне поддерживать мотивацию и не
уходить в дебри. Общение с тобой вдохновляло меня продолжать, особенно в
сложные моменты. Спасибо тебе за вдохновение, положительные эмоции и
поддержку!</p>
<p>Спасибо всем, кто писал комментарии к книге – благодаря вам в
книге не только стало меньше опечаток и ошибок, но и содержание книги
стало лучше.</p>
<p>Спасибо всем слушателям онлайн-курса – благодаря вашим
вопросам книга стала намного лучше.</p>
<p>Слава Скороход, спасибо тебе
огромное, что вызвался быть редактором – количество ошибок теперь
стремится к нулю :-)</p>
</div>
</div>
</div>
<span id="document-book_links"></span><div class="section" id="id1">
<h2>Ресурсы для обучения по книге<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h2>
<p>Ресурсы, которые пригодятся в процессе обучения:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозиторий с примерами, заданиями</a></li>
<li><a class="reference external" href="https://github.com/natenka/pyneng-answers/">репозиторий с ответами</a></li>
<li><a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/tree/master/tests">вопросы (мини-задания)</a></li>
<li><a class="reference external" href="https://join.slack.com/t/pyneng/shared_invite/enQtNzkyNTYwOTU5Njk5LWE4OGNjMmM1ZTlkNWQ0N2RhODExZDA0OTNhNDJjZDZlOTZhOGRiMzIyZjBhZWYzYzc3MTg3ZmQzODllYmQ4OWU">в чате slack PyNEng можно задать вопросы</a></li>
</ul>
<div class="section" id="id2">
<h3>Подготовка рабочего окружения<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h3>
<p>Для выполнения заданий книги можно использовать несколько вариантов:</p>
<ul class="simple">
<li>взять подготовленную виртуалку vmware или vagrant (virtualbox)</li>
<li>подготовить виртуалку самостоятельно</li>
<li>использовать вм или какой-то сервис в облаке</li>
<li>работать без создания виртуальной машины</li>
</ul>
<p>Подробнее о подготовке рабочего окружения <a class="reference internal" href="contents.html#working-env"><span class="std std-ref">Подготовка рабочего окружения</span></a>.</p>
</div>
<div class="section" id="id3">
<h3>Задания<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h3>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.
Задания продублированы в книге исключительно для удобного обзора всех заданий раздела.
Так как все вспомогательные файлы, код и тесты находятся в репозитории заданий,
лучше делать задания в копии репозитория. Как сделать копию описано
во <a class="reference external" href="https://pyneng.readthedocs.io/ru/latest/book/02_git_github/git_github_changes.html">втором разделе</a>.</p>
<p>Иногда, какой-то раздел может оказаться особенно сложным, в этом случае, можно остановиться на минимуме заданий.
Это позволит двигаться дальше и не забрасывать учебу. А позже можно вернуться и доделать задания.
В целом, конечно лучше делать все задания, так как практика это единственный способ нормально разобраться
с темой, но иногда лучше сделать меньше заданий и продолжать учебу, чем застрять на одной теме и забросить все.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="30%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Раздел</th>
<th class="head">Минимум заданий</th>
<th class="head">Все задания</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>04_data_structures</td>
<td>4.1, 4.2, 4.3, 4.6</td>
<td>4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8</td>
</tr>
<tr class="row-odd"><td>05_basic_scripts</td>
<td>5.1, 5.1a, 5.2, 5.2a</td>
<td>5.1, 5.1a, 5.1b, 5.1c, 5.1d, 5.2, 5.2a, 5.3, 5.3a</td>
</tr>
<tr class="row-even"><td>06_control_structures</td>
<td>6.1, 6.2, 6.3</td>
<td>6.1, 6.2, 6.2a, 6.2b, 6.3</td>
</tr>
<tr class="row-odd"><td>07_files</td>
<td>7.1, 7.2, 7.3</td>
<td>7.1, 7.2, 7.2a, 7.2b, 7.2c, 7.3, 7.3a, 7.3b</td>
</tr>
<tr class="row-even"><td>09_functions</td>
<td>9.1, 9.1a, 9.2, 9.2a, 9.3</td>
<td>9.1, 9.1a, 9.2, 9.2a, 9.3, 9.3a, 9.4</td>
</tr>
<tr class="row-odd"><td>11_modules</td>
<td>11.1, 11.2</td>
<td>11.1, 11.2</td>
</tr>
<tr class="row-even"><td>12_useful_modules</td>
<td>12.1, 12.2</td>
<td>12.1, 12.2, 12.3</td>
</tr>
<tr class="row-odd"><td>15_module_re</td>
<td>15.1, 15.2, 15.3, 15.4</td>
<td>15.1, 15.1a, 15.1b, 15.2, 15.2a, 15.3, 15.4, 15.5</td>
</tr>
<tr class="row-even"><td>17_serialization</td>
<td>17.1, 17.2, 17.3</td>
<td>17.1, 17.2, 17.3, 17.3a, 17.3b, 17.4</td>
</tr>
<tr class="row-odd"><td>18_ssh_telnet</td>
<td>18.1, 18.1a, 18.2, 18.2a, 18.2b, 18.3</td>
<td>18.1, 18.1a, 18.1b, 18.2, 18.2a, 18.2b, 18.2c, 18.3</td>
</tr>
<tr class="row-even"><td>19_concurrent_connections</td>
<td>19.1, 19.2, 19.3</td>
<td>19.1, 19.2, 19.3, 19.3a, 19.4</td>
</tr>
<tr class="row-odd"><td>20_jinja2</td>
<td>20.1, 20.2, 20.3</td>
<td>20.1, 20.2, 20.3, 20.4, 20.5, 20.5a</td>
</tr>
<tr class="row-even"><td>21_textfsm</td>
<td>21.1, 21.1a, 21.2, 21.3, 21.4</td>
<td>21.1, 21.1a, 21.2, 21.3, 21.4, 21.5</td>
</tr>
<tr class="row-odd"><td>22_oop_basics</td>
<td>22.1, 22.1a, 22.1b, 22.2, 22.2a</td>
<td>22.1, 22.1a, 22.1b, 22.1c, 22.1d, 22.2, 22.2a, 22.2b, 22.2c</td>
</tr>
<tr class="row-even"><td>23_oop_special_methods</td>
<td>23.1, 23.1a, 23.2</td>
<td>23.1, 23.1a, 23.2, 23.3, 23.3a</td>
</tr>
<tr class="row-odd"><td>24_oop_inheritance</td>
<td>24.1, 24.2, 24.2a</td>
<td>24.1, 24.1a, 24.2, 24.2a, 24.2b, 24.2c, 24.2d</td>
</tr>
<tr class="row-even"><td>25_db</td>
<td>25.1, 25.2, 25.3</td>
<td>25.1, 25.2, 25.3, 25.4, 25.5, 25.5a, 25.6</td>
</tr>
</tbody>
</table>
<div class="section" id="id4">
<h4>Тесты<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>В <a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории заданий</a>
для проверки заданий есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.</p>
<p><a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">Как работать с тестами</span></a>.</p>
</div>
</div>
<div class="section" id="id5">
<h3>Дополнительные материалы<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h3>
<p>Почти в каждой части книги есть глава «Дополнительные материалы», в
которой находятся полезные материалы и ссылки по теме, а также ссылки на
документацию. Кроме того, я сделала
<a class="reference external" href="https://natenka.github.io/pyneng-resources/">подборку</a> ресурсов по
Python для сетевых инженеров, где можно найти много полезных статей,
книг, видео курсов и подкастов.</p>
</div>
</div>
<span id="document-book/Part_I"></span><div class="section" id="i-python">
<h2>I. Основы Python<a class="headerlink" href="#i-python" title="Ссылка на этот заголовок">¶</a></h2>
<p>Первая часть книги посвящена основам Python. В ней рассматриваются:</p>
<ul class="simple">
<li>типы данных Python;</li>
<li>как создавать базовые скрипты;</li>
<li>контроль хода программы;</li>
<li>работа с файлами.</li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-book/01_intro/index"></span><div class="section" id="intro-index">
<span id="id1"></span><h3>1. Подготовка к работе<a class="headerlink" href="#intro-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>Для того, чтобы начать работать с Python, надо определиться с
несколькими вещами:</p>
<ul class="simple">
<li>какая операционная система будет использоваться</li>
<li>какой редактор будет использоваться</li>
<li>какая версия Python будет использоваться</li>
</ul>
<p>В книге используется Debian Linux (в других ОС вывод может незначительно
отличаться) и Python 3.7.</p>
<p>Ещё один важный момент – выбор редактора. В следующем разделе приведены
примеры редакторов для разных ОС. Вместо редактора можно использовать
IDE. IDE это хорошая вещь, но не стоит переходить на IDE из-за таких
вещей как:</p>
<ul class="simple">
<li>подсветка кода</li>
<li>подсказки синтаксиса</li>
<li>автоматические отступы (важно для Python)</li>
</ul>
<p>Всё это есть в любом хорошем редакторе, но для этого может потребоваться
установить дополнительные модули. В начале работы может получиться так,
что IDE будет только отвлекать вас обилием возможностей. Список IDE для
Python можно можно посмотреть
<a class="reference external" href="https://wiki.python.org/moin/IntegratedDevelopmentEnvironments/">здесь</a>.
Например, можно выбрать <a class="reference external" href="http://www.jetbrains.com/pycharm/">PyCharm</a>
или Spyder для Windows.</p>
<div class="toctree-wrapper compound">
<span id="document-book/01_intro/work_env"></span><div class="section" id="working-env">
<span id="id1"></span><h4>Подготовка рабочего окружения<a class="headerlink" href="#working-env" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для выполнения заданий книги можно использовать несколько вариантов:</p>
<ul class="simple">
<li>взять подготовленную виртуалку vmware или vagrant (virtualbox)</li>
<li>подготовить виртуалку самостоятельно</li>
<li>использовать вм или какой-то сервис в облаке</li>
<li>работать без создания виртуальной машины</li>
</ul>
<div class="section" id="vm">
<h5>Подготовленные VM<a class="headerlink" href="#vm" title="Ссылка на этот заголовок">¶</a></h5>
<p>Подготовлены виртуальные машины, в которых установлены:</p>
<ul class="simple">
<li>Debian 9.9</li>
<li>Python 3.7 и 3.8 в виртуальном окружении</li>
<li>IPython и другие модули, которые потребуются для выполнения заданий</li>
<li>текстовые редакторы vim, Geany, Mu</li>
<li>GNS3 для работы с сетевым оборудованием</li>
</ul>
<p>Есть два варианта подготовленных виртуальных машин (по ссылкам инструкции для каждого варианта, в которых есть ссылки на образ и инструкция как работать с GNS3):</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.google.com/document/d/1tIb8prINPM7uhyFxIhSSIF1-jckN_OWkKaO8zHQus9g/edit?usp=sharing">vagrant</a></li>
<li><a class="reference external" href="https://drive.google.com/open?id=1r7Si9xTphdWp79sKxDhVk2zjWGggfy5Z6h8cKCLP5Cs">vmware</a></li>
</ul>
</div>
<div class="section" id="id2">
<h5>Подготовка виртуальной машины/хоста самостоятельно<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://pyneng.github.io/docs/pynenglinux/">Инструкция для подготовки Linux</a></li>
<li><a class="reference external" href="https://natenka.github.io/pyneng/pyneng-on-windows/">Нюансы подготовки и выполнения заданий на Windows</a></li>
</ul>
<p>Список модулей, которые нужно установить:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pytest</span> <span class="n">pytest</span><span class="o">-</span><span class="n">clarity</span> <span class="n">pyyaml</span> <span class="n">tabulate</span> <span class="n">jinja2</span> <span class="n">textfsm</span> <span class="n">pexpect</span> <span class="n">netmiko</span> <span class="n">graphviz</span>
</pre></div>
</div>
<p>Также надо установить graphviz принятым способом в ОС (пример для debian):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">graphviz</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Облачные сервисы<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Ещё один вариант – использовать один из следующих сервисов:</p>
<ul class="simple">
<li><a class="reference external" href="https://repl.it/">repl.it</a> – этот сервис предоставляет
онлайн-интерпретатор Python, а также графический редактор. <a class="reference external" href="https://repl.it/KSIp/3/">Пример
использования</a>.</li>
<li><a class="reference external" href="https://www.pythonanywhere.com/">PythonAnywhere</a> - выделяет
отдельную виртуалку, но в бесплатном варианте вы можете работать
только из командной строки, то есть, нет графического текстового
редактора;</li>
</ul>
</div>
<div class="section" id="id4">
<h5>Сетевое оборудование<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>К 18 разделу книги, нужно подготовить виртуальное или реальное сетевое оборудование.</p>
<p>Все примеры и задания, в которых встречается сетевое оборудование, используют
одинаковое количество устройств: три маршрутизатора с такими базовыми настройками:</p>
<ul class="simple">
<li>пользователь: cisco</li>
<li>пароль: cisco</li>
<li>пароль на режим enable: cisco</li>
<li>SSH версии 2 (обязательно именно версия 2), Telnet</li>
<li>IP-адреса маршрутизаторов: 192.168.100.1, 192.168.100.2, 192.168.100.3</li>
<li>IP-адреса должны быть доступны из виртуалки на которой вы выполняете задания
и могут быть назначены на физических/логических/loopback интерфейсах</li>
</ul>
<p>Топология может быть произвольной. Пример топологии:</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/pyneng/pyneng.github.io/master/assets/images/gns3_network.png" src="https://raw.githubusercontent.com/pyneng/pyneng.github.io/master/assets/images/gns3_network.png" />
</div>
<p>Базовый конфиг:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>hostname R1
!
no ip domain lookup
ip domain name pyneng
!
crypto key generate rsa modulus 1024
ip ssh version 2
!
username cisco password cisco
enable secret cisco
!
line vty 0 4
 logging synchronous
 login local
 transport input telnet ssh
</pre></div>
</div>
<p>На каком-то интерфейсе надо настроить IP-адрес</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="o">...</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
</pre></div>
</div>
<p>Алиасы (по желанию)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!
alias configure sh do sh
alias exec ospf sh run | s ^router ospf
alias exec bri show ip int bri | exc unass
alias exec id show int desc
alias exec top sh proc cpu sorted | excl 0.00%__0.00%__0.00%
alias exec c conf t
alias exec diff sh archive config differences nvram:startup-config system:running-config
alias exec desc sh int desc | ex down
alias exec bgp sh run | s ^router bgp
</pre></div>
</div>
<p>При желании можно настроить <a class="reference external" href="http://xgu.ru/wiki/Embedded_Event_Manager">EEM applet</a>
для отображения команд, которые вводит пользователь:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!
event manager applet COMM_ACC
 event cli pattern &quot;.*&quot; sync no skip no occurs 1
 action 1 syslog msg &quot;User $_cli_username entered $_cli_msg on device $_cli_host &quot;
!
</pre></div>
</div>
</div>
</div>
<span id="document-book/01_intro/os_and_editor"></span><div class="section" id="id1">
<h4>ОС и редактор<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Можно выбрать любую ОС и любой редактор, но желательно использовать
Python версии 3.7, так как в книге используется именно эта версия.</p>
<p>Все примеры в книге выполнялись на Debian, на других ОС вывод может незначительно отличаться.
Для выполнения заданий из книги можно использовать Linux, macOS или Windows.
Однако, стоит учитывать, что, например, Ansible можно установить только на Linux/macOS.</p>
<p>Для работы с Python можно выбрать любой текстовый редактор или IDE, который поддерживает Python. Как правило, для работы с Python требуется минимум настройки редактора и часто редактор по умолчанию распознает Python.</p>
<div class="section" id="mu">
<h5>Редактор Mu<a class="headerlink" href="#mu" title="Ссылка на этот заголовок">¶</a></h5>
<p>Отдельно стоит упомянуть <a class="reference external" href="https://codewith.mu/">редактор Mu</a>: это редактор для начинающих изучать Python (он поддерживает только Python).</p>
<p>С одной стороны, в нём нет ничего лишнего, что поначалу может сильно отвлекать и путать. В то же время, в нём есть такие важные функции как проверка кода на соблюдение PEP 8 и debugger. Плюс, Mu работает на разных ОС (macOS, Windows, Linux).</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Записи лекций по редактору Mu:
<a class="reference external" href="https://youtu.be/9qH92jz0p58">Основы работы с Mu</a>,
<a class="reference external" href="https://youtu.be/s9Lskg37xss">Использование debugger в  Mu</a></p>
</div>
</div>
<div class="section" id="ide-pycharm">
<h5>IDE PyCharm<a class="headerlink" href="#ide-pycharm" title="Ссылка на этот заголовок">¶</a></h5>
<p><a class="reference external" href="https://www.jetbrains.com/pycharm/">PyCharm</a> — интегрированная среда разработки для Python. Для начинающих изучать язык может оказаться сложным вариантом из-за обилия настроек, но это зависит от личных предпочтений.
В PyCharm поддерживается огромное количество возможностей, даже в бесплатной версии.</p>
<p>PyCharm прекрасный IDE, но, на мой взгляд, он сложноват для начинающих. Я бы не советовала использовать его, если вы с ним не знакомы и только начинаете учить Python. Вы всегда сможете перейти на него после книги, но пока что лучше попробовать что-то другое.</p>
</div>
<div class="section" id="geany">
<h5>Geany<a class="headerlink" href="#geany" title="Ссылка на этот заголовок">¶</a></h5>
<p><a class="reference external" href="https://www.geany.org/">Geany</a> - текстовый редактор, который поддерживает разные языки программирования, среди них Python. Также является кроссплатформенным редактором и поддерживает ОС Linux, macOS, Windows.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Варианты редакторов выше приведены для примера, вместо них можно использовать любой
текстовый редактор, который поддерживает Python.</p>
</div>
</div>
</div>
<span id="document-book/01_intro/pip"></span><div class="section" id="pip">
<h4>Система управления пакетами pip<a class="headerlink" href="#pip" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для установки пакетов Python будет использоваться pip. Это система
управления пакетами, которая используется для установки пакетов из
Python Package Index (PyPI). Скорее всего, если у вас уже установлен
Python, то установлен и pip.</p>
<p>Проверка версии pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip --version
pip 19.1.1 from /home/vagrant/venv/pyneng-py3-7/lib/python3.7/site-packages/pip (python 3.7)
</pre></div>
</div>
<p>Если команда выдала ошибку, значит, pip не установлен. Установка pip
описана в <a class="reference external" href="https://pip.pypa.io/en/stable/installing/">документации</a></p>
<div class="section" id="id1">
<h5>Установка модулей<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для установки модулей используется команда <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install tabulate
</pre></div>
</div>
<p>Удаление пакета выполняется таким образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip uninstall tabulate
</pre></div>
</div>
<p>Кроме того, иногда необходимо обновить пакет:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install --upgrade tabulate
</pre></div>
</div>
</div>
<div class="section" id="pip-pip3">
<h5>pip или pip3<a class="headerlink" href="#pip-pip3" title="Ссылка на этот заголовок">¶</a></h5>
<p>В зависимости от того, как установлен и настроен Python в системе, может
потребоваться использовать pip3 вместо pip. Чтобы проверить, какой
вариант используется, надо выполнить команду <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">--version</span></code>.</p>
<p>Вариант, когда pip соответствует Python 2.7:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip --version
pip 9.0.1 from /usr/local/lib/python2.7/dist-packages (python 2.7)
</pre></div>
</div>
<p>Вариант, когда pip3 соответствует Python 3.7:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip3 --version
pip 19.1.1 from /home/vagrant/venv/pyneng-py3-7/lib/python3.7/site-packages/pip (python 3.7)
</pre></div>
</div>
<p>Если в системе используется pip3, то каждый раз, когда в книге
устанавливается модуль Python, нужно будет заменить pip на pip3.</p>
<p>Также можно использовать альтернативный вариант вызова pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3.7 -m pip install tabulate
</pre></div>
</div>
<p>Таким образом, всегда понятно для какой именно версии Python
устанавливается пакет.</p>
</div>
</div>
<span id="document-book/01_intro/virtualenv"></span><div class="section" id="id1">
<h4>Виртуальные окружения<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Виртуальные окружения:</p>
<ul class="simple">
<li>позволяют изолировать различные проекты друг от друга;</li>
<li>пакеты, которые нужны разным проектам, находятся в разных местах –
если, например, в одном проекте требуется пакет версии 1.0, а в
другом проекте требуется тот же пакет, но версии 3.1, то они не будут
мешать друг другу;</li>
<li>пакеты, которые установлены в виртуальных окружениях, не перебивают
глобальные пакеты.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В Python есть несколько вариантов для создания виртуальных окружений.
Использовать можно любой из них. Для начала можно использовать virtualenvwrapper,
а затем со временем уже разбираться с тем, какие еще есть варианты.</p>
</div>
<div class="section" id="virtualenvwrapper">
<h5>virtualenvwrapper<a class="headerlink" href="#virtualenvwrapper" title="Ссылка на этот заголовок">¶</a></h5>
<p>Виртуальные окружения создаются с помощью virtualenvwrapper.</p>
<p>Установка virtualenvwrapper с помощью pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo pip3.7 install virtualenvwrapper
</pre></div>
</div>
<p>После установки, в файле .bashrc, находящимся в домашней папке текущего
пользователя, нужно добавить несколько строк:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">VIRTUALENVWRAPPER_PYTHON</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">7</span>
<span class="n">export</span> <span class="n">WORKON_HOME</span><span class="o">=~/</span><span class="n">venv</span>
<span class="o">.</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">virtualenvwrapper</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Если вы используете командный интерпретатор, отличный от bash,
посмотрите, поддерживается ли он в
<a class="reference external" href="http://virtualenvwrapper.readthedocs.io/en/latest/install.html">документации</a>
virtualenvwrapper. Переменная окружения VIRTUALENVWRAPPER_PYTHON
указывает на бинарный файл командной строки Python, WORKON_HOME – на
расположение виртуальных окружений. Третья строка указывает, где
находится скрипт, установленный с пакетом virtualenvwrapper. Для того,
чтобы скрипт virtualenvwrapper.sh выполнился и можно было работать с
виртуальными окружениями, надо перезапустить bash.</p>
<p>Перезапуск командного интерпретатора:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ exec bash
</pre></div>
</div>
<p>Такой вариант может быть не всегда правильным. Подробнее на <a class="reference external" href="http://stackoverflow.com/questions/2518127/how-do-i-reload-bashrc-without-logging-out-and-back-in">Stack
Overflow</a>.</p>
</div>
<div class="section" id="id2">
<h5>Работа с виртуальными окружениями<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создание нового виртуального окружения, в котором Python 3.7
используется по умолчанию:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkvirtualenv --python=/usr/local/bin/python3.7 pyneng
New python executable in PyNEng/bin/python
Installing distribute........................done.
Installing pip...............done.
(pyneng)$
</pre></div>
</div>
<p>В скобках перед стандартным приглашением отображается имя виртуального
окружения. Это означает, что вы находитесь в нём. В virtualenvwrapper по
Tab работает автодополнение имени виртуального окружения. Это особенно
удобно в тех случаях, когда виртуальных окружений много. Теперь в том
каталоге, который был указан в переменной окружения WORKON_HOME, создан
каталог pyneng:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(pyneng)$ ls -ls venv
total 52
....
4 -rwxr-xr-x 1 nata nata   99 Sep 30 16:41 preactivate
4 -rw-r--r-- 1 nata nata   76 Sep 30 16:41 predeactivate
4 -rwxr-xr-x 1 nata nata   91 Sep 30 16:41 premkproject
4 -rwxr-xr-x 1 nata nata  130 Sep 30 16:41 premkvirtualenv
4 -rwxr-xr-x 1 nata nata  111 Sep 30 16:41 prermvirtualenv
4 drwxr-xr-x 6 nata nata 4096 Sep 30 16:42 pyneng
</pre></div>
</div>
<p>Выход из виртуального окружения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(pyneng)$ deactivate
$
</pre></div>
</div>
<p>Для перехода в созданное виртуальное окружение надо выполнить команду
workon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ workon pyneng
(pyneng)$
</pre></div>
</div>
<p>Если необходимо перейти из одного виртуального окружения в другое, то
необязательно делать deactivate, можно перейти сразу через workon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ workon Test
(Test)$ workon pyneng
(pyneng)$
</pre></div>
</div>
<p>Если виртуальное окружение нужно удалить, то надо использовать команду
rmvirtualenv:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rmvirtualenv Test
Removing Test...
$
</pre></div>
</div>
<p>Посмотреть, какие пакеты установлены в виртуальном окружении можно
командой lssitepackages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(pyneng)$ lssitepackages
ANSI.py                                pexpect-3.3-py2.7.egg-info
ANSI.pyc                               pickleshare-0.5-py2.7.egg-info
decorator-4.0.4-py2.7.egg-info         pickleshare.py
decorator.py                           pickleshare.pyc
decorator.pyc                          pip-1.1-py2.7.egg
distribute-0.6.24-py2.7.egg            pxssh.py
easy-install.pth                       pxssh.pyc
fdpexpect.py                           requests
fdpexpect.pyc                          requests-2.7.0-py2.7.egg-info
FSM.py                                 screen.py
FSM.pyc                                screen.pyc
IPython                                setuptools.pth
ipython-4.0.0-py2.7.egg-info           simplegeneric-0.8.1-py2.7.egg-info
ipython_genutils                       simplegeneric.py
ipython_genutils-0.1.0-py2.7.egg-info  simplegeneric.pyc
path.py                                test_path.py
path.py-8.1.1-py2.7.egg-info           test_path.pyc
path.pyc                               traitlets
pexpect                                traitlets-4.0.0-py2.7.egg-info
</pre></div>
</div>
</div>
<div class="section" id="venv">
<h5>Встроенный модуль venv<a class="headerlink" href="#venv" title="Ссылка на этот заголовок">¶</a></h5>
<p>Начиная с версии 3.5, в Python рекомендуется использовать модуль venv
для создания виртуальных окружений:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3.7 -m venv new/pyneng
</pre></div>
</div>
<p>Вместо python3.7 может использоваться python или python3, в зависимости
от того, как установлен Python 3.7. Эта команда создаёт указанный
каталог и все необходимые каталоги внутри него, если они не были
созданы.</p>
<p>Команда создаёт следующую структуру каталогов:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls -ls new/pyneng
total 16
4 drwxr-xr-x 2 vagrant vagrant 4096 Aug 21 14:50 bin
4 drwxr-xr-x 2 vagrant vagrant 4096 Aug 21 14:50 include
4 drwxr-xr-x 3 vagrant vagrant 4096 Aug 21 14:50 lib
4 -rw-r--r-- 1 vagrant vagrant   75 Aug 21 14:50 pyvenv.cfg
</pre></div>
</div>
<p>Для перехода в виртуальное окружение надо выполнить команду:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ source new/pyneng/bin/activate
</pre></div>
</div>
<p>Для выхода из виртуального окружения используется команда deactivate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ deactivate
</pre></div>
</div>
<p>Подробнее о модуле venv в
<a class="reference external" href="https://docs.python.org/3/library/venv.html#module-venv">документации</a>.</p>
</div>
<div class="section" id="id3">
<h5>Установка пакетов<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Например, установим в виртуальном окружении пакет simplejson.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(pyneng)$ pip install simplejson
...
Successfully installed simplejson
Cleaning up...
</pre></div>
</div>
<p>Если перейти в интерпретатор Python и импортировать simplejson, то он доступен
и никаких ошибок нет:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(pyneng)$ python
&gt;&gt;&gt; import simplejson
&gt;&gt;&gt; simplejson
&lt;module &#39;simplejson&#39; from &#39;/home/vagrant/venv/pyneng-py3-7/lib/python3.7/site-packages/simplejson/__init__.py&#39;&gt;
&gt;&gt;&gt;
</pre></div>
</div>
<p>Но если выйти из виртуального окружения и попытаться сделать то же
самое, то такого модуля нет:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(pyneng)$ deactivate

$ python
&gt;&gt;&gt; import simplejson
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
ModuleNotFoundError: No module named &#39;simplejson&#39;
&gt;&gt;&gt;
</pre></div>
</div>
</div>
</div>
<span id="document-book/01_intro/check_python"></span><div class="section" id="python">
<h4>Интерпретатор Python<a class="headerlink" href="#python" title="Ссылка на этот заголовок">¶</a></h4>
<p>Перед началом работы надо проверить, что при вызове интерпретатора
Python вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python
Python 3.7.3 (default, May 13 2019, 15:44:23)
[GCC 4.9.2] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
</pre></div>
</div>
<p>Вывод показывает, что установлен Python 3.7. Приглашение <code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code>, это
стандартное приглашение интерпретатора Python. Вызов интерпретатора
выполняется командой python, а чтобы выйти, нужно набрать <code class="docutils literal notranslate"><span class="pre">quit()</span></code>, либо
нажать Ctrl+D.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В книге, вместо стандартного интерпретатора Python, будет использоваться ipython</p>
</div>
</div>
<span id="document-book/01_intro/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/using/index.html">Python Setup and
Usage</a></li>
<li><a class="reference external" href="https://pip.pypa.io/en/stable/">pip</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/venv.html">venv</a></li>
<li><a class="reference external" href="http://virtualenvwrapper.readthedocs.io/en/latest/index.html">virtualenvwrapper</a></li>
</ul>
<p>Редакторы и IDE:</p>
<ul class="simple">
<li><a class="reference external" href="https://wiki.python.org/moin/PythonEditors/">PythonEditors</a></li>
<li><a class="reference external" href="https://wiki.python.org/moin/IntegratedDevelopmentEnvironments/">IntegratedDevelopmentEnvironments</a></li>
<li><a class="reference external" href="https://realpython.com/blog/python/vim-and-python-a-match-made-in-heaven/">VIM and Python - a Match Made in
Heaven</a></li>
</ul>
</div>
<span id="document-exercises/01_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<div class="section" id="id2">
<h5>Задание 1.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Единственное задание в этом разделе: подготовка к работе.</p>
<p>Для этого нужно:</p>
<ul class="simple">
<li>определиться с ОС, которую вы будете использовать<ul>
<li>так как все примеры в курсе ориентированы на Linux (Debian), желательно использовать его</li>
<li>желательно использовать новую виртуальную машину, чтобы было спокойней экспериментировать</li>
</ul>
</li>
<li>установить Python 3.7, 3.8 или 3.9 (3.7, если будете использовать редактор Mu). Проверить, что Python и pip установлены</li>
<li>создать виртуальное окружение, в котором вы будете работать весь курс</li>
<li>определиться с редактором/IDE</li>
<li>начиная с раздела 18, в заданиях надо будет подключаться к оборудованию. Поэтому нужно подготовить виртуальное или реальное оборудование</li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-book/02_git_github/index"></span><div class="section" id="git-github">
<span id="git-github-index"></span><h3>2. Использование Git и GitHub<a class="headerlink" href="#git-github" title="Ссылка на этот заголовок">¶</a></h3>
<p>В книге достаточно много заданий и нужно где-то их хранить. Один из
вариантов – использование для этого Git и GitHub. Конечно, можно
использовать для этого и другие средства, но используя GitHub, можно
постепенно разобраться с ним и затем использовать его для других задач.
Задания и примеры из книги находятся в отдельном
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>
на GitHub. Их можно скачать как zip-архив, но лучше
работать с репозиторием с помощью Git, тогда можно будет посмотреть
внесённые изменения и легко обновить репозиторий. Если изучать Git с
нуля и, особенно, если это первая система контроля версий, с которой Вы
работаете, информации может быть очень много, поэтому в этой главе всё
нацелено на практическую сторону вопроса, и рассказывается:</p>
<ul class="simple">
<li>как начать использовать Git и GitHub;</li>
<li>как выполнить базовые настройки;</li>
<li>как посмотреть информацию и/или изменения.</li>
</ul>
<p>Теории в этом подразделе будет мало, но будут даны ссылки на полезные
ресурсы. Попробуйте сначала провести все базовые настройки для
выполнения заданий, а потом продолжайте читать книгу. И в конце, когда
базовая работа с Git и GitHub будет уже привычным делом, почитайте о них
подробнее. Для чего может пригодиться Git:</p>
<ul class="simple">
<li>для хранения конфигураций и всех изменений в них;</li>
<li>для хранения документации и всех её версий;</li>
<li>для хранения схем и всех их версий;</li>
<li>для хранения кода и его версий.</li>
</ul>
<p>GitHub позволяет централизованно хранить все перечисленные выше вещи, но
следует учитывать, что эти ресурсы будут доступны и другим. У GitHub
есть и приватные репозитории (платные), но даже в них, пожалуй, не стоит
выкладывать такую информацию, как пароли. Конечно, основное
использование GitHub — размещение кода различных проектов. Кроме
этого, GitHub ещё и:</p>
<ul class="simple">
<li>хостинг для вашего сайта (<a class="reference external" href="https://pages.github.com/">GitHub
Pages</a>);</li>
<li>хостинг для онлайн-презентаций и инструмент для их создания
(<a class="reference external" href="https://gitpitch.com/">GitPitch</a>);</li>
<li>вместе с <a class="reference external" href="https://www.gitbook.com">GitBook</a>, это ещё и платформа
для публикации книг, документации или подобного тому.</li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-book/02_git_github/git_basics"></span><div class="section" id="git">
<h4>Основы Git<a class="headerlink" href="#git" title="Ссылка на этот заголовок">¶</a></h4>
<p>Git — это распределённая система контроля версий (Version Control System,
VCS), которая широко используется и выпущена под лицензией GNU GPL v2.
Она может:</p>
<ul class="simple">
<li>отслеживать изменения в файлах;</li>
<li>хранить несколько версий одного файла;</li>
<li>отменять внесённые изменения;</li>
<li>регистрировать, кто и когда сделал изменения.</li>
</ul>
<p>Git хранит изменения как снимок (snapshot) всего репозитория. Этот
снимок выполняется после каждого коммита (commit).</p>
<p>Установка Git:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install git
</pre></div>
</div>
<div class="section" id="id1">
<h5>Первичная настройка Git<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для начала работы с Git, необходимо указать имя и e-mail пользователя,
которые будут использоваться для синхронизации локального репозитория с
репозиторием на GitHub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git config --global user.name &quot;username&quot;
$ git config --global user.email &quot;username.user@example.com&quot;
</pre></div>
</div>
<p>Посмотреть настройки Git можно таким образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git config --list
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Инициализация репозитория<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Инициализация репозитория выполняется с помощью команды git init:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[~/tools/first_repo]
$ git init
Initialized empty Git repository in /home/vagrant/tools/first_repo/.git/
</pre></div>
</div>
<p>После выполнения этой команды, в текущем каталоге создаётся папка .git,
в которой содержатся служебные файлы, необходимые для Git.</p>
</div>
</div>
<span id="document-book/02_git_github/git_basics_bash_status"></span><div class="section" id="id1">
<h4>Отображение статуса репозитория в приглашении<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Пропускаем эту часть на Windows.</p>
</div>
<p>Это дополнительный функционал, который не требуется для работы с Git, но
очень помогает в этом. При работе с Git очень удобно, когда можно сразу
определить, находитесь вы в обычном каталоге или в репозитории Git.
Кроме того, было бы хорошо понимать статус текущего репозитория. Для
этого нужно установить специальную
<a class="reference external" href="https://github.com/magicmonty/bash-git-prompt/">утилиту</a>, которая
будет показывать статус репозитория. Для установки утилиты надо
скопировать её репозиторий в домашний каталог пользователя, под которым
вы работаете:</p>
<div class="code shell highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">magicmonty</span><span class="o">/</span><span class="n">bash</span><span class="o">-</span><span class="n">git</span><span class="o">-</span><span class="n">prompt</span><span class="o">.</span><span class="n">git</span> <span class="o">.</span><span class="n">bash</span><span class="o">-</span><span class="n">git</span><span class="o">-</span><span class="n">prompt</span> <span class="o">--</span><span class="n">depth</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>А затем добавить в конец файла .bashrc такие строки:</p>
<div class="code shell highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GIT_PROMPT_ONLY_IN_REPO</span><span class="o">=</span><span class="mi">1</span>
<span class="n">source</span> <span class="o">~/.</span><span class="n">bash</span><span class="o">-</span><span class="n">git</span><span class="o">-</span><span class="n">prompt</span><span class="o">/</span><span class="n">gitprompt</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Для того, чтобы изменения применились, перезапустить bash:</p>
<div class="code shell highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span> <span class="n">bash</span>
</pre></div>
</div>
<p>В моей конфигурации приглашение командной строки разнесено на несколько
строк, поэтому у вас оно будет отличаться. Главное, обратите внимание на
то, что появляется дополнительная информация при переходе в репозиторий.</p>
<p>Теперь, если вы находитесь в обычном каталоге, приглашение выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[~]
vagrant@jessie-i386:
$
</pre></div>
</div>
<p>Если же перейти в репозиторий Git:</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/setup_prompt.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/setup_prompt.png" />
</div>
</div>
<span id="document-book/02_git_github/git_basics_commands"></span><div class="section" id="git">
<h4>Работа с Git<a class="headerlink" href="#git" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для управления Git используются различные команды, смысл которых
поясняется далее.</p>
<div class="section" id="git-status">
<h5>git status<a class="headerlink" href="#git-status" title="Ссылка на этот заголовок">¶</a></h5>
<p>При работе с Git, важно понимать текущий статус репозитория. Для этого в
Git есть команда git status</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_0.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_0.png" />
</div>
<p>Git сообщает, что мы находимся в ветке master (эта ветка создаётся сама
и используется по умолчанию), и что ему нечего добавлять в коммит. Кроме
этого, Git предлагает создать или скопировать файлы и после этого
воспользоваться командой git add, чтобы Git начал за ними следить.</p>
<p>Создание файла README и добавление в него строки «test»</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vi README
$ echo &quot;test&quot; &gt;&gt; README
</pre></div>
</div>
<p>После этого приглашение выглядит таким образом</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/bash_prompt.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/bash_prompt.png" />
</div>
<p>В приглашении показано, что есть два файла, за которыми Git ещё не
следит</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_1.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_1.png" />
</div>
<p>Два файла получилось из-за того, что у меня настроены undo-файлы для
Vim. Это специальные файлы, благодаря которым можно отменять изменения
не только в текущей сессии файла, но и прошлые. Обратите внимание, что
Git сообщает, что есть файлы, за которыми он не следит и подсказывает,
какой командой это сделать.</p>
</div>
<div class="section" id="gitignore">
<h5>Файл .gitignore<a class="headerlink" href="#gitignore" title="Ссылка на этот заголовок">¶</a></h5>
<p>Undo-файл .README.un~ – служебный файл, который не нужно добавлять в
репозиторий. В Git есть возможность указать, какие файлы или каталоги
нужно игнорировать. Для этого нужно создать соответствующие шаблоны в
файле .gitignore в каталоге репозитория.</p>
<p>Для того, чтобы Git игнорировал undo-файлы Vim, можно добавить,
например, такую строку в файл .gitignore</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*.</span><span class="n">un</span><span class="o">~</span>
</pre></div>
</div>
<p>Это значит, что Git должен игнорировать все файлы, которые заканчиваются
на «.un~».</p>
<p>После этого, git status показывает</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_2.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_2.png" />
</div>
<p>Обратите внимание, что теперь в выводе нет файла .README.un~. Как только
в репозиторий был добавлен файл .gitignore, файлы, которые указаны в
нём, стали игнорироваться.</p>
</div>
<div class="section" id="git-add">
<h5>git add<a class="headerlink" href="#git-add" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для того, чтобы Git начал следить за файлами, используется команда git
add.</p>
<p>Можно указать что надо следить за конкретным файлом</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_add_readme.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_add_readme.png" />
</div>
<p>Или за всеми файлами</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_add_all.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_add_all.png" />
</div>
<p>Вывод git status</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_3.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_3.png" />
</div>
<p>Теперь файлы находятся в секции под названием «Changes to be committed».</p>
</div>
<div class="section" id="git-commit">
<h5>git commit<a class="headerlink" href="#git-commit" title="Ссылка на этот заголовок">¶</a></h5>
<p>После того, как все нужные файлы были добавлены в staging, можно
закоммитить изменения. Staging — это совокупность файлов, которые будут
добавлены в следующий коммит. У команды git commit есть только один
обязательный параметр – флаг «-m». Он позволяет указать сообщение для
этого коммита.</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_commit_1.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_commit_1.png" />
</div>
<p>После этого git status отображает</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_4.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_4.png" />
</div>
<p>Фраза «nothing to commit, working directory clean» обозначает, что нет
изменений, которые нужно добавить в Git или закоммитить.</p>
</div>
</div>
<span id="document-book/02_git_github/git_basics_additional"></span><div class="section" id="id1">
<h4>Дополнительные возможности<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<div class="section" id="git-diff">
<h5>git diff<a class="headerlink" href="#git-diff" title="Ссылка на этот заголовок">¶</a></h5>
<p>Команда git diff позволяет посмотреть разницу между различными
состояниями. Например, на данный момент, в репозитории внесены изменения
в файл README и .gitignore.</p>
<p>Команда git status показывает, что оба файла изменены</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_5.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_status_5.png" />
</div>
<p>Команда git diff показывает, какие изменения были внесены с момента
последнего коммита</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_diff.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_diff.png" />
</div>
<p>Если добавить изменения, внесённые в файлы, в staging командой <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span></code> и
ещё раз выполнить команду <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code>, то она ничего не покажет</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_add_git_diff.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_add_git_diff.png" />
</div>
<p>Чтобы показать отличия между staging и последним коммитом, надо добавить
параметр <code class="docutils literal notranslate"><span class="pre">--staged</span></code></p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_diff_staged.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_diff_staged.png" />
</div>
<p>Закоммитим изменения</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_commit_2.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_commit_2.png" />
</div>
</div>
<div class="section" id="git-log">
<h5>git log<a class="headerlink" href="#git-log" title="Ссылка на этот заголовок">¶</a></h5>
<p>Команда git log показывает, когда были выполнены последние изменения</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_log.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_log.png" />
</div>
<p>По умолчанию команда показывает все коммиты, начиная с ближайшего по
времени. С помощью дополнительных параметров можно не только посмотреть
информацию о коммитах, но и то, какие именно изменения были внесены.</p>
<p>Флаг <code class="docutils literal notranslate"><span class="pre">-p</span></code> позволяет отобразить отличия, которые были внесены каждым
коммитом</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_log_p.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_log_p.png" />
</div>
<p>Более короткий вариант вывода можно вывести с флагом <code class="docutils literal notranslate"><span class="pre">--stat</span></code></p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_log_stat.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/git_log_stat.png" />
</div>
</div>
</div>
<span id="document-book/02_git_github/git_github_auth"></span><div class="section" id="github">
<h4>Аутентификация на GitHub<a class="headerlink" href="#github" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для того, чтобы начать работать с GitHub, надо на нём
<a class="reference external" href="https://github.com/join">зарегистрироваться</a>. Для безопасной работы
с GitHub лучше использовать аутентификацию по ключам SSH.</p>
<p>Генерация нового SSH-ключа (используйте e-mail, который привязан к
GitHub):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh-keygen -t rsa -b 4096 -C &quot;github_email@gmail.com&quot;
</pre></div>
</div>
<p>На всех вопросах достаточно нажать Enter (более безопасно использовать
ключ с passphrase, но можно и без, если нажать Enter при вопросе, тогда
passphrase не будет запрашиваться у вас постоянно при операциях с
репозиторием).</p>
<p>SSH-агент используется для хранения ключей в памяти и удобен тем, что
нет необходимости вводить пароль passphrase каждый раз при взаимодействии
с удаленным хостом (в данном случае - github.com).</p>
<p>Запуск SSH-агента (пропускаем на Windows):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ eval &quot;$(ssh-agent -s)&quot;
</pre></div>
</div>
<p>Добавить ключ в SSH-агент (пропускаем на Windows):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh-add ~/.ssh/id_rsa
</pre></div>
</div>
<div class="section" id="ssh-github">
<h5>Добавление SSH-ключа на GitHub<a class="headerlink" href="#ssh-github" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для добавления ключа надо его скопировать.</p>
<p>Например, таким образом можно отобразить ключ для копирования:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat ~/.ssh/id_rsa.pub
</pre></div>
</div>
<p>После копирования надо перейти на GitHub. Находясь на любой странице
GitHub, в правом верхнем углу нажмите на картинку вашего профиля и в
выпадающем списке выберите «Settings». В списке слева надо выбрать поле
«SSH and GPG keys». После этого надо нажать «New SSH key» и в поле
«Title» написать название ключа (например «Home»), а в поле «Key»
вставить содержимое, которое было скопировано из файла
~/.ssh/id_rsa.pub.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Если GitHub запросит пароль, введите пароль своего аккаунта на GitHub.</p>
</div>
<p>Чтобы проверить, всё ли прошло успешно, попробуйте выполнить команду
<code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-T</span> <span class="pre">git&#64;github.com</span></code>.</p>
<p>Вывод должен быть таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -T git@github.com
Hi username! You&#39;ve successfully authenticated, but GitHub does not provide shell access.
</pre></div>
</div>
<p>Теперь вы готовы работать с Git и GitHub.</p>
</div>
</div>
<span id="document-book/02_git_github/git_github_changes"></span><div class="section" id="id1">
<h4>Работа со своим репозиторием заданий<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>В данной главе описывается, как создать свой репозиторий с копией файлов заданий для курса.</p>
<div class="section" id="github">
<h5>Создание репозитория на GitHub<a class="headerlink" href="#github" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для создания своего репозитория на основе шаблона нужно:</p>
<ul class="simple">
<li>залогиниться на <a class="reference external" href="https://github.com/">GitHub</a></li>
<li>открыть <a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises">репозиторий с заданиями</a></li>
<li>нажать «Use this template» и создать новый репозиторий на основе этого шаблона</li>
<li>в открывшемся окне надо ввести название репозитория</li>
<li>после этого готов новый репозиторий с копией всех файлов из исходного репозитория с заданиями</li>
</ul>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/github_use_template.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/git/github_use_template.png" />
</div>
</div>
<div class="section" id="id2">
<h5>Клонирование репозитория с GitHub<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для локальной работы с репозиторием его нужно клонировать.</p>
<p>Для этого используется команда git clone:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone ssh://git@github.com/pyneng/online-2-natasha-samoylenko.git
Cloning into &#39;online-2-natasha-samoylenko&#39;...
remote: Counting objects: 241, done.
remote: Compressing objects: 100% (191/191), done.
remote: Total 241 (delta 43), reused 239 (delta 41), pack-reused 0
Receiving objects: 100% (241/241), 119.60 KiB | 0 bytes/s, done.
Resolving deltas: 100% (43/43), done.
Checking connectivity... done.
</pre></div>
</div>
<p>По сравнению с приведённой в этом листинге командой, вам нужно изменить:</p>
<ul class="simple">
<li>имя пользователя pyneng на имя своего пользователя на GitHub;</li>
<li>имя репозитория online-2-natasha-samoylenko на имя своего
репозитория на GitHub.</li>
</ul>
<p>В итоге, в текущем каталоге, в котором была выполнена команда git clone,
появится каталог с именем репозитория, в моём случае –
«online-2-natasha-samoylenko». В этом каталоге теперь находится
содержимое репозитория на GitHub.</p>
</div>
<div class="section" id="id3">
<h5>Работа с репозиторием<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Предыдущая команда не просто скопировала репозиторий чтобы использовать
его локально, но и настроила соответствующим образом Git:</p>
<ul class="simple">
<li>создан каталог .git</li>
<li>скачаны все данные репозитория</li>
<li>скачаны все изменения, которые были в репозитории</li>
<li>репозиторий на GitHub настроен как remote для локального репозитория</li>
</ul>
<p>Теперь готов полноценный локальный репозиторий Git, в котором вы можете
работать. Обычно последовательность работы будет такой:</p>
<ul class="simple">
<li>перед началом работы, синхронизация локального содержимого с GitHub
командой git pull</li>
<li>изменение файлов репозитория</li>
<li>добавление изменённых файлов в staging командой git add</li>
<li>фиксация изменений через коммит командой git commit</li>
<li>передача локальных изменений в репозитории на GitHub командой git
push</li>
</ul>
<p>При работе с заданиями на работе и дома, надо обратить особое внимание
на первый и последний шаг:</p>
<ul class="simple">
<li>первый шаг – обновление локального репозитория</li>
<li>последний шаг – загрузка изменений на GitHub</li>
</ul>
</div>
<div class="section" id="id4">
<h5>Синхронизация локального репозитория с удалённым<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Все команды выполняются внутри каталога репозитория (в примере выше -
online-2-natasha-samoylenko).</p>
<p>Если содержимое локального репозитория одинаково с удалённым, вывод
будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git pull
Already up-to-date.
</pre></div>
</div>
<p>Если были изменения, вывод будет примерно таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git pull
remote: Counting objects: 5, done.
remote: Compressing objects: 100% (1/1), done.
remote: Total 5 (delta 4), reused 5 (delta 4), pack-reused 0
Unpacking objects: 100% (5/5), done.
From ssh://github.com/pyneng/online-2-natasha-samoylenko
   89c04b6..fc4c721  master     -&gt; origin/master
Updating 89c04b6..fc4c721
Fast-forward
 exercises/03_data_structures/task_3_3.py | 2 ++
 1 file changed, 2 insertions(+)
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Добавление новых файлов или изменений в существующих<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если необходимо добавить конкретный файл (в данном случае – README.md),
нужно дать команду <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">README.md</span></code>. Добавление всех файлов текущей
директории производится командой <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">.</span></code>.</p>
</div>
<div class="section" id="id6">
<h5>Коммит<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>При выполнении коммита обязательно надо указать сообщение. Лучше, если
сообщение будет со смыслом, а не просто «update» или подобное. Коммит
делается командой, подобной <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">&quot;Сделаны</span> <span class="pre">задания</span> <span class="pre">4.1-4.3&quot;</span></code>.</p>
</div>
<div class="section" id="push-github">
<h5>Push на GitHub<a class="headerlink" href="#push-github" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для загрузки всех локальных изменений на GitHub используется команда git
push:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git push origin master
Counting objects: 5, done.
Compressing objects: 100% (5/5), done.
Writing objects: 100% (5/5), 426 bytes | 0 bytes/s, done.
Total 5 (delta 4), reused 0 (delta 0)
remote: Resolving deltas: 100% (4/4), completed with 4 local objects.
To ssh://git@github.com/pyneng/online-2-natasha-samoylenko.git
   fc4c721..edcf417  master -&gt; master
</pre></div>
</div>
<p>Перед выполнением git push можно выполнить команду <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span> <span class="pre">-p</span>
<span class="pre">origin/master..</span></code> – она покажет, какие изменения вы собираетесь добавлять
в свой репозиторий на GitHub.</p>
</div>
</div>
<span id="document-book/02_git_github/pyneng_github"></span><div class="section" id="id1">
<h4>Работа с репозиторием заданий и примеров<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все примеры и задания книги выложены в отдельном
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises">репозитории</a>.</p>
<div class="section" id="github">
<h5>Копирование репозитория с GitHub<a class="headerlink" href="#github" title="Ссылка на этот заголовок">¶</a></h5>
<p>Примеры и задания иногда обновляются, поэтому будет удобнее клонировать
этот репозиторий на свою машину и периодически обновлять его.</p>
<p>Для копирования репозитория с GitHub выполните команду git clone:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/natenka/pyneng-examples-exercises
Cloning into &#39;pyneng-examples-exercises&#39;...
remote: Counting objects: 1263, done.
remote: Compressing objects: 100% (504/504), done.
remote: Total 1263 (delta 735), reused 1263 (delta 735), pack-reused 0
Receiving objects: 100% (1263/1263), 267.10 KiB | 444.00 KiB/s, done.
Resolving deltas: 100% (735/735), done.
Checking connectivity... done.
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Обновление локальной копии репозитория<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>При необходимости обновить локальный репозиторий, чтобы синхронизировать
его с версией на GitHub, надо выполнить git pull, находясь внутри
созданного каталога pyneng-examples-exercises.</p>
<p>Если обновлений не было, вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git pull
Already up-to-date.
</pre></div>
</div>
<p>Если обновления были, вывод будет примерно таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git pull
remote: Counting objects: 3, done.
remote: Compressing objects: 100% (1/1), done.
remote: Total 3 (delta 2), reused 3 (delta 2), pack-reused 0
Unpacking objects: 100% (3/3), done.
From https://github.com/natenka/pyneng-examples-exercises
   49e9f1b..1eb82ad  master     -&gt; origin/master
Updating 49e9f1b..1eb82ad
Fast-forward
 README.md | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
</pre></div>
</div>
<p>Обратите внимание на информацию о том, что изменился только файл
README.md.</p>
</div>
<div class="section" id="id3">
<h5>Просмотр изменений<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если вы хотите посмотреть, какие именно изменения были внесены, можно
воспользоваться командой git log:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git log -p -1
commit 98e393c27e7aae4b41878d9d979c7587bfeb24b4
Author: Наташа Самойленко &lt;nataliya.samoylenko@gmail.com&gt;
Date:   Fri Aug 18 17:32:07 2017 +0300

    Update task_24_4.md

diff --git a/exercises/24_ansible_for_network/task_24_4.md b/exercises/24_ansible_for_network/task_24_4.md
index c4307fa..137a221 100644
--- a/exercises/24_ansible_for_network/task_24_4.md
+++ b/exercises/24_ansible_for_network/task_24_4.md
@@ -13,11 +13,12 @@
 * применить ACL к интерфейсу

 ACL должен быть таким:
+
 ip access-list extended INET-to-LAN
  permit tcp 10.0.1.0 0.0.0.255 any eq www
  permit tcp 10.0.1.0 0.0.0.255 any eq 22
  permit icmp any any
-
+

 Проверьте работу playbook на маршрутизаторе R1.
</pre></div>
</div>
<p>В этой команде флаг <code class="docutils literal notranslate"><span class="pre">-p</span></code> указывает, что надо отобразить вывод утилиты
Linux diff для внесённых изменений, а не только сообщение коммита. В
свою очередь, <code class="docutils literal notranslate"><span class="pre">-1</span></code> указывает, что надо показать только один самый свежий
коммит.</p>
</div>
<div class="section" id="id4">
<h5>Просмотр изменений, которые будут синхронизированы<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Прошлый вариант git log опирается на количество коммитов, но это не
всегда удобно. До выполнения команды git pull можно посмотреть, какие
изменения были выполнены с момента последней синхронизации.</p>
<p>Для этого используется следующая команда:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git log -p ..origin/master
commit 4c1821030d20b3682b67caf362fd777d098d9126
Author: Наташа Самойленко &lt;nataliya.samoylenko@gmail.com&gt;
Date:   Mon May 29 07:53:45 2017 +0300

Update README.md

diff --git a/tools/README.md b/tools/README.md
index 2b6f380..4f8d4af 100644
--- a/tools/README.md
+++ b/tools/README.md
@@ -1 +1,4 @@
+
+Тут находятся PDF версии руководств по настройке инструментов, которые используются на курсе.
</pre></div>
</div>
<p>В данном случае изменения были только в одном файле. Эта команда будет
очень полезна для того, чтобы посмотреть, какие изменения были внесены в
формулировку заданий и каких именно заданий. Так будет легче
ориентироваться, и понимать, касается ли это заданий, которые вы уже
сделали, и если касается, то надо ли их изменять.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">«..origin/master» в команде <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span> <span class="pre">-p</span> <span class="pre">..origin/master</span></code>
означает показать все коммиты, которые есть в origin/master
(в данном случае, это GitHub), но которых нет в локальной копии репозитория</p>
</div>
<p>Если изменения были в тех заданиях, которые вы ещё не делали, этот вывод
подскажет, какие файлы нужно скопировать с репозитория курса в ваш
личный репозиторий (а может быть и весь раздел, если вы ещё не делали
задания из этого раздела).</p>
</div>
</div>
<span id="document-book/02_git_github/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/magicmonty/bash-git-prompt/">Informative git prompt for bash and
fish</a>;</li>
<li><a class="reference external" href="https://help.github.com/categories/authenticating-to-github/">Authenticating to
GitHub</a>;</li>
<li><a class="reference external" href="https://help.github.com/articles/connecting-to-github-with-ssh/">Connecting to GitHub with
SSH</a>.</li>
</ul>
<p>Про Git/GitHub:</p>
<ul class="simple">
<li><a class="reference external" href="https://githowto.com/ru">GitHowTo</a> - интерактивный howto на
русском;</li>
<li><a class="reference external" href="http://kbroman.org/github_tutorial/">git/github guide. a minimal
tutorial</a> - минимально
необходимые знания для работы с Git и GitHub;</li>
<li><a class="reference external" href="https://git-scm.com/book/en/v2/">Pro Git book</a>. Эта же
<a class="reference external" href="https://git-scm.com/book/ru/v2/">книга</a> на русском;</li>
<li><a class="reference external" href="https://ru.hexlet.io/courses/intro_to_git/">Системы контроля версий (GIT) (курс на
Hexlet)</a>.</li>
</ul>
</div>
<span id="document-exercises/02_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<div class="section" id="id2">
<h5>Задание 2.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>В этом задании необходимо:</p>
<ul class="simple">
<li>создать свой репозиторий для выполнения заданий на GitHub</li>
<li>клонировать его на свою виртуалку/хост</li>
</ul>
<p>Создать свой репозиторий на основе шаблона <a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises">репозиторий с заданиями и примерами</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last"><a class="reference external" href="https://pyneng.readthedocs.io/ru/latest/book/02_git_github/git_github_changes.html">Как создать репозиторий на основе шаблона</a>.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/03_start/index"></span><div class="section" id="python">
<span id="start-index"></span><h3>3. Начало работы с Python<a class="headerlink" href="#python" title="Ссылка на этот заголовок">¶</a></h3>
<p>В этом разделе рассматриваются:</p>
<ul class="simple">
<li>синтаксис Python</li>
<li>работа в интерактивном режиме</li>
<li>переменные в Python</li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-book/03_start/0_syntax"></span><div class="section" id="python">
<h4>Синтаксис Python<a class="headerlink" href="#python" title="Ссылка на этот заголовок">¶</a></h4>
<p>Первое, что, как правило, бросается в глаза, если говорить о синтаксисе
в Python, это то, что отступы имеют значение:</p>
<ul class="simple">
<li>они определяют, какой код попадает в блок;</li>
<li>когда блок кода начинается и заканчивается.</li>
</ul>
<p>Пример кода Python:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A больше B&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;B больше или равно A&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Конец&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Чтение файла&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Готово&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Этот код показан для демонстрации синтаксиса. И, несмотря на то, что ещё не
рассматривалась конструкция if/else, скорее всего, суть кода будет понятной.</p>
</div>
<p>Python понимает, какие строки относятся к if на основе отступов.
Выполнение блока <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">a</span> <span class="pre">&gt;</span> <span class="pre">b</span></code> заканчивается, когда встречается строка с
тем же отступом, что и сама строка <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">a</span> <span class="pre">&gt;</span> <span class="pre">b</span></code>. Аналогично с блоком else.
Вторая особенность Python: после некоторых выражений должно идти
двоеточие (например, после <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">a</span> <span class="pre">&gt;</span> <span class="pre">b</span></code> и после <code class="docutils literal notranslate"><span class="pre">else</span></code>).</p>
<p>Несколько правил и рекомендаций по отступам:</p>
<ul class="simple">
<li>В качестве отступов могут использоваться табы или пробелы (лучше
использовать пробелы, а точнее, настроить редактор так, чтобы
таб был равен 4 пробелам – тогда при использовании клавиши
табуляции будут ставиться 4 пробела, вместо 1 знака табуляции).</li>
<li>Количество пробелов должно быть одинаковым в одном блоке (лучше,
чтобы количество пробелов было одинаковым во всём коде – популярный
вариант, это использовать 2-4 пробела, так, например, в этой книге
используются 4 пробела).</li>
</ul>
<p>Ещё одна особенность приведённого кода, это пустые строки. С их помощью
код форматируется, чтобы его было проще читать. Остальные особенности
синтаксиса будут показаны в процессе знакомства со структурами данных в
Python.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В Python есть специальный документ, в котором описано как лучше писать
код Python <a class="reference external" href="https://pep8.org/">PEP 8</a> - the Style Guide for Python Code.</p>
</div>
<div class="section" id="id1">
<h5>Комментарии<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>При написании кода часто нужно оставить комментарий, например, чтобы
описать особенности работы кода.</p>
<p>Комментарии в Python могут быть однострочными:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Очень важный комментарий</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># Очень нужный комментарий</span>
</pre></div>
</div>
<p>Однострочные комментарии начинаются со знака решётки. Обратите внимание,
что комментарий может быть как в строке, где находится сам код, так и в
отдельной строке.</p>
<p>При необходимости написать несколько строк с комментариями, чтобы не
ставить перед каждой решётку, можно сделать многострочный комментарий:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Очень важный</span>
<span class="sd">и длинный комментарий</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>Для многострочного комментария можно использовать три двойные или три
одинарные кавычки. Комментарии могут использоваться как для того, чтобы
комментировать, что происходит в коде, так и для того, чтобы исключить
выполнение определённой строки или блока кода (то есть закомментировать
их).</p>
</div>
</div>
<span id="document-book/03_start/1_ipython"></span><div class="section" id="python-ipython">
<h4>Интерпретатор Python. IPython<a class="headerlink" href="#python-ipython" title="Ссылка на этот заголовок">¶</a></h4>
<p>Интерпретатор позволяет получать моментальный отклик на выполненные
действия. Можно сказать, что интерпретатор работает как CLI (Command
Line Interface) сетевых устройств: каждая команда будет выполняться
сразу же после нажатия Enter. Однако есть исключение – более сложные
объекты (например циклы или функции) выполняются только после
двухкратного нажатия Enter.</p>
<p>В предыдущем разделе, для проверки установки
Python вызывался стандартный интерпретатор. Кроме него, есть и
усовершенствованный интерпретатор
<a class="reference external" href="http://ipython.readthedocs.io/en/stable/index.html">IPython</a>.
IPython позволяет намного больше, чем стандартный
интерпретатор, который вызывается по команде python. Несколько примеров
(возможности IPython намного шире):</p>
<ul class="simple">
<li>автодополнение команд по Tab или подсказка, если вариантов команд
несколько;</li>
<li>более структурированный и понятный вывод команд;</li>
<li>автоматические отступы в циклах и других объектах;</li>
<li>можно передвигаться по истории выполнения команд, или же посмотреть
её «волшебной» командой %history.</li>
</ul>
<p>Установить IPython можно с помощью pip (установка будет производиться в
виртуальном окружении, если оно настроено):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">ipython</span>
</pre></div>
</div>
<p>После этого, перейти в IPython можно следующим образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipython
Python 3.7.3 (default, May 13 2019, 15:44:23)
Type &#39;copyright&#39;, &#39;credits&#39; or &#39;license&#39; for more information
IPython 7.5.0 -- An enhanced Interactive Python. Type &#39;?&#39; for help.

In [1]:
</pre></div>
</div>
<p>Для выхода используется команда quit. Далее описывается, как будет
использоваться IPython.</p>
<p>Для знакомства с интерпретатором можно попробовать использовать его как
калькулятор:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">22</span><span class="o">*</span><span class="mi">45</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">990</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">2</span><span class="o">**</span><span class="mi">3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">8</span>
</pre></div>
</div>
<p>В IPython ввод и вывод помечены:</p>
<ul class="simple">
<li>In – входные данные пользователя</li>
<li>Out – результат, который возвращает команда (если он есть)</li>
<li>числа после In или Out – это порядковые номера выполненных команд в
текущей сессии IPython</li>
</ul>
<p>Пример вывода строки функцией print():</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [4]: print(&#39;Hello!&#39;)
Hello!
</pre></div>
</div>
<p>Когда в интерпретаторе создаётся, например, цикл, то внутри цикла
приглашение меняется на многоточие. Для выполнения цикла и выхода из
этого подрежима необходимо дважды нажать Enter:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>
</pre></div>
</div>
<div class="section" id="help">
<h5>help()<a class="headerlink" href="#help" title="Ссылка на этот заголовок">¶</a></h5>
<p>В IPython есть возможность посмотреть справку по произвольному объекту,
функции или методу с помощью help():</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">help</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">Help</span> <span class="n">on</span> <span class="k">class</span> <span class="nc">str</span> <span class="ow">in</span> <span class="n">module</span> <span class="n">builtins</span><span class="p">:</span>

<span class="k">class</span> <span class="nc">str</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
 <span class="o">|</span>  <span class="nb">str</span><span class="p">(</span><span class="nb">object</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
 <span class="o">|</span>  <span class="nb">str</span><span class="p">(</span><span class="n">bytes_or_buffer</span><span class="p">[,</span> <span class="n">encoding</span><span class="p">[,</span> <span class="n">errors</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span>
 <span class="o">|</span>
 <span class="o">|</span>  <span class="n">Create</span> <span class="n">a</span> <span class="n">new</span> <span class="n">string</span> <span class="nb">object</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">given</span> <span class="nb">object</span><span class="o">.</span> <span class="n">If</span> <span class="n">encoding</span> <span class="ow">or</span>
 <span class="o">|</span>  <span class="n">errors</span> <span class="ow">is</span> <span class="n">specified</span><span class="p">,</span> <span class="n">then</span> <span class="n">the</span> <span class="nb">object</span> <span class="n">must</span> <span class="n">expose</span> <span class="n">a</span> <span class="n">data</span> <span class="n">buffer</span>
 <span class="o">|</span>  <span class="n">that</span> <span class="n">will</span> <span class="n">be</span> <span class="n">decoded</span> <span class="n">using</span> <span class="n">the</span> <span class="n">given</span> <span class="n">encoding</span> <span class="ow">and</span> <span class="n">error</span> <span class="n">handler</span><span class="o">.</span>
<span class="o">...</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">help</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">)</span>
<span class="n">Help</span> <span class="n">on</span> <span class="n">method_descriptor</span><span class="p">:</span>

<span class="n">strip</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">S</span><span class="o">.</span><span class="n">strip</span><span class="p">([</span><span class="n">chars</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span>

    <span class="n">Return</span> <span class="n">a</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">the</span> <span class="n">string</span> <span class="n">S</span> <span class="k">with</span> <span class="n">leading</span> <span class="ow">and</span> <span class="n">trailing</span>
    <span class="n">whitespace</span> <span class="n">removed</span><span class="o">.</span>
    <span class="n">If</span> <span class="n">chars</span> <span class="ow">is</span> <span class="n">given</span> <span class="ow">and</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">remove</span> <span class="n">characters</span> <span class="ow">in</span> <span class="n">chars</span> <span class="n">instead</span><span class="o">.</span>
</pre></div>
</div>
<p>Второй вариант:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>In [3]: ?str
Init signature: str(self, /, *args, **kwargs)
Docstring:
str(object=&#39;&#39;) -&gt; str
str(bytes_or_buffer[, encoding[, errors]]) -&gt; str

Create a new string object from the given object. If encoding or
errors is specified, then the object must expose a data buffer
that will be decoded using the given encoding and error handler.
Otherwise, returns the result of object.__str__() (if defined)
or repr(object).
encoding defaults to sys.getdefaultencoding().
errors defaults to &#39;strict&#39;.
Type:           type

In [4]: ?str.strip
Docstring:
S.strip([chars]) -&gt; str

Return a copy of the string S with leading and trailing
whitespace removed.
If chars is given and not None, remove characters in chars instead.
Type:      method_descriptor
</pre></div>
</div>
</div>
<div class="section" id="print">
<h5>print()<a class="headerlink" href="#print" title="Ссылка на этот заголовок">¶</a></h5>
<p>Функция <code class="docutils literal notranslate"><span class="pre">print()</span></code> позволяет вывести информацию на стандартный поток вывода
(текущий экран терминала). Если необходимо вывести строку, то её нужно
обязательно заключить в кавычки (двойные или одинарные). Если же нужно
вывести, например, результат вычисления или просто число, то кавычки не
нужны:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [6]: print(&#39;Hello!&#39;)
Hello!

In [7]: print(5*5)
25
</pre></div>
</div>
<p>Если нужно вывести подряд несколько значений через пробел, то нужно
перечислить их через запятую:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
<span class="mi">5</span> <span class="mi">10</span> <span class="mi">15</span> <span class="mi">20</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">)</span>
<span class="n">one</span> <span class="n">two</span> <span class="n">three</span>
</pre></div>
</div>
<p>По умолчанию в конце каждого выражения, переданного в print(), будет
перевод строки. Если необходимо, чтобы после вывода каждого выражения не
было бы перевода строки, надо в качестве последнего выражения в print()
указать дополнительный аргумент end.</p>
<div class="admonition seealso">
<p class="first admonition-title">См.также</p>
<p class="last">Дополнительные параметры функции print <a class="reference internal" href="contents.html#print"><span class="std std-ref">Функция print</span></a></p>
</div>
</div>
<div class="section" id="dir">
<h5>dir()<a class="headerlink" href="#dir" title="Ссылка на этот заголовок">¶</a></h5>
<p>Функция <code class="docutils literal notranslate"><span class="pre">dir()</span></code> может использоваться для того, чтобы посмотреть, какие имеются
атрибуты (переменные, привязанные к объекту) и методы (функции,
привязанные к объекту).</p>
<p>Например, для числа вывод будет таким (обратите внимание на различные
методы, которые позволяют делать арифметические операции):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;__abs__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__add__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__and__&#39;</span><span class="p">,</span>
 <span class="o">...</span>
 <span class="s1">&#39;bit_length&#39;</span><span class="p">,</span>
 <span class="s1">&#39;conjugate&#39;</span><span class="p">,</span>
 <span class="s1">&#39;denominator&#39;</span><span class="p">,</span>
 <span class="s1">&#39;imag&#39;</span><span class="p">,</span>
 <span class="s1">&#39;numerator&#39;</span><span class="p">,</span>
 <span class="s1">&#39;real&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Аналогично для строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;__add__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__class__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__contains__&#39;</span><span class="p">,</span>
 <span class="o">...</span>
 <span class="s1">&#39;startswith&#39;</span><span class="p">,</span>
 <span class="s1">&#39;strip&#39;</span><span class="p">,</span>
 <span class="s1">&#39;swapcase&#39;</span><span class="p">,</span>
 <span class="s1">&#39;title&#39;</span><span class="p">,</span>
 <span class="s1">&#39;translate&#39;</span><span class="p">,</span>
 <span class="s1">&#39;upper&#39;</span><span class="p">,</span>
 <span class="s1">&#39;zfill&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Если выполнить dir() без передачи значения, то она показывает
существующие методы, атрибуты и переменные, определённые в текущей
сессии интерпретатора:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span>
<span class="p">[</span> <span class="s1">&#39;__builtin__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__builtins__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__name__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;_dh&#39;</span><span class="p">,</span>
 <span class="o">...</span>
 <span class="s1">&#39;_oh&#39;</span><span class="p">,</span>
 <span class="s1">&#39;_sh&#39;</span><span class="p">,</span>
 <span class="s1">&#39;exit&#39;</span><span class="p">,</span>
 <span class="s1">&#39;get_ipython&#39;</span><span class="p">,</span>
 <span class="s1">&#39;i&#39;</span><span class="p">,</span>
 <span class="s1">&#39;quit&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Например, после создания переменной a и test():</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;hello&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
   <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span>
 <span class="o">...</span>
 <span class="s1">&#39;a&#39;</span><span class="p">,</span>
 <span class="s1">&#39;exit&#39;</span><span class="p">,</span>
 <span class="s1">&#39;get_ipython&#39;</span><span class="p">,</span>
 <span class="s1">&#39;i&#39;</span><span class="p">,</span>
 <span class="s1">&#39;quit&#39;</span><span class="p">,</span>
 <span class="s1">&#39;test&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/03_start/1a_ipython_magic"></span><div class="section" id="ipython">
<h4>Специальные команды ipython<a class="headerlink" href="#ipython" title="Ссылка на этот заголовок">¶</a></h4>
<p>В IPython есть специальные команды, которые упрощают работу
с интерпретатором. Все они начинаются со знака процента.</p>
<div class="section" id="history">
<h5>%history<a class="headerlink" href="#history" title="Ссылка на этот заголовок">¶</a></h5>
<p>Например, команда <code class="docutils literal notranslate"><span class="pre">%history</span></code> позволяет просмотреть историю введённых пользователем
команд в текущей сессии IPython:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A is bigger&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">A</span> <span class="ow">is</span> <span class="n">bigger</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="o">%</span><span class="n">history</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A is bigger&quot;</span><span class="p">)</span>
<span class="o">%</span><span class="n">history</span>
</pre></div>
</div>
<p>С помощью %history можно скопировать нужный блок кода.</p>
</div>
<div class="section" id="time">
<h5>%time<a class="headerlink" href="#time" title="Ссылка на этот заголовок">¶</a></h5>
<p>Команда <code class="docutils literal notranslate"><span class="pre">%time</span></code> показывает сколько секунд выполнялось выражение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">ping_ip</span><span class="p">(</span><span class="n">ip_address</span><span class="p">):</span>
    <span class="o">..</span><span class="p">:</span>     <span class="n">reply</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ping&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">],</span>
    <span class="o">..</span><span class="p">:</span>                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="o">..</span><span class="p">:</span>                            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="o">..</span><span class="p">:</span>                            <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="o">..</span><span class="p">:</span>     <span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="o">..</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">True</span>
    <span class="o">..</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
    <span class="o">..</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
    <span class="o">..</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="o">%</span><span class="n">time</span> <span class="n">ping_ip</span><span class="p">(</span><span class="s1">&#39;8.8.8.8&#39;</span><span class="p">)</span>
<span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mi">0</span> <span class="n">ns</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">4</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mi">4</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2.03</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="o">%</span><span class="n">time</span> <span class="n">ping_ip</span><span class="p">(</span><span class="s1">&#39;8.8.8&#39;</span><span class="p">)</span>
<span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mi">0</span> <span class="n">ns</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">8</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mi">8</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mi">12</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">33</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="o">%</span><span class="n">time</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mi">0</span> <span class="n">ns</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">0</span> <span class="n">ns</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mi">0</span> <span class="n">ns</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">8.11</span> <span class="n">µs</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">77</span><span class="p">]</span>
</pre></div>
</div>
<p>Подробнее об IPython можно почитать в
<a class="reference external" href="http://ipython.readthedocs.io/en/stable/index.html">документации</a>
IPython.</p>
<p>Коротко информацию можно посмотреть в самом IPython командой %quickref:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>IPython -- An enhanced Interactive Python - Quick Reference Card
===========================================================

obj?, obj??      : Get help, or more help for object (also works as
                   ?obj, ??obj).
?foo.*abc*       : List names in &#39;foo&#39; containing &#39;abc&#39; in them.
%magic           : Information about IPython&#39;s &#39;magic&#39; % functions.

Magic functions are prefixed by % or %%, and typically take their arguments
without parentheses, quotes or even commas for convenience.  Line magics take a
single % and cell magics are prefixed with two %%.

Example magic function calls:

%alias d ls -F   : &#39;d&#39; is now an alias for &#39;ls -F&#39;
alias d ls -F    : Works if &#39;alias&#39; not a python name
alist = %alias   : Get list of aliases to &#39;alist&#39;
cd /usr/share    : Obvious. cd -&lt;tab&gt; to choose from visited dirs.
%cd??            : See help AND source for magic %cd
%timeit x=10     : time the &#39;x=10&#39; statement with high precision.
%%timeit x=2**100
x**100           : time &#39;x**100&#39; with a setup of &#39;x=2**100&#39;; setup code is not
                   counted.  This is an example of a cell magic.

System commands:

!cp a.txt b/     : System command escape, calls os.system()
cp a.txt b/      : after %rehashx, most system commands work without !
cp ${f}.txt $bar : Variable expansion in magics and system commands
files = !ls /usr : Capture sytem command output
files.s, files.l, files.n: &quot;a b c&quot;, [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;], &#39;a\nb\nc&#39;

History:

_i, _ii, _iii    : Previous, next previous, next next previous input
_i4, _ih[2:5]    : Input history line 4, lines 2-4
exec _i81        : Execute input history line #81 again
%rep 81          : Edit input history line #81
_, __, ___       : previous, next previous, next next previous output
_dh              : Directory history
_oh              : Output history
%hist            : Command history of current session.
%hist -g foo     : Search command history of (almost) all sessions for &#39;foo&#39;.
%hist -g         : Command history of (almost) all sessions.
%hist 1/2-8      : Command history containing lines 2-8 of session 1.
%hist 1/ ~2/     : Command history of session 1 and 2 sessions before current.
</pre></div>
</div>
</div>
</div>
<span id="document-book/03_start/2_variables"></span><div class="section" id="id1">
<h4>Переменные<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Переменные в Python не требуют объявления типа переменной (так как
Python – язык с динамической типизацией) и являются ссылками на область
памяти. Правила именования переменных:</p>
<ul class="simple">
<li>имя переменной может состоять только из букв, цифр и знака
подчёркивания;</li>
<li>имя не может начинаться с цифры;</li>
<li>имя не может содержать специальных символов &#64;, $, %.</li>
</ul>
<p>Пример создания переменных в Python:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="s1">&#39;Hello&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
<span class="mi">3</span> <span class="n">Hello</span> <span class="mi">9</span> <span class="n">Test</span>
</pre></div>
</div>
<p>Обратите внимание, что в Python не нужно указывать, что «a» это число, а
«b» это строка.</p>
<p>Переменные являются ссылками на область памяти. Это можно
продемонстрировать с помощью id(), которая показывает идентификатор
объекта:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">33</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mi">31671480</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">31671480</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="mi">31671480</span>
</pre></div>
</div>
<p>В этом примере видно, что все три имени ссылаются на один и тот же
идентификатор, то есть, это один и тот же объект, на который указывают
три ссылки – «a», «b» и «c». С числами у Python есть одна особенность,
которая может немного сбить с понимания: числа от -5 до 256 заранее
созданы и хранятся в массиве (списке). Поэтому при создании числа из
этого диапазона фактически создаётся ссылка на число в созданном
массиве.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Эта особенность характерна именно для реализации CPython, которая
рассматривается в книге</p>
</div>
<p>Это можно проверить таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="mi">4400936168</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="mi">4400936168</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="mi">4400936168</span>
</pre></div>
</div>
<p>Обратите внимание, что у <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code> и числа <code class="docutils literal notranslate"><span class="pre">3</span></code> имеют одинаковые идентификаторы.
Все они являются ссылками на существующее число в списке.</p>
<p>Если сделать то же самое с числом больше 256, идентификаторы у всех
будут разные:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">500</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">500</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="mi">140239990503056</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="mi">140239990503032</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="mi">140239990502960</span>
</pre></div>
</div>
<p>При этом, если сделать присваивание переменных друг другу, то
идентификаторы будут у всех одинаковые (в таком варианте <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code> и <code class="docutils literal notranslate"><span class="pre">c</span></code>
ссылаются на один и тот же объект):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">500</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="mi">140239990503080</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="mi">140239990503080</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="mi">140239990503080</span>
</pre></div>
</div>
<div class="section" id="id2">
<h5>Имена переменных<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Имена переменных не должны пересекаться с названиями операторов и
модулей или же других зарезервированных слов. В Python есть рекомендации
по именованию функций, классов и переменных:</p>
<ul class="simple">
<li>имена переменных обычно пишутся или полностью большими или полностью
маленькими буквами (например DB_NAME, db_name);</li>
<li>имена функций задаются маленькими буквами, с подчёркиваниями между
словами (например, get_names);</li>
<li>имена классов задаются словами с заглавными буквами без пробелов, это
так называемый CamelCase (например, CiscoSwitch).</li>
</ul>
</div>
</div>
<span id="document-exercises/03_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<div class="section" id="id2">
<h5>Задание 3.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Выполните установку IPython в виртуальном окружении или глобально в
системе, если виртуальные окружения не используются. После установки, по
команде ipython должен открываться интерпретатор IPython (вывод может
незначительно отличаться):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipython
Python 3.8.0 (default, Nov  9 2019, 12:40:50)
Type &#39;copyright&#39;, &#39;credits&#39; or &#39;license&#39; for more information
IPython 7.18.1 -- An enhanced Interactive Python. Type &#39;?&#39; for help.

In [1]:
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/04_data_structures/index"></span><div class="section" id="python">
<span id="data-structures-index"></span><h3>4. Типы данных в Python<a class="headerlink" href="#python" title="Ссылка на этот заголовок">¶</a></h3>
<p>В Python есть несколько стандартных типов данных:</p>
<ul class="simple">
<li>Numbers (числа)</li>
<li>Strings (строки)</li>
<li>Lists (списки)</li>
<li>Dictionaries (словари)</li>
<li>Tuples (кортежи)</li>
<li>Sets (множества)</li>
<li>Boolean (логический тип данных)</li>
</ul>
<p>Эти типы данных можно, в свою очередь, классифицировать по нескольким
признакам:</p>
<ul class="simple">
<li>изменяемые (списки, словари и множества)</li>
<li>неизменяемые (числа, строки и кортежи)</li>
<li>упорядоченные (списки, кортежи, строки и словари)</li>
<li>неупорядоченные (множества)</li>
</ul>
<p>Содержание раздела:</p>
<div class="toctree-wrapper compound">
<span id="document-book/04_data_structures/numbers"></span><div class="section" id="id1">
<h4>Числа<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>С числами можно выполнять различные математические операции.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mi">2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mf">3.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">4</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">6</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">2</span><span class="o">**</span><span class="mi">3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">8</span>
</pre></div>
</div>
<p>Деление int и float:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="mi">10</span><span class="o">/</span><span class="mi">3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="mf">3.3333333333333335</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mi">10</span><span class="o">/</span><span class="mf">3.0</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mf">3.3333333333333335</span>
</pre></div>
</div>
<p>С помощью функции round можно округлять числа до нужного количества
знаков:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">round</span><span class="p">(</span><span class="mi">10</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="mf">3.33</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">round</span><span class="p">(</span><span class="mi">10</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="mf">3.3333</span>
</pre></div>
</div>
<p>Остаток от деления:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="mi">10</span> <span class="o">%</span> <span class="mi">3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Операторы сравнения</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="mi">10</span> <span class="o">&gt;</span> <span class="mf">3.0</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="mi">10</span> <span class="o">&lt;</span> <span class="mi">3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">10</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="mi">10</span> <span class="o">&lt;=</span> <span class="mi">10</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="mf">10.0</span> <span class="o">==</span> <span class="mi">10</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Функция int() позволяет выполнять конвертацию в тип int. Во втором
аргументе можно указывать систему счисления:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;11&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="mi">11</span>
</pre></div>
</div>
<p>Если указать, что строку a надо воспринимать как двоичное число, то
результат будет таким:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Конвертация в int типа float:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">3.333</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">3.9</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Функция bin позволяет получить двоичное представление числа (обратите
внимание, что результат - строка):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="nb">bin</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="s1">&#39;0b1000&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="nb">bin</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="s1">&#39;0b11111111&#39;</span>
</pre></div>
</div>
<p>Аналогично, функция hex() позволяет получить шестнадцатеричное значение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="nb">hex</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="s1">&#39;0xa&#39;</span>
</pre></div>
</div>
<p>И, конечно же, можно делать несколько преобразований одновременно:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;ff&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="mi">255</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s1">&#39;ff&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="s1">&#39;0b11111111&#39;</span>
</pre></div>
</div>
<p>Для более сложных математических функций в Python есть модуль <strong>math</strong>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="kn">import</span>  <span class="nn">math</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="mf">3.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="mf">3.1622776601683795</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="mi">6</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="mf">3.141592653589793</span>
</pre></div>
</div>
</div>
<span id="document-book/04_data_structures/strings"></span><div class="section" id="strings">
<h4>Строки (Strings)<a class="headerlink" href="#strings" title="Ссылка на этот заголовок">¶</a></h4>
<p>Строка в Python это:</p>
<ul class="simple">
<li>последовательность символов, заключенная в кавычки</li>
<li>неизменяемый упорядоченный тип данных</li>
</ul>
<p>Примеры строк:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s1">&#39;Hello&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s1">&#39;Hello&#39;</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s2">&quot;Hello&quot;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;Hello&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">tunnel</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">   ....: interface Tunnel0</span>
<span class="s2">   ....:  ip address 10.10.10.1 255.255.255.0</span>
<span class="s2">   ....:  ip mtu 1416</span>
<span class="s2">   ....:  ip ospf hello-interval 5</span>
<span class="s2">   ....:  tunnel source FastEthernet1/0</span>
<span class="s2">   ....:  tunnel protection ipsec profile DMVPN</span>
<span class="s2">   ....: &quot;&quot;&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">tunnel</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">interface Tunnel0</span><span class="se">\n</span><span class="s1"> ip address 10.10.10.1 255.255.255.0</span><span class="se">\n</span><span class="s1"> ip mtu 1416</span><span class="se">\n</span><span class="s1"> ip ospf hello-interval 5</span><span class="se">\n</span><span class="s1"> tunnel source FastEthernet1/0</span><span class="se">\n</span><span class="s1"> tunnel protection ipsec profile DMVPN</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">tunnel</span><span class="p">)</span>

<span class="n">interface</span> <span class="n">Tunnel0</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">10.10</span><span class="o">.</span><span class="mf">10.1</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
 <span class="n">ip</span> <span class="n">mtu</span> <span class="mi">1416</span>
 <span class="n">ip</span> <span class="n">ospf</span> <span class="n">hello</span><span class="o">-</span><span class="n">interval</span> <span class="mi">5</span>
 <span class="n">tunnel</span> <span class="n">source</span> <span class="n">FastEthernet1</span><span class="o">/</span><span class="mi">0</span>
 <span class="n">tunnel</span> <span class="n">protection</span> <span class="n">ipsec</span> <span class="n">profile</span> <span class="n">DMVPN</span>
</pre></div>
</div>
<p>Строки можно суммировать. Тогда они объединяются в одну строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">intf</span> <span class="o">=</span> <span class="s1">&#39;interface&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">tun</span> <span class="o">=</span> <span class="s1">&#39;Tunnel0&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">intf</span> <span class="o">+</span> <span class="n">tun</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;interfaceTunnel0&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">intf</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">tun</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;interface Tunnel0&#39;</span>
</pre></div>
</div>
<p>Строку можно умножать на число. В этом случае, строка повторяется
указанное количество раз:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">intf</span> <span class="o">*</span> <span class="mi">5</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="s1">&#39;interfaceinterfaceinterfaceinterfaceinterface&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="s1">&#39;#&#39;</span> <span class="o">*</span> <span class="mi">40</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="s1">&#39;########################################&#39;</span>
</pre></div>
</div>
<p>То, что строки являются упорядоченным типом данных, позволяет обращаться
к символам в строке по номеру, начиная с нуля:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">string1</span> <span class="o">=</span> <span class="s1">&#39;interface FastEthernet1/0&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">string1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="s1">&#39;i&#39;</span>
</pre></div>
</div>
<p>Нумерация всех символов в строке идет с нуля. Но, если нужно обратиться
к какому-то по счету символу, начиная с конца, то можно указывать
отрицательные значения (на этот раз с единицы).</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">string1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="s1">&#39;n&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">string1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="s1">&#39;0&#39;</span>
</pre></div>
</div>
<p>Кроме обращения к конкретному символу, можно делать срезы строк, указав
диапазон номеров (срез выполняется по второе число, не включая его):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">string1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="s1">&#39;interface&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">string1</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet&#39;</span>
</pre></div>
</div>
<p>Если не указывается второе число, то срез будет до конца строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span>  <span class="n">string1</span><span class="p">[</span><span class="mi">10</span><span class="p">:]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet1/0&#39;</span>
</pre></div>
</div>
<p>Срезать три последних символа строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">string1</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="s1">&#39;1/0&#39;</span>
</pre></div>
</div>
<p>Также в срезе можно указывать шаг. Так можно получить нечетные числа:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;0123456789&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="s1">&#39;13579&#39;</span>
</pre></div>
</div>
<p>А таким образом можно получить все четные числа строки a:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">a</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="s1">&#39;02468&#39;</span>
</pre></div>
</div>
<p>Срезы также можно использовать для получения строки в обратном порядке:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;0123456789&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">a</span><span class="p">[::]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="s1">&#39;0123456789&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">a</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="s1">&#39;9876543210&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Записи <code class="docutils literal notranslate"><span class="pre">a[::]</span></code> и <code class="docutils literal notranslate"><span class="pre">a[:]</span></code> дают одинаковый результат, но двойное
двоеточие позволяет указывать, что надо брать не каждый элемент, а,
например, каждый второй.</p>
</div>
<p>Функция <code class="docutils literal notranslate"><span class="pre">len</span></code> позволяет получить количество символов в строке:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;interface Gi0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">15</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Функция и метод отличаются тем, что метод привязан к объекту конкретного типа, а функция,
как правило, более универсальная и может применяться к объектам разного типа.
Например, функция <code class="docutils literal notranslate"><span class="pre">len</span></code> может применяться к строкам, спискам, словарям и так далее,
а метод <code class="docutils literal notranslate"><span class="pre">startswith</span></code> относится только к строкам.</p>
</div>
<div class="toctree-wrapper compound">
<span id="document-book/04_data_structures/string_methods"></span><div class="section" id="id1">
<h5>Полезные методы для работы со строками<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>При автоматизации очень часто надо будет работать со строками, так как
конфигурационный файл, вывод команд и отправляемые команды - это строки.</p>
<p>Знание различных методов (действий), которые можно применять к
строкам, помогает более эффективно работать с ними.</p>
<p>Строки неизменяемый тип данных, поэтому все методы, которые преобразуют
строку возвращают новую строку, а исходная строка остается неизменной.</p>
<div class="section" id="upper-lower-swapcase-capitalize">
<h6>Методы upper, lower, swapcase, capitalize<a class="headerlink" href="#upper-lower-swapcase-capitalize" title="Ссылка на этот заголовок">¶</a></h6>
<p>Методы <code class="docutils literal notranslate"><span class="pre">upper()</span></code>, <code class="docutils literal notranslate"><span class="pre">lower()</span></code>, <code class="docutils literal notranslate"><span class="pre">swapcase()</span></code>,
<code class="docutils literal notranslate"><span class="pre">capitalize()</span></code> выполняют преобразование регистра строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">string1</span> <span class="o">=</span> <span class="s1">&#39;FastEthernet&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="s1">&#39;FASTETHERNET&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="s1">&#39;fastethernet&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">swapcase</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="s1">&#39;fASTeTHERNET&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">string2</span> <span class="o">=</span> <span class="s1">&#39;tunnel 0&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">string2</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="s1">&#39;Tunnel 0&#39;</span>
</pre></div>
</div>
<p>Очень важно обращать внимание на то, что часто методы возвращают
преобразованную строку. И, значит, надо не забыть присвоить ее какой-то
переменной (можно той же).</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">string1</span> <span class="o">=</span> <span class="n">string1</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">string1</span><span class="p">)</span>
<span class="n">FASTETHERNET</span>
</pre></div>
</div>
</div>
<div class="section" id="count">
<h6>Метод count<a class="headerlink" href="#count" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">count()</span></code> используется для подсчета того, сколько раз символ
или подстрока встречаются в строке:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">string1</span> <span class="o">=</span> <span class="s1">&#39;Hello, hello, hello, hello&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;ello&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="mi">4</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="mi">8</span>
</pre></div>
</div>
</div>
<div class="section" id="find">
<h6>Метод find<a class="headerlink" href="#find" title="Ссылка на этот заголовок">¶</a></h6>
<p>Методу <code class="docutils literal notranslate"><span class="pre">find()</span></code> можно передать подстроку или символ, и он покажет,
на какой позиции находится первый символ подстроки (для первого
совпадения):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">string1</span> <span class="o">=</span> <span class="s1">&#39;interface FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Fast&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="mi">10</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">string1</span><span class="p">[</span><span class="n">string1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Fast&#39;</span><span class="p">)::]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet0/1&#39;</span>
</pre></div>
</div>
<p>Если совпадение не найдено, метод find возвращает <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</p>
</div>
<div class="section" id="startswith-endswith">
<h6>Методы startswith, endswith<a class="headerlink" href="#startswith-endswith" title="Ссылка на этот заголовок">¶</a></h6>
<p>Проверка на то, начинается или заканчивается ли строка на определенные
символы (методы <code class="docutils literal notranslate"><span class="pre">startswith()</span></code>, <code class="docutils literal notranslate"><span class="pre">endswith()</span></code>):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">string1</span> <span class="o">=</span> <span class="s1">&#39;FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Fast&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;0/1&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;0/2&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Методам <code class="docutils literal notranslate"><span class="pre">startswith()</span></code> и <code class="docutils literal notranslate"><span class="pre">endswith()</span></code> можно передавать несколько значений
(обязательно как кортеж):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;test&quot;</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s2">&quot;test&quot;</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s2">&quot;rtest&quot;</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s2">&quot;rtest&quot;</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s2">&quot;rtest&quot;</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="replace">
<h6>Метод replace<a class="headerlink" href="#replace" title="Ссылка на этот заголовок">¶</a></h6>
<p>Замена последовательности символов в строке на другую последовательность
(метод <code class="docutils literal notranslate"><span class="pre">replace()</span></code>):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">string1</span> <span class="o">=</span> <span class="s1">&#39;FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Fast&#39;</span><span class="p">,</span> <span class="s1">&#39;Gigabit&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="s1">&#39;GigabitEthernet0/1&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="strip">
<h6>Метод strip<a class="headerlink" href="#strip" title="Ссылка на этот заголовок">¶</a></h6>
<p>Часто при обработке файла файл открывается построчно. Но в конце каждой
строки, как правило, есть какие-то спецсимволы (а могут быть и в
начале). Например, перевод строки.</p>
<p>Для того, чтобы избавиться от них, очень удобно использовать метод
<code class="docutils literal notranslate"><span class="pre">strip()</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">string1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">interface FastEthernet0/1</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">string1</span><span class="p">)</span>

    <span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>


<span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">string1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">interface FastEthernet0/1</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="s1">&#39;interface FastEthernet0/1&#39;</span>
</pre></div>
</div>
<p>По умолчанию метод strip() убирает пробельные символы. В этот набор
символов входят: <code class="docutils literal notranslate"><span class="pre">\t\n\r\f\v</span></code></p>
<p>Методу strip можно передать как аргумент любые символы. Тогда в начале и
в конце строки будут удалены все символы, которые были указаны в строке:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">ad_metric</span> <span class="o">=</span> <span class="s1">&#39;[110/1045]&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">ad_metric</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="s1">&#39;110/1045&#39;</span>
</pre></div>
</div>
<p>Метод strip() убирает спецсимволы и в начале, и в конце строки. Если
необходимо убрать символы только слева или только справа, можно
использовать, соответственно, методы <code class="docutils literal notranslate"><span class="pre">lstrip()</span></code> и
<code class="docutils literal notranslate"><span class="pre">rstrip()</span></code>.</p>
</div>
<div class="section" id="split">
<h6>Метод split<a class="headerlink" href="#split" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">split()</span></code> разбивает строку на части, используя как
разделитель какой-то символ (или символы) и возвращает список строк:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">string1</span> <span class="o">=</span> <span class="s1">&#39;switchport trunk allowed vlan 10,20,30,100-200&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">commands</span> <span class="o">=</span> <span class="n">string1</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;switchport&#39;</span><span class="p">,</span> <span class="s1">&#39;trunk&#39;</span><span class="p">,</span> <span class="s1">&#39;allowed&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan&#39;</span><span class="p">,</span> <span class="s1">&#39;10,20,30,100-200&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>В примере выше <code class="docutils literal notranslate"><span class="pre">string1.split()</span></code> разбивает строку по пробельным символам
и возвращает список строк. Список записан в переменную commands.</p>
<p>По умолчанию в качестве разделителя используются пробельные символы
(пробелы, табы, перевод строки), но в скобках можно указать любой разделитель:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="n">commands</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">vlans</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>В списке commands последний элемент это строка с вланами, поэтому используется индекс -1.
Затем строка разбивается на части с помощью split <code class="docutils literal notranslate"><span class="pre">commands[-1].split(',')</span></code>.
Так как, как разделитель указана запятая, получен такой список <code class="docutils literal notranslate"><span class="pre">['10',</span> <span class="pre">'20',</span> <span class="pre">'30',</span> <span class="pre">'100-200']</span></code>.</p>
<p>Пример разделения адреса на октеты:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">ip</span> <span class="o">=</span> <span class="s2">&quot;192.168.100.1&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">ip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;192&#39;</span><span class="p">,</span> <span class="s1">&#39;168&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Полезная особенность метода split с разделителем по умолчанию — строка не только разделяется
в список строк по пробельным символам, но пробельные символы также удаляются в начале и
в конце строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="n">string1</span> <span class="o">=</span> <span class="s1">&#39;  switchport trunk allowed vlan 10,20,30,100-200</span><span class="se">\n\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="n">string1</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;switchport&#39;</span><span class="p">,</span> <span class="s1">&#39;trunk&#39;</span><span class="p">,</span> <span class="s1">&#39;allowed&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan&#39;</span><span class="p">,</span> <span class="s1">&#39;10,20,30,100-200&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>У метода <code class="docutils literal notranslate"><span class="pre">split()</span></code> есть ещё одна хорошая особенность: по умолчанию
метод разбивает строку не по одному пробельному символу, а по любому количеству.
Это будет, например, очень полезным при обработке команд show:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="n">sh_ip_int_br</span> <span class="o">=</span> <span class="s2">&quot;FastEthernet0/0       15.0.15.1    YES manual up         up&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">61</span><span class="p">]:</span> <span class="n">sh_ip_int_br</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">61</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;15.0.15.1&#39;</span><span class="p">,</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>А вот так выглядит разделение той же строки, когда один пробел
используется как разделитель:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">62</span><span class="p">]:</span> <span class="n">sh_ip_int_br</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">62</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;15.0.15.1&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/04_data_structures/string_format"></span><div class="section" id="id1">
<h5>Форматирование строк<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>При работе со строками часто возникают ситуации, когда в шаблон строки
надо подставить разные данные.</p>
<p>Это можно делать объединяя, части строки и данные, но в Python есть
более удобный способ — форматирование строк.</p>
<p>Форматирование строк может помочь, например, в таких ситуациях:</p>
<ul class="simple">
<li>необходимо подставить значения в строку по определенному шаблону</li>
<li>необходимо отформатировать вывод столбцами</li>
<li>надо конвертировать числа в двоичный формат</li>
</ul>
<p>Существует несколько вариантов форматирования строк:</p>
<ul class="simple">
<li>с оператором <code class="docutils literal notranslate"><span class="pre">%</span></code> — более старый вариант</li>
<li>метод <code class="docutils literal notranslate"><span class="pre">format()</span></code> — относительно новый вариант</li>
<li>f-строки — новый вариант, который появился в Python 3.6.</li>
</ul>
<p>Несмотря на то, что рекомендуется использовать метод <code class="docutils literal notranslate"><span class="pre">format</span></code>, часто
можно встретить форматирование строк и через оператор <code class="docutils literal notranslate"><span class="pre">%</span></code>.</p>
<div class="section" id="format">
<h6>Форматирование строк с методом format<a class="headerlink" href="#format" title="Ссылка на этот заголовок">¶</a></h6>
<p>Пример использования метода format:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;interface FastEthernet0/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s1">&#39;interface FastEthernet0/1&#39;</span>
</pre></div>
</div>
<p>Специальный символ <code class="docutils literal notranslate"><span class="pre">{}</span></code> указывает, что сюда подставится значение,
которое передается методу format. При этом каждая пара фигурных скобок
обозначает одно место для подстановки.</p>
<p>Значения, которые подставляются в фигурные скобки, могут быть разного
типа. Например, это может быть строка, число или список:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">))</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="mi">100</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>С помощью форматирования строк можно выводить результат столбцами. В
форматировании строк можно указывать, какое количество символов выделено
на данные. Если количество символов в данных меньше, чем выделенное
количество символов, недостающие символы заполняются пробелами.</p>
<p>Например, таким образом можно вывести данные столбцами одинаковой ширины
по 15 символов с выравниванием по правой стороне:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">intf</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;aabb.cc80.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/1&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&gt;15}</span><span class="s2"> </span><span class="si">{:&gt;15}</span><span class="s2"> </span><span class="si">{:&gt;15}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">intf</span><span class="p">))</span>
            <span class="mi">100</span>  <span class="n">aabb</span><span class="o">.</span><span class="n">cc80</span><span class="o">.</span><span class="mi">7000</span>           <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
<p>Выравнивание по левой стороне:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:15}</span><span class="s2"> </span><span class="si">{:15}</span><span class="s2"> </span><span class="si">{:15}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">intf</span><span class="p">))</span>
<span class="mi">100</span>             <span class="n">aabb</span><span class="o">.</span><span class="n">cc80</span><span class="o">.</span><span class="mi">7000</span>  <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
<p>Шаблон для вывода может быть и многострочным:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">ip_template</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">   ...: IP address:</span>
<span class="s1">   ...: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">   ...: &#39;&#39;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">ip_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">))</span>

<span class="n">IP</span> <span class="n">address</span><span class="p">:</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>
</pre></div>
</div>
<p>С помощью форматирования строк можно также влиять на отображение чисел.</p>
<p>Например, можно указать, сколько цифр после запятой выводить:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">10.0</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
<span class="mf">3.333</span>
</pre></div>
</div>
<p>С помощью форматирования строк можно конвертировать числа в двоичный
формат:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;</span><span class="si">{:b}</span><span class="s1"> </span><span class="si">{:b}</span><span class="s1"> </span><span class="si">{:b}</span><span class="s1"> </span><span class="si">{:b}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;11000000 1100100 1 1&#39;</span>
</pre></div>
</div>
<p>При этом по-прежнему можно указывать дополнительные параметры, например,
ширину столбца:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="s1">&#39;</span><span class="si">{:8b}</span><span class="s1"> </span><span class="si">{:8b}</span><span class="s1"> </span><span class="si">{:8b}</span><span class="s1"> </span><span class="si">{:8b}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="s1">&#39;11000000  1100100        1        1&#39;</span>
</pre></div>
</div>
<p>А также можно указать, что надо дополнить числа нулями, вместо пробелов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="s1">&#39;</span><span class="si">{:08b}</span><span class="s1"> </span><span class="si">{:08b}</span><span class="s1"> </span><span class="si">{:08b}</span><span class="s1"> </span><span class="si">{:08b}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="s1">&#39;11000000 01100100 00000001 00000001&#39;</span>
</pre></div>
</div>
<p>В фигурных скобках можно указывать имена. Это позволяет передавать
аргументы в любом порядке, а также делает шаблон более понятным:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="s1">&#39;</span><span class="si">{ip}</span><span class="s1">/</span><span class="si">{mask}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="s1">&#39;10.1.1.1/24&#39;</span>
</pre></div>
</div>
<p>Еще одна полезная возможность форматирования строк - указание номера
аргумента:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;</span><span class="si">{1}</span><span class="s1">/</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;10.1.1.1/24&#39;</span>
</pre></div>
</div>
<p>За счет этого, например, можно избавиться от повторной передачи одних и
тех же значений:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">ip_template</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    ...: IP address:</span>
<span class="s1">    ...: </span><span class="si">{:&lt;8}</span><span class="s1"> </span><span class="si">{:&lt;8}</span><span class="s1"> </span><span class="si">{:&lt;8}</span><span class="s1"> </span><span class="si">{:&lt;8}</span><span class="s1"></span>
<span class="s1">    ...: </span><span class="si">{:08b}</span><span class="s1"> </span><span class="si">{:08b}</span><span class="s1"> </span><span class="si">{:08b}</span><span class="s1"> </span><span class="si">{:08b}</span><span class="s1"></span>
<span class="s1">    ...: &#39;&#39;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">ip_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">IP</span> <span class="n">address</span><span class="p">:</span>
<span class="mi">192</span>      <span class="mi">100</span>      <span class="mi">1</span>        <span class="mi">1</span>
<span class="mi">11000000</span> <span class="mi">01100100</span> <span class="mi">00000001</span> <span class="mi">00000001</span>
</pre></div>
</div>
<p>В примере выше октеты адреса приходится передавать два раза - один для
отображения в десятичном формате, а второй - для двоичного.</p>
<p>Указав индексы значений, которые передаются методу format, можно
избавиться от дублирования:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">ip_template</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    ...: IP address:</span>
<span class="s1">    ...: </span><span class="si">{0:&lt;8}</span><span class="s1"> </span><span class="si">{1:&lt;8}</span><span class="s1"> </span><span class="si">{2:&lt;8}</span><span class="s1"> </span><span class="si">{3:&lt;8}</span><span class="s1"></span>
<span class="s1">    ...: </span><span class="si">{0:08b}</span><span class="s1"> </span><span class="si">{1:08b}</span><span class="s1"> </span><span class="si">{2:08b}</span><span class="s1"> </span><span class="si">{3:08b}</span><span class="s1"></span>
<span class="s1">    ...: &#39;&#39;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">ip_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">IP</span> <span class="n">address</span><span class="p">:</span>
<span class="mi">192</span>      <span class="mi">100</span>      <span class="mi">1</span>        <span class="mi">1</span>
<span class="mi">11000000</span> <span class="mi">01100100</span> <span class="mi">00000001</span> <span class="mi">00000001</span>
</pre></div>
</div>
</div>
<div class="section" id="f">
<h6>Форматирование строк с помощью f-строк<a class="headerlink" href="#f" title="Ссылка на этот заголовок">¶</a></h6>
<p>В Python 3.6 добавился новый вариант форматирования строк - f-строки или
интерполяция строк. F-строки позволяют не только подставлять какие-то
значения в шаблон, но и позволяют выполнять вызовы функций, методов и
т.п.</p>
<p>Во многих ситуациях f-строки удобней и проще использовать, чем format,
кроме того, f-строки работают быстрее, чем format и другие методы
форматирования строк.</p>
<div class="section" id="id2">
<h7>Синтаксис<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h7>
<p>F-строки — это литерал строки с буквой <code class="docutils literal notranslate"><span class="pre">f</span></code> перед ним. Внутри f-строки
в паре фигурных скобок указываются имена переменных, которые надо
подставить:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [1]: ip = &#39;10.1.1.1&#39;

In [2]: mask = 24

In [3]: f&quot;IP: {ip}, mask: {mask}&quot;
Out[3]: &#39;IP: 10.1.1.1, mask: 24&#39;

Аналогичный результат с format можно получить так:
``&quot;IP: {ip}, mask: {mask}&quot;.format(ip=ip, mask=mask)``.
</pre></div>
</div>
<p>Очень важное отличие f-строк от format: f-строки — это выражение, которое
выполняется, а не просто строка. То есть, в случае с ipython, как только
мы написали выражение и нажали Enter, оно выполнилось и вместо выражений
<code class="docutils literal notranslate"><span class="pre">{ip}</span></code> и <code class="docutils literal notranslate"><span class="pre">{mask}</span></code> подставились значения переменных.</p>
<p>Поэтому, например, нельзя сначала написать шаблон, а затем определить
переменные, которые используются в шаблоне:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="sa">f</span><span class="s2">&quot;IP: </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">, mask: </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">e6f8e01ac9c4</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="sa">f</span><span class="s2">&quot;IP: </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">, mask: </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;ip&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
</pre></div>
</div>
<p>Кроме подстановки значений переменных, в фигурных скобках можно писать
выражения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;William&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">second_name</span> <span class="o">=</span> <span class="s1">&#39;Shakespeare&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">second_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;WILLIAM SHAKESPEARE&#39;</span>
</pre></div>
</div>
<p>После двоеточия в f-строках можно указывать те же значения, что и при
использовании format:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">oct1</span><span class="p">,</span> <span class="n">oct2</span><span class="p">,</span> <span class="n">oct3</span><span class="p">,</span> <span class="n">oct4</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    ...: IP address:</span>
<span class="s1">    ...: </span><span class="si">{</span><span class="n">oct1</span><span class="si">:</span><span class="s1">&lt;8</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct2</span><span class="si">:</span><span class="s1">&lt;8</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct3</span><span class="si">:</span><span class="s1">&lt;8</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct4</span><span class="si">:</span><span class="s1">&lt;8</span><span class="si">}</span><span class="s1"></span>
<span class="s1">    ...: </span><span class="si">{</span><span class="n">oct1</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct2</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct3</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct4</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">IP</span> <span class="n">address</span><span class="p">:</span>
<span class="mi">10</span>       <span class="mi">1</span>        <span class="mi">1</span>        <span class="mi">1</span>
<span class="mi">00001010</span> <span class="mi">00000001</span> <span class="mi">00000001</span> <span class="mi">00000001</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Так как для полноценного объяснения f-строк, надо показывать
примеры с циклами и работой с объектами, которые  еще не рассматривались,
это тема также есть в разделе <a class="reference internal" href="contents.html#f-string"><span class="std std-ref">Форматирование строк с помощью f-строк</span></a> с дополнительными примерами и пояснениями.</p>
</div>
</div>
</div>
</div>
<span id="document-book/04_data_structures/string_literal_concatenation"></span><div class="section" id="id1">
<h5>Объединение литералов строк<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>В Python есть очень удобная функциональность — объединение литералов
строк.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Test&#39;</span> <span class="s1">&#39;String&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;TestString&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Test&#39;</span> <span class="s1">&#39;String&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;TestString&#39;</span>
</pre></div>
</div>
<p>Можно даже переносить составляющие строки на разные строки, но только
если они в скобках:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Test&#39;</span>
   <span class="o">...</span><span class="p">:</span> <span class="s1">&#39;String&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;TestString&#39;</span>
</pre></div>
</div>
<p>Этим очень удобно пользоваться в регулярных выражениях:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">regex</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;(\S+) +(\S+) +&#39;</span>
         <span class="s1">&#39;\w+ +\w+ +&#39;</span>
         <span class="s1">&#39;(up|down|administratively down) +&#39;</span>
         <span class="s1">&#39;(\w+)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Так регулярное выражение можно разбивать на части и его будет проще
понять. Плюс можно добавлять поясняющие комментарии в строках.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">regex</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;(\S+) +(\S+) +&#39;</span> <span class="c1"># interface and IP</span>
         <span class="s1">&#39;\w+ +\w+ +&#39;</span>
         <span class="s1">&#39;(up|down|administratively down) +&#39;</span> <span class="c1"># Status</span>
         <span class="s1">&#39;(\w+)&#39;</span><span class="p">)</span> <span class="c1"># Protocol</span>
</pre></div>
</div>
<p>Также этим приемом удобно пользоваться, когда надо написать длинное
сообщение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;При выполнении команды &quot;</span><span class="si">{}</span><span class="s1">&quot; &#39;</span>
   <span class="o">...</span><span class="p">:</span> <span class="s1">&#39;возникла такая ошибка &quot;</span><span class="si">{}</span><span class="s1">&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
   <span class="o">...</span><span class="p">:</span> <span class="s1">&#39;Исключить эту команду из списка? [y/n]&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">message</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;При выполнении команды &quot;</span><span class="si">{}</span><span class="s1">&quot; возникла такая ошибка &quot;</span><span class="si">{}</span><span class="s1">&quot;.</span><span class="se">\n</span><span class="s1">Исключить эту команду из списка? [y/n]&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-book/04_data_structures/lists"></span><div class="section" id="list">
<h4>Список (List)<a class="headerlink" href="#list" title="Ссылка на этот заголовок">¶</a></h4>
<p>Список в Python это:</p>
<ul class="simple">
<li>последовательность элементов, разделенных между собой запятой и заключенных в квадратные скобки</li>
<li>изменяемый упорядоченный тип данных</li>
</ul>
<p>Примеры списков:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">77</span><span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">list2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;seven&#39;</span><span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">list3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Создание списка с помощью литерала:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Литерал - это выражение, которое создает объект.</p>
</div>
<p>Создание списка с помощью функции <strong>list()</strong>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">list1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;router&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Так как список - это упорядоченный тип данных, то, как и в строках, в
списках можно обращаться к элементу по номеру, делать срезы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">list3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">list3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="mi">20</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">list3</span><span class="p">[</span><span class="mi">1</span><span class="p">::]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">list3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;word&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">list3</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Перевернуть список наоборот можно и с помощью метода reverse():</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">vlans</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">vlans</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;100-200&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Так как списки изменяемые, элементы списка можно менять:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">list3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">list3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">list3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Можно создавать и список списков. И, как и в обычном списке, можно
обращаться к элементам во вложенных списках:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;15.0.15.1&#39;</span><span class="p">,</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">],</span>
   <span class="o">....</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">],</span>
   <span class="o">....</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;FastEthernet0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">]]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">interfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet0/0&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">interfaces</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet0/2&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">interfaces</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="s1">&#39;10.0.2.1&#39;</span>
</pre></div>
</div>
<p>Функция len возвращает количество элементов в списке:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">3</span>
</pre></div>
</div>
<p>А функция sorted сортирует элементы списка по возрастанию и возвращает новый список с отсортированными элементами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;Michael&#39;</span><span class="p">,</span> <span class="s1">&#39;Antony&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;Antony&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;Michael&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="toctree-wrapper compound">
<span id="document-book/04_data_structures/list_methods"></span><div class="section" id="id1">
<h5>Полезные методы для работы со списками<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Список - это изменяемый тип данных, поэтому очень важно обращать
внимание на то, что большинство методов для работы со списками меняют
список на месте, при этом ничего не возвращая.</p>
<div class="section" id="join">
<h6><code class="docutils literal notranslate"><span class="pre">join</span></code><a class="headerlink" href="#join" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">join</span></code> собирает список строк в одну строку с разделителем,
который указан перед join:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vlans</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;10,20,30&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Метод join на самом деле относится к строкам, но так как значение
ему надо передавать как список, он рассматривается тут.</p>
</div>
</div>
<div class="section" id="append">
<h6><code class="docutils literal notranslate"><span class="pre">append</span></code><a class="headerlink" href="#append" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">append</span></code> добавляет в конец списка указанный элемент:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">vlans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;300&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">vlans</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Метод append меняет список на месте и ничего не возвращает.</p>
</div>
<div class="section" id="extend">
<h6><code class="docutils literal notranslate"><span class="pre">extend</span></code><a class="headerlink" href="#extend" title="Ссылка на этот заголовок">¶</a></h6>
<p>Если нужно объединить два списка, то можно использовать два способа:
метод <code class="docutils literal notranslate"><span class="pre">extend</span></code> и операцию сложения.</p>
<p>У этих способов есть важное отличие - extend меняет список, к которому
применен метод, а суммирование возвращает новый список, который состоит
из двух.</p>
<p>Метод extend:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">vlans2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">,</span> <span class="s1">&#39;500&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">vlans</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">vlans2</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">vlans</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">,</span> <span class="s1">&#39;500&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Суммирование списков:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">vlans2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">,</span> <span class="s1">&#39;500&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">+</span> <span class="n">vlans2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">,</span> <span class="s1">&#39;500&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Обратите внимание на то, что при суммировании списков в ipython
появилась строка Out. Это означает, что результат суммирования можно
присвоить в переменную:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">vlans</span> <span class="o">+</span> <span class="n">vlans2</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">,</span> <span class="s1">&#39;500&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="pop">
<h6><code class="docutils literal notranslate"><span class="pre">pop</span></code><a class="headerlink" href="#pop" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">pop</span></code> удаляет элемент, который соответствует указанному
номеру. Но, что важно, при этом метод возвращает этот элемент:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">vlans</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="s1">&#39;100-200&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">vlans</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Без указания номера удаляется последний элемент списка.</p>
</div>
<div class="section" id="remove">
<h6><code class="docutils literal notranslate"><span class="pre">remove</span></code><a class="headerlink" href="#remove" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">remove</span></code> удаляет указанный элемент.</p>
<p>remove() не возвращает удаленный элемент:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">vlans</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;20&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">vlans</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>В методе remove надо указывать сам элемент, который надо удалить, а не
его номер в списке. Если указать номер элемента, возникнет ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">vlans</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="o">-------------------------------------------------</span>
<span class="ne">ValueError</span>      <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">32</span><span class="o">-</span><span class="n">f4ee38810cb7</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">vlans</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="ne">ValueError</span><span class="p">:</span> <span class="nb">list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span>
</pre></div>
</div>
</div>
<div class="section" id="index">
<h6><code class="docutils literal notranslate"><span class="pre">index</span></code><a class="headerlink" href="#index" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">index</span></code> используется для того, чтобы проверить, под каким
номером в списке хранится элемент:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">vlans</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;30&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="section" id="insert">
<h6><code class="docutils literal notranslate"><span class="pre">insert</span></code><a class="headerlink" href="#insert" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">insert</span></code> позволяет вставить элемент на определенное место в
списке:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">vlans</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">vlans</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100-200&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="sort">
<h6><code class="docutils literal notranslate"><span class="pre">sort</span></code><a class="headerlink" href="#sort" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод sort сортирует список на месте:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">vlans</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">vlans</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/04_data_structures/dicts"></span><div class="section" id="dictionary">
<h4>Словарь (Dictionary)<a class="headerlink" href="#dictionary" title="Ссылка на этот заголовок">¶</a></h4>
<p>Словари - это изменяемый упорядоченный тип данных:</p>
<ul class="simple">
<li>данные в словаре - это пары <code class="docutils literal notranslate"><span class="pre">ключ:</span> <span class="pre">значение</span></code></li>
<li>доступ к значениям осуществляется по ключу, а не по номеру, как в списках</li>
<li>данные в словаре упорядочены по порядку добавления элементов</li>
<li>так как словари изменяемы, то элементы словаря можно менять, добавлять, удалять</li>
<li>ключ должен быть объектом неизменяемого типа: число, строка, кортеж</li>
<li>значение может быть данными любого типа</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В других языках программирования тип данных подобный словарю может называться ассоциативный массив, хеш или хеш-таблица.</p>
</div>
<p>Пример словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Можно записывать и так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">london</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London&#39;</span><span class="p">,</span>
    <span class="s1">&#39;it_vlan&#39;</span><span class="p">:</span> <span class="mi">320</span><span class="p">,</span>
    <span class="s1">&#39;user_vlan&#39;</span><span class="p">:</span> <span class="mi">1010</span><span class="p">,</span>
    <span class="s1">&#39;mngmt_vlan&#39;</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span>
    <span class="s1">&#39;to_name&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;to_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="s1">&#39;G1/0/11&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Для того, чтобы получить значение из словаря, надо обратиться по ключу,
таким же образом, как это было в списках, только вместо номера будет
использоваться ключ:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">london</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;London1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">london</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;London Str&#39;</span>
</pre></div>
</div>
<p>Аналогичным образом можно добавить новую пару ключ-значение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">london</span><span class="p">[</span><span class="s1">&#39;vendor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Cisco&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">london</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>В словаре в качестве значения можно использовать словарь:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">london_co</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;r1&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
        <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span>
    <span class="p">},</span>
    <span class="s1">&#39;r2&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
        <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.2&#39;</span>
    <span class="p">},</span>
    <span class="s1">&#39;sw1&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_sw1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
        <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;3.6.XE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.101&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Получить значения из вложенного словаря можно так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">london_co</span><span class="p">[</span><span class="s1">&#39;r1&#39;</span><span class="p">][</span><span class="s1">&#39;ios&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;15.4&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">london_co</span><span class="p">[</span><span class="s1">&#39;r1&#39;</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;4451&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">london_co</span><span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">][</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s1">&#39;10.255.0.101&#39;</span>
</pre></div>
</div>
<p>Функция sorted сортирует ключи словаря по возрастанию и возвращает
новый список с отсортированными ключами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">london</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="toctree-wrapper compound">
<span id="document-book/04_data_structures/dict_methods"></span><div class="section" id="id1">
<h5>Полезные методы для работы со словарями<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<div class="section" id="clear">
<h6><code class="docutils literal notranslate"><span class="pre">clear</span></code><a class="headerlink" href="#clear" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">clear</span></code> позволяет очистить словарь:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">london</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">london</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
<div class="section" id="copy">
<h6><code class="docutils literal notranslate"><span class="pre">copy</span></code><a class="headerlink" href="#copy" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">copy</span></code> позволяет создать полную копию словаря.</p>
<p>Если указать, что один словарь равен другому:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">london2</span> <span class="o">=</span> <span class="n">london</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">london</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mi">25489072</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">london2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">25489072</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">london</span><span class="p">[</span><span class="s1">&#39;vendor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Juniper&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">london2</span><span class="p">[</span><span class="s1">&#39;vendor&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s1">&#39;Juniper&#39;</span>
</pre></div>
</div>
<p>В этом случае london2 это еще одно имя, которое ссылается на словарь. И
при изменениях словаря london меняется и словарь london2, так как это
ссылки на один и тот же объект.</p>
<p>Поэтому, если нужно сделать копию словаря, надо использовать метод
copy():</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">london2</span> <span class="o">=</span> <span class="n">london</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">london</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="mi">25524512</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">london2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="mi">25563296</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">london</span><span class="p">[</span><span class="s1">&#39;vendor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Juniper&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">london2</span><span class="p">[</span><span class="s1">&#39;vendor&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="s1">&#39;Cisco&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="get">
<h6><code class="docutils literal notranslate"><span class="pre">get</span></code><a class="headerlink" href="#get" title="Ссылка на этот заголовок">¶</a></h6>
<p>Если при обращении к словарю указывается ключ, которого нет в словаре,
возникает ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">london</span><span class="p">[</span><span class="s1">&#39;ios&#39;</span><span class="p">]</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span>                                  <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">17</span><span class="o">-</span><span class="n">b4fae8480b21</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">london</span><span class="p">[</span><span class="s1">&#39;ios&#39;</span><span class="p">]</span>

<span class="ne">KeyError</span><span class="p">:</span> <span class="s1">&#39;ios&#39;</span>
</pre></div>
</div>
<p>Метод <code class="docutils literal notranslate"><span class="pre">get</span></code> запрашивает ключ, и если его нет, вместо ошибки
возвращает <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">london</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ios&#39;</span><span class="p">))</span>
<span class="kc">None</span>
</pre></div>
</div>
<p>Метод get() позволяет также указывать другое значение вместо <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">london</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ios&#39;</span><span class="p">,</span> <span class="s1">&#39;Ooops&#39;</span><span class="p">))</span>
<span class="n">Ooops</span>
</pre></div>
</div>
</div>
<div class="section" id="setdefault">
<h6><code class="docutils literal notranslate"><span class="pre">setdefault</span></code><a class="headerlink" href="#setdefault" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">setdefault</span></code> ищет ключ, и если его нет, вместо ошибки создает
ключ со значением <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">ios</span> <span class="o">=</span> <span class="n">london</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ios&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">ios</span><span class="p">)</span>
<span class="kc">None</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">london</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</pre></div>
</div>
<p>Если ключ есть, setdefault возвращает значение, которое ему
соответствует:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">london</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="s1">&#39;London1&#39;</span>
</pre></div>
</div>
<p>Второй аргумент позволяет указать, какое значение должно соответствовать
ключу:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">model</span> <span class="o">=</span> <span class="n">london</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco3580&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">Cisco3580</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">london</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span>
 <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco3580&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Метод setdefault заменяет такую конструкцию:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">london</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">value</span> <span class="o">=</span> <span class="n">london</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="o">...</span><span class="p">:</span> <span class="k">else</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">london</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;somevalue&#39;</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">value</span> <span class="o">=</span> <span class="n">london</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
</div>
<div class="section" id="keys-values-items">
<h6><code class="docutils literal notranslate"><span class="pre">keys,</span> <span class="pre">values,</span> <span class="pre">items</span></code><a class="headerlink" href="#keys-values-items" title="Ссылка на этот заголовок">¶</a></h6>
<p>Методы <code class="docutils literal notranslate"><span class="pre">keys</span></code>, <code class="docutils literal notranslate"><span class="pre">values</span></code>, <code class="docutils literal notranslate"><span class="pre">items</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">london</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">london</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">dict_values</span><span class="p">([</span><span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">london</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">dict_items</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;London1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;London Str&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p>Все три метода возвращают специальные объекты view, которые отображают
ключи, значения и пары ключ-значение словаря соответственно.</p>
<p>Очень важная особенность view заключается в том, что они меняются вместе
с изменением словаря. И фактически они лишь дают способ посмотреть на
соответствующие объекты, но не создают их копию.</p>
<p>На примере метода keys:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">london</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
<span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Сейчас переменной keys соответствует view <code class="docutils literal notranslate"><span class="pre">dict_keys</span></code>, в котором три
ключа: name, location и vendor.</p>
<p>Если добавить в словарь еще одну пару ключ-значение, объект keys
тоже поменяется:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">london</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;10.1.1.1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">keys</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Если нужно получить обычный список ключей, который не будет меняться с
изменениями словаря, достаточно конвертировать view в список:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">list_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">london</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">list_keys</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="del">
<h6><code class="docutils literal notranslate"><span class="pre">del</span></code><a class="headerlink" href="#del" title="Ссылка на этот заголовок">¶</a></h6>
<p>Удалить ключ и значение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">london</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="k">del</span> <span class="n">london</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">london</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="update">
<h6><code class="docutils literal notranslate"><span class="pre">update</span></code><a class="headerlink" href="#update" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод update позволяет добавлять в словарь содержимое другого словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">:</span><span class="s1">&#39;15.2&#39;</span><span class="p">})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.2&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Аналогичным образом можно обновить значения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;london-r1&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">:</span><span class="s1">&#39;15.4&#39;</span><span class="p">})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;london-r1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London Str&#39;</span><span class="p">,</span>
 <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/04_data_structures/create_dict"></span><div class="section" id="id1">
<h5>Варианты создания словаря<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<div class="section" id="id2">
<h6>Литерал<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h6>
<p>Словарь можно создать с помощью литерала:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="dict">
<h6>dict<a class="headerlink" href="#dict" title="Ссылка на этот заголовок">¶</a></h6>
<p>Конструктор <strong>dict</strong> позволяет создавать словарь несколькими способами.</p>
<p>Если в роли ключей используются строки, можно использовать такой вариант
создания словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;4451&#39;</span><span class="p">,</span> <span class="n">ios</span><span class="o">=</span><span class="s1">&#39;15.4&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Второй вариант создания словаря с помощью dict:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;4451&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ios&#39;</span><span class="p">,</span> <span class="s1">&#39;15.4&#39;</span><span class="p">)])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="dict-fromkeys">
<h6>dict.fromkeys<a class="headerlink" href="#dict-fromkeys" title="Ссылка на этот заголовок">¶</a></h6>
<p>В ситуации, когда надо создать словарь с известными ключами, но пока
что пустыми значениями (или одинаковыми значениями), очень удобен метод
<strong>fromkeys()</strong>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">d_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">d_keys</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</pre></div>
</div>
<p>По умолчанию метод fromkeys подставляет значение None. Но можно
указывать и свой вариант значения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">router_models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ISR2811&#39;</span><span class="p">,</span> <span class="s1">&#39;ISR2911&#39;</span><span class="p">,</span> <span class="s1">&#39;ISR2921&#39;</span><span class="p">,</span> <span class="s1">&#39;ASR9002&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">models_count</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">router_models</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">models_count</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ISR2811&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ISR2911&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ISR2921&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ASR9002&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
</div>
<p>Этот вариант создания словаря подходит не для всех случаев. Например,
при использовании изменяемого типа данных в значении, будет создана
ссылка на один и тот же объект:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">router_models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ISR2811&#39;</span><span class="p">,</span> <span class="s1">&#39;ISR2911&#39;</span><span class="p">,</span> <span class="s1">&#39;ISR2921&#39;</span><span class="p">,</span> <span class="s1">&#39;ASR9002&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">routers</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">router_models</span><span class="p">,</span> <span class="p">[])</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">routers</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;ISR2811&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;ISR2911&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;ISR2921&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;ASR9002&#39;</span><span class="p">:</span> <span class="p">[]}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">routers</span><span class="p">[</span><span class="s1">&#39;ASR9002&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;london_r1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">routers</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;ISR2811&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;london_r1&#39;</span><span class="p">],</span>
 <span class="s1">&#39;ISR2911&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;london_r1&#39;</span><span class="p">],</span>
 <span class="s1">&#39;ISR2921&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;london_r1&#39;</span><span class="p">],</span>
 <span class="s1">&#39;ASR9002&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;london_r1&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<p>В данном случае каждый ключ ссылается на один и тот же список. Поэтому,
при добавлении значения в один из списков обновляются и остальные.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Для такой задачи лучше подходит генератор словаря. Смотри раздел <a class="reference internal" href="contents.html#x-comprehensions"><span class="std std-ref">List, dict, set comprehensions</span></a></p>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/04_data_structures/tuple"></span><div class="section" id="tuple">
<h4>Кортеж (Tuple)<a class="headerlink" href="#tuple" title="Ссылка на этот заголовок">¶</a></h4>
<p>Кортеж в Python это:</p>
<ul class="simple">
<li>последовательность элементов, которые разделены между собой запятой и заключены в скобки</li>
<li>неизменяемый упорядоченный тип данных</li>
</ul>
<p>Грубо говоря, кортеж - это список, который нельзя изменить. То есть, в
кортеже есть только права на чтение. Это может быть защитой от случайных
изменений.</p>
<p>Создать пустой кортеж:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">tuple1</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">tuple1</span><span class="p">)</span>
<span class="p">()</span>
</pre></div>
</div>
<p>Кортеж из одного элемента (обратите внимание на запятую):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">tuple2</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<p>Кортеж из списка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">list_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">tuple_keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">list_keys</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">tuple_keys</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>К объектам в кортеже можно обращаться, как и к объектам списка, по
порядковому номеру:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">tuple_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;hostname&#39;</span>
</pre></div>
</div>
<p>Но так как кортеж неизменяем, присвоить новое значение нельзя:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">tuple_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">9</span><span class="o">-</span><span class="mi">1</span><span class="n">c7162cdefa3</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">tuple_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;tuple&#39;</span> <span class="nb">object</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">item</span> <span class="n">assignment</span>
</pre></div>
</div>
<p>Функция sorted сортирует элементы кортежа по возрастанию и возвращает
новый список с отсортированными элементами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">tuple_keys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tuple_keys</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<span id="document-book/04_data_structures/set"></span><div class="section" id="set">
<h4>Множество (Set)<a class="headerlink" href="#set" title="Ссылка на этот заголовок">¶</a></h4>
<p>Множество - это изменяемый неупорядоченный тип данных. В множестве
всегда содержатся только уникальные элементы.</p>
<p>Множество в Python - это последовательность элементов, которые разделены
между собой запятой и заключены в фигурные скобки.</p>
<p>С помощью множества можно легко убрать повторяющиеся элементы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">set</span><span class="p">(</span><span class="n">vlans</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">set1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">vlans</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">set1</span><span class="p">)</span>
<span class="p">{</span><span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">}</span>
</pre></div>
</div>
<div class="toctree-wrapper compound">
<span id="document-book/04_data_structures/set_methods"></span><div class="section" id="id1">
<h5>Полезные методы для работы с множествами<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<div class="section" id="add">
<h6><code class="docutils literal notranslate"><span class="pre">add()</span></code><a class="headerlink" href="#add" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">add()</span></code> добавляет элемент во множество:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">set1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">set1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">set1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="discard">
<h6><code class="docutils literal notranslate"><span class="pre">discard()</span></code><a class="headerlink" href="#discard" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">discard()</span></code> позволяет удалять элементы, не выдавая ошибку,
если элемента в множестве нет:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">set1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">set1</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">set1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">set1</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">set1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="clear">
<h6><code class="docutils literal notranslate"><span class="pre">clear()</span></code><a class="headerlink" href="#clear" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">clear()</span></code> очищает множество:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">set1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">set1</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">set1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">set</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/04_data_structures/set_operations"></span><div class="section" id="id1">
<h5>Операции с множествами<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Множества полезны тем, что с ними можно делать различные операции и
находить объединение множеств, пересечение и так далее.</p>
<p>Объединение множеств можно получить с помощью метода <code class="docutils literal notranslate"><span class="pre">union()</span></code> или
оператора <code class="docutils literal notranslate"><span class="pre">|</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">vlans1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">}</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">vlans2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">200</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">vlans1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">vlans2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">200</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">vlans1</span> <span class="o">|</span> <span class="n">vlans2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">200</span><span class="p">}</span>
</pre></div>
</div>
<p>Пересечение множеств можно получить с помощью метода
<code class="docutils literal notranslate"><span class="pre">intersection()</span></code> или оператора <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">vlans1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">}</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">vlans2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">200</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">vlans1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">vlans2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">{</span><span class="mi">100</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">vlans1</span> <span class="o">&amp;</span> <span class="n">vlans2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="p">{</span><span class="mi">100</span><span class="p">}</span>
</pre></div>
</div>
</div>
<span id="document-book/04_data_structures/create_set"></span><div class="section" id="id1">
<h5>Варианты создания множества<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Нельзя создать пустое множество с помощью литерала (так как в таком
случае это будет не множество, а словарь):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">set1</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">set1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">dict</span>
</pre></div>
</div>
<p>Но пустое множество можно создать таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">set2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">set2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">set</span>
</pre></div>
</div>
<p>Множество из строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">set</span><span class="p">(</span><span class="s1">&#39;long long long long string&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Множество из списка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-book/04_data_structures/boolean"></span><div class="section" id="id1">
<h4>Булевы значения<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Булевы значения в Python это две константы <code class="docutils literal notranslate"><span class="pre">True</span></code> и <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>В Python истинными и ложными значениями считаются не только True и False.</p>
<ul class="simple">
<li>истинное значение:<ul>
<li>любое ненулевое число</li>
<li>любая непустая строка</li>
<li>любой непустой объект</li>
</ul>
</li>
<li>ложное значение:<ul>
<li>0</li>
<li>None</li>
<li>пустая строка</li>
<li>пустой объект</li>
</ul>
</li>
</ul>
<p>Остальные истинные и ложные значения, как правило, логически следуют из условия.</p>
<p>Для проверки булевого значения объекта, можно воспользоваться <code class="docutils literal notranslate"><span class="pre">bool</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">empty_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">empty_list</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">bool</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<span id="document-book/04_data_structures/convert_type"></span><div class="section" id="id1">
<h4>Преобразование типов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python есть несколько полезных встроенных функций, которые позволяют
преобразовать данные из одного типа в другой.</p>
<div class="section" id="int">
<h5><code class="docutils literal notranslate"><span class="pre">int</span></code><a class="headerlink" href="#int" title="Ссылка на этот заголовок">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">int</span></code> преобразует строку в int:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;10&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="mi">10</span>
</pre></div>
</div>
<p>С помощью функции int можно преобразовать и число в двоичной записи в
десятичную (двоичная запись должна быть в виде строки)</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;11111111&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">255</span>
</pre></div>
</div>
</div>
<div class="section" id="bin">
<h5><code class="docutils literal notranslate"><span class="pre">bin</span></code><a class="headerlink" href="#bin" title="Ссылка на этот заголовок">¶</a></h5>
<p>Преобразовать десятичное число в двоичный формат можно с помощью
<code class="docutils literal notranslate"><span class="pre">bin</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">bin</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;0b1010&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">bin</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;0b11111111&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="hex">
<h5><code class="docutils literal notranslate"><span class="pre">hex</span></code><a class="headerlink" href="#hex" title="Ссылка на этот заголовок">¶</a></h5>
<p>Аналогичная функция есть и для преобразования в шестнадцатеричный
формат:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">hex</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;0xa&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">hex</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;0xff&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="list">
<h5><code class="docutils literal notranslate"><span class="pre">list</span></code><a class="headerlink" href="#list" title="Ссылка на этот заголовок">¶</a></h5>
<p>Функция <code class="docutils literal notranslate"><span class="pre">list</span></code> преобразует аргумент в список:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">list</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">})</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">list</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="set">
<h5><code class="docutils literal notranslate"><span class="pre">set</span></code><a class="headerlink" href="#set" title="Ссылка на этот заголовок">¶</a></h5>
<p>Функция <code class="docutils literal notranslate"><span class="pre">set</span></code> преобразует аргумент в множество:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="nb">set</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;string string&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Эта функция очень полезна, когда нужно получить уникальные элементы в
последовательности.</p>
</div>
<div class="section" id="tuple">
<h5><code class="docutils literal notranslate"><span class="pre">tuple</span></code><a class="headerlink" href="#tuple" title="Ссылка на этот заголовок">¶</a></h5>
<p>Функция <code class="docutils literal notranslate"><span class="pre">tuple</span></code> преобразует аргумент в кортеж:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="nb">tuple</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">})</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Это может пригодиться в том случае, если нужно получить неизменяемый
объект.</p>
</div>
<div class="section" id="str">
<h5><code class="docutils literal notranslate"><span class="pre">str</span></code><a class="headerlink" href="#str" title="Ссылка на этот заголовок">¶</a></h5>
<p>Функция <code class="docutils literal notranslate"><span class="pre">str</span></code> преобразует аргумент в строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;10&#39;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/04_data_structures/check_type"></span><div class="section" id="id1">
<h4>Проверка типов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>При преобразовании типов данных могут возникнуть ошибки такого рода:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="o">------------------------------------------------------</span>
<span class="ne">ValueError</span>           <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">42</span><span class="o">-</span><span class="n">b3c3f4515dd4</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>

<span class="ne">ValueError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">literal</span> <span class="k">for</span> <span class="nb">int</span><span class="p">()</span> <span class="k">with</span> <span class="n">base</span> <span class="mi">10</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span>
</pre></div>
</div>
<p>Ошибка абсолютно логичная. Мы пытаемся преобразовать в десятичный формат
строку „a“.</p>
<p>И если тут пример выглядит, возможно, глупым, тем не менее, когда нужно,
например, пройтись по списку строк и преобразовать в числа те из них,
которые содержат числа, можно получить такую ошибку.</p>
<p>Чтобы избежать её, было бы хорошо иметь возможность проверить, с чем мы
работаем.</p>
<div class="section" id="isdigit">
<h5><code class="docutils literal notranslate"><span class="pre">isdigit</span></code><a class="headerlink" href="#isdigit" title="Ссылка на этот заголовок">¶</a></h5>
<p>В Python такие методы есть. Например, чтобы проверить, состоит ли строка
из одних цифр, можно использовать метод <code class="docutils literal notranslate"><span class="pre">isdigit</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s2">&quot;a&quot;</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s2">&quot;a10&quot;</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s2">&quot;10&quot;</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="isalpha">
<h5><code class="docutils literal notranslate"><span class="pre">isalpha</span></code><a class="headerlink" href="#isalpha" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">isalpha</span></code> позволяет проверить, состоит ли строка из одних
букв:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s2">&quot;a&quot;</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s2">&quot;a100&quot;</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s2">&quot;a--  &quot;</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s2">&quot;a &quot;</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="section" id="isalnum">
<h5><code class="docutils literal notranslate"><span class="pre">isalnum</span></code><a class="headerlink" href="#isalnum" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">isalnum</span></code> позволяет проверить, состоит ли строка из букв или
цифр:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s2">&quot;a&quot;</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="s2">&quot;a10&quot;</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="type">
<h5><code class="docutils literal notranslate"><span class="pre">type</span></code><a class="headerlink" href="#type" title="Ссылка на этот заголовок">¶</a></h5>
<p>Иногда, в зависимости от результата, библиотека или функция может
выводить разные типы объектов. Например, если объект один, возвращается
строка, если несколько, то возвращается кортеж.</p>
<p>Нам же надо построить ход программы по-разному, в зависимости от того,
была ли возвращена строка или кортеж.</p>
<p>В этом может помочь функция <code class="docutils literal notranslate"><span class="pre">type</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">str</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Аналогично с кортежем (и другими типами данных):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">type</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">tuple</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="nb">type</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="nb">tuple</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="nb">type</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="nb">list</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/04_data_structures/method_chaining"></span><div class="section" id="id1">
<h4>Вызов методов цепочкой<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Часто с данными надо выполнить несколько операций, например:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;switchport trunk allowed vlan 10,20,30&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">words</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;switchport&#39;</span><span class="p">,</span> <span class="s1">&#39;trunk&#39;</span><span class="p">,</span> <span class="s1">&#39;allowed&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan&#39;</span><span class="p">,</span> <span class="s1">&#39;10,20,30&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">vlans_str</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">vlans_str</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;10,20,30&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="n">vlans_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">vlans</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Или в скрипте:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;switchport trunk allowed vlan 10,20,30&quot;</span>
<span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">vlans_str</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">vlans</span> <span class="o">=</span> <span class="n">vlans_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vlans</span><span class="p">)</span>
</pre></div>
</div>
<p>В этом случае переменные используются для хранения промежуточного результата
и последующие методы/действия выполняются уже с переменной.
Это совершенно нормальный вариант кода, особенно поначалу, когда тяжело
воспринимать более сложные выражения.</p>
<p>Однако в Python часто встречаются выражения, в которых действия или методы
применяются один за другим в одном выражении.
Например, предыдущий код можно записать так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;switchport trunk allowed vlan 10,20,30&quot;</span>
<span class="n">vlans</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vlans</span><span class="p">)</span>
</pre></div>
</div>
<p>Так как тут нет выражений в скобках, которые бы указывали приоритет выполнения,
все выполняется слева направо.
Сначала выполняется <code class="docutils literal notranslate"><span class="pre">line.split()</span></code> - получаем список, затем к полученному списку
применяется <code class="docutils literal notranslate"><span class="pre">[-1]</span></code> - получаем последний элемент списка, строку <code class="docutils literal notranslate"><span class="pre">10,20,30</span></code>.
К этой строке применяется метод <code class="docutils literal notranslate"><span class="pre">split(&quot;,&quot;)</span></code> и в итоге получаем список <code class="docutils literal notranslate"><span class="pre">['10',</span> <span class="pre">'20',</span> <span class="pre">'30']</span></code>.</p>
<p>Главный нюанс при написании таких цепочек предыдущий метод/действие должен возвращать то,
что ждет следующий метод/дествие.
И обязательно чтобы что-то возвращалось, иначе будет ошибка.</p>
</div>
<span id="document-book/04_data_structures/sorting"></span><div class="section" id="id1">
<h4>Основы сортировки данных<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>При сортировке данных типа списка списков или списка кортежей,
<code class="docutils literal notranslate"><span class="pre">sorted</span></code> сортирует по первому элементу вложенных списков (кортежей),
а если первый элемент одинаковый, по второму:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
<p>Если сортировка делается для списка чисел, которые записаны как строки,
сортировка будет лексикографической, не натуральной и порядок будет таким:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">vlans</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Чтобы сортировка была «правильной» надо преобразовать вланы в числа.</p>
<p>Эта же проблема проявляется, например, с IP-адресами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">ip_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;10.1.1.1&quot;</span><span class="p">,</span> <span class="s2">&quot;10.1.10.1&quot;</span><span class="p">,</span> <span class="s2">&quot;10.1.2.1&quot;</span><span class="p">,</span> <span class="s2">&quot;10.1.11.1&quot;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ip_list</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.10.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.11.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.2.1&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Как решить проблему с сортировкой IP-адресов рассматривается в разделе «10. Полезные функции».</p>
</div>
<span id="document-book/04_data_structures/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#text-sequence-type-str">Strings</a>.
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#string-methods">String
Methods</a></li>
<li><a class="reference external" href="https://docs.python.org/3/tutorial/introduction.html#lists">Lists
basics</a>.
<a class="reference external" href="https://docs.python.org/3/tutorial/datastructures.html#more-on-lists">More on
lists</a></li>
<li><a class="reference external" href="https://docs.python.org/3/tutorial/datastructures.html#tuples-and-sequences">Tuples</a>.
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuples">More on
tuples</a></li>
<li><a class="reference external" href="https://docs.python.org/3/tutorial/datastructures.html#sets">Sets
basics</a>.
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set">More on
sets</a></li>
<li><a class="reference external" href="https://docs.python.org/3/tutorial/datastructures.html#dictionaries">Dict
basics</a>.
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#typesmapping">More on
dicts</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#typesseq-common">Common Sequence
Operations</a></li>
</ul>
<p>Форматирование строк:</p>
<ul class="simple">
<li><a class="reference external" href="https://pyformat.info/">Примеры использования форматирования
строк</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/string.html#format-string-syntax">Документация по форматированию
строк</a></li>
<li><a class="reference external" href="https://realpython.com/python-f-strings/">Python 3’s f-Strings: An Improved String Formatting Syntax
(Guide)</a></li>
<li><a class="reference external" href="https://realpython.com/python-string-formatting/">Python String Formatting Best
Practices</a></li>
</ul>
</div>
<span id="document-exercises/04_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В разделе 4 тесты можно легко «обмануть» сделав нужный вывод,
без получения результатов из исходных данных с помощью Python.
Это не значит, что задание сделано правильно, просто на данном этапе сложно иначе
проверять результат.</p>
</div>
<div class="section" id="id2">
<h5>Задание 4.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Используя подготовленную строку nat, получить новую строку, в которой в имени
интерфейса вместо FastEthernet написано GigabitEthernet.
Полученную новую строку вывести на стандартный поток вывода (stdout) с помощью print.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nat</span> <span class="o">=</span> <span class="s2">&quot;ip nat inside source list ACL interface FastEthernet0/1 overload&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Задание 4.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Преобразовать строку в переменной mac из формата XXXX:XXXX:XXXX
в формат XXXX.XXXX.XXXX
Полученную новую строку вывести на стандартный поток вывода (stdout) с помощью print.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mac</span> <span class="o">=</span> <span class="s2">&quot;AAAA:BBBB:CCCC&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Задание 4.3<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Получить из строки config такой список VLANов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Записать итоговый список в переменную result.
(именно эта переменная будет проверяться в тесте)</p>
<p>Полученный список result вывести на стандартный поток вывода (stdout)
с помощью print.
Тут очень важный момент, что надо получить именно список (тип данных), а не,
например, строку, которая похожа на показанный список.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="s2">&quot;switchport trunk allowed vlan 1,3,10,20,30,100&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Задание 4.4<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Список vlans это список VLANов, собранных со всех устройств сети,
поэтому в списке есть повторяющиеся номера VLAN.</p>
<p>Из списка vlans нужно получить новый список уникальных номеров VLANов,
отсортированный по возрастанию номеров. Для получения итогового
списка нельзя удалять конкретные vlanы вручную.</p>
<p>Записать итоговый список уникальных номеров VLANов в переменную result.
(именно эта переменная будет проверяться в тесте)</p>
<p>Полученный список result вывести на стандартный поток вывода (stdout)
с помощью print.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>Задание 4.5<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Из строк command1 и command2 получить список VLANов, которые есть
и в команде command1 и в команде command2 (пересечение).</p>
<p>В данном случае, результатом должен быть такой список: <code class="docutils literal notranslate"><span class="pre">['1',</span> <span class="pre">'3',</span> <span class="pre">'8']</span></code></p>
<p>Записать итоговый список в переменную result. (именно эта переменная будет
проверяться в тесте)</p>
<p>Полученный список result вывести на стандартный поток вывода (stdout) с помощью print.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">command1</span> <span class="o">=</span> <span class="s2">&quot;switchport trunk allowed vlan 1,2,3,5,8&quot;</span>
<span class="n">command2</span> <span class="o">=</span> <span class="s2">&quot;switchport trunk allowed vlan 1,3,8,9&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h5>Задание 4.6<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h5>
<p>Обработать строку ospf_route и вывести информацию на стандартный поток вывода в виде:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Prefix</span>                <span class="mf">10.0</span><span class="o">.</span><span class="mf">24.0</span><span class="o">/</span><span class="mi">24</span>
<span class="n">AD</span><span class="o">/</span><span class="n">Metric</span>             <span class="mi">110</span><span class="o">/</span><span class="mi">41</span>
<span class="n">Next</span><span class="o">-</span><span class="n">Hop</span>              <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
<span class="n">Last</span> <span class="n">update</span>           <span class="mi">3</span><span class="n">d18h</span>
<span class="n">Outbound</span> <span class="n">Interface</span>    <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span>
</pre></div>
</div>
<p>Ограничение: Все задания надо выполнять используя только пройденные
темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ospf_route</span> <span class="o">=</span> <span class="s2">&quot;       10.0.24.0/24 [110/41] via 10.0.13.3, 3d18h, FastEthernet0/0&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h5>Задание 4.7<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h5>
<p>Преобразовать MAC-адрес в строке mac в двоичную строку такого вида:
„101010101010101010111011101110111100110011001100“</p>
<p>Полученную новую строку вывести на стандартный поток вывода (stdout) с помощью print.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные
темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mac</span> <span class="o">=</span> <span class="s2">&quot;AAAA:BBBB:CCCC&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h5>Задание 4.8<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h5>
<p>Преобразовать IP-адрес в переменной ip в двоичный формат и вывести на стандартный
поток вывода вывод столбцами, таким образом:</p>
<ul class="simple">
<li>первой строкой должны идти десятичные значения байтов</li>
<li>второй строкой двоичные значения</li>
</ul>
<p>Вывод должен быть упорядочен также, как в примере:</p>
<ul class="simple">
<li>столбцами</li>
<li>ширина столбца 10 символов (в двоичном формате
надо добавить два пробела между столбцами
для разделения октетов между собой)</li>
</ul>
<p>Пример вывода для адреса 10.1.1.1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span>        <span class="mi">1</span>         <span class="mi">1</span>         <span class="mi">1</span>
<span class="mi">00001010</span>  <span class="mi">00000001</span>  <span class="mi">00000001</span>  <span class="mi">00000001</span>
</pre></div>
</div>
<p>Ограничение: Все задания надо выполнять используя только пройденные
темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="o">=</span> <span class="s2">&quot;192.168.3.1&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/05_basic_scripts/index"></span><div class="section" id="basic-scripts-index">
<span id="id1"></span><h3>5. Создание базовых скриптов<a class="headerlink" href="#basic-scripts-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>Если говорить в целом, то скрипт - это обычный файл. В этом файле
хранится последовательность команд, которые необходимо выполнить.</p>
<p>Начнем с базового скрипта. Выведем на стандартный поток вывода несколько
строк.</p>
<p>Для этого надо создать файл access_template.py с таким содержимым:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;switchport access vlan </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">access_template</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>Сначала элементы списка объединяются в строку, которая разделена
символом <code class="docutils literal notranslate"><span class="pre">\n</span></code>, а в строку подставляется номер VLAN, используя
форматирование строк.</p>
<p>После этого надо сохранить файл и перейти в командную строку.</p>
<p>Так выглядит выполнение скрипта:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ python access_template.py
switchport mode access
switchport access vlan 5
switchport nonegotiate
spanning-tree portfast
spanning-tree bpduguard enable
</pre></div>
</div>
<p>Ставить расширение <code class="docutils literal notranslate"><span class="pre">.py</span></code> у файла не обязательно, но, если вы используете Windows,
то это желательно делать, так как Windows использует расширение файла для определения того, как
обрабатывать файл.</p>
<p>В курсе все скрипты, которые будут создаваться, используют
расширение .py. Можно сказать, что это «хороший тон» - создавать
скрипты Python с таким расширением.</p>
<div class="toctree-wrapper compound">
<span id="document-book/05_basic_scripts/executable"></span><div class="section" id="id1">
<h4>Исполняемый файл<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для того, чтобы файл был исполняемым, и не нужно было каждый раз писать
python перед вызовом файла, нужно:</p>
<ul class="simple">
<li>сделать файл исполняемым (для Linux)</li>
<li><strong>в первой строке файла</strong> должна находиться строка <code class="docutils literal notranslate"><span class="pre">#!/usr/bin/env</span> <span class="pre">python</span></code>
или <code class="docutils literal notranslate"><span class="pre">#!/usr/bin/env</span> <span class="pre">python3</span></code>, в зависимости от того,
какая версия Python используется по умолчанию</li>
</ul>
<p>Пример файла access_template_exec.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;switchport access vlan </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">access_template</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>После этого:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">access_template_exec</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Теперь можно вызывать файл таким образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./access_template_exec.py
</pre></div>
</div>
</div>
<span id="document-book/05_basic_scripts/args"></span><div class="section" id="argv">
<h4>Передача аргументов скрипту (argv)<a class="headerlink" href="#argv" title="Ссылка на этот заголовок">¶</a></h4>
<p>Очень часто скрипт решает какую-то общую задачу. Например, скрипт
обрабатывает как-то файл конфигурации. Конечно, в таком случае не
хочется каждый раз руками в скрипте править название файла.</p>
<p>Гораздо лучше будет передавать имя файла как аргумент скрипта и затем
использовать уже указанный файл.</p>
<p>Модуль sys позволяет работать с аргументами скрипта с помощью argv.</p>
<p>Пример access_template_argv.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>

<span class="n">interface</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">vlan</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;switchport access vlan </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;interface </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">access_template</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vlan</span><span class="p">))</span>
</pre></div>
</div>
<p>Проверка работы скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python access_template_argv.py Gi0/7 4
interface Gi0/7
switchport mode access
switchport access vlan 4
switchport nonegotiate
spanning-tree portfast
spanning-tree bpduguard enable
</pre></div>
</div>
<p>Аргументы, которые были переданы скрипту, подставляются как значения в
шаблон.</p>
<p>Тут надо пояснить несколько моментов:</p>
<ul class="simple">
<li>argv - это список</li>
<li>все аргументы находятся в списке в виде строк</li>
<li>argv содержит не только аргументы, которые передали скрипту, но и название самого скрипта</li>
</ul>
<p>В данном случае в списке argv находятся такие элементы:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;access_template_argv.py&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/7&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Сначала идет имя самого скрипта, затем аргументы, в том же порядке.</p>
</div>
<span id="document-book/05_basic_scripts/user_input"></span><div class="section" id="id1">
<h4>Ввод информации пользователем<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Иногда необходимо получить информацию от пользователя, например, запросить пароль.</p>
<p>Для получения информации от пользователя используется функция <code class="docutils literal notranslate"><span class="pre">input</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [1]: print(input(&#39;Твой любимый протокол маршрутизации? &#39;))
Твой любимый протокол маршрутизации? OSPF
OSPF
</pre></div>
</div>
<p>В данном случае информация тут же выводится пользователю, но
кроме этого, информация, которую ввел пользователь, может быть сохранена
в какую-то переменную и может использоваться далее в скрипте.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [2]: protocol = input(&#39;Твой любимый протокол маршрутизации? &#39;)
Твой любимый протокол маршрутизации? OSPF

In [3]: print(protocol)
OSPF
</pre></div>
</div>
<p>В скобках обычно пишется какой-то вопрос, который уточняет, какую
информацию нужно ввести.</p>
<p>Запрос информации из скрипта (файл access_template_input.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter interface type and number: &#39;</span><span class="p">)</span>
<span class="n">vlan</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter VLAN number: &#39;</span><span class="p">)</span>

<span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;switchport access vlan </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;interface </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">access_template</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vlan</span><span class="p">))</span>
</pre></div>
</div>
<p>В первых двух строках запрашивается информация у пользователя.</p>
<p>Строка <code class="docutils literal notranslate"><span class="pre">print('\n'</span> <span class="pre">+</span> <span class="pre">'-'</span> <span class="pre">*</span> <span class="pre">30)</span></code> используется для того,
чтобы визуально отделить запрос информации от вывода.</p>
<p>Выполнение скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python access_template_input.py
Enter interface type and number: Gi0/3
Enter VLAN number: 55

------------------------------
interface Gi0/3
switchport mode access
switchport access vlan 55
switchport nonegotiate
spanning-tree portfast
spanning-tree bpduguard enable
</pre></div>
</div>
</div>
<span id="document-exercises/05_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 5.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>В задании создан словарь, с информацией о разных устройствах.</p>
<p>Необходимо запросить у пользователя ввод имени устройства (r1, r2 или sw1).
И вывести информацию о соответствующем устройстве на стандартный поток вывода
(информация будет в виде словаря).</p>
<p>Пример выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python task_5_1.py
Введите имя устройства: r1
{&#39;location&#39;: &#39;21 New Globe Walk&#39;, &#39;vendor&#39;: &#39;Cisco&#39;, &#39;model&#39;: &#39;4451&#39;, &#39;ios&#39;: &#39;15.4&#39;, &#39;ip&#39;: &#39;10.255.0.1&#39;}
</pre></div>
</div>
<p>Ограничение: нельзя изменять словарь london_co.</p>
<p>Все задания надо выполнять используя только пройденные темы. То есть эту задачу можно
решить без использования условия if.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">london_co</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;r1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;4451&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;15.4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.1&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;4451&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;15.4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.2&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;sw1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;3850&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;3.6.XE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.101&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vlans&quot;</span><span class="p">:</span> <span class="s2">&quot;10,20,30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;routing&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 5.1a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Переделать скрипт из задания 5.1 таким образом, чтобы, кроме имени устройства,
запрашивался также параметр устройства, который нужно отобразить.</p>
<p>Вывести информацию о соответствующем параметре, указанного устройства.</p>
<p>Пример выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python task_5_1a.py
Введите имя устройства: r1
Введите имя параметра: ios
15.4
</pre></div>
</div>
<p>Ограничение: нельзя изменять словарь london_co.</p>
<p>Все задания надо выполнять используя только пройденные темы. То есть эту задачу можно
решить без использования условия if.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">london_co</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;r1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;4451&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;15.4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.1&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;4451&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;15.4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.2&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;sw1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;3850&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;3.6.XE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.101&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vlans&quot;</span><span class="p">:</span> <span class="s2">&quot;10,20,30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;routing&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="b">
<h5>Задание 5.1b<a class="headerlink" href="#b" title="Ссылка на этот заголовок">¶</a></h5>
<p>Переделать скрипт из задания 5.1a таким образом, чтобы, при запросе параметра,
отображался список возможных параметров. Список параметров надо получить из словаря,
а не прописывать вручную.</p>
<p>Вывести информацию о соответствующем параметре, указанного устройства.</p>
<p>Пример выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python task_5_1b.py
Введите имя устройства: r1
Введите имя параметра (location, vendor, model, ios, ip): ip
10.255.0.1

$ python task_5_1b.py
Введите имя устройства: sw1
Введите имя параметра (location, vendor, model, ios, ip, vlans, routing): ip
10.255.0.101
</pre></div>
</div>
<p>Ограничение: нельзя изменять словарь london_co.</p>
<p>Все задания надо выполнять используя только пройденные темы. То есть эту задачу можно
решить без использования условия if.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">london_co</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;r1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;4451&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;15.4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.1&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;4451&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;15.4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.2&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;sw1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;3850&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;3.6.XE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.101&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vlans&quot;</span><span class="p">:</span> <span class="s2">&quot;10,20,30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;routing&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="c">
<h5>Задание 5.1c<a class="headerlink" href="#c" title="Ссылка на этот заголовок">¶</a></h5>
<p>Переделать скрипт из задания 5.1b таким образом, чтобы, при запросе параметра,
которого нет в словаре устройства, отображалось сообщение „Такого параметра нет“.
Задание относится только к параметрам устройств, не к самим устройствам.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Попробуйте набрать неправильное имя параметра  или несуществующий параметр,
чтобы увидеть какой будет результат. А затем выполняйте задание.</p>
</div>
<p>Если выбран существующий параметр, вывести информацию о соответствующем параметре,
указанного устройства.</p>
<p>Пример выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python task_5_1c.py
Введите имя устройства: r1
Введите имя параметра (ios, model, vendor, location, ip): ips
Такого параметра нет
</pre></div>
</div>
<p>Ограничение: нельзя изменять словарь london_co.</p>
<p>Все задания надо выполнять используя только пройденные темы. То есть эту задачу можно
решить без использования условия if.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">london_co</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;r1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;4451&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;15.4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.1&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;4451&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;15.4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.2&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;sw1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;3850&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;3.6.XE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.101&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vlans&quot;</span><span class="p">:</span> <span class="s2">&quot;10,20,30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;routing&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="d">
<h5>Задание 5.1d<a class="headerlink" href="#d" title="Ссылка на этот заголовок">¶</a></h5>
<p>Переделать скрипт из задания 5.1c таким образом, чтобы, при запросе параметра,
пользователь мог вводить название параметра в любом регистре.</p>
<p>Пример выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python task_5_1d.py
Введите имя устройства: r1
Введите имя параметра (ios, model, vendor, location, ip): IOS
15.4
</pre></div>
</div>
<p>Ограничение: нельзя изменять словарь london_co.</p>
<p>Все задания надо выполнять используя только пройденные темы. То есть эту задачу можно
решить без использования условия if.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">london_co</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;r1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;4451&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;15.4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.1&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;4451&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;15.4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.2&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;sw1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;21 New Globe Walk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;3850&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;3.6.XE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.255.0.101&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vlans&quot;</span><span class="p">:</span> <span class="s2">&quot;10,20,30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;routing&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Задание 5.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Запросить у пользователя ввод IP-сети в формате: <code class="docutils literal notranslate"><span class="pre">10.1.1.0/24</span></code></p>
<p>Затем вывести информацию о сети и маске в таком формате:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Network</span><span class="p">:</span>
<span class="mi">10</span>        <span class="mi">1</span>         <span class="mi">1</span>         <span class="mi">0</span>
<span class="mi">00001010</span>  <span class="mi">00000001</span>  <span class="mi">00000001</span>  <span class="mi">00000000</span>

<span class="n">Mask</span><span class="p">:</span>
<span class="o">/</span><span class="mi">24</span>
<span class="mi">255</span>       <span class="mi">255</span>       <span class="mi">255</span>       <span class="mi">0</span>
<span class="mi">11111111</span>  <span class="mi">11111111</span>  <span class="mi">11111111</span>  <span class="mi">00000000</span>
</pre></div>
</div>
<p>Проверить работу скрипта на разных комбинациях сеть/маска.</p>
<p>Подсказка: Получить маску в двоичном формате можно так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;1&quot;</span> <span class="o">*</span> <span class="mi">28</span> <span class="o">+</span> <span class="s2">&quot;0&quot;</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;11111111111111111111111111110000&quot;</span>
</pre></div>
</div>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
<div class="section" id="id4">
<h5>Задание 5.2a<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Всё, как в задании 5.2, но, если пользователь ввел адрес хоста, а не адрес сети,
надо преобразовать адрес хоста в адрес сети и вывести адрес сети и маску,
как в задании 5.2.</p>
<p>Пример адреса сети (все биты хостовой части равны нулю):</p>
<ul class="simple">
<li>10.0.1.0/24</li>
<li>190.1.0.0/16</li>
</ul>
<p>Пример адреса хоста:</p>
<ul class="simple">
<li>10.0.1.1/24 - хост из сети 10.0.1.0/24</li>
<li>10.0.5.195/28 - хост из сети 10.0.5.192/28</li>
</ul>
<p>Если пользователь ввел адрес 10.0.1.1/24, вывод должен быть таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Network</span><span class="p">:</span>
<span class="mi">10</span>        <span class="mi">0</span>         <span class="mi">1</span>         <span class="mi">0</span>
<span class="mi">00001010</span>  <span class="mi">00000000</span>  <span class="mi">00000001</span>  <span class="mi">00000000</span>

<span class="n">Mask</span><span class="p">:</span>
<span class="o">/</span><span class="mi">24</span>
<span class="mi">255</span>       <span class="mi">255</span>       <span class="mi">255</span>       <span class="mi">0</span>
<span class="mi">11111111</span>  <span class="mi">11111111</span>  <span class="mi">11111111</span>  <span class="mi">00000000</span>
</pre></div>
</div>
<p>Проверить работу скрипта на разных комбинациях хост/маска, например: 10.0.5.195/28, 10.0.1.1/24</p>
<p>Подсказка:</p>
<p>Есть адрес хоста в двоичном формате и маска сети 28. Адрес сети это
первые 28 бит адреса хоста + 4 ноля. То есть, например, адрес хоста 10.1.1.195/28  в двоичном формате будет <code class="docutils literal notranslate"><span class="pre">bin_ip</span> <span class="pre">=</span> <span class="pre">&quot;00001010000000010000000111000011&quot;</span></code>.</p>
<p>А адрес сети будет первых 28 символов из bin_ip + 0000 (4 потому что всего в адресе может быть 32 бита, а 32 - 28 = 4): <code class="docutils literal notranslate"><span class="pre">00001010000000010000000111000000</span></code></p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
<div class="section" id="id5">
<h5>Задание 5.3<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скрипт должен запрашивать у пользователя:</p>
<ul class="simple">
<li>информацию о режиме интерфейса (access/trunk)</li>
<li>номере интерфейса (тип и номер, вида Gi0/3)</li>
<li>номер VLANа (для режима trunk будет вводиться список VLANов)</li>
</ul>
<p>В зависимости от выбранного режима, на стандартный поток вывода,
должна возвращаться соответствующая конфигурация access или trunk
(шаблоны команд находятся в списках access_template и trunk_template).</p>
<p>При этом, сначала должна идти строка interface и подставлен номер интерфейса,
а затем соответствующий шаблон, в который подставлен номер VLANа (или список VLANов).</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.
То есть эту задачу можно решить без использования условия if и циклов for/while.</p>
<p>Подсказка:
Подводящим к этому заданию было задание 5.1.
Чтобы было легче решить это задание, можно посмотреть на задание 5.1 и разобраться как там получилось
вывести разную информацию в зависимости от ввода пользователя.</p>
<p>Ниже примеры выполнения скрипта, чтобы было проще понять задачу.</p>
<p>Пример выполнения скрипта, при выборе режима access:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python task_5_3.py
Введите режим работы интерфейса (access/trunk): access
Введите тип и номер интерфейса: Fa0/6
Введите номер влан(ов): 3

interface Fa0/6
switchport mode access
switchport access vlan 3
switchport nonegotiate
spanning-tree portfast
spanning-tree bpduguard enable
</pre></div>
</div>
<p>Пример выполнения скрипта, при выборе режима trunk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python task_5_3.py
Введите режим работы интерфейса (access/trunk): trunk
Введите тип и номер интерфейса: Fa0/7
Введите номер влан(ов): 2,3,4,5

interface Fa0/7
switchport trunk encapsulation dot1q
switchport mode trunk
switchport trunk allowed vlan 2,3,4,5
</pre></div>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span> <span class="s2">&quot;switchport access vlan </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport nonegotiate&quot;</span><span class="p">,</span> <span class="s2">&quot;spanning-tree portfast&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spanning-tree bpduguard enable&quot;</span>
<span class="p">]</span>

<span class="n">trunk_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;switchport trunk encapsulation dot1q&quot;</span><span class="p">,</span> <span class="s2">&quot;switchport mode trunk&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport trunk allowed vlan </span><span class="si">{}</span><span class="s2">&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>Задание 5.3a<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Дополнить скрипт из задания 5.3 таким образом, чтобы, в зависимости от выбранного режима,
задавались разные вопросы в запросе о номере VLANа или списка VLANов:</p>
<ul class="simple">
<li>для access: «Введите номер VLAN:»</li>
<li>для trunk: «Введите разрешенные VLANы:»</li>
</ul>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.
То есть эту задачу можно решить без использования условия if и циклов for/while.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span> <span class="s2">&quot;switchport access vlan </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport nonegotiate&quot;</span><span class="p">,</span> <span class="s2">&quot;spanning-tree portfast&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spanning-tree bpduguard enable&quot;</span>
<span class="p">]</span>

<span class="n">trunk_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;switchport trunk encapsulation dot1q&quot;</span><span class="p">,</span> <span class="s2">&quot;switchport mode trunk&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport trunk allowed vlan </span><span class="si">{}</span><span class="s2">&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/06_control_structures/index"></span><div class="section" id="control-structures-index">
<span id="id1"></span><h3>6. Контроль хода программы<a class="headerlink" href="#control-structures-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>До сих пор, весь код выполнялся последовательно - все строки
скрипта выполнялись в том порядке, в котором они записаны в файле.
В этом разделе рассматриваются возможности Python в управлении ходом программы:</p>
<ul class="simple">
<li>ответвления в ходе программы с помощью конструкции <code class="docutils literal notranslate"><span class="pre">if/elif/else</span></code></li>
<li>повторение действий в цикле с помощью конструкций <code class="docutils literal notranslate"><span class="pre">for</span></code> и <code class="docutils literal notranslate"><span class="pre">while</span></code></li>
<li>обработка ошибок с помощью конструкции <code class="docutils literal notranslate"><span class="pre">try/except</span></code></li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-book/06_control_structures/if_else"></span><div class="section" id="if-elif-else">
<h4>if/elif/else<a class="headerlink" href="#if-elif-else" title="Ссылка на этот заголовок">¶</a></h4>
<p>Конструкция <code class="docutils literal notranslate"><span class="pre">if/elif/else</span></code> позволяет делать ответвления в ходе программы.
Программа уходит в ветку при выполнении определенного условия.</p>
<p>В этой конструкции только if является обязательным, elif и else
опциональны:</p>
<ul class="simple">
<li>Проверка if всегда идет первой.</li>
<li>После оператора if должно быть какое-то условие: если это условие выполняется
(возвращает True), то действия в блоке if выполняются.</li>
<li>С помощью elif можно сделать несколько разветвлений, то есть,
проверять входящие данные на разные условия.</li>
<li>Блок elif это тот же if, но только следующая проверка. Грубо говоря, это «а если …»</li>
<li>Блоков elif может быть много.</li>
<li>Блок else выполняется в том случае, если ни одно из условий if или elif не было истинным.</li>
</ul>
<p>Пример конструкции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">9</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a равно 10&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="k">elif</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a меньше 10&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a больше 10&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">a</span> <span class="n">меньше</span> <span class="mi">10</span>
</pre></div>
</div>
<div class="section" id="id1">
<h5>Условия<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Конструкция if построена на условиях: после if и elif всегда пишется условие.
Блоки if/elif выполняются только когда условие возвращает True, поэтому первое с чем надо
разобраться - это что является истинным, а что ложным в Python.</p>
<div class="section" id="true-false">
<h6>True и False<a class="headerlink" href="#true-false" title="Ссылка на этот заголовок">¶</a></h6>
<p>В Python, кроме очевидных значений True и False, всем остальным объектам также
соответствует ложное или истинное значение:</p>
<ul class="simple">
<li>истинное значение:<ul>
<li>любое ненулевое число</li>
<li>любая непустая строка</li>
<li>любой непустой объект</li>
</ul>
</li>
<li>ложное значение:<ul>
<li>0</li>
<li>None</li>
<li>пустая строка</li>
<li>пустой объект</li>
</ul>
</li>
</ul>
<p>Например, так как пустой список это ложное значение, проверить, пустой ли список,
можно таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">list_to_test</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="k">if</span> <span class="n">list_to_test</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;В списке есть объекты&quot;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>
<span class="n">В</span> <span class="n">списке</span> <span class="n">есть</span> <span class="n">объекты</span>
</pre></div>
</div>
<p>Тот же результат можно было бы получить несколько иначе:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_to_test</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;В списке есть объекты&quot;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>
<span class="n">В</span> <span class="n">списке</span> <span class="n">есть</span> <span class="n">объекты</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h6>Операторы сравнения<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h6>
<p><strong>Операторы сравнения</strong>, которые могут использоваться в условиях:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">5</span> <span class="o">&gt;</span> <span class="mi">6</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">5</span> <span class="o">&gt;</span> <span class="mi">2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="mi">5</span> <span class="o">&lt;</span> <span class="mi">2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">5</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="mi">5</span> <span class="o">&gt;=</span> <span class="mi">5</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="mi">5</span> <span class="o">&lt;=</span> <span class="mi">10</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="mi">8</span> <span class="o">!=</span> <span class="mi">10</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Обратите внимание, что равенство проверяется двойным <code class="docutils literal notranslate"><span class="pre">==</span></code>.</p>
</div>
<p>Пример использования операторов сравнения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">9</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a равно 10&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="k">elif</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a меньше 10&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a больше 10&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">a</span> <span class="n">меньше</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="section" id="in">
<h6>Оператор in<a class="headerlink" href="#in" title="Ссылка на этот заголовок">¶</a></h6>
<p>Оператор <code class="docutils literal notranslate"><span class="pre">in</span></code> позволяет выполнять проверку на наличие элемента в
последовательности (например, элемента в списке или подстроки в строке):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;Fast&#39;</span> <span class="ow">in</span> <span class="s1">&#39;FastEthernet&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s1">&#39;Gigabit&#39;</span> <span class="ow">in</span> <span class="s1">&#39;FastEthernet&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">vlan</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="mi">10</span> <span class="ow">in</span> <span class="n">vlan</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="mi">50</span> <span class="ow">in</span> <span class="n">vlan</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>При использовании со словарями условие <strong>in</strong> выполняет проверку по
ключам словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;IOS&#39;</span> <span class="ow">in</span> <span class="n">r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;4451&#39;</span> <span class="ow">in</span> <span class="n">r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="section" id="and-or-not">
<h6>Операторы and, or, not<a class="headerlink" href="#and-or-not" title="Ссылка на этот заголовок">¶</a></h6>
<p>В условиях могут также использоваться <strong>логические операторы</strong>
<code class="docutils literal notranslate"><span class="pre">and</span></code>, <code class="docutils literal notranslate"><span class="pre">or</span></code>, <code class="docutils literal notranslate"><span class="pre">not</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>  <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">vlan</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="s1">&#39;IOS&#39;</span> <span class="ow">in</span> <span class="n">r1</span> <span class="ow">and</span> <span class="mi">10</span> <span class="ow">in</span> <span class="n">vlan</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="s1">&#39;4451&#39;</span> <span class="ow">in</span> <span class="n">r1</span> <span class="ow">and</span> <span class="mi">10</span> <span class="ow">in</span> <span class="n">vlan</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="s1">&#39;4451&#39;</span> <span class="ow">in</span> <span class="n">r1</span> <span class="ow">or</span> <span class="mi">10</span> <span class="ow">in</span> <span class="n">vlan</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="ow">not</span> <span class="s1">&#39;4451&#39;</span> <span class="ow">in</span> <span class="n">r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="s1">&#39;4451&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<div class="section" id="and">
<h7>Оператор and<a class="headerlink" href="#and" title="Ссылка на этот заголовок">¶</a></h7>
<p>В Python оператор <code class="docutils literal notranslate"><span class="pre">and</span></code> возвращает не булево значение, а значение
одного из операндов.</p>
<p>Если оба операнда являются истиной, результатом выражения будет
последнее значение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="s1">&#39;string1&#39;</span> <span class="ow">and</span> <span class="s1">&#39;string2&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="s1">&#39;string2&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="s1">&#39;string1&#39;</span> <span class="ow">and</span> <span class="s1">&#39;string2&#39;</span> <span class="ow">and</span> <span class="s1">&#39;string3&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="s1">&#39;string3&#39;</span>
</pre></div>
</div>
<p>Если один из операторов является ложью, результатом выражения будет
первое ложное значение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="s1">&#39;string1&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="p">[]</span> <span class="ow">and</span> <span class="s1">&#39;string1&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="or">
<h7>Оператор or<a class="headerlink" href="#or" title="Ссылка на этот заголовок">¶</a></h7>
<p>Оператор <code class="docutils literal notranslate"><span class="pre">or</span></code>, как и оператор and, возвращает значение одного из
операндов.</p>
<p>При оценке операндов возвращается первый истинный операнд:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="s1">&#39;string1&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="s1">&#39;string1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="p">[]</span> <span class="ow">or</span> <span class="s1">&#39;string1&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="s1">&#39;string1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="s1">&#39;string1&#39;</span> <span class="ow">or</span> <span class="s1">&#39;string2&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="s1">&#39;string1&#39;</span>
</pre></div>
</div>
<p>Если все значения являются ложными, возвращается последнее значение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="p">[]</span> <span class="ow">or</span> <span class="p">{}</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="p">{}</span>
</pre></div>
</div>
<p>Важная особенность работы оператора <code class="docutils literal notranslate"><span class="pre">or</span></code> - операнды, которые находятся
после истинного, не вычисляются:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="nb">sorted</span><span class="p">([</span><span class="mi">44</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">67</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">67</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="s1">&#39;string1&#39;</span> <span class="ow">or</span> <span class="nb">sorted</span><span class="p">([</span><span class="mi">44</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">67</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="s1">&#39;string1&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="if-example">
<span id="id3"></span><h5>Пример использования конструкции if/elif/else<a class="headerlink" href="#if-example" title="Ссылка на этот заголовок">¶</a></h5>
<p>Пример скрипта check_password.py, который проверяет длину пароля и есть
ли в пароле имя пользователя:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="n">username</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите имя пользователя: &#39;</span><span class="p">)</span>
<span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите пароль: &#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{}</span><span class="s1"> установлен&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
</pre></div>
</div>
<p>Проверка скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python check_password.py
Введите имя пользователя: nata
Введите пароль: nata1234
Пароль содержит имя пользователя

$ python check_password.py
Введите имя пользователя: nata
Введите пароль: 123nata123
Пароль содержит имя пользователя

$ python check_password.py
Введите имя пользователя: nata
Введите пароль: 1234
Пароль слишком короткий

$ python check_password.py
Введите имя пользователя: nata
Введите пароль: 123456789
Пароль для пользователя nata установлен
</pre></div>
</div>
</div>
<div class="section" id="ternary-expression">
<h5>Тернарное выражение (Ternary expression)<a class="headerlink" href="#ternary-expression" title="Ссылка на этот заголовок">¶</a></h5>
<p>Иногда удобнее использовать тернарный оператор, нежели развернутую
форму:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Этим лучше не злоупотреблять, но в простых выражениях такая запись может быть полезной.</p>
</div>
</div>
<span id="document-book/06_control_structures/for"></span><div class="section" id="for">
<h4>for<a class="headerlink" href="#for" title="Ссылка на этот заголовок">¶</a></h4>
<p>Очень часто одно и то же действие надо выполнить для набора однотипных данных.
Например, преобразовать все строки в списке в верхний регистр. Для выполнения таких действий
в Python используется цикл <code class="docutils literal notranslate"><span class="pre">for</span></code>.</p>
<p>Цикл for перебирает по одному элементы указанной последовательности и выполняет
действия, которые указаны в блоке for, для каждого элемента.</p>
<p>Примеры последовательностей элементов, по которым может проходиться цикл
for:</p>
<ul class="simple">
<li>строка</li>
<li>список</li>
<li>словарь</li>
<li><a class="reference internal" href="contents.html#range"><span class="std std-ref">Функция range</span></a></li>
<li>любой <a class="reference internal" href="contents.html#iterable"><span class="std std-ref">Итерируемый объект</span></a></li>
</ul>
<p>Пример преобразования строк в списке в верхний регистр без цикла for:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;tuple&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">upper_words</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;list&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="c1"># преобразование слова в верхний регистр</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;LIST&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">upper_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="c1"># преобразование и добавление в новый список</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">upper_words</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;LIST&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">upper_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">upper_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">upper_words</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;LIST&#39;</span><span class="p">,</span> <span class="s1">&#39;DICT&#39;</span><span class="p">,</span> <span class="s1">&#39;TUPLE&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>У данного решения есть несколько нюансов:</p>
<ul class="simple">
<li>одно и то же действие надо повторять несколько раз</li>
<li>код привязан к определенному количеству элементов в списке words</li>
</ul>
<p>Те же действия с циклом for:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;tuple&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">upper_words</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">upper_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">upper_words</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;LIST&#39;</span><span class="p">,</span> <span class="s1">&#39;DICT&#39;</span><span class="p">,</span> <span class="s1">&#39;TUPLE&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Выражение <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">word</span> <span class="pre">in</span> <span class="pre">words:</span> <span class="pre">upper_words.append(word.upper())</span></code>
означает «для каждого слова в списке words выполнить действия в блоке for».
При этом word это имя переменной, которое каждую итерацию цикла ссылается на разные значения.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last"><a class="reference external" href="http://www.pythontutor.com/">Проект pythontutor</a> может очень помочь в понимании циклов.
Там есть специальная визуализация кода, которая позволяет увидеть, что происходит
на каждом этапе выполнения кода, что особенно полезно на первых порах с циклами.
На <a class="reference external" href="http://www.pythontutor.com/visualize.html#mode=edit">сайте pythontutor</a> можно загружать свой код, но для примера, по этой ссылке можно посмотреть
<a class="reference external" href="http://www.pythontutor.com/visualize.html#code=words%20%3D%20%5B'list',%20'dict',%20'tuple'%5D%0Aupper_words%20%3D%20%5B%5D%0A%0Afor%20word%20in%20words%3A%0A%20%20%20%20upper_words.append%28word.upper%28%29%29%0A&amp;cumulative=false&amp;curInstr=0&amp;heapPrimitives=nevernest&amp;mode=display&amp;origin=opt-frontend.js&amp;py=3&amp;rawInputLstJSON=%5B%5D&amp;textReferences=false">пример выше</a>.</p>
</div>
<p>Цикл for может работать с любой последовательностью элементов.
Например, выше использовался список и цикл перебирал элементы списка.
Аналогичным образом for работает с кортежами.</p>
<p>При работе со строками, цикл for перебирает символы строки, например:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="s1">&#39;Test string&#39;</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">T</span>
<span class="n">e</span>
<span class="n">s</span>
<span class="n">t</span>

<span class="n">s</span>
<span class="n">t</span>
<span class="n">r</span>
<span class="n">i</span>
<span class="n">n</span>
<span class="n">g</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В цикле используется переменная с именем <strong>letter</strong>. Хотя имя может быть
любое, удобно, когда имя подсказывает, через какие объекты проходит
цикл.</p>
</div>
<p>Иногда в цикле необходимо использовать последовательность чисел. В этом случае, лучше всего использовать функцию
<a class="reference internal" href="contents.html#range"><span class="std std-ref">Функция range</span></a></p>
<p>Пример цикла for с функцией range():</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;interface FastEthernet0/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">2</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">3</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">4</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">5</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">6</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">7</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">8</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">9</span>
</pre></div>
</div>
<p>В этом цикле используется <code class="docutils literal notranslate"><span class="pre">range(10)</span></code>. Функция range генерирует числа в диапазоне
от нуля до указанного числа (в данном примере - до 10), не включая его.</p>
<p>В этом примере цикл проходит по списку VLANов, поэтому переменную можно
назвать vlan:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="k">for</span> <span class="n">vlan</span> <span class="ow">in</span> <span class="n">vlans</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;vlan </span><span class="si">{</span><span class="n">vlan</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; name VLAN_</span><span class="si">{</span><span class="n">vlan</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">vlan</span> <span class="mi">10</span>
 <span class="n">name</span> <span class="n">VLAN_10</span>
<span class="n">vlan</span> <span class="mi">20</span>
 <span class="n">name</span> <span class="n">VLAN_20</span>
<span class="n">vlan</span> <span class="mi">30</span>
 <span class="n">name</span> <span class="n">VLAN_30</span>
<span class="n">vlan</span> <span class="mi">40</span>
 <span class="n">name</span> <span class="n">VLAN_40</span>
<span class="n">vlan</span> <span class="mi">100</span>
 <span class="n">name</span> <span class="n">VLAN_100</span>
</pre></div>
</div>
<p>Когда цикл идет по словарю, то фактически он проходится по ключам:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>      <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>      <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>      <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>      <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>      <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>      <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">r1</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">ios</span>
<span class="n">ip</span>
<span class="n">hostname</span>
<span class="n">location</span>
<span class="n">model</span>
<span class="n">vendor</span>
</pre></div>
</div>
<p>Если необходимо выводить пары ключ-значение в цикле, можно делать так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">r1</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39; =&gt; &#39;</span> <span class="o">+</span> <span class="n">r1</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">ios</span> <span class="o">=&gt;</span> <span class="mf">15.4</span>
<span class="n">ip</span> <span class="o">=&gt;</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">0.1</span>
<span class="n">hostname</span> <span class="o">=&gt;</span> <span class="n">london_r1</span>
<span class="n">location</span> <span class="o">=&gt;</span> <span class="mi">21</span> <span class="n">New</span> <span class="n">Globe</span> <span class="n">Walk</span>
<span class="n">model</span> <span class="o">=&gt;</span> <span class="mi">4451</span>
<span class="n">vendor</span> <span class="o">=&gt;</span> <span class="n">Cisco</span>
</pre></div>
</div>
<p>Или воспользоваться методом items, который позволяет проходиться в
цикле сразу по паре ключ-значение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">r1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39; =&gt; &#39;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">ios</span> <span class="o">=&gt;</span> <span class="mf">15.4</span>
<span class="n">ip</span> <span class="o">=&gt;</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">0.1</span>
<span class="n">hostname</span> <span class="o">=&gt;</span> <span class="n">london_r1</span>
<span class="n">location</span> <span class="o">=&gt;</span> <span class="mi">21</span> <span class="n">New</span> <span class="n">Globe</span> <span class="n">Walk</span>
<span class="n">model</span> <span class="o">=&gt;</span> <span class="mi">4451</span>
<span class="n">vendor</span> <span class="o">=&gt;</span> <span class="n">Cisco</span>
</pre></div>
</div>
<p>Метод items возвращает специальный объект view, который отображает пары
ключ-значение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">dict_items</span><span class="p">([(</span><span class="s1">&#39;ios&#39;</span><span class="p">,</span> <span class="s1">&#39;15.4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ip&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;4451&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<div class="toctree-wrapper compound">
<span id="document-book/06_control_structures/for_in_for"></span><div class="section" id="for">
<h5>Вложенные for<a class="headerlink" href="#for" title="Ссылка на этот заголовок">¶</a></h5>
<p>Циклы for можно вкладывать друг в друга.</p>
<p>В этом примере в списке commands хранятся команды, которые надо
выполнить для каждого из интерфейсов в списке fast_int:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span> <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span> <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span><span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">fast_int</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0/1&#39;</span><span class="p">,</span><span class="s1">&#39;0/3&#39;</span><span class="p">,</span><span class="s1">&#39;0/4&#39;</span><span class="p">,</span><span class="s1">&#39;0/7&#39;</span><span class="p">,</span><span class="s1">&#39;0/9&#39;</span><span class="p">,</span><span class="s1">&#39;0/10&#39;</span><span class="p">,</span><span class="s1">&#39;0/11&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="k">for</span> <span class="n">intf</span> <span class="ow">in</span> <span class="n">fast_int</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;interface FastEthernet </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intf</span><span class="p">))</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">interface</span> <span class="n">FastEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
 <span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">portfast</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">bpduguard</span> <span class="n">enable</span>
<span class="n">interface</span> <span class="n">FastEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">3</span>
 <span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">portfast</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">bpduguard</span> <span class="n">enable</span>
<span class="n">interface</span> <span class="n">FastEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">4</span>
 <span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">portfast</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">bpduguard</span> <span class="n">enable</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Первый цикл for проходится по интерфейсам в списке fast_int, а второй
по командам в списке commands.</p>
</div>
<span id="document-book/06_control_structures/for_if"></span><div class="section" id="for-if">
<h5>Совмещение for и if<a class="headerlink" href="#for-if" title="Ссылка на этот заголовок">¶</a></h5>
<p>Рассмотрим пример совмещения for и if.</p>
<p>Файл generate_access_port_config.py:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;switchport access vlan&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span><span class="p">]</span>

 <span class="n">access</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;0/12&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;0/14&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;0/16&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="s1">&#39;0/17&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">}}</span>

 <span class="k">for</span> <span class="n">intf</span><span class="p">,</span> <span class="n">vlan</span> <span class="ow">in</span> <span class="n">access</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;interface FastEthernet&#39;</span> <span class="o">+</span> <span class="n">intf</span><span class="p">)</span>
     <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">access_template</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;access vlan&#39;</span><span class="p">):</span>
             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">vlan</span><span class="p">))</span>
         <span class="k">else</span><span class="p">:</span>
             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>Комментарии к коду:</p>
<ul class="simple">
<li>В первом цикле for перебираются ключи и значения во вложенном словаре access</li>
<li>Текущий ключ, на данный момент цикла, хранится в переменной intf</li>
<li>Текущее значение, на данный момент цикла, хранится в переменной vlan</li>
<li>Выводится строка interface FastEthernet с добавлением к ней номера интерфейса</li>
<li>Во втором цикле for перебираются команды из списка access_template</li>
<li>Так как к команде switchport access vlan надо добавить номер VLAN:<ul>
<li>внутри второго цикла for проверяются команды</li>
<li>если команда заканчивается на access vlan<ul>
<li>выводится команда, и к ней добавляется номер VLAN</li>
</ul>
</li>
<li>во всех остальных случаях просто выводится команда</li>
</ul>
</li>
</ul>
<p>Результат выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python generate_access_port_config.py
interface FastEthernet0/12
 switchport mode access
 switchport access vlan 10
 spanning-tree portfast
 spanning-tree bpduguard enable
interface FastEthernet0/14
 switchport mode access
 switchport access vlan 11
 spanning-tree portfast
 spanning-tree bpduguard enable
interface FastEthernet0/16
 switchport mode access
 switchport access vlan 17
 spanning-tree portfast
 spanning-tree bpduguard enable
interface FastEthernet0/17
 switchport mode access
 switchport access vlan 150
 spanning-tree portfast
 spanning-tree bpduguard enable
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-book/06_control_structures/while"></span><div class="section" id="while">
<h4>while<a class="headerlink" href="#while" title="Ссылка на этот заголовок">¶</a></h4>
<p>Цикл while - это еще одна разновидность цикла в Python.</p>
<p>В цикле while, как и в выражении if, надо писать условие. Если условие
истинно, выполняются действия внутри блока while. При этом, в отличие от if,
после выполнения кода в блоке, while возвращается в начало цикла.</p>
<p>При использовании циклов while необходимо обращать внимание на то, будет
ли достигнуто такое состояние, при котором условие цикла будет ложным.</p>
<p>Рассмотрим простой пример:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">while</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">a</span> <span class="o">-=</span> <span class="mi">1</span> <span class="c1"># Эта запись равнозначна a = a - 1</span>
   <span class="o">...</span><span class="p">:</span>
<span class="mi">5</span>
<span class="mi">4</span>
<span class="mi">3</span>
<span class="mi">2</span>
<span class="mi">1</span>
</pre></div>
</div>
<p>Сначала создается переменная а со значением 5.</p>
<p>Затем, в цикле while указано условие a &gt; 0. То есть, пока значение а
больше 0, будут выполняться действия в теле цикла. В данном случае,
будет выводиться значение переменной а.</p>
<p>Кроме того, в теле цикла при каждом прохождении значение а становится на
единицу меньше.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p>Запись <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">-=</span> <span class="pre">1</span></code> может быть немного необычной. Python позволяет
использовать такой формат вместо <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">-</span> <span class="pre">1</span></code>.</p>
<p class="last">Аналогичным образом можно писать: <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+=</span> <span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">*=</span> <span class="pre">2</span></code>,
<code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">/=</span> <span class="pre">2</span></code>.</p>
</div>
<p>Так как значение а уменьшается, цикл не будет бесконечным, и в какой-то
момент выражение a &gt; 0 станет ложным.</p>
<p>Следующий пример построен на основе примера про пароль из раздела о
конструкции if <a class="reference internal" href="contents.html#if-example"><span class="std std-ref">Пример использования конструкции if/elif/else</span></a>.
В том примере приходилось заново запускать скрипт, если пароль не соответствовал требованиям.</p>
<p>С помощью цикла while можно сделать так, что скрипт сам будет
запрашивать пароль заново, если он не соответствует требованиям.</p>
<p>Файл check_password_with_while.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="n">username</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите имя пользователя: &#39;</span><span class="p">)</span>
<span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите пароль: &#39;</span><span class="p">)</span>

<span class="n">password_correct</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">password_correct</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите пароль еще раз: &#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите пароль еще раз: &#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1"> установлен&#39;</span><span class="p">)</span>
        <span class="n">password_correct</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>В этом случае цикл while полезен, так как он возвращает скрипт снова в
начало проверок, позволяет снова набрать пароль, но при этом не требует
перезапуска самого скрипта.</p>
<p>Теперь скрипт отрабатывает так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python check_password_with_while.py
Введите имя пользователя: nata
Введите пароль: nata
Пароль слишком короткий

Введите пароль еще раз: natanata
Пароль содержит имя пользователя

Введите пароль еще раз: 123345345345
Пароль для пользователя nata установлен
</pre></div>
</div>
</div>
<span id="document-book/06_control_structures/break_continue_pass"></span><div class="section" id="break-continue-pass">
<h4>break, continue, pass<a class="headerlink" href="#break-continue-pass" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python есть несколько операторов, которые позволяют менять поведение
циклов по умолчанию.</p>
<div class="section" id="break">
<h5>Оператор break<a class="headerlink" href="#break" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор <code class="docutils literal notranslate"><span class="pre">break</span></code> позволяет досрочно прервать цикл:</p>
<ul class="simple">
<li>break прерывает текущий цикл и продолжает выполнение следующих выражений</li>
<li>если используется несколько вложенных циклов, break прерывает внутренний цикл
и продолжает выполнять выражения, следующие за блоком
* break может использоваться в циклах for и while</li>
</ul>
<p>Пример с циклом for:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">break</span>
   <span class="o">...</span><span class="p">:</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>
<span class="mi">5</span>
<span class="mi">6</span>
</pre></div>
</div>
<p>Пример с циклом while:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">break</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
   <span class="o">...</span><span class="p">:</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>
</pre></div>
</div>
<p>Использование break в примере с запросом пароля (файл
check_password_with_while_break.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">username</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите имя пользователя: &#39;</span><span class="p">)</span>
<span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите пароль: &#39;</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{}</span><span class="s1"> установлен&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
        <span class="c1"># завершает цикл while</span>
        <span class="k">break</span>
    <span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите пароль еще раз: &#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь можно не повторять строку
<code class="docutils literal notranslate"><span class="pre">password</span> <span class="pre">=</span> <span class="pre">input('Введите</span> <span class="pre">пароль</span> <span class="pre">еще</span> <span class="pre">раз:</span> <span class="pre">')</span></code> в каждом ответвлении,
достаточно перенести ее в конец цикла.</p>
<p>И, как только будет введен правильный пароль, break выведет программу из
цикла while.</p>
</div>
<div class="section" id="continue">
<h5>Оператор continue<a class="headerlink" href="#continue" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор continue возвращает управление в начало цикла. То есть,
continue позволяет «перепрыгнуть» оставшиеся выражения в цикле и перейти
к следующей итерации.</p>
<p>Пример с циклом for:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">continue</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">4</span>
</pre></div>
</div>
<p>Пример с циклом while:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Пропускаем 3&quot;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>         <span class="k">continue</span>
   <span class="o">....</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Это никто не увидит&quot;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Текущее значение: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>
<span class="n">Текущее</span> <span class="n">значение</span><span class="p">:</span>  <span class="mi">1</span>
<span class="n">Текущее</span> <span class="n">значение</span><span class="p">:</span>  <span class="mi">2</span>
<span class="n">Пропускаем</span> <span class="mi">3</span>
<span class="n">Текущее</span> <span class="n">значение</span><span class="p">:</span>  <span class="mi">4</span>
<span class="n">Текущее</span> <span class="n">значение</span><span class="p">:</span>  <span class="mi">5</span>
<span class="n">Текущее</span> <span class="n">значение</span><span class="p">:</span>  <span class="mi">6</span>
</pre></div>
</div>
<p>Использование continue в примере с запросом пароля (файл
check_password_with_while_continue.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">username</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите имя пользователя: &#39;</span><span class="p">)</span>
<span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите пароль: &#39;</span><span class="p">)</span>

<span class="n">password_correct</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">password_correct</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{}</span><span class="s1"> установлен&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
        <span class="n">password_correct</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">continue</span>
    <span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Введите пароль еще раз: &#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Тут выход из цикла выполнятся с помощью проверки флага
password_correct. Когда был введен правильный пароль, флаг выставляется
равным True, и с помощью continue выполняется переход в начало цикла,
перескочив последнюю строку с запросом пароля.</p>
<p>Результат выполнения будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python check_password_with_while_continue.py
Введите имя пользователя: nata
Введите пароль: nata12
Пароль слишком короткий

Введите пароль еще раз: natalksdjflsdjf
Пароль содержит имя пользователя

Введите пароль еще раз: asdfsujljhdflaskjdfh
Пароль для пользователя nata установлен
</pre></div>
</div>
</div>
<div class="section" id="pass">
<h5>Оператор pass<a class="headerlink" href="#pass" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор <code class="docutils literal notranslate"><span class="pre">pass</span></code> ничего не делает. Фактически, это такая заглушка для
объектов.</p>
<p>Например, <code class="docutils literal notranslate"><span class="pre">pass</span></code> может помочь в ситуации, когда нужно прописать
структуру скрипта. Его можно ставить в циклах, функциях, классах. И это
не будет влиять на исполнение кода.</p>
<p>Пример использования pass:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="k">pass</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>
<span class="mi">3</span>
<span class="mi">4</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/06_control_structures/for_while_else"></span><div class="section" id="for-else-while-else">
<h4>for/else, while/else<a class="headerlink" href="#for-else-while-else" title="Ссылка на этот заголовок">¶</a></h4>
<p>В циклах for и while опционально может использоваться блок else.</p>
<div class="section" id="for-else">
<h5>for/else<a class="headerlink" href="#for-else" title="Ссылка на этот заголовок">¶</a></h5>
<p>В цикле for:</p>
<ul class="simple">
<li>блок else выполняется в том случае, если цикл завершил итерацию списка</li>
<li>но else <strong>не выполняется</strong>, если в цикле был выполнен break</li>
</ul>
<p>Пример цикла for с else (блок else выполняется после завершения цикла
for):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span> <span class="k">else</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Числа закончились&quot;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>
<span class="n">Числа</span> <span class="n">закончились</span>
</pre></div>
</div>
<p>Пример цикла for с else и break в цикле (из-за break блок else не
выполняется):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="k">break</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span> <span class="k">else</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Числа закончились&quot;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
</pre></div>
</div>
<p>Пример цикла for с else и continue в цикле (continue не влияет на блок
else):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="k">continue</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span> <span class="k">else</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Числа закончились&quot;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">4</span>
<span class="n">Числа</span> <span class="n">закончились</span>
</pre></div>
</div>
</div>
<div class="section" id="while-else">
<h5>while/else<a class="headerlink" href="#while-else" title="Ссылка на этот заголовок">¶</a></h5>
<p>В цикле while:</p>
<ul class="simple">
<li>блок else выполняется в том случае, если цикл завершил итерацию списка</li>
<li>но else <strong>не выполняется</strong>, если в цикле был выполнен break</li>
</ul>
<p>Пример цикла while с else (блок else выполняется после завершения цикла
while):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>     <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
   <span class="o">....</span><span class="p">:</span> <span class="k">else</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Конец&quot;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>
<span class="n">Конец</span>
</pre></div>
</div>
<p>Пример цикла while с else и break в цикле (из-за break блок else не
выполняется):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="k">break</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>         <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
   <span class="o">....</span><span class="p">:</span> <span class="k">else</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Конец&quot;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/06_control_structures/exceptions"></span><div class="section" id="try-except-else-finally">
<h4>Работа с исключениями try/except/else/finally<a class="headerlink" href="#try-except-else-finally" title="Ссылка на этот заголовок">¶</a></h4>
<div class="section" id="try-except">
<h5>try/except<a class="headerlink" href="#try-except" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если вы повторяли примеры, которые использовались ранее, то наверняка
были ситуации, когда выскакивала ошибка. Скорее всего, это была ошибка
синтаксиса, когда не хватало, например, двоеточия.</p>
<p>Как правило, Python довольно понятно реагирует на подобные ошибки, и их
можно исправить.</p>
<p>Тем не менее, даже если код синтаксически написан правильно, могут
возникать ошибки. В Python эти ошибки называются <strong>исключения (exceptions)</strong>.</p>
<p>Примеры исключений:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="mi">2</span><span class="o">/</span><span class="mi">0</span>
<span class="o">-----------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="p">:</span> <span class="n">division</span> <span class="n">by</span> <span class="n">zero</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;test&#39;</span> <span class="o">+</span> <span class="mi">2</span>
<span class="o">-----------------------------------------------------</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="n">must</span> <span class="n">be</span> <span class="nb">str</span><span class="p">,</span> <span class="ow">not</span> <span class="nb">int</span>
</pre></div>
</div>
<p>В данном случае возникло два исключения: <strong>ZeroDivisionError</strong> и
<strong>TypeError</strong>.</p>
<p>Чаще всего можно предсказать, какого рода исключения возникнут во время
исполнения программы.</p>
<p>Например, если программа на вход ожидает два числа, а на выходе выдает
их сумму, а пользователь ввел вместо одного из чисел строку, появится
ошибка TypeError, как в примере выше.</p>
<p>Python позволяет работать с исключениями. Их можно перехватывать и
выполнять определенные действия в том случае, если возникло исключение.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Когда в программе возникает исключение, она сразу завершает работу.</p>
</div>
<p>Для работы с исключениями используется конструкция <code class="docutils literal notranslate"><span class="pre">try/except</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">try</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="mi">2</span><span class="o">/</span><span class="mi">0</span>
   <span class="o">...</span><span class="p">:</span> <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You can&#39;t divide by zero&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">You</span> <span class="n">can</span><span class="s1">&#39;t divide by zero</span>
</pre></div>
</div>
<p>Конструкция try работает таким образом:</p>
<ul class="simple">
<li>сначала выполняются выражения, которые записаны в блоке try</li>
<li>если при выполнения блока try не возникло никаких исключений, блок except пропускается,
и выполняется дальнейший код</li>
<li>если во время выполнения блока try в каком-то месте возникло исключение,
оставшаяся часть блока try пропускается<ul>
<li>если в блоке except указано исключение, которое возникло, выполняется код в блоке except</li>
<li>если исключение, которое возникло, не указано в блоке except,
выполнение программы прерывается и выдается ошибка</li>
</ul>
</li>
</ul>
<p>Обратите внимание, что строка <code class="docutils literal notranslate"><span class="pre">Cool!</span></code> в блоке try не выводится:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="k">try</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s divide some numbers&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="mi">2</span><span class="o">/</span><span class="mi">0</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cool!&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You can&#39;t divide by zero&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">Let</span><span class="s1">&#39;s divide some numbers</span>
<span class="n">You</span> <span class="n">can</span><span class="s1">&#39;t divide by zero</span>
</pre></div>
</div>
<p>В конструкции try/except может быть много except, если нужны разные
действия в зависимости от типа ошибки.</p>
<p>Например, скрипт divide.py делит два числа введенных пользователем:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите первое число: &quot;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите второе число: &quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Результат: &quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Пожалуйста, вводите только числа&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;На ноль делить нельзя&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Примеры выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python divide.py
Введите первое число: 3
Введите второе число: 1
Результат:  3

$ python divide.py
Введите первое число: 5
Введите второе число: 0
На ноль делить нельзя

$ python divide.py
Введите первое число: qewr
Введите второе число: 3
Пожалуйста, вводите только числа
</pre></div>
</div>
<p>В данном случае исключение <strong>ValueError</strong> возникает, когда пользователь
ввел строку вместо числа, во время перевода строки в число.</p>
<p>Исключение ZeroDivisionError возникает в случае, если второе число было
равным 0.</p>
<p>Если нет необходимости выводить различные сообщения на ошибки ValueError
и ZeroDivisionError, можно сделать так (файл divide_ver2.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите первое число: &quot;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите второе число: &quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Результат: &quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">ZeroDivisionError</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Что-то пошло не так...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Проверка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ python divide_ver2.py
Введите первое число: wer
Введите второе число: 4
Что-то пошло не так...

$ python divide_ver2.py
Введите первое число: 5
Введите второе число: 0
Что-то пошло не так...
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p>В блоке except можно не указывать конкретное исключение или
исключения. В таком случае будут перехватываться все исключения.</p>
<p class="last"><strong>Это делать не рекомендуется!</strong></p>
</div>
</div>
<div class="section" id="try-except-else">
<h5>try/except/else<a class="headerlink" href="#try-except-else" title="Ссылка на этот заголовок">¶</a></h5>
<p>В конструкции try/except есть опциональный блок else. Он выполняется в
том случае, если не было исключения.</p>
<p>Например, если необходимо выполнять в дальнейшем какие-то операции с
данными, которые ввел пользователь, можно записать их в блоке else (файл
divide_ver3.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите первое число: &quot;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите второе число: &quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">ZeroDivisionError</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Что-то пошло не так...&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Результат в квадрате: &quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Пример выполнения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ python divide_ver3.py
Введите первое число: 10
Введите второе число: 2
Результат в квадрате:  25

$ python divide_ver3.py
Введите первое число: werq
Введите второе число: 3
Что-то пошло не так...
</pre></div>
</div>
</div>
<div class="section" id="try-except-finally">
<h5>try/except/finally<a class="headerlink" href="#try-except-finally" title="Ссылка на этот заголовок">¶</a></h5>
<p>Блок finally - это еще один опциональный блок в конструкции try. Он
выполняется <strong>всегда</strong>, независимо от того, было ли исключение или нет.</p>
<p>Сюда ставятся действия, которые надо выполнить в любом случае. Например,
это может быть закрытие файла.</p>
<p>Файл divide_ver4.py с блоком finally:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите первое число: &quot;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите второе число: &quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">ZeroDivisionError</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Что-то пошло не так...&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Результат в квадрате: &quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Вот и сказочке конец, а кто слушал - молодец.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Проверка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ python divide_ver4.py
Введите первое число: 10
Введите второе число: 2
Результат в квадрате:  25
Вот и сказочке конец, а кто слушал - молодец.

$ python divide_ver4.py
Введите первое число: qwerewr
Введите второе число: 3
Что-то пошло не так...
Вот и сказочке конец, а кто слушал - молодец.

$ python divide_ver4.py
Введите первое число: 4
Введите второе число: 0
Что-то пошло не так...
Вот и сказочке конец, а кто слушал - молодец.
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h5>Когда использовать исключения<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Как правило, один и тот же код можно написать и с использованием
исключений, и без них.</p>
<p>Например, этот вариант кода:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите число: &quot;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите второе число: &quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Поддерживаются только числа&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;На ноль делить нельзя&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">break</span>
</pre></div>
</div>
<p>Можно переписать таким образом без try/except (файл
try_except_divide.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите число: &quot;</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Введите второе число: &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;На ноль делить нельзя&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Поддерживаются только числа&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Далеко не всегда аналогичный вариант без использования исключений
будет простым и понятным.</p>
<p>Важно в каждой конкретной ситуации оценивать, какой вариант кода более
понятный, компактный и универсальный - с исключениями или без.</p>
<p>Если вы раньше использовали какой-то другой язык программирования, есть
вероятность, что в нём использование исключений считалось плохим тоном.
В Python это не так. Чтобы немного больше разобраться с этим вопросом,
посмотрите ссылки на дополнительные материалы в конце этого раздела.</p>
</div>
<div class="section" id="raise">
<h5>raise<a class="headerlink" href="#raise" title="Ссылка на этот заголовок">¶</a></h5>
<p>Иногда в коде надо сгенерировать исключение, это можно сделать так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;При выполнении команды возникла ошибка&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Встроенные исключения<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>В Python есть много <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#exception-hierarchy">встроенных исключений</a>,
каждое из которых генерируется в
определенной ситуации.</p>
<p>Например, TypeError обычно генерируется когда ожидался один тип данных, а передали другой</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;a&quot;</span> <span class="o">+</span> <span class="mi">3</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="n">aa8a24e3e06</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="s2">&quot;a&quot;</span> <span class="o">+</span> <span class="mi">3</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="n">can</span> <span class="n">only</span> <span class="n">concatenate</span> <span class="nb">str</span> <span class="p">(</span><span class="ow">not</span> <span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="n">to</span> <span class="nb">str</span>
</pre></div>
</div>
<p>ValueError когда значение не соответствует ожидаемому:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span>                                <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">d9136db7b558</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="ne">ValueError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">literal</span> <span class="k">for</span> <span class="nb">int</span><span class="p">()</span> <span class="k">with</span> <span class="n">base</span> <span class="mi">10</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/06_control_structures/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html">Compound statements (if, while, for,
try)</a></li>
<li><a class="reference external" href="https://docs.python.org/3/tutorial/controlflow.html#break-and-continue-statements-and-else-clauses-on-loops">break,
continue</a></li>
<li><a class="reference external" href="https://docs.python.org/3.6/tutorial/errors.html">Errors and
Exceptions</a></li>
<li><a class="reference external" href="https://docs.python.org/3.6/library/exceptions.html">Built-in
Exceptions</a></li>
</ul>
<p>Статьи:</p>
<ul class="simple">
<li><a class="reference external" href="https://jeffknupp.com/blog/2013/02/06/write-cleaner-python-use-exceptions/">Write Cleaner Python: Use
Exceptions</a></li>
<li><a class="reference external" href="http://eli.thegreenplace.net/2008/08/21/robust-exception-handling/">Robust exception
handling</a></li>
<li><a class="reference external" href="https://doughellmann.com/posts/python-exception-handling-techniques/">Python Exception Handling
Techniques</a></li>
</ul>
<p>Stack Overflow:</p>
<ul class="simple">
<li><a class="reference external" href="https://stackoverflow.com/questions/9979970/why-does-python-use-else-after-for-and-while-loops">Why does python use „else“ after for and while
loops?</a></li>
<li><a class="reference external" href="https://stackoverflow.com/questions/16138232/is-it-a-good-practice-to-use-try-except-else-in-python">Is it a good practice to use try-except-else in
Python?</a></li>
</ul>
</div>
<span id="document-exercises/06_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 6.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Список mac содержит MAC-адреса в формате XXXX:XXXX:XXXX.
Однако, в оборудовании cisco MAC-адреса используются в формате XXXX.XXXX.XXXX.</p>
<p>Написать код, который преобразует MAC-адреса в формат cisco и добавляет их в новый
список result. Полученный список result вывести на стандартный поток вывода (stdout)
с помощью print.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mac</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;aabb:cc80:7000&quot;</span><span class="p">,</span> <span class="s2">&quot;aabb:dd80:7340&quot;</span><span class="p">,</span> <span class="s2">&quot;aabb:ee80:7000&quot;</span><span class="p">,</span> <span class="s2">&quot;aabb:ff80:7000&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Задание 6.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<ol class="arabic simple">
<li>Запросить у пользователя ввод IP-адреса в формате 10.0.1.1</li>
<li>В зависимости от типа адреса (описаны ниже), вывести на стандартный поток вывода:<ul>
<li>«unicast» - если первый байт в диапазоне 1-223</li>
<li>«multicast» - если первый байт в диапазоне 224-239</li>
<li>«local broadcast» - если IP-адрес равен 255.255.255.255</li>
<li>«unassigned» - если IP-адрес равен 0.0.0.0</li>
<li>«unused» - во всех остальных случаях</li>
</ul>
</li>
</ol>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
<div class="section" id="a">
<h5>Задание 6.2a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Сделать копию скрипта задания 6.2.</p>
<p>Добавить проверку введенного IP-адреса. Адрес считается корректно заданным, если он:</p>
<ul class="simple">
<li>состоит из 4 чисел (а не букв или других символов)</li>
<li>числа разделенны точкой</li>
<li>каждое число в диапазоне от 0 до 255</li>
</ul>
<p>Если адрес задан неправильно, выводить сообщение: «Неправильный IP-адрес».
Сообщение «Неправильный IP-адрес» должно выводиться только один раз,
даже если несколько пунктов выше не выполнены.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
<div class="section" id="b">
<h5>Задание 6.2b<a class="headerlink" href="#b" title="Ссылка на этот заголовок">¶</a></h5>
<p>Сделать копию скрипта задания 6.2a.</p>
<p>Дополнить скрипт:
Если адрес был введен неправильно, запросить адрес снова.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
<div class="section" id="id4">
<h5>Задание 6.3<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>В скрипте сделан генератор конфигурации для access-портов.
Сделать аналогичный генератор конфигурации для портов trunk.</p>
<p>В транках ситуация усложняется тем, что VLANов может быть много, и надо понимать,
что с ним делать.
Поэтому в соответствии каждому порту стоит список
и первый (нулевой) элемент списка указывает как воспринимать номера VLAN,
которые идут дальше.</p>
<p>Пример значения и соответствующей команды:</p>
<ul class="simple">
<li>[«add», «10», «20»] - команда switchport trunk allowed vlan add 10,20</li>
<li>[«del», «17»] - команда switchport trunk allowed vlan remove 17</li>
<li>[«only», «11», «30»] - команда switchport trunk allowed vlan 11,30</li>
</ul>
<p>Задача для портов 0/1, 0/2, 0/4:</p>
<ul class="simple">
<li>сгенерировать конфигурацию на основе шаблона trunk_template</li>
<li>с учетом ключевых слов add, del, only</li>
</ul>
<p>Код не должен привязываться к конкретным номерам портов. То есть, если в словаре
trunk будут другие номера интерфейсов, код должен работать.</p>
<p>Для данных в словаре trunk_template вывод на
стандартный поток вывода должен быть таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="n">FastEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">encapsulation</span> <span class="n">dot1q</span>
 <span class="n">switchport</span> <span class="n">mode</span> <span class="n">trunk</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">add</span> <span class="mi">10</span><span class="p">,</span><span class="mi">20</span>
<span class="n">interface</span> <span class="n">FastEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">2</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">encapsulation</span> <span class="n">dot1q</span>
 <span class="n">switchport</span> <span class="n">mode</span> <span class="n">trunk</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="mi">11</span><span class="p">,</span><span class="mi">30</span>
<span class="n">interface</span> <span class="n">FastEthernet</span> <span class="mi">0</span><span class="o">/</span><span class="mi">4</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">encapsulation</span> <span class="n">dot1q</span>
 <span class="n">switchport</span> <span class="n">mode</span> <span class="n">trunk</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">remove</span> <span class="mi">17</span>
</pre></div>
</div>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport access vlan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spanning-tree portfast&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spanning-tree bpduguard enable&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">trunk_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;switchport trunk encapsulation dot1q&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport mode trunk&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport trunk allowed vlan&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">access</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;0/12&quot;</span><span class="p">:</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;0/14&quot;</span><span class="p">:</span> <span class="s2">&quot;11&quot;</span><span class="p">,</span> <span class="s2">&quot;0/16&quot;</span><span class="p">:</span> <span class="s2">&quot;17&quot;</span><span class="p">,</span> <span class="s2">&quot;0/17&quot;</span><span class="p">:</span> <span class="s2">&quot;150&quot;</span><span class="p">}</span>
<span class="n">trunk</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;0/1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;20&quot;</span><span class="p">],</span> <span class="s2">&quot;0/2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;only&quot;</span><span class="p">,</span> <span class="s2">&quot;11&quot;</span><span class="p">,</span> <span class="s2">&quot;30&quot;</span><span class="p">],</span> <span class="s2">&quot;0/4&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;del&quot;</span><span class="p">,</span> <span class="s2">&quot;17&quot;</span><span class="p">]}</span>

<span class="k">for</span> <span class="n">intf</span><span class="p">,</span> <span class="n">vlan</span> <span class="ow">in</span> <span class="n">access</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;interface FastEthernet&quot;</span> <span class="o">+</span> <span class="n">intf</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">access_template</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;access vlan&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">vlan</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/07_files/index"></span><div class="section" id="files-index">
<span id="id1"></span><h3>7. Работа с файлами<a class="headerlink" href="#files-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>В реальной жизни для того чтобы полноценно использовать всё, что
рассматривалось до этого раздела, надо разобраться как работать с
файлами.</p>
<p>При работе с сетевым оборудованием (и не только), файлами могут быть:</p>
<ul class="simple">
<li>конфигурации (простые, не структурированные текстовые файлы)<ul>
<li>работа с ними рассматривается в этом разделе</li>
</ul>
</li>
<li>шаблоны конфигураций<ul>
<li>как правило, это какой-то специальный формат файлов.</li>
<li>в разделе <a class="reference external" href="../20_jinja2/">Шаблоны конфигураций с Jinja</a> рассматривается
использование Jinja2 для создания шаблонов конфигураций</li>
</ul>
</li>
<li>файлы с параметрами подключений<ul>
<li>как правило, это структурированные файлы, в каком-то определенном формате: YAML, JSON, CSV<ul>
<li>в разделе <a class="reference external" href="../17_serialization/">Сериализация данных</a> рассматривается, как работать с такими  файлами</li>
</ul>
</li>
</ul>
</li>
<li>другие скрипты Python<ul>
<li>в разделе <a class="reference external" href="../11_modules/">Модули</a> рассматривается, как работать с модулями (другими скриптами Python)</li>
</ul>
</li>
</ul>
<p>В этом разделе рассматривается работа с простыми текстовыми файлами.
Например, конфигурационный файл Cisco.</p>
<p>В работе с файлами есть несколько аспектов:</p>
<ul class="simple">
<li>открытие/закрытие</li>
<li>чтение</li>
<li>запись</li>
</ul>
<p>В этом разделе рассматривается только необходимый минимум для работы с файлами. Подробнее в
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-file-objects">документации Python</a>.</p>
<div class="toctree-wrapper compound">
<span id="document-book/07_files/open"></span><div class="section" id="id1">
<h4>Открытие файлов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для начала работы с файлом, его надо открыть.</p>
<div class="section" id="open">
<h5><code class="docutils literal notranslate"><span class="pre">open</span></code><a class="headerlink" href="#open" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для открытия файлов, чаще всего, используется функция <code class="docutils literal notranslate"><span class="pre">open</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file_name.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>В функции open():</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'file_name.txt'</span></code> - имя файла</li>
<li>тут можно указывать не только имя, но и путь (абсолютный или относительный)</li>
<li><code class="docutils literal notranslate"><span class="pre">'r'</span></code> - режим открытия файла</li>
</ul>
<p>Функция <code class="docutils literal notranslate"><span class="pre">open</span></code> создает объект file, к которому потом можно применять
различные методы, для работы с ним.</p>
<p>Режимы открытия файлов:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">r</span></code> - открыть файл только для чтения (значение по умолчанию)</li>
<li><code class="docutils literal notranslate"><span class="pre">r+</span></code> - открыть файл для чтения и записи</li>
<li><code class="docutils literal notranslate"><span class="pre">w</span></code> - открыть файл для записи</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>если файл существует, то его содержимое удаляется</li>
<li>если файл не существует, то создается новый</li>
</ul>
</div></blockquote>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">w+</span></code> - открыть файл для чтения и записи</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>если файл существует, то его содержимое удаляется</li>
<li>если файл не существует, то создается новый</li>
</ul>
</div></blockquote>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">a</span></code> - открыть файл для дополнения записи. Данные добавляются в
конец файла</li>
<li><code class="docutils literal notranslate"><span class="pre">a+</span></code> - открыть файл для чтения и записи. Данные добавляются в конец
файла</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">r - read; a - append; w - write</p>
</div>
</div>
</div>
<span id="document-book/07_files/read"></span><div class="section" id="id1">
<h4>Чтение файлов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python есть несколько методов чтения файла:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">read</span></code> - считывает содержимое файла в строку</li>
<li><code class="docutils literal notranslate"><span class="pre">readline</span></code> - считывает файл построчно</li>
<li><code class="docutils literal notranslate"><span class="pre">readlines</span></code> - считывает строки файла и создает список из строк</li>
</ul>
<p>Посмотрим как считывать содержимое файлов, на примере файла r1.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
</pre></div>
</div>
<div class="section" id="read">
<h5><code class="docutils literal notranslate"><span class="pre">read</span></code><a class="headerlink" href="#read" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">read</span></code> - считывает весь файл в одну строку.</p>
<p>Пример использования метода <code class="docutils literal notranslate"><span class="pre">read</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;r1.txt&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;!</span><span class="se">\n</span><span class="s1">service timestamps debug datetime msec localtime show-timezone year</span><span class="se">\n</span><span class="s1">service timestamps log datetime msec localtime show-timezone year</span><span class="se">\n</span><span class="s1">service password-encryption</span><span class="se">\n</span><span class="s1">service sequence-numbers</span><span class="se">\n</span><span class="s1">!</span><span class="se">\n</span><span class="s1">no ip domain lookup</span><span class="se">\n</span><span class="s1">!</span><span class="se">\n</span><span class="s1">ip ssh version 2</span><span class="se">\n</span><span class="s1">!</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>При повторном чтении файла в 3 строке, отображается пустая строка. Так
происходит из-за того, что при вызове метода <code class="docutils literal notranslate"><span class="pre">read</span></code>, считывается
весь файл. И после того, как файл был считан, курсор остается в конце
файла. Управлять положением курсора можно с помощью метода <code class="docutils literal notranslate"><span class="pre">seek</span></code>.</p>
</div>
<div class="section" id="readline">
<h5><code class="docutils literal notranslate"><span class="pre">readline</span></code><a class="headerlink" href="#readline" title="Ссылка на этот заголовок">¶</a></h5>
<p>Построчно файл можно считать с помощью метода <code class="docutils literal notranslate"><span class="pre">readline</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;r1.txt&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;!</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;service timestamps debug datetime msec localtime show-timezone year</span><span class="se">\n</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Но чаще всего проще пройтись по объекту file в цикле, не используя
методы <code class="docutils literal notranslate"><span class="pre">read...</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [7]: f = open(&#39;r1.txt&#39;)

In [8]: for line in f:
   ...:     print(line)
   ...:
!

service timestamps debug datetime msec localtime show-timezone year

service timestamps log datetime msec localtime show-timezone year

service password-encryption

service sequence-numbers

!

no ip domain lookup

!

ip ssh version 2

!
</pre></div>
</div>
</div>
<div class="section" id="readlines">
<h5><code class="docutils literal notranslate"><span class="pre">readlines</span></code><a class="headerlink" href="#readlines" title="Ссылка на этот заголовок">¶</a></h5>
<p>Еще один полезный метод - <code class="docutils literal notranslate"><span class="pre">readlines</span></code>. Он считывает строки файла в
список:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;r1.txt&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service timestamps debug datetime msec localtime show-timezone year</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service timestamps log datetime msec localtime show-timezone year</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service password-encryption</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service sequence-numbers</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;no ip domain lookup</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ip ssh version 2</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Если нужно получить строки файла, но без перевода строки в конце, можно
воспользоваться методом <code class="docutils literal notranslate"><span class="pre">split</span></code> и как разделитель, указать символ
<code class="docutils literal notranslate"><span class="pre">\n</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;r1.txt&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service timestamps debug datetime msec localtime show-timezone year&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service timestamps log datetime msec localtime show-timezone year&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service password-encryption&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service sequence-numbers&#39;</span><span class="p">,</span>
 <span class="s1">&#39;!&#39;</span><span class="p">,</span>
 <span class="s1">&#39;no ip domain lookup&#39;</span><span class="p">,</span>
 <span class="s1">&#39;!&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ip ssh version 2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;!&#39;</span><span class="p">,</span>
 <span class="s1">&#39;&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Обратите внимание, что последний элемент списка - пустая строка.</p>
<p>Если перед выполнением <code class="docutils literal notranslate"><span class="pre">split</span></code>, воспользоваться методом
<code class="docutils literal notranslate"><span class="pre">rstrip</span></code>, список будет без пустой строки в конце:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;r1.txt&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service timestamps debug datetime msec localtime show-timezone year&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service timestamps log datetime msec localtime show-timezone year&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service password-encryption&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service sequence-numbers&#39;</span><span class="p">,</span>
 <span class="s1">&#39;!&#39;</span><span class="p">,</span>
 <span class="s1">&#39;no ip domain lookup&#39;</span><span class="p">,</span>
 <span class="s1">&#39;!&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ip ssh version 2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;!&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="seek">
<h5><code class="docutils literal notranslate"><span class="pre">seek</span></code><a class="headerlink" href="#seek" title="Ссылка на этот заголовок">¶</a></h5>
<p>До сих пор, файл каждый раз приходилось открывать заново, чтобы снова
его считать. Так происходит из-за того, что после методов чтения, курсор
находится в конце файла. И повторное чтение возвращает пустую строку.</p>
<p>Чтобы ещё раз считать информацию из файла, нужно воспользоваться методом
<code class="docutils literal notranslate"><span class="pre">seek</span></code>, который перемещает курсор в необходимое положение.</p>
<p>Пример открытия файла и считывания содержимого:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [15]: f = open(&#39;r1.txt&#39;)

In [16]: print(f.read())
!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
</pre></div>
</div>
<p>Если вызывать ещё раз метод <code class="docutils literal notranslate"><span class="pre">read</span></code>, возвращается пустая строка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>Но с помощью метода <code class="docutils literal notranslate"><span class="pre">seek</span></code> можно перейти в начало файла (0 означает
начало файла):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>После того как с помощью <code class="docutils literal notranslate"><span class="pre">seek</span></code> курсор был переведен в начало
файла, можно опять считывать содержимое:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [19]: print(f.read())
!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
</pre></div>
</div>
</div>
</div>
<span id="document-book/07_files/write"></span><div class="section" id="id1">
<h4>Запись файлов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>При записи, очень важно определиться с режимом открытия файла, чтобы
случайно его не удалить:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">w</span></code> - открыть файл для записи. Если файл существует, то его
содержимое удаляется</li>
<li><code class="docutils literal notranslate"><span class="pre">a</span></code> - открыть файл для дополнения записи. Данные добавляются в
конец файла</li>
</ul>
<p>При этом оба режима создают файл, если он не существует.</p>
<p>Для записи в файл используются такие методы:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">write</span></code> - записать в файл одну строку</li>
<li><code class="docutils literal notranslate"><span class="pre">writelines</span></code> - позволяет передавать в качестве аргумента список строк</li>
</ul>
<div class="section" id="write">
<h5><code class="docutils literal notranslate"><span class="pre">write</span></code><a class="headerlink" href="#write" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">write</span></code> ожидает строку, для записи.</p>
<p>Для примера, возьмем список строк с конфигурацией:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">cfg_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;service timestamps debug datetime msec localtime show-timezone year&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;service timestamps log datetime msec localtime show-timezone year&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;service password-encryption&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;service sequence-numbers&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;!&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;no ip domain lookup&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;!&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;ip ssh version 2&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;!&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Открытие файла r2.txt в режиме для записи:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;r2.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Преобразуем список команд в одну большую строку с помощью <code class="docutils literal notranslate"><span class="pre">join</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">cfg_lines_as_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfg_lines</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">cfg_lines_as_string</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;!</span><span class="se">\n</span><span class="s1">service timestamps debug datetime msec localtime show-timezone year</span><span class="se">\n</span><span class="s1">service timestamps log datetime msec localtime show-timezone year</span><span class="se">\n</span><span class="s1">service password-encryption</span><span class="se">\n</span><span class="s1">service sequence-numbers</span><span class="se">\n</span><span class="s1">!</span><span class="se">\n</span><span class="s1">no ip domain lookup</span><span class="se">\n</span><span class="s1">!</span><span class="se">\n</span><span class="s1">ip ssh version 2</span><span class="se">\n</span><span class="s1">!&#39;</span>
</pre></div>
</div>
<p>Запись строки в файл:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cfg_lines_as_string</span><span class="p">)</span>
</pre></div>
</div>
<p>Аналогично можно добавить строку вручную:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">hostname r2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>После завершения работы с файлом, его необходимо закрыть:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Так как ipython поддерживает команду cat, можно легко посмотреть
содержимое файла:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [8]: cat r2.txt
!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
hostname r2
</pre></div>
</div>
</div>
<div class="section" id="writelines">
<h5><code class="docutils literal notranslate"><span class="pre">writelines</span></code><a class="headerlink" href="#writelines" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">writelines</span></code> ожидает список строк, как аргумент.</p>
<p>Запись списка строк cfg_lines в файл:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [1]: cfg_lines = [&#39;!&#39;,
   ...:  &#39;service timestamps debug datetime msec localtime show-timezone year&#39;,
   ...:  &#39;service timestamps log datetime msec localtime show-timezone year&#39;,
   ...:  &#39;service password-encryption&#39;,
   ...:  &#39;service sequence-numbers&#39;,
   ...:  &#39;!&#39;,
   ...:  &#39;no ip domain lookup&#39;,
   ...:  &#39;!&#39;,
   ...:  &#39;ip ssh version 2&#39;,
   ...:  &#39;!&#39;]

In [9]: f = open(&#39;r2.txt&#39;, &#39;w&#39;)

In [10]: f.writelines(cfg_lines)

In [11]: f.close()

In [12]: cat r2.txt
!service timestamps debug datetime msec localtime show-timezone yearservice timestamps log datetime msec localtime show-timezone yearservice password-encryptionservice sequence-numbers!no ip domain lookup!ip ssh version 2!
</pre></div>
</div>
<p>В результате все строки из списка записались в одну строку файла, так
как в конце строк не было символа <code class="docutils literal notranslate"><span class="pre">\n</span></code>.</p>
<p>Добавить перевод строки можно по-разному.
Например, можно просто обработать список в цикле:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">cfg_lines2</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cfg_lines</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="n">cfg_lines2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">cfg_lines2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service timestamps debug datetime msec localtime show-timezone year</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service timestamps log datetime msec localtime show-timezone year</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service password-encryption</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;service sequence-numbers</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;no ip domain lookup</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ip ssh version 2</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</pre></div>
</div>
<p>Если итоговый список записать заново в файл, то в нём уже
будут переводы строк:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [18]: f = open(&#39;r2.txt&#39;, &#39;w&#39;)

In [19]: f.writelines(cfg_lines2)

In [20]: f.close()

In [21]: cat r2.txt
!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
</pre></div>
</div>
</div>
</div>
<span id="document-book/07_files/close"></span><div class="section" id="id1">
<h4>Закрытие файлов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В реальной жизни для закрытия файлов чаще всего используется
конструкция <code class="docutils literal notranslate"><span class="pre">with</span></code>. Её намного удобней использовать, чем закрывать
файл явно. Но, так как в жизни можно встретить и метод <code class="docutils literal notranslate"><span class="pre">close</span></code>, в
этом разделе рассматривается как его использовать.</p>
</div>
<p>После завершения работы с файлом, его нужно закрыть.
В некоторых случаях Python может самостоятельно закрыть файл.
Но лучше на это не рассчитывать и закрывать файл явно.</p>
<div class="section" id="close">
<h5><code class="docutils literal notranslate"><span class="pre">close</span></code><a class="headerlink" href="#close" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод close встречался в разделе <a class="reference external" href="https://pyneng.readthedocs.io/ru/latest/book/07_files/3_write.html">запись файлов</a>.
Там он был нужен для того, чтобы содержимое файла было записано на диск.</p>
<p>Для этого, в Python есть отдельный метод <code class="docutils literal notranslate"><span class="pre">flush</span></code>.
Но так как в примере с записью файлов, не нужно было больше
выполнять никаких операций, файл можно было закрыть.</p>
<p>Откроем файл r1.txt:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;r1.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь можно считать содержимое:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [2]: print(f.read())
!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
</pre></div>
</div>
<p>У объекта file есть специальный атрибут <code class="docutils literal notranslate"><span class="pre">closed</span></code>, который позволяет
проверить, закрыт файл или нет.
Если файл открыт, он возвращает <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">closed</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Теперь закрываем файл и снова проверяем <code class="docutils literal notranslate"><span class="pre">closed</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">closed</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Если попробовать прочитать файл, возникнет исключение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="o">------------------------------------------------------------------</span>
<span class="ne">ValueError</span>                       <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">53</span><span class="o">-</span><span class="mi">2</span><span class="n">c962247edc5</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="ne">ValueError</span><span class="p">:</span> <span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">operation</span> <span class="n">on</span> <span class="n">closed</span> <span class="n">file</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/07_files/with"></span><div class="section" id="with">
<h4>Конструкция with<a class="headerlink" href="#with" title="Ссылка на этот заголовок">¶</a></h4>
<p>Конструкция with называется менеджер контекста.</p>
<p>В Python существует более удобный способ работы с файлами, чем те,
которые использовались до сих пор - конструкция <code class="docutils literal notranslate"><span class="pre">with</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [1]: with open(&#39;r1.txt&#39;, &#39;r&#39;) as f:
  ....:     for line in f:
  ....:         print(line)
  ....:
!

service timestamps debug datetime msec localtime show-timezone year

service timestamps log datetime msec localtime show-timezone year

service password-encryption

service sequence-numbers

!

no ip domain lookup

!

ip ssh version 2

!
</pre></div>
</div>
<p>Кроме того, конструкция <code class="docutils literal notranslate"><span class="pre">with</span></code> гарантирует закрытие файла
автоматически.</p>
<p>Обратите внимание на то, как считываются строки файла:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>Когда с файлом нужно работать построчно, лучше использовать такой
вариант.</p>
<p>В предыдущем выводе, между строками файла были лишние пустые строки, так
как print добавляет ещё один перевод строки.</p>
<p>Чтобы избавиться от этого, можно использовать метод <code class="docutils literal notranslate"><span class="pre">rstrip</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [2]: with open(&#39;r1.txt&#39;, &#39;r&#39;) as f:
  ....:     for line in f:
  ....:         print(line.rstrip())
  ....:
!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!

In [3]: f.closed
Out[3]: True
</pre></div>
</div>
<p>И конечно же, с конструкцией <code class="docutils literal notranslate"><span class="pre">with</span></code> можно использовать не только
такой построчный вариант считывания, все методы, которые рассматривались
до этого, также работают:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [4]: with open(&#39;r1.txt&#39;, &#39;r&#39;) as f:
  ....:     print(f.read())
  ....:
!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
</pre></div>
</div>
<div class="section" id="id1">
<h5>Открытие двух файлов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Иногда нужно работать одновременно с двумя файлами. Например, надо
записать некоторые строки из одного файла, в другой.</p>
<p>В таком случае, в блоке with можно открывать два файла таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;r1.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;result.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dest</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;service&#39;</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>             <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">cat</span> <span class="n">result</span><span class="o">.</span><span class="n">txt</span>
<span class="n">service</span> <span class="n">timestamps</span> <span class="n">debug</span> <span class="n">datetime</span> <span class="n">msec</span> <span class="n">localtime</span> <span class="n">show</span><span class="o">-</span><span class="n">timezone</span> <span class="n">year</span>
<span class="n">service</span> <span class="n">timestamps</span> <span class="n">log</span> <span class="n">datetime</span> <span class="n">msec</span> <span class="n">localtime</span> <span class="n">show</span><span class="o">-</span><span class="n">timezone</span> <span class="n">year</span>
<span class="n">service</span> <span class="n">password</span><span class="o">-</span><span class="n">encryption</span>
<span class="n">service</span> <span class="n">sequence</span><span class="o">-</span><span class="n">numbers</span>
</pre></div>
</div>
<p>Это равнозначно таким двум блокам with:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;r1.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;result.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dest</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>             <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;service&#39;</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>                 <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/07_files/working_with_files"></span><div class="section" id="id1">
<h4>Примеры работы с файлами<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>В этом подразделе рассматривается работа с файлами и объединяются
темы: файлы, циклы и условия.</p>
<p>При обработке вывода команд или конфигурации часто надо будет записать
итоговые данные в словарь.
Не всегда очевидно, как обрабатывать вывод команд и каким образом в целом
подходить к разбору вывода на части. В этом подразделе рассматриваются
несколько примеров, с возрастающим уровнем сложности.</p>
<div class="section" id="id2">
<h5>Разбор вывода столбцами<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>В этом примере будет разбираться вывод команды sh ip int br. Из вывода
команды нам надо получить соответствия имя интерфейса - IP-адрес. То
есть имя интерфейса - это ключ словаря, а IP-адрес - значение. При этом,
соответствие надо делать только для тех интерфейсов, у которых назначен
IP-адрес.</p>
<p>Пример вывода команды sh ip int br (файл sh_ip_int_br.txt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>R1#show ip interface brief
Interface                  IP-Address      OK? Method Status                Protocol
FastEthernet0/0            15.0.15.1       YES manual up                    up
FastEthernet0/1            10.0.12.1       YES manual up                    up
FastEthernet0/2            10.0.13.1       YES manual up                    up
FastEthernet0/3            unassigned      YES unset  up                    down
Loopback0                  10.1.1.1        YES manual up                    up
Loopback100                100.0.0.1       YES manual up                    up
</pre></div>
</div>
<p>Файл working_with_dict_example_1.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sh_ip_int_br.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="n">interface</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="o">*</span><span class="n">other</span> <span class="o">=</span> <span class="n">line</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span> <span class="o">=</span> <span class="n">address</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Команда sh ip int br отображает вывод столбцами. Значит нужные поля
находятся в одной строке. Скрипт обрабатывает вывод построчно и каждую
строку разбивает с помощью метода split.</p>
<p>Полученный в итоге список содержит столбцы вывода. Так как из всего
вывода нужны только интерфейсы на которых настроен IP-адрес, выполняется
проверка первого символа второго столбца: если первый символ число,
значит на интерфейсе назначен адрес и эту строку надо обрабатывать.</p>
<p>В строке <code class="docutils literal notranslate"><span class="pre">interface,</span> <span class="pre">address,</span> <span class="pre">*other</span> <span class="pre">=</span> <span class="pre">line</span></code> выполняется распаковка
переменных. В переменную interface попадет имя интерфейса, в address
попадет IP-адрес, а в other все остальные поля.</p>
<p>Так как для каждой строки есть пара ключ и значение, они присваиваются в
словарь: <code class="docutils literal notranslate"><span class="pre">result[interface]</span> <span class="pre">=</span> <span class="pre">address</span></code>.</p>
<p>Результатом выполнения скрипта будет такой словарь (тут он разбит на
пары ключ-значение для удобства, в реальном выводе скрипта словарь будет
отображаться в одну строку):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">:</span> <span class="s1">&#39;15.0.15.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">:</span> <span class="s1">&#39;10.0.12.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;FastEthernet0/2&#39;</span><span class="p">:</span> <span class="s1">&#39;10.0.13.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Loopback0&#39;</span><span class="p">:</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Loopback100&#39;</span><span class="p">:</span> <span class="s1">&#39;100.0.0.1&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Получение ключа и значения из разных строк вывода<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Очень часто вывод команд выглядит таким образом, что ключ и значение
находятся в разных строках. И надо придумать каким образом обрабатывать
вывод, чтобы получить нужное соответствие.</p>
<p>Например, из вывода команды <code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">ip</span> <span class="pre">interface</span></code> надо получить соответствие
имя интерфейса - MTU (файл sh_ip_interface.txt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ethernet0</span><span class="o">/</span><span class="mi">0</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span><span class="o">/</span><span class="mi">24</span>
  <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
  <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">non</span><span class="o">-</span><span class="n">volatile</span> <span class="n">memory</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="o">...</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">200.1</span><span class="o">/</span><span class="mi">24</span>
  <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
  <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">non</span><span class="o">-</span><span class="n">volatile</span> <span class="n">memory</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="o">...</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">19.1</span><span class="o">.</span><span class="mf">1.1</span><span class="o">/</span><span class="mi">24</span>
  <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
  <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">non</span><span class="o">-</span><span class="n">volatile</span> <span class="n">memory</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>Имя интерфейса находится в строке вида
<code class="docutils literal notranslate"><span class="pre">Ethernet0/0</span> <span class="pre">is</span> <span class="pre">up,</span> <span class="pre">line</span> <span class="pre">protocol</span> <span class="pre">is</span> <span class="pre">up</span></code>, а MTU в строке вида
<code class="docutils literal notranslate"><span class="pre">MTU</span> <span class="pre">is</span> <span class="pre">1500</span> <span class="pre">bytes</span></code>.</p>
<p>Например, попробуем запоминать каждый раз интерфейс и выводить его
значение, когда встречается MTU, вместе со значением MTU:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sh_ip_interface.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="s1">&#39;line protocol&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>             <span class="n">interface</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">elif</span> <span class="s1">&#39;MTU is&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>             <span class="n">mtu</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
   <span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:15}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">mtu</span><span class="p">))</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">0</span>    <span class="mi">1500</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">1</span>    <span class="mi">1500</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span>    <span class="mi">1500</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">3</span>    <span class="mi">1500</span>
<span class="n">Loopback0</span>      <span class="mi">1514</span>
</pre></div>
</div>
<p>Вывод организован таким образом, что всегда сначала идет строка с
интерфейсом, а затем через несколько строк - строка с MTU. Если
запоминать имя интерфейса каждый раз, когда оно встречается, то на
момент когда встретится строка с MTU, последний запомненный интерфейс -
это тот к которому относится MTU.</p>
<p>Теперь, если необходимо создать словарь с соответствием интерфейс - MTU,
достаточно записать значения на момент, когда был найден MTU.</p>
<p>Файл working_with_dict_example_2.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sh_ip_interface.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;line protocol&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">interface</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;MTU is&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">mtu</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtu</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Результатом выполнения скрипта будет такой словарь (тут он разбит на
пары ключ-значение для удобства, в реальном выводе скрипта словарь будет
отображаться в одну строку):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;Ethernet0/0&#39;</span><span class="p">:</span> <span class="s1">&#39;1500&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Ethernet0/1&#39;</span><span class="p">:</span> <span class="s1">&#39;1500&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Ethernet0/2&#39;</span><span class="p">:</span> <span class="s1">&#39;1500&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Ethernet0/3&#39;</span><span class="p">:</span> <span class="s1">&#39;1500&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Loopback0&#39;</span><span class="p">:</span> <span class="s1">&#39;1514&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Этот прием будет достаточно часто полезен, так как вывод команд, в
целом, организован очень похожим образом.</p>
</div>
<div class="section" id="id4">
<h5>Вложенный словарь<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если из вывода команды надо получить несколько параметров, очень удобно
использовать словарь с вложенным словарем.</p>
<p>Например, из вывода <code class="docutils literal notranslate"><span class="pre">`sh</span> <span class="pre">ip</span> <span class="pre">interface`</span></code> надо получить два параметра:
IP-адрес и MTU. Для начала, вывод информации:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ethernet0</span><span class="o">/</span><span class="mi">0</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span><span class="o">/</span><span class="mi">24</span>
  <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
  <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">non</span><span class="o">-</span><span class="n">volatile</span> <span class="n">memory</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="o">...</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">200.1</span><span class="o">/</span><span class="mi">24</span>
  <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
  <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">non</span><span class="o">-</span><span class="n">volatile</span> <span class="n">memory</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="o">...</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">Internet</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">19.1</span><span class="o">.</span><span class="mf">1.1</span><span class="o">/</span><span class="mi">24</span>
  <span class="n">Broadcast</span> <span class="n">address</span> <span class="ow">is</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
  <span class="n">Address</span> <span class="n">determined</span> <span class="n">by</span> <span class="n">non</span><span class="o">-</span><span class="n">volatile</span> <span class="n">memory</span>
  <span class="n">MTU</span> <span class="ow">is</span> <span class="mi">1500</span> <span class="nb">bytes</span>
  <span class="n">Helper</span> <span class="n">address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>На первом этапе каждое значение запоминается в переменную, а затем, выводятся все три значения.
Значения выводятся, когда встретилась строка с MTU, потому что она идет последней:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sh_ip_interface.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="s1">&#39;line protocol&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>             <span class="n">interface</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">elif</span> <span class="s1">&#39;Internet address&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>             <span class="n">ip_address</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">elif</span> <span class="s1">&#39;MTU&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>             <span class="n">mtu</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
   <span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:15}{:17}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">,</span> <span class="n">mtu</span><span class="p">))</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">0</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span><span class="o">/</span><span class="mi">24</span> <span class="mi">1500</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">1</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">200.1</span><span class="o">/</span><span class="mi">24</span> <span class="mi">1500</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span>    <span class="mf">19.1</span><span class="o">.</span><span class="mf">1.1</span><span class="o">/</span><span class="mi">24</span>      <span class="mi">1500</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">3</span>    <span class="mf">192.168</span><span class="o">.</span><span class="mf">230.1</span><span class="o">/</span><span class="mi">24</span> <span class="mi">1500</span>
<span class="n">Loopback0</span>      <span class="mf">4.4</span><span class="o">.</span><span class="mf">4.4</span><span class="o">/</span><span class="mi">32</span>       <span class="mi">1514</span>
</pre></div>
</div>
<p>Тут используется такой же прием, как в предыдущем примере, но
добавляется еще одна вложенность словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sh_ip_interface.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;line protocol&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">interface</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="s1">&#39;Internet address&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">ip_address</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interface</span><span class="p">][</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ip_address</span>
        <span class="k">elif</span> <span class="s1">&#39;MTU&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">mtu</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interface</span><span class="p">][</span><span class="s1">&#39;mtu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtu</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Каждый раз, когда встречается интерфейс, в словаре <code class="docutils literal notranslate"><span class="pre">`result`</span></code> создается ключ
с именем интерфейса, которому соответствует пустой словарь. Эта
заготовка нужна для того, чтобы на момент когда встретится IP-адрес или
MTU можно было записать параметр во вложенный словарь соответствующего
интерфейса.</p>
<p>Результатом выполнения скрипта будет такой словарь (тут он разбит на
пары ключ-значение для удобства, в реальном выводе скрипта словарь будет
отображаться в одну строку):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;Ethernet0/0&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1/24&#39;</span><span class="p">,</span> <span class="s1">&#39;mtu&#39;</span><span class="p">:</span> <span class="s1">&#39;1500&#39;</span><span class="p">},</span>
 <span class="s1">&#39;Ethernet0/1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.200.1/24&#39;</span><span class="p">,</span> <span class="s1">&#39;mtu&#39;</span><span class="p">:</span> <span class="s1">&#39;1500&#39;</span><span class="p">},</span>
 <span class="s1">&#39;Ethernet0/2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;19.1.1.1/24&#39;</span><span class="p">,</span> <span class="s1">&#39;mtu&#39;</span><span class="p">:</span> <span class="s1">&#39;1500&#39;</span><span class="p">},</span>
 <span class="s1">&#39;Ethernet0/3&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.230.1/24&#39;</span><span class="p">,</span> <span class="s1">&#39;mtu&#39;</span><span class="p">:</span> <span class="s1">&#39;1500&#39;</span><span class="p">},</span>
 <span class="s1">&#39;Loopback0&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;4.4.4.4/32&#39;</span><span class="p">,</span> <span class="s1">&#39;mtu&#39;</span><span class="p">:</span> <span class="s1">&#39;1514&#39;</span><span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Вывод с пустыми значениями<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Иногда, в выводе будут попадаться секции с пустыми значениями. Например,
в случае с выводом <code class="docutils literal notranslate"><span class="pre">`sh</span> <span class="pre">ip</span> <span class="pre">interface`</span></code>, могут попадаться интерфейсы, которые
выглядят так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ethernet0</span><span class="o">/</span><span class="mi">1</span> <span class="ow">is</span> <span class="n">up</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">up</span>
  <span class="n">Internet</span> <span class="n">protocol</span> <span class="n">processing</span> <span class="n">disabled</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span> <span class="ow">is</span> <span class="n">administratively</span> <span class="n">down</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">down</span>
  <span class="n">Internet</span> <span class="n">protocol</span> <span class="n">processing</span> <span class="n">disabled</span>
<span class="n">Ethernet0</span><span class="o">/</span><span class="mi">3</span> <span class="ow">is</span> <span class="n">administratively</span> <span class="n">down</span><span class="p">,</span> <span class="n">line</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="n">down</span>
  <span class="n">Internet</span> <span class="n">protocol</span> <span class="n">processing</span> <span class="n">disabled</span>
</pre></div>
</div>
<p>Соответственно тут нет MTU или IP-адреса.</p>
<p>И если выполнить предыдущий скрипт для файла с такими интерфейсами,
результат будет таким (вывод для файла sh_ip_interface2.txt):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;Ethernet0/0&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.2/24&#39;</span><span class="p">,</span> <span class="s1">&#39;mtu&#39;</span><span class="p">:</span> <span class="s1">&#39;1500&#39;</span><span class="p">},</span>
 <span class="s1">&#39;Ethernet0/1&#39;</span><span class="p">:</span> <span class="p">{},</span>
 <span class="s1">&#39;Ethernet0/2&#39;</span><span class="p">:</span> <span class="p">{},</span>
 <span class="s1">&#39;Ethernet0/3&#39;</span><span class="p">:</span> <span class="p">{},</span>
 <span class="s1">&#39;Loopback0&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;2.2.2.2/32&#39;</span><span class="p">,</span> <span class="s1">&#39;mtu&#39;</span><span class="p">:</span> <span class="s1">&#39;1514&#39;</span><span class="p">}}</span>
</pre></div>
</div>
<p>Если необходимо добавлять интерфейсы в словарь только, когда на
интерфейсе назначен IP-адрес, надо перенести создание ключа с именем
интерфейса на момент, когда встречается строка с IP-адресом (файл
working_with_dict_example_4.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sh_ip_interface2.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;line protocol&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">interface</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;Internet address&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">ip_address</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interface</span><span class="p">][</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ip_address</span>
        <span class="k">elif</span> <span class="s1">&#39;MTU&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">mtu</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interface</span><span class="p">][</span><span class="s1">&#39;mtu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mtu</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>В этом случае результатом будет такой словарь:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;Ethernet0/0&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.2/24&#39;</span><span class="p">,</span> <span class="s1">&#39;mtu&#39;</span><span class="p">:</span> <span class="s1">&#39;1500&#39;</span><span class="p">},</span>
 <span class="s1">&#39;Loopback0&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;2.2.2.2/32&#39;</span><span class="p">,</span> <span class="s1">&#39;mtu&#39;</span><span class="p">:</span> <span class="s1">&#39;1514&#39;</span><span class="p">}}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/07_files/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/tutorial/inputoutput.html#reading-and-writing-files">Reading and Writing
Files</a></li>
<li><a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#the-with-statement">The with
statement</a></li>
</ul>
<p>Статьи:</p>
<ul class="simple">
<li><a class="reference external" href="http://preshing.com/20110920/the-python-with-statement-by-example/">The Python «with» Statement by
Example</a></li>
</ul>
<p>Stack Overflow:</p>
<ul class="simple">
<li><a class="reference external" href="http://stackoverflow.com/questions/3012488/what-is-the-python-with-statement-designed-for">What is the python “with” statement designed
for?</a></li>
</ul>
</div>
<span id="document-exercises/07_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 7.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Обработать строки из файла ospf.txt и вывести информацию по каждой строке в таком
виде на стандартный поток вывода:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Prefix</span>                <span class="mf">10.0</span><span class="o">.</span><span class="mf">24.0</span><span class="o">/</span><span class="mi">24</span>
<span class="n">AD</span><span class="o">/</span><span class="n">Metric</span>             <span class="mi">110</span><span class="o">/</span><span class="mi">41</span>
<span class="n">Next</span><span class="o">-</span><span class="n">Hop</span>              <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
<span class="n">Last</span> <span class="n">update</span>           <span class="mi">3</span><span class="n">d18h</span>
<span class="n">Outbound</span> <span class="n">Interface</span>    <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span>
</pre></div>
</div>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
<div class="section" id="id3">
<h5>Задание 7.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать скрипт, который будет обрабатывать конфигурационный файл config_sw1.txt. Имя файла передается как аргумент скрипту.</p>
<p>Скрипт должен возвращать на стандартный поток вывода команды из переданного
конфигурационного файла, исключая строки, которые начинаются с <code class="docutils literal notranslate"><span class="pre">!</span></code>.</p>
<p>Вывод должен быть без пустых строк.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<p>Пример вывода:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python task_7_2.py config_sw1.txt
Current configuration : 2033 bytes
version 15.0
service timestamps debug datetime msec
service timestamps log datetime msec
no service password-encryption
hostname sw1
interface Ethernet0/0
 duplex auto
interface Ethernet0/1
 switchport trunk encapsulation dot1q
 switchport trunk allowed vlan 100
 switchport mode trunk
 duplex auto
 spanning-tree portfast edge trunk
interface Ethernet0/2
 duplex auto
interface Ethernet0/3
 switchport trunk encapsulation dot1q
 switchport trunk allowed vlan 100
 duplex auto
 switchport mode trunk
 spanning-tree portfast edge trunk
...
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 7.2a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Сделать копию скрипта задания 7.2.</p>
<p>Дополнить скрипт: Скрипт не должен выводить команды, в которых содержатся слова, которые указаны в списке ignore.</p>
<p>При этом скрипт также не должен выводить строки, которые начинаются на !.</p>
<p>Проверить работу скрипта на конфигурационном файле config_sw1.txt.
Имя файла передается как аргумент скрипту.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;duplex&quot;</span><span class="p">,</span> <span class="s2">&quot;alias&quot;</span><span class="p">,</span> <span class="s2">&quot;configuration&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="b">
<h5>Задание 7.2b<a class="headerlink" href="#b" title="Ссылка на этот заголовок">¶</a></h5>
<p>Переделать скрипт из задания 7.2a: вместо вывода на стандартный поток вывода,
скрипт должен записать полученные строки в файл</p>
<p>Имена файлов нужно передавать как аргументы скрипту:</p>
<blockquote>
<div><ul class="simple">
<li>имя исходного файла конфигурации</li>
<li>имя итогового файла конфигурации</li>
</ul>
</div></blockquote>
<p>При этом, должны быть отфильтрованы строки, которые содержатся в списке ignore
и строки, которые начинаются на „!“.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;duplex&quot;</span><span class="p">,</span> <span class="s2">&quot;alias&quot;</span><span class="p">,</span> <span class="s2">&quot;configuration&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Задание 7.3<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скрипт должен обрабатывать записи в файле CAM_table.txt. Каждая строка,
где есть MAC-адрес, должна быть обработана таким образом, чтобы
на стандартный поток вывода была выведена таблица вида:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">100</span>      <span class="mi">01</span><span class="n">bb</span><span class="o">.</span><span class="n">c580</span><span class="o">.</span><span class="mi">7000</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
<span class="mi">200</span>      <span class="mi">0</span><span class="n">a4b</span><span class="o">.</span><span class="n">c380</span><span class="o">.</span><span class="mi">7</span><span class="n">c00</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>
<span class="mi">300</span>      <span class="n">a2ab</span><span class="o">.</span><span class="n">c5a0</span><span class="o">.</span><span class="mi">700</span><span class="n">e</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">3</span>
<span class="mi">10</span>       <span class="mi">0</span><span class="n">a1b</span><span class="o">.</span><span class="mi">1</span><span class="n">c80</span><span class="o">.</span><span class="mi">7000</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">4</span>
<span class="mi">500</span>      <span class="mi">02</span><span class="n">b1</span><span class="o">.</span><span class="mi">3</span><span class="n">c80</span><span class="o">.</span><span class="mi">7</span><span class="n">b00</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">5</span>
<span class="mi">200</span>      <span class="mi">1</span><span class="n">a4b</span><span class="o">.</span><span class="n">c580</span><span class="o">.</span><span class="mi">7000</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">6</span>
<span class="mi">300</span>      <span class="mi">0</span><span class="n">a1b</span><span class="o">.</span><span class="mi">5</span><span class="n">c80</span><span class="o">.</span><span class="mi">70</span><span class="n">f0</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">7</span>
<span class="mi">10</span>       <span class="mi">01</span><span class="n">ab</span><span class="o">.</span><span class="n">c5d0</span><span class="o">.</span><span class="mi">70</span><span class="n">d0</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">8</span>
<span class="mi">1000</span>     <span class="mi">0</span><span class="n">a4b</span><span class="o">.</span><span class="n">c380</span><span class="o">.</span><span class="mi">7</span><span class="n">d00</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">9</span>
</pre></div>
</div>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
<div class="section" id="id5">
<h5>Задание 7.3a<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Сделать копию скрипта задания 7.3.</p>
<p>Переделать скрипт:  Отсортировать вывод по номеру VLAN
В результате должен получиться такой вывод:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span>       <span class="mi">01</span><span class="n">ab</span><span class="o">.</span><span class="n">c5d0</span><span class="o">.</span><span class="mi">70</span><span class="n">d0</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">8</span>
<span class="mi">10</span>       <span class="mi">0</span><span class="n">a1b</span><span class="o">.</span><span class="mi">1</span><span class="n">c80</span><span class="o">.</span><span class="mi">7000</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">4</span>
<span class="mi">100</span>      <span class="mi">01</span><span class="n">bb</span><span class="o">.</span><span class="n">c580</span><span class="o">.</span><span class="mi">7000</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
<span class="mi">200</span>      <span class="mi">0</span><span class="n">a4b</span><span class="o">.</span><span class="n">c380</span><span class="o">.</span><span class="mi">7</span><span class="n">c00</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>
<span class="mi">200</span>      <span class="mi">1</span><span class="n">a4b</span><span class="o">.</span><span class="n">c580</span><span class="o">.</span><span class="mi">7000</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">6</span>
<span class="mi">300</span>      <span class="mi">0</span><span class="n">a1b</span><span class="o">.</span><span class="mi">5</span><span class="n">c80</span><span class="o">.</span><span class="mi">70</span><span class="n">f0</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">7</span>
<span class="mi">300</span>      <span class="n">a2ab</span><span class="o">.</span><span class="n">c5a0</span><span class="o">.</span><span class="mi">700</span><span class="n">e</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">3</span>
<span class="mi">500</span>      <span class="mi">02</span><span class="n">b1</span><span class="o">.</span><span class="mi">3</span><span class="n">c80</span><span class="o">.</span><span class="mi">7</span><span class="n">b00</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">5</span>
<span class="mi">1000</span>     <span class="mi">0</span><span class="n">a4b</span><span class="o">.</span><span class="n">c380</span><span class="o">.</span><span class="mi">7</span><span class="n">d00</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">9</span>
</pre></div>
</div>
<p>Обратите внимание на vlan 1000 - он должен выводиться последним.
Правильной сортировки можно добиться, если vlan будет числом, а не строкой.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
<div class="section" id="id6">
<h5>Задание 7.3b<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Сделать копию скрипта задания 7.3a.</p>
<p>Переделать скрипт:</p>
<ul class="simple">
<li>Запросить у пользователя ввод номера VLAN.</li>
<li>Выводить информацию только по указанному VLAN.</li>
</ul>
<p>Пример работы скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Enter</span> <span class="n">VLAN</span> <span class="n">number</span><span class="p">:</span> <span class="mi">10</span>
<span class="mi">10</span>       <span class="mi">0</span><span class="n">a1b</span><span class="o">.</span><span class="mi">1</span><span class="n">c80</span><span class="o">.</span><span class="mi">7000</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">4</span>
<span class="mi">10</span>       <span class="mi">01</span><span class="n">ab</span><span class="o">.</span><span class="n">c5d0</span><span class="o">.</span><span class="mi">70</span><span class="n">d0</span>      <span class="n">Gi0</span><span class="o">/</span><span class="mi">8</span>
</pre></div>
</div>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
</div>
</div>
</div>
<span id="document-book/08_python_basic_examples/index"></span><div class="section" id="python-basic-examples-index">
<span id="id1"></span><h3>8. Примеры использования основ<a class="headerlink" href="#python-basic-examples-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>В этом разделе собраны те темы, которые не вошли в предыдущие разделы, а
также приведены примеры использования основ Python для решения задач.</p>
<p>Хотя большинство примеров будет ориентировано на работу с файлами, те же
принципы обработки информации будут применимы и при работе с сетевым
оборудованием. Только часть с чтением из файла будет заменена на
получение вывода с оборудования.</p>
<div class="toctree-wrapper compound">
<span id="document-book/08_python_basic_examples/f-string"></span><div class="section" id="f">
<span id="f-string"></span><h4>Форматирование строк с помощью f-строк<a class="headerlink" href="#f" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python 3.6 добавился новый вариант форматирования строк - f-строки или
интерполяция строк. F-строки позволяют не только подставлять какие-то
значения в шаблон, но и позволяют выполнять вызовы функций, методов и
т.п.</p>
<p>Во многих ситуациях f-строки удобней и проще использовать, чем format,
кроме того, f-строки работают быстрее, чем format и другие методы
форматирования строк.</p>
<div class="section" id="id1">
<h5>Синтаксис<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>F-строки - это литерал строки с буквой <code class="docutils literal notranslate"><span class="pre">f</span></code> перед ним. Внутри f-строки
в паре фигурных скобок указываются имена переменных, которые надо
подставить:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">ip</span> <span class="o">=</span> <span class="s1">&#39;10.1.1.1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">mask</span> <span class="o">=</span> <span class="mi">24</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="sa">f</span><span class="s2">&quot;IP: </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">, mask: </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;IP: 10.1.1.1, mask: 24&#39;</span>
</pre></div>
</div>
<p>Аналогичный результат с format можно получить так:
<code class="docutils literal notranslate"><span class="pre">&quot;IP:</span> <span class="pre">{ip},</span> <span class="pre">mask:</span> <span class="pre">{mask}&quot;.format(ip=ip,</span> <span class="pre">mask=mask)</span></code>.</p>
<p>Очень важное отличие f-строк от format: f-строки это выражение, которое
выполняется, а не просто строка. То есть, в случае с ipython, как только
мы написали выражение и нажали Enter, оно выполнилось и вместо выражений
<code class="docutils literal notranslate"><span class="pre">{ip}</span></code> и <code class="docutils literal notranslate"><span class="pre">{mask}</span></code> подставились значения переменных.</p>
<p>Поэтому, например, нельзя сначала написать шаблон, а затем определить
переменные, которые используются в шаблоне:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="sa">f</span><span class="s2">&quot;IP: </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">, mask: </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">e6f8e01ac9c4</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="sa">f</span><span class="s2">&quot;IP: </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">, mask: </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;ip&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
</pre></div>
</div>
<p>Кроме подстановки значений переменных, в фигурных скобках можно писать
выражения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">octets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">mask</span> <span class="o">=</span> <span class="mi">24</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="sa">f</span><span class="s2">&quot;IP: </span><span class="si">{</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">octets</span><span class="p">)</span><span class="si">}</span><span class="s2">, mask: </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;IP: 10.1.1.1, mask: 24&#39;</span>
</pre></div>
</div>
<p>После двоеточия в f-строках можно указывать те же значения, что и при
использовании format:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">oct1</span><span class="p">,</span> <span class="n">oct2</span><span class="p">,</span> <span class="n">oct3</span><span class="p">,</span> <span class="n">oct4</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    ...: IP address:</span>
<span class="s1">    ...: </span><span class="si">{</span><span class="n">oct1</span><span class="si">:</span><span class="s1">&lt;8</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct2</span><span class="si">:</span><span class="s1">&lt;8</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct3</span><span class="si">:</span><span class="s1">&lt;8</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct4</span><span class="si">:</span><span class="s1">&lt;8</span><span class="si">}</span><span class="s1"></span>
<span class="s1">    ...: </span><span class="si">{</span><span class="n">oct1</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct2</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct3</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct4</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">IP</span> <span class="n">address</span><span class="p">:</span>
<span class="mi">10</span>       <span class="mi">1</span>        <span class="mi">1</span>        <span class="mi">1</span>
<span class="mi">00001010</span> <span class="mi">00000001</span> <span class="mi">00000001</span> <span class="mi">00000001</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Особенности использования f-строк<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>При использовании f-строк нельзя сначала создать шаблон, а затем его
использовать, как при использовании format.</p>
<p>F-строка сразу выполняется и в нее подставляются значения переменных,
которые должны быть определены ранее:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">ip</span> <span class="o">=</span> <span class="s1">&#39;10.1.1.1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">mask</span> <span class="o">=</span> <span class="mi">24</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IP: </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">, mask: </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">IP</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="mi">24</span>
</pre></div>
</div>
<p>Если необходимо подставить другие значения, надо создать новые
переменные (с теми же именами) и снова написать f-строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">ip</span> <span class="o">=</span> <span class="s1">&#39;10.2.2.2&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">mask</span> <span class="o">=</span> <span class="mi">24</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IP: </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">, mask: </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">IP</span><span class="p">:</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="mi">24</span>
</pre></div>
</div>
<p>При использовании f-строк в циклах, f-строку надо писать в теле цикла,
чтобы она «подхватывала» новые значения переменных на каждой итерации:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">ip_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1/24&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2.2.2/24&#39;</span><span class="p">,</span> <span class="s1">&#39;10.3.3.3/24&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">for</span> <span class="n">ip_address</span> <span class="ow">in</span> <span class="n">ip_list</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">ip</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">ip_address</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IP: </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">, mask: </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">IP</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="mi">24</span>
<span class="n">IP</span><span class="p">:</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="mi">24</span>
<span class="n">IP</span><span class="p">:</span> <span class="mf">10.3</span><span class="o">.</span><span class="mf">3.3</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="mi">24</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Примеры использования f-строк<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Базовая подстановка переменных:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">intf_type</span> <span class="o">=</span> <span class="s1">&#39;Gi&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">intf_name</span> <span class="o">=</span> <span class="s1">&#39;0/3&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="sa">f</span><span class="s1">&#39;interface </span><span class="si">{</span><span class="n">intf_type</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">intf_name</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;interface Gi/0/3&#39;</span>
</pre></div>
</div>
<p>Выравнивание столбцами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">topology</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;r1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/2&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/1&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/3&#39;</span><span class="p">,</span> <span class="s1">&#39;r3&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/0&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/5&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/2&#39;</span><span class="p">]]</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">topology</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">l_device</span><span class="p">,</span> <span class="n">l_port</span><span class="p">,</span> <span class="n">r_device</span><span class="p">,</span> <span class="n">r_port</span> <span class="o">=</span> <span class="n">connection</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">l_device</span><span class="si">:</span><span class="s1">10</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">l_port</span><span class="si">:</span><span class="s1">7</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">r_device</span><span class="si">:</span><span class="s1">10</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">r_port</span><span class="si">:</span><span class="s1">7</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">sw1</span>        <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>   <span class="n">r1</span>         <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>
<span class="n">sw1</span>        <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>   <span class="n">r2</span>         <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">sw1</span>        <span class="n">Gi0</span><span class="o">/</span><span class="mi">3</span>   <span class="n">r3</span>         <span class="n">Gi0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">sw1</span>        <span class="n">Gi0</span><span class="o">/</span><span class="mi">5</span>   <span class="n">sw4</span>        <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>
</pre></div>
</div>
<p>Ширина столбцов может быть указана через переменную:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">topology</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;r1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/2&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/1&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/3&#39;</span><span class="p">,</span> <span class="s1">&#39;r3&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/0&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/5&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/2&#39;</span><span class="p">]]</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">topology</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">l_device</span><span class="p">,</span> <span class="n">l_port</span><span class="p">,</span> <span class="n">r_device</span><span class="p">,</span> <span class="n">r_port</span> <span class="o">=</span> <span class="n">connection</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">l_device</span><span class="si">:{</span><span class="n">width</span><span class="si">}}</span><span class="s1"> </span><span class="si">{</span><span class="n">l_port</span><span class="si">:{</span><span class="n">width</span><span class="si">}}</span><span class="s1"> </span><span class="si">{</span><span class="n">r_device</span><span class="si">:{</span><span class="n">width</span><span class="si">}}</span><span class="s1"> </span><span class="si">{</span><span class="n">r_port</span><span class="si">:{</span><span class="n">width</span><span class="si">}}</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">sw1</span>        <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>      <span class="n">r1</span>         <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>
<span class="n">sw1</span>        <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>      <span class="n">r2</span>         <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">sw1</span>        <span class="n">Gi0</span><span class="o">/</span><span class="mi">3</span>      <span class="n">r3</span>         <span class="n">Gi0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">sw1</span>        <span class="n">Gi0</span><span class="o">/</span><span class="mi">5</span>      <span class="n">sw4</span>        <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>
</pre></div>
</div>
<p>Работа со словарями</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">session_stats</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;done&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;todo&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">if</span> <span class="n">session_stats</span><span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">]:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pomodoros done: </span><span class="si">{</span><span class="n">session_stats</span><span class="p">[</span><span class="s1">&#39;done&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, TODO: </span><span class="si">{</span><span class="n">session_stats</span><span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Good job! All </span><span class="si">{</span><span class="n">session_stats</span><span class="p">[</span><span class="s1">&#39;done&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> pomodoros done!&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">Pomodoros</span> <span class="n">done</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">TODO</span><span class="p">:</span> <span class="mi">5</span>
</pre></div>
</div>
<p>Вызов функции len внутри f-строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">topology</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;r1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/2&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/1&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/3&#39;</span><span class="p">,</span> <span class="s1">&#39;r3&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/0&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/5&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/2&#39;</span><span class="p">]]</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Количество подключений в топологии: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">Количество</span> <span class="n">подключений</span> <span class="n">в</span> <span class="n">топологии</span><span class="p">:</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Вызов метода upper внутри f-строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;python&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Zen of </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">Zen</span> <span class="n">of</span> <span class="n">PYTHON</span>
</pre></div>
</div>
<p>Конвертация чисел в двоичный формат:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">ip</span> <span class="o">=</span> <span class="s1">&#39;10.1.1.1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">oct1</span><span class="p">,</span> <span class="n">oct2</span><span class="p">,</span> <span class="n">oct3</span><span class="p">,</span> <span class="n">oct4</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">oct1</span><span class="p">)</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">oct2</span><span class="p">)</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">oct3</span><span class="p">)</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">oct4</span><span class="p">)</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="mi">00001010</span> <span class="mi">00000001</span> <span class="mi">00000001</span> <span class="mi">00000001</span>
</pre></div>
</div>
</div>
<div class="section" id="format-f">
<h5>Что использовать format или f-строки<a class="headerlink" href="#format-f" title="Ссылка на этот заголовок">¶</a></h5>
<p>Во многих случаях f-строки удобней использовать, так как шаблон выглядит
понятней и компактней. Однако бывают случаи, когда метод format
удобней. Например:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">ip</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">oct1</span><span class="p">,</span> <span class="n">oct2</span><span class="p">,</span> <span class="n">oct3</span><span class="p">,</span> <span class="n">oct4</span> <span class="o">=</span> <span class="n">ip</span>
   <span class="o">...</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">oct1</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct2</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct3</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">oct4</span><span class="si">:</span><span class="s1">08b</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="mi">00001010</span> <span class="mi">00000001</span> <span class="mi">00000001</span> <span class="mi">00000001</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:08b}</span><span class="s2"> &quot;</span><span class="o">*</span><span class="mi">4</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oct1</span><span class="p">,</span> <span class="n">oct2</span><span class="p">,</span> <span class="n">oct3</span><span class="p">,</span> <span class="n">oct4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s1">&#39;00001010 00000001 00000001 00000001 &#39;</span>
</pre></div>
</div>
<p>Еще одна ситуация, когда format, как правило, удобней использовать:
необходимость использовать в скрипте один и тот же шаблон много раз.
F-строка выполнится первый раз и подставит текущие значения переменных и
для использования шаблона еще раз, его надо заново писать. Это значит,
что в скрипте будут находится копии одной и то же строки. В то же время
format позволяет создать шаблон в одном месте и потом использовать его
повторно, подставляя переменные по мере необходимости.</p>
<p>Это можно обойти создав функцию, но создавать функцию для вывода строки
по шаблону далеко не всегда оправдано. Пример создания функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">show_me_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;IP: </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">, mask: </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s2">&quot;</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">show_me_ip</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;IP: 10.1.1.1, mask: 24&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">show_me_ip</span><span class="p">(</span><span class="s1">&#39;192.16.10.192&#39;</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;IP: 192.16.10.192, mask: 28&#39;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/08_python_basic_examples/variable_unpacking"></span><div class="section" id="id1">
<h4>Распаковка переменных<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Распаковка переменных - это специальный синтаксис, который позволяет
присваивать переменным элементы итерируемого объекта.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Достаточно часто этот функционал встречается под именем tuple
unpacking, но распаковка работает на любом итерируемом объекте, не
только с кортежами</p>
</div>
<p>Пример распаковки переменных:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">interface</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">intf</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">protocol</span> <span class="o">=</span> <span class="n">interface</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">intf</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">ip</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;10.1.1.1&#39;</span>
</pre></div>
</div>
<p>Такой вариант намного удобней использовать, чем использование индексов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">intf</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">protocol</span> <span class="o">=</span> <span class="n">interface</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">interface</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">interface</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">interface</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
<p>При распаковке переменных каждый элемент списка попадает в
соответствующую переменную. Важно учитывать, что переменных слева
должно быть ровно столько, сколько элементов в списке.</p>
<p>Если переменных больше или меньше, возникнет исключение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">intf</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">interface</span>
<span class="o">------------------------------------------------------------</span>
<span class="ne">ValueError</span>                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="n">a304c4372b1a</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">intf</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">interface</span>

<span class="ne">ValueError</span><span class="p">:</span> <span class="n">too</span> <span class="n">many</span> <span class="n">values</span> <span class="n">to</span> <span class="n">unpack</span> <span class="p">(</span><span class="n">expected</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">intf</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="n">interface</span>
<span class="o">------------------------------------------------------------</span>
<span class="ne">ValueError</span>                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">ac93e78b978c</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">intf</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="n">interface</span>

<span class="ne">ValueError</span><span class="p">:</span> <span class="ow">not</span> <span class="n">enough</span> <span class="n">values</span> <span class="n">to</span> <span class="n">unpack</span> <span class="p">(</span><span class="n">expected</span> <span class="mi">5</span><span class="p">,</span> <span class="n">got</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id2">
<h5>Замена ненужных элементов <code class="docutils literal notranslate"><span class="pre">_</span></code><a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Часто из всех элементов итерируемого объекта нужны только
некоторые. При этом синтаксис распаковки требует
указать ровно столько переменных, сколько элементов в итерируемом
объекте.</p>
<p>Если, например, из строки line надо получить только VLAN, MAC и
интерфейс, надо все равно указать переменную для типа записи:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;100    01bb.c580.7000    DYNAMIC     Gi0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">item_type</span><span class="p">,</span> <span class="n">intf</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">vlan</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;100&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">intf</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;Gi0/1&#39;</span>
</pre></div>
</div>
<p>Если тип записи не нужен в дальнейшем, можно заменить переменную
item_type нижним подчеркиванием:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">intf</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
<p>Таким образом явно указывается то, что этот элемент не нужен.</p>
<p>Нижнее подчеркивание можно использовать и несколько раз:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">dhcp</span> <span class="o">=</span> <span class="s1">&#39;00:09:BB:3D:D6:58   10.1.10.2        86250       dhcp-snooping   10    FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">mac</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">intf</span> <span class="o">=</span> <span class="n">dhcp</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">mac</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="s1">&#39;00:09:BB:3D:D6:58&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">vlan</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;10&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Использование <code class="docutils literal notranslate"><span class="pre">*</span></code><a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Распаковка переменных поддерживает специальный синтаксис, который
позволяет распаковывать несколько элементов в один. Если поставить <code class="docutils literal notranslate"><span class="pre">*</span></code>
перед именем переменной, в нее запишутся все элементы, кроме тех, что
присвоены явно.</p>
<p>Например, так можно получить первый элемент в переменную first, а
остальные в rest:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span> <span class="o">=</span> <span class="n">vlans</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">first</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="mi">10</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">rest</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
</pre></div>
</div>
<p>При этом переменная со звездочкой всегда будет содержать список:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span> <span class="o">=</span> <span class="n">vlans</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">first</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="mi">10</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">rest</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
</pre></div>
</div>
<p>Если элемент всего один, распаковка все равно отработает:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span> <span class="o">=</span> <span class="n">vlans</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">first</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="mi">55</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">rest</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="p">[]</span>
</pre></div>
</div>
<p>Такая переменная со звездочкой в выражении распаковки может быть только
одна.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span> <span class="o">=</span> <span class="n">vlans</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;ipython-input-37-dedf7a08933a&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
    <span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span> <span class="o">=</span> <span class="n">vlans</span>
                                 <span class="o">^</span>
<span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">two</span> <span class="n">starred</span> <span class="n">expressions</span> <span class="ow">in</span> <span class="n">assignment</span>
</pre></div>
</div>
<p>Такая переменная может находиться не только в конце выражения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="o">*</span><span class="n">rest</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">vlans</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">rest</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">last</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="mi">30</span>
</pre></div>
</div>
<p>Таким образом можно указать, что нужен первый, второй и последний
элемент:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">cdp</span> <span class="o">=</span> <span class="s1">&#39;SW1     Eth 0/0    140   S I   WS-C3750-  Eth 0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">name</span><span class="p">,</span> <span class="n">l_intf</span><span class="p">,</span> <span class="o">*</span><span class="n">other</span><span class="p">,</span> <span class="n">r_intf</span> <span class="o">=</span> <span class="n">cdp</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">name</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="s1">&#39;SW1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">l_intf</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="s1">&#39;Eth&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">r_intf</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="s1">&#39;0/1&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Примеры распаковки<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<div class="section" id="id5">
<h6>Распаковка итерируемых объектов<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h6>
<p>Эти примеры показывают, что распаковывать можно не только списки,
кортежи и строки, но и любой другой итерируемый объект.</p>
<p>Распаковка range:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">first</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">rest</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<p>Распаковка zip:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="o">&lt;</span><span class="nb">zip</span> <span class="n">at</span> <span class="mh">0xb4df4fac</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">500</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">first</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">rest</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">400</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">last</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="for">
<h6>Пример распаковки в цикле for<a class="headerlink" href="#for" title="Ссылка на этот заголовок">¶</a></h6>
<p>Пример цикла, который проходится по ключам:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>                    <span class="s1">&#39;switchport access vlan&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>                    <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>                    <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span><span class="p">]</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">access</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;0/12&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;0/14&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;0/16&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="k">for</span> <span class="n">intf</span> <span class="ow">in</span> <span class="n">access</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;interface FastEthernet </span><span class="si">{</span><span class="n">intf</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">access_template</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;access vlan&#39;</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">access</span><span class="p">[</span><span class="n">intf</span><span class="p">]))</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">else</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">12</span>
 <span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
 <span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span> <span class="mi">10</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">portfast</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">bpduguard</span> <span class="n">enable</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">14</span>
 <span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
 <span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span> <span class="mi">11</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">portfast</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">bpduguard</span> <span class="n">enable</span>
<span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">16</span>
 <span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
 <span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span> <span class="mi">17</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">portfast</span>
 <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">bpduguard</span> <span class="n">enable</span>
</pre></div>
</div>
<p>Вместо этого можно проходиться по парам ключ-значение и сразу же
распаковывать их в разные переменные:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="k">for</span> <span class="n">intf</span><span class="p">,</span> <span class="n">vlan</span> <span class="ow">in</span> <span class="n">access</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;interface FastEthernet </span><span class="si">{</span><span class="n">intf</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">access_template</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;access vlan&#39;</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">vlan</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">else</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Пример распаковки элементов списка в цикле:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">table</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">54</span><span class="p">]:</span>
<span class="p">[[</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;a1b2.ac10.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;DYNAMIC&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/1&#39;</span><span class="p">],</span>
 <span class="p">[</span><span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="s1">&#39;a0d4.cb20.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;DYNAMIC&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/2&#39;</span><span class="p">],</span>
 <span class="p">[</span><span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;acb4.cd30.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;DYNAMIC&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/3&#39;</span><span class="p">],</span>
 <span class="p">[</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;a2bb.ec40.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;DYNAMIC&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/4&#39;</span><span class="p">],</span>
 <span class="p">[</span><span class="s1">&#39;500&#39;</span><span class="p">,</span> <span class="s1">&#39;aa4b.c550.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;DYNAMIC&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/5&#39;</span><span class="p">],</span>
 <span class="p">[</span><span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="s1">&#39;a1bb.1c60.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;DYNAMIC&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/6&#39;</span><span class="p">],</span>
 <span class="p">[</span><span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;aa0b.cc70.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;DYNAMIC&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/7&#39;</span><span class="p">]]</span>


<span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">intf</span> <span class="o">=</span> <span class="n">line</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">intf</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="mi">100</span> <span class="n">a1b2</span><span class="o">.</span><span class="n">ac10</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
<span class="mi">200</span> <span class="n">a0d4</span><span class="o">.</span><span class="n">cb20</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>
<span class="mi">300</span> <span class="n">acb4</span><span class="o">.</span><span class="n">cd30</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">3</span>
<span class="mi">100</span> <span class="n">a2bb</span><span class="o">.</span><span class="n">ec40</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">4</span>
<span class="mi">500</span> <span class="n">aa4b</span><span class="o">.</span><span class="n">c550</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">5</span>
<span class="mi">200</span> <span class="n">a1bb</span><span class="o">.</span><span class="mi">1</span><span class="n">c60</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">6</span>
<span class="mi">300</span> <span class="n">aa0b</span><span class="o">.</span><span class="n">cc70</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">7</span>
</pre></div>
</div>
<p>Но еще лучше сделать так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="k">for</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">intf</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">intf</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="mi">100</span> <span class="n">a1b2</span><span class="o">.</span><span class="n">ac10</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
<span class="mi">200</span> <span class="n">a0d4</span><span class="o">.</span><span class="n">cb20</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>
<span class="mi">300</span> <span class="n">acb4</span><span class="o">.</span><span class="n">cd30</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">3</span>
<span class="mi">100</span> <span class="n">a2bb</span><span class="o">.</span><span class="n">ec40</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">4</span>
<span class="mi">500</span> <span class="n">aa4b</span><span class="o">.</span><span class="n">c550</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">5</span>
<span class="mi">200</span> <span class="n">a1bb</span><span class="o">.</span><span class="mi">1</span><span class="n">c60</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">6</span>
<span class="mi">300</span> <span class="n">aa0b</span><span class="o">.</span><span class="n">cc70</span><span class="o">.</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">7</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-book/08_python_basic_examples/x_comprehensions"></span><div class="section" id="list-dict-set-comprehensions">
<span id="x-comprehensions"></span><h4>List, dict, set comprehensions<a class="headerlink" href="#list-dict-set-comprehensions" title="Ссылка на этот заголовок">¶</a></h4>
<p>Python поддерживает специальные выражения, которые позволяют компактно
создавать списки, словари и множества.</p>
<p>На английском эти выражения называются, соответственно:</p>
<ul class="simple">
<li>List comprehensions</li>
<li>Dict comprehensions</li>
<li>Set comprehensions</li>
</ul>
<p>К сожалению, официальный перевод на русский звучит как <a class="reference external" href="https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BA%D0%BE%D0%B2%D0%BE%D0%B5_%D0%B2%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5">абстракция
списков или списковое
включение</a>,
что не особо помогает понять суть объекта.</p>
<p>В книге использовался перевод «генератор списка», что, к сожалению, тоже
не самый удачный вариант, так как в Python есть отдельное понятие
генератор и генераторные выражения, но он лучше отображает суть
выражения.</p>
<p>Эти выражения не только позволяют более компактно создавать
соответствующие объекты, но и создают их быстрее. И хотя поначалу они
требуют определенной привычки использования и понимания, они очень часто
используются.</p>
<div class="section" id="list-comprehensions">
<h5>List comprehensions (генераторы списков)<a class="headerlink" href="#list-comprehensions" title="Ссылка на этот заголовок">¶</a></h5>
<p>Генератор списка - это выражение вида:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;vlan </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">vlans</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;vlan 10&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 11&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 12&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 13&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 14&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 15&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>В общем случае, это выражение, которое преобразует итерируемый объект в
список. То есть, последовательность элементов преобразуется и
добавляется в новый список.</p>
<p>Выражению выше аналогичен такой цикл:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">16</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">vlans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;vlan </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">vlans</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;vlan 10&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 11&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 12&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 13&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 14&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 15&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>В list comprehensions можно использовать выражение if. Таким образом
можно добавлять в список только некоторые объекты.</p>
<p>Например, такой цикл отбирает те элементы, которые являются числами,
конвертирует их и добавляет в итоговый список only_digits:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;40&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">only_digits</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">only_digits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">only_digits</span><span class="p">)</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
</pre></div>
</div>
<p>Аналогичный вариант в виде list comprehensions:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;40&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">only_digits</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">only_digits</span><span class="p">)</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
</pre></div>
</div>
<p>Конечно, далеко не все циклы можно переписать как генератор списка, но
когда это можно сделать, и при этом выражение не усложняется, лучше
использовать генераторы списка.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В Python генераторы списка могут также заменить функции filter и map
и считаются более понятными вариантами решения.</p>
</div>
<p>С помощью генератора списка также удобно получать элементы из вложенных
словарей:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">london_co</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;r1&#39;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span>
    <span class="o">...</span><span class="p">:</span>     <span class="p">},</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;r2&#39;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r2&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.2&#39;</span>
    <span class="o">...</span><span class="p">:</span>     <span class="p">},</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;sw1&#39;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_sw1&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;3.6.XE&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.101&#39;</span>
    <span class="o">...</span><span class="p">:</span>     <span class="p">}</span>
    <span class="o">...</span><span class="p">:</span> <span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="p">[</span><span class="n">london_co</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s1">&#39;IOS&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">london_co</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;15.4&#39;</span><span class="p">,</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span> <span class="s1">&#39;3.6.XE&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="p">[</span><span class="n">london_co</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s1">&#39;IP&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">london_co</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.0.2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.0.101&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>На самом деле, синтаксис генератора списка выглядит так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">expression</span> <span class="k">for</span> <span class="n">item1</span> <span class="ow">in</span> <span class="n">iterable1</span> <span class="k">if</span> <span class="n">condition1</span>
            <span class="k">for</span> <span class="n">item2</span> <span class="ow">in</span> <span class="n">iterable2</span> <span class="k">if</span> <span class="n">condition2</span>
            <span class="o">...</span>
            <span class="k">for</span> <span class="n">itemN</span> <span class="ow">in</span> <span class="n">iterableN</span> <span class="k">if</span> <span class="n">conditionN</span> <span class="p">]</span>
</pre></div>
</div>
<p>Это значит, можно использовать несколько for в выражении.</p>
<p>Например, в списке vlans находятся несколько вложенных списков с
VLAN’ами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">35</span><span class="p">],</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="p">[</span><span class="mi">111</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]]</span>
</pre></div>
</div>
<p>Из этого списка надо сформировать один плоский список с номерами VLAN.
Первый вариант — с помощью циклов for:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="k">for</span> <span class="n">vlan_list</span> <span class="ow">in</span> <span class="n">vlans</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">vlan</span> <span class="ow">in</span> <span class="n">vlan_list</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vlan</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
</pre></div>
</div>
<p>Аналогичный вариант с генератором списков:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">10</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">35</span><span class="p">],</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="p">[</span><span class="mi">111</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">vlan</span> <span class="k">for</span> <span class="n">vlan_list</span> <span class="ow">in</span> <span class="n">vlans</span> <span class="k">for</span> <span class="n">vlan</span> <span class="ow">in</span> <span class="n">vlan_list</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
</pre></div>
</div>
<p>Можно одновременно проходиться по двум последовательностям, используя
zip:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mngmt&#39;</span><span class="p">,</span> <span class="s1">&#39;voice&#39;</span><span class="p">,</span> <span class="s1">&#39;video&#39;</span><span class="p">,</span> <span class="s1">&#39;dmz&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;vlan </span><span class="si">{}</span><span class="se">\n</span><span class="s1"> name </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vlan</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vlans</span><span class="p">,</span> <span class="n">names</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="n">vlan</span> <span class="mi">100</span>
 <span class="n">name</span> <span class="n">mngmt</span>
<span class="n">vlan</span> <span class="mi">110</span>
 <span class="n">name</span> <span class="n">voice</span>
<span class="n">vlan</span> <span class="mi">150</span>
 <span class="n">name</span> <span class="n">video</span>
<span class="n">vlan</span> <span class="mi">200</span>
 <span class="n">name</span> <span class="n">dmz</span>
</pre></div>
</div>
</div>
<div class="section" id="dict-comprehensions">
<h5>Dict comprehensions (генераторы словарей)<a class="headerlink" href="#dict-comprehensions" title="Ссылка на этот заголовок">¶</a></h5>
<p>Генераторы словарей аналогичны генераторам списков, но они используются
для создания словарей.</p>
<p>Например, такое выражение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">d</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="o">**</span><span class="mi">2</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
</pre></div>
</div>
<p>Можно заменить генератором словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">num</span><span class="p">:</span> <span class="n">num</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
</pre></div>
</div>
<p>Еще один пример, в котором надо преобразовать существующий словарь и
перевести все ключи в нижний регистр. Для начала, вариант решения без
генератора словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>       <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>       <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>       <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>       <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>       <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">lower_r1</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">r1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">lower_r1</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">lower_r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">35</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
 <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
 <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Аналогичный вариант с помощью генератора словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">lower_r1</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">r1</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">lower_r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">38</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
 <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
 <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Как и list comprehensions, dict comprehensions можно делать вложенными.
Попробуем аналогичным образом преобразовать ключи во вложенных словарях:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">london_co</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;r1&#39;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span>
    <span class="o">...</span><span class="p">:</span>     <span class="p">},</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;r2&#39;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r2&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.2&#39;</span>
    <span class="o">...</span><span class="p">:</span>     <span class="p">},</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;sw1&#39;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_sw1&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;3.6.XE&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.101&#39;</span>
    <span class="o">...</span><span class="p">:</span>     <span class="p">}</span>
    <span class="o">...</span><span class="p">:</span> <span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">lower_london_co</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="k">for</span> <span class="n">device</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">london_co</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">lower_london_co</span><span class="p">[</span><span class="n">device</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">lower_london_co</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">lower_london_co</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;r1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
  <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">},</span>
 <span class="s1">&#39;r2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r2&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.2&#39;</span><span class="p">,</span>
  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
  <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">},</span>
 <span class="s1">&#39;sw1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_sw1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;3.6.XE&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.101&#39;</span><span class="p">,</span>
  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span>
  <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}}</span>
</pre></div>
</div>
<p>Аналогичное преобразование с dict comprehensions:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">device</span><span class="p">:</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="k">for</span> <span class="n">device</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">london_co</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">44</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;r1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
  <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">},</span>
 <span class="s1">&#39;r2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r2&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.2&#39;</span><span class="p">,</span>
  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
  <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">},</span>
 <span class="s1">&#39;sw1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_sw1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;3.6.XE&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.101&#39;</span><span class="p">,</span>
  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span>
  <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="set-comprehensions">
<h5>Set comprehensions (генераторы множеств)<a class="headerlink" href="#set-comprehensions" title="Ссылка на этот заголовок">¶</a></h5>
<p>Генераторы множеств в целом аналогичны генераторам списков.</p>
<p>Например, надо получить множество с уникальными номерами VLAN’ов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;56&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">unique_vlans</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">vlan</span><span class="p">)</span> <span class="k">for</span> <span class="n">vlan</span> <span class="ow">in</span> <span class="n">vlans</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">unique_vlans</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">56</span><span class="p">}</span>
</pre></div>
</div>
<p>Аналогичное решение, без использования set comprehensions:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;56&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">unique_vlans</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="k">for</span> <span class="n">vlan</span> <span class="ow">in</span> <span class="n">vlans</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">unique_vlans</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vlan</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">unique_vlans</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">56</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/08_python_basic_examples/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.python.org/dev/peps/pep-3132/">PEP 3132 – Extended Iterable
Unpacking</a></li>
</ul>
<p>Статьи:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.smallsurething.com/list-dict-and-set-comprehensions-by-example/">List, Dict And Set Comprehensions By
Example</a>
- хорошая статья. И в конце статьи есть несколько упражнений (с
ответами)</li>
<li><a class="reference external" href="http://treyhunner.com/2015/12/python-list-comprehensions-now-in-color/">Python List Comprehensions: Explained
Visually</a>
- отличное объяснение list comprehensions, плюс видео</li>
</ul>
<p>Stack Overflow:</p>
<ul class="simple">
<li><a class="reference external" href="https://stackoverflow.com/questions/6967632/unpacking-extended-unpacking-and-nested-extended-unpacking">Ответ со множеством вариантов
распаковки</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/Part_II"></span><div class="section" id="ii">
<h2>II. Повторное использование кода<a class="headerlink" href="#ii" title="Ссылка на этот заголовок">¶</a></h2>
<p>При написании кода достаточно часто часть действий повторяется. Это
может быть небольшой блок на 3-5 строк, а может быть и достаточно
большая последовательность действий.</p>
<p>Копировать код — плохая затея. Так как, если потом понадобится обновить
одну из копий, надо будет обновлять и другие.</p>
<p>Вместо этого, надо создать специальный блок кода с именем - функцию. И
каждый раз, когда код надо повторить, достаточно вызвать функцию.
Функция позволяет не только назвать какой-то блок кода, но и сделать его
более абстрактным за счет параметров. Параметры дают возможность
передавать разные исходные данные для выполнения функции. И,
соответственно, получать разный результат, в зависимости от входящих
параметров.</p>
<p>Созданию функций посвящён раздел <a class="reference internal" href="contents.html#functions-index"><span class="std std-ref">9. Функции</span></a>.
Кроме того, в разделе <a class="reference internal" href="contents.html#useful-functions-index"><span class="std std-ref">10. Полезные функции</span></a>
рассматриваются полезные встроенные функции.</p>
<p>После разделения кода на функции, достаточно быстро наступает момент,
когда необходимо использовать функцию в другом скрипте. Конечно же,
копирование функции так же неудобно, как и копирование обычного кода.
Для повторного использования кода из другого скрипта Python используются
модули.</p>
<p>Одиннадцатый
раздел <a class="reference internal" href="contents.html#modules-index"><span class="std std-ref">11. Модули</span></a>
посвящён созданию собственных модулей, а в разделе <a class="reference internal" href="contents.html#useful-modules-index"><span class="std std-ref">12. Полезные модули</span></a>
рассматриваются полезные модули из стандартной библиотеки Python.</p>
<p>Последний
раздел <a class="reference internal" href="contents.html#iterator-generator-index"><span class="std std-ref">13. Итераторы, итерируемые объекты и генераторы</span></a>
этой части посвящён итерируемым объектам, итераторам и генераторам.</p>
<div class="toctree-wrapper compound">
<span id="document-book/09_functions/index"></span><div class="section" id="functions-index">
<span id="id1"></span><h3>9. Функции<a class="headerlink" href="#functions-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>Функция - это блок кода, выполняющий определенные действия:</p>
<ul class="simple">
<li>у функции есть имя, с помощью которого можно запускать этот блок кода
сколько угодно раз<ul>
<li>запуск кода функции называется вызовом функции</li>
</ul>
</li>
<li>при создании функции, как правило, определяются параметры функции.<ul>
<li>параметры функции определяют, какие аргументы функция может принимать</li>
<li>функциям можно передавать аргументы</li>
<li>соответственно, код функции будет выполняться с учетом указанных аргументов</li>
</ul>
</li>
</ul>
<p><strong>Зачем нужны функции?</strong></p>
<p>Как правило, задачи, которые решает код, очень похожи и часто имеют
что-то общее.</p>
<p>Например, при работе с конфигурационными файлами каждый раз надо
выполнять такие действия:</p>
<ul class="simple">
<li>открытие файла</li>
<li>удаление (или пропуск) строк, начинающиеся со знака восклицания (для Cisco)</li>
<li>удаление (или пропуск) пустых строк</li>
<li>удаление символов перевода строки в конце строк</li>
<li>преобразование полученного результата в список</li>
</ul>
<p>Дальше действия могут отличаться в зависимости от того, что нужно
делать.</p>
<p>Часто получается, что есть кусок кода, который повторяется. Конечно, его
можно копировать из одного скрипта в другой. Но это очень неудобно, так
как при внесении изменений в код нужно будет обновить его во всех
файлах, в которые он скопирован.</p>
<p>Гораздо проще и правильней вынести этот код в функцию (это может быть и
несколько функций).</p>
<p>И тогда будет производиться вызов этой функции - в этом файле или
каком-то другом.</p>
<p>В этом разделе рассматривается ситуация, когда функция находится в том
же файле.</p>
<p>А в разделе <a class="reference internal" href="contents.html#modules-index"><span class="std std-ref">11. Модули</span></a> будет рассматриваться, как
повторно использовать объекты, которые находятся в других скриптах.</p>
<div class="toctree-wrapper compound">
<span id="document-book/09_functions/create_func"></span><div class="section" id="id1">
<h4>Создание функций<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Создание функции:</p>
<ul class="simple">
<li>функции создаются с помощью зарезервированного слова <strong>def</strong></li>
<li>за <strong>def</strong> следуют имя функции и круглые скобки</li>
<li>внутри скобок могут указываться параметры, которые функция принимает</li>
<li>после круглых скобок идет двоеточие и с новой строки, с отступом, идет блок
кода, который выполняет функция</li>
<li>первой строкой, опционально, может быть комментарий, так называемая <strong>docstring</strong></li>
<li>в функциях может использоваться оператор <strong>return</strong><ul>
<li>он используется для прекращения работы функции и выхода из нее</li>
<li>чаще всего, оператор return возвращает какое-то значение</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Код функций, которые используются в этом подразделе, можно
скопировать из файла create_func.py</p>
</div>
<p>Пример функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">configure_intf</span><span class="p">(</span><span class="n">intf_name</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;interface&#39;</span><span class="p">,</span> <span class="n">intf_name</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ip address&#39;</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Функция configure_intf создает конфигурацию интерфейса с указанным именем и IP-адресом.
У функции есть три параметра: intf_name, ip, mask. При вызове функции в эти параметры
попадут реальные данные.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Когда функция создана, она ещё ничего не выполняет. Только при вызове
функции действия, которые в ней перечислены, будут выполняться. Это
чем-то похоже на ACL в сетевом оборудовании: при создании ACL в
конфигурации, он ничего не делает до тех пор, пока не будет куда-то
применен.</p>
</div>
<div class="section" id="id2">
<h5>Вызов функции<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>При вызове функции нужно указать её имя и передать аргументы, если
нужно.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Параметры - это переменные, которые используются при создании
функции.
Аргументы - это фактические значения (данные), которые передаются
функции при вызове.</p>
</div>
<p>Функция configure_intf ожидает при вызове три значения, потому
что она была создана с тремя параметрами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">configure_intf</span><span class="p">(</span><span class="s1">&#39;F0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">)</span>
<span class="n">interface</span> <span class="n">F0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">ip</span> <span class="n">address</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">configure_intf</span><span class="p">(</span><span class="s1">&#39;Fa0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;94.150.197.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.248&#39;</span><span class="p">)</span>
<span class="n">interface</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">ip</span> <span class="n">address</span> <span class="mf">94.150</span><span class="o">.</span><span class="mf">197.1</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.248</span>
</pre></div>
</div>
<p>Текущий вариант функции configure_intf выводит команды на стандартный поток вывода,
команды можно увидеть, но при этом результат функции нельзя сохранить в переменную.</p>
<p>Например, функция sorted не просто выводит результат сортировки на стандартный поток вывода,
а <strong>возвращает</strong> его, поэтому его можно сохранить в переменную таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">sorted_items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">sorted_items</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Обратите внимание на строку <code class="docutils literal notranslate"><span class="pre">Out[5]</span></code> в ipython: таким образом ipython показывает,
что функция/метод что-то возвращает и показывает, что именно возвращает.</p>
</div>
<p>Если же попытаться записать в переменную результат функции configure_intf,
в переменной окажется значение None:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">configure_intf</span><span class="p">(</span><span class="s1">&#39;Fa0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">)</span>
<span class="n">interface</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">ip</span> <span class="n">address</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="kc">None</span>
</pre></div>
</div>
<p>Чтобы функция могла возвращать какое-то значение, надо использовать оператор <code class="docutils literal notranslate"><span class="pre">return</span></code>.</p>
</div>
<div class="section" id="return">
<h5>Оператор return<a class="headerlink" href="#return" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор <strong>return</strong> используется для возврата какого-то значения, и в то же время
он завершает работу функции.
Функция может возвращать любой объект Python.
По умолчанию, функция всегда возвращает <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>Для того, чтобы функция configure_intf возвращала значение, которое потом можно,
например, присвоить переменной, надо использовать оператор <code class="docutils literal notranslate"><span class="pre">return</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">configure_intf</span><span class="p">(</span><span class="n">intf_name</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">config</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;interface </span><span class="si">{</span><span class="n">intf_name</span><span class="si">}</span><span class="se">\n</span><span class="s1">ip address </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">config</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">configure_intf</span><span class="p">(</span><span class="s1">&#39;Fa0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">interface</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">ip</span> <span class="n">address</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="s1">&#39;interface Fa0/0</span><span class="se">\n</span><span class="s1">ip address 10.1.1.1 255.255.255.0&#39;</span>
</pre></div>
</div>
<p>Теперь в переменой result находится строка с командами для настройки интерфейса.</p>
<p>В реальной жизни практически всегда функция будет возвращать какое-то
значение. Вместе с тем можно использовать выражение print, чтобы
дополнительно выводить какие-то сообщения.</p>
<p>Ещё один важный аспект работы оператора return: после return, функция завершает работу,
а значит выражения, которые идут после return, не выполняются.</p>
<p>Например, в функции ниже, строка «Конфигурация готова» не будет выводиться, так как она
стоит после return:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">configure_intf</span><span class="p">(</span><span class="n">intf_name</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">config</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;interface </span><span class="si">{</span><span class="n">intf_name</span><span class="si">}</span><span class="se">\n</span><span class="s1">ip address </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">config</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Конфигурация готова&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">configure_intf</span><span class="p">(</span><span class="s1">&#39;Fa0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="s1">&#39;interface Fa0/0</span><span class="se">\n</span><span class="s1">ip address 10.1.1.1 255.255.255.0&#39;</span>
</pre></div>
</div>
<p>Функция может возвращать несколько значений. В этом случае, они пишутся через запятую после оператора return.
При этом фактически функция возвращает кортеж:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">configure_intf</span><span class="p">(</span><span class="n">intf_name</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">config_intf</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;interface </span><span class="si">{</span><span class="n">intf_name</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">config_ip</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ip address </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">config_intf</span><span class="p">,</span> <span class="n">config_ip</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">configure_intf</span><span class="p">(</span><span class="s1">&#39;Fa0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;interface Fa0/0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;ip address 10.1.1.1 255.255.255.0&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">tuple</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">intf</span><span class="p">,</span> <span class="n">ip_addr</span> <span class="o">=</span> <span class="n">configure_intf</span><span class="p">(</span><span class="s1">&#39;Fa0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">intf</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="s1">&#39;interface Fa0/0</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">ip_addr</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="s1">&#39;ip address 10.1.1.1 255.255.255.0&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="docstring">
<h5>Документация (docstring)<a class="headerlink" href="#docstring" title="Ссылка на этот заголовок">¶</a></h5>
<p>Первая строка в определении функции - это docstring, строка
документации. Это комментарий, который используется как описание
функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [23]: def configure_intf(intf_name, ip, mask):
    ...:     &#39;&#39;&#39;
    ...:     Функция генерирует конфигурацию интерфейса
    ...:     &#39;&#39;&#39;
    ...:     config_intf = f&#39;interface {intf_name}\n&#39;
    ...:     config_ip = f&#39;ip address {ip} {mask}&#39;
    ...:     return config_intf, config_ip
    ...:

In [24]: configure_intf?
Signature: configure_intf(intf_name, ip, mask)
Docstring: Функция генерирует конфигурацию интерфейса
File:      ~/repos/pyneng-examples-exercises/examples/06_control_structures/&lt;ipython-input-23-2b2bd970db8f&gt;
Type:      function
</pre></div>
</div>
<p>Лучше не лениться писать краткие комментарии, которые описывают
работу функции. Например, описать, что функция ожидает на вход,
какого типа должны быть аргументы и что будет на выходе. Кроме того,
лучше написать пару предложений о том, что делает функция. Это очень
поможет, когда через месяц-два вы будете пытаться понять, что делает
функция, которую вы же написали.</p>
</div>
</div>
<span id="document-book/09_functions/namespace"></span><div class="section" id="id1">
<h4>Пространства имен. Области видимости<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>У переменных в Python есть область видимости. В зависимости от места в
коде, где переменная была определена, определяется и область видимости,
то есть, где переменная будет доступна.</p>
<p>При использовании имен переменных в программе, Python каждый раз ищет,
создает или изменяет эти имена в соответствующем пространстве имен.
Пространство имен, которое доступно в каждый момент, зависит от области,
в которой находится код.</p>
<p>У Python есть правило LEGB, которым он пользуется при поиске переменных.</p>
<p>Например, если внутри функции выполняется обращение к имени переменной,
Python ищет переменную в таком порядке по областям видимости (до первого
совпадения):</p>
<ul class="simple">
<li>L (local) - в локальной (внутри функции)</li>
<li>E (enclosing) - в локальной области объемлющих функций (это те функции,
внутри которых находится наша функция)</li>
<li>G (global) - в глобальной (в скрипте)</li>
<li>B (built-in) - во встроенной (зарезервированные значения Python)</li>
</ul>
<p>Соответственно, есть локальные и глобальные переменные:</p>
<ul class="simple">
<li>локальные переменные:<ul>
<li>переменные, которые определены внутри функции</li>
<li>эти переменные становятся недоступными после выхода из функции</li>
</ul>
</li>
<li>глобальные переменные:<ul>
<li>переменные, которые определены вне функции</li>
<li>эти переменные „глобальны“ только в пределах модуля</li>
<li>например, чтобы они были доступны в другом модуле, их надо импортировать</li>
</ul>
</li>
</ul>
<p>Пример локальной intf_config:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">configure_intf</span><span class="p">(</span><span class="n">intf_name</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">intf_config</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;interface </span><span class="si">{</span><span class="n">intf_name</span><span class="si">}</span><span class="se">\n</span><span class="s1">ip address </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s1">&#39;</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">intf_config</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">intf_config</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mf">5983e972</span><span class="n">fb1c</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">intf_config</span>

<span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;intf_config&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
</pre></div>
</div>
<p>Обратите внимание, что переменная intf_config недоступна за пределами функции.
Для того чтобы получить результат функции, надо вызвать функцию и присвоить результат в переменную:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">configure_intf</span><span class="p">(</span><span class="s1">&#39;F0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;interface F0/0</span><span class="se">\n</span><span class="s1">ip address 10.1.1.1 255.255.255.0&#39;</span>
</pre></div>
</div>
</div>
<span id="document-book/09_functions/func_params_args"></span><div class="section" id="id1">
<h4>Параметры и аргументы функций<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Цель создания функции, как правило, заключается в том, чтобы вынести
кусок кода, который выполняет определенную задачу, в отдельный объект.
Это позволяет использовать этот кусок кода многократно, не создавая
его заново в программе.</p>
<p>Как правило, функция должна выполнять какие-то действия с входящими
значениями и на выходе выдавать результат.</p>
<p>При работе с функциями важно различать:</p>
<ul class="simple">
<li><strong>параметры</strong> - это переменные, которые используются при создании
функции.</li>
<li><strong>аргументы</strong> - это фактические значения (данные), которые передаются
функции при вызове.</li>
</ul>
<p>Параметры бывают обязательные и необязательные.</p>
<p>Обязательные:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Необязательные (со значением по умолчанию):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>В этом случае <code class="docutils literal notranslate"><span class="pre">a</span></code> - передавать необязательно.</p>
<p>Аргументы бывают позиционные и ключевые.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">summ</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
<p>Позиционные:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">summ</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Ключевые:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">summ</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Независимо от того как параметры созданы, при вызове функции им можно передавать
значения и как ключевые и как позиционные аргументы. При этом обязательные параметры
надо передать в любом случае, любым способом (позиционными или ключевыми),
а необязательные можно передавать, можно нет. Если передавать, то тоже любым способом.</p>
<p>Подробнее типы параметров и аргументов будут рассматриваться позже.</p>
<p>Для того, чтобы функция могла принимать входящие значения, ее нужно
создать с параметрами (файл func_check_passwd.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">check_passwd</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">elif</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1"> прошел все проверки&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">True</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>В данном случае, у функции два параметра: username и password.</p>
<p>Функция проверяет пароль и возвращает False, если проверки не прошли и
True если пароль прошел проверки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345&#39;</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">слишком</span> <span class="n">короткий</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345lsdkjflskfdjsnata&#39;</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">содержит</span> <span class="n">имя</span> <span class="n">пользователя</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345lsdkjflskfdjs&#39;</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>При таком определении функции надо обязательно передать оба аргумента.
Если передать только один аргумент, возникнет ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">e07773bb4cc8</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">)</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">check_passwd</span><span class="p">()</span> <span class="n">missing</span> <span class="mi">1</span> <span class="n">required</span> <span class="n">positional</span> <span class="n">argument</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span>
</pre></div>
</div>
<p>Аналогично, возникнет ошибка, если передать три и больше аргументов.</p>
<div class="toctree-wrapper compound">
<span id="document-book/09_functions/func_params_types"></span><div class="section" id="id1">
<h5>Типы параметров функции<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>При создании функции можно указать, какие аргументы нужно передавать
обязательно, а какие нет. Соответственно, функция может быть создана с:</p>
<ul class="simple">
<li><strong>обязательными параметрами</strong></li>
<li><strong>необязательными параметрами</strong> (опциональными, параметрами со значением по умолчанию)</li>
</ul>
<div class="section" id="id2">
<h6>Обязательные параметры<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h6>
<p><strong>Обязательные параметры</strong> - определяют, какие аргументы нужно передать
функции обязательно. При этом, их нужно передать ровно столько, сколько
указано параметров функции (нельзя указать большее или меньшее
количество)</p>
<p>Функция с обязательными параметрами (файл func_params_types.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">check_passwd</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">elif</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1"> прошел все проверки&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">True</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Функция check_passwd ожидает два аргумента: username и password.</p>
<p>Функция проверяет пароль и возвращает False, если проверки не прошли и
True, если пароль прошел проверки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345&#39;</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">слишком</span> <span class="n">короткий</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345lsdkjflskfdjsnata&#39;</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">содержит</span> <span class="n">имя</span> <span class="n">пользователя</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345lsdkjflskfdjs&#39;</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h6>Необязательные параметры (параметры со значением по умолчанию)<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h6>
<p>При создании функции можно указывать значение по умолчанию для параметра таким образом:
<code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">check_passwd(username,</span> <span class="pre">password,</span> <span class="pre">min_length=8)</span></code>. В этом случае, параметр min_length
указан со значением по умолчанию и может не передаваться при вызове функции.</p>
<p>Пример функции check_passwd с параметром со значением по умолчанию (файл func_check_passwd_optional_param.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">check_passwd</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_length</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">elif</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1"> прошел все проверки&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">True</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Так как у параметра min_length есть значение по умолчанию, соответствующий аргумент
можно не указывать при вызове функции, если значение по умолчанию подходит:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345&#39;</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">слишком</span> <span class="n">короткий</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Если нужно поменять значение по умолчанию:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/09_functions/func_args_types"></span><div class="section" id="id1">
<h5>Типы аргументов функции<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>При вызове функции аргументы можно передавать двумя способами:</p>
<ul class="simple">
<li>как <strong>позиционные</strong> - передаются в том же порядке, в котором они определены
при создании функции. То есть, порядок передачи аргументов определяет,
какое значение получит каждый аргумент</li>
<li>как <strong>ключевые</strong> - передаются с указанием имени аргумента и его значения.
В таком случае, аргументы могут быть указаны в любом порядке, так как их имя указывается явно.</li>
</ul>
<p>Позиционные и ключевые аргументы могут быть использоваться одновременно при вызове функции.
При этом сначала должны идти позиционные аргументы, а только потом - ключевые.</p>
<p>Посмотрим на разные способы передачи аргументов на примере функции
check_passwd (файл func_check_passwd_optional_param.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">check_passwd</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">elif</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1"> прошел все проверки&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">True</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<div class="section" id="id2">
<h6>Позиционные аргументы<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h6>
<p>Позиционные аргументы при вызове функции надо передать в правильном
порядке (поэтому они и называются позиционные).</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345&#39;</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">слишком</span> <span class="n">короткий</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345lsdkjflskfdjsnata&#39;</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">содержит</span> <span class="n">имя</span> <span class="n">пользователя</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345lsdkjflskfdjs&#39;</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Если при вызове функции поменять аргументы местами, скорее всего,
возникнет ошибка, в зависимости от конкретной функции.</p>
</div>
<div class="section" id="id3">
<h6>Ключевые аргументы<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h6>
<p><strong>Ключевые аргументы</strong>:</p>
<ul class="simple">
<li>передаются с указанием имени аргумента</li>
<li>за счет этого они могут передаваться в любом порядке</li>
</ul>
<p>Если передать оба аргумента как ключевые, можно передавать их в любом
порядке:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;12345&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Обратите внимание, что всегда сначала должны идти позиционные
аргументы, а затем ключевые.</p>
</div>
<p>Если сделать наоборот, возникнет ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;12345&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;ipython-input-10-7e8246b6b402&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
    <span class="n">check_passwd</span><span class="p">(</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;12345&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                                                   <span class="o">^</span>
<span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">positional</span> <span class="n">argument</span> <span class="n">follows</span> <span class="n">keyword</span> <span class="n">argument</span>
</pre></div>
</div>
<p>Но в такой комбинации можно:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>В реальной жизни зачастую намного понятней и удобней указывать
флаги (параметры со значениями True/False) или числовые значения как ключевой аргумент. Если
задать хорошее название параметра, то по его имени сразу
будет понятно, что именно он делает.</p>
<p>Например, можно добавить флаг, который будет контролировать, выполнять проверку наличия имени пользователя в пароле или нет:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">check_passwd</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">check_username</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_length</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">elif</span> <span class="n">check_username</span> <span class="ow">and</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1"> прошел все проверки&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">True</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>По умолчанию флаг равен True, а значит проверку выполнять надо:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345nata&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">содержит</span> <span class="n">имя</span> <span class="n">пользователя</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345nata&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">check_username</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">содержит</span> <span class="n">имя</span> <span class="n">пользователя</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Если указать значение равным False, проверка не будет выполняться:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345nata&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">check_username</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/09_functions/func_args_var"></span><div class="section" id="id1">
<h5>Аргументы переменной длины<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Иногда необходимо сделать так, чтобы функция принимала не фиксированное
количество аргументов, а любое. Для такого случая в Python можно
создавать функцию со специальным параметром, который принимает аргументы
переменной длины. Такой параметр может быть как ключевым, так и
позиционным.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Даже если вы не будете использовать этот прием в своих скриптах,
есть большая вероятность, что вы встретите его в чужом коде.</p>
</div>
<div class="section" id="id2">
<h6>Позиционные аргументы переменной длины<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h6>
<p>Параметр, который принимает позиционные аргументы переменной длины,
создается добавлением перед именем параметра звездочки. Имя параметра
может быть любым, но по договоренности чаще всего используют имя
<code class="docutils literal notranslate"><span class="pre">*args</span></code></p>
<p>Пример функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">sum_arg</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
  <span class="o">....</span><span class="p">:</span>     <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
  <span class="o">....</span><span class="p">:</span>
</pre></div>
</div>
<p>Функция sum_arg создана с двумя параметрами:</p>
<ul class="simple">
<li>параметр <code class="docutils literal notranslate"><span class="pre">a</span></code><ul>
<li>если передается как позиционный аргумент, должен идти первым</li>
<li>если передается как ключевой аргумент, то порядок не важен</li>
</ul>
</li>
<li>параметр <code class="docutils literal notranslate"><span class="pre">*args</span></code> - ожидает аргументы переменной длины<ul>
<li>сюда попадут все остальные аргументы в виде кортежа</li>
<li>эти аргументы могут отсутствовать</li>
</ul>
</li>
</ul>
<p>Вызов функции с разным количеством аргументов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">sum_arg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="mi">1</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">61</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">sum_arg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="mi">1</span> <span class="p">(</span><span class="mi">10</span><span class="p">,)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">11</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">sum_arg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="mi">1</span> <span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Можно создать и такую функцию:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">sum_arg</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
  <span class="o">....</span><span class="p">:</span>     <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
  <span class="o">....</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">sum_arg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mi">61</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">sum_arg</span><span class="p">()</span>
<span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h6>Ключевые аргументы переменной длины<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h6>
<p>Параметр, который принимает ключевые аргументы переменной длины,
создается добавлением перед именем параметра двух звездочек. Имя
параметра может быть любым, но, по договоренности, чаще всего,
используют имя <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> (от keyword arguments).</p>
<p>Пример функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">sum_arg</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
  <span class="o">....</span><span class="p">:</span>     <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
  <span class="o">....</span><span class="p">:</span>
</pre></div>
</div>
<p>Функция sum_arg создана с двумя параметрами:</p>
<ul class="simple">
<li>параметр <code class="docutils literal notranslate"><span class="pre">a</span></code><ul>
<li>если передается как позиционный аргумент, должен идти первым</li>
<li>если передается как ключевой аргумент, то порядок не важен</li>
</ul>
</li>
<li>параметр <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> - ожидает ключевые аргументы переменной длины<ul>
<li>сюда попадут все остальные ключевые аргументы в виде словаря</li>
<li>эти аргументы могут отсутствовать</li>
</ul>
</li>
</ul>
<p>Вызов функции с разным количеством ключевых аргументов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">sum_arg</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="mi">10</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="mi">70</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">sum_arg</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="mi">10</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="mi">70</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/09_functions/func_unpacking_args"></span><div class="section" id="unpacking-args">
<span id="id1"></span><h5>Распаковка аргументов<a class="headerlink" href="#unpacking-args" title="Ссылка на этот заголовок">¶</a></h5>
<p>В Python выражения <code class="docutils literal notranslate"><span class="pre">*args</span></code> и <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> позволяют выполнять ещё одну
задачу - <strong>распаковку аргументов</strong>.</p>
<p>До сих пор мы вызывали все функции вручную. И соответственно
передавали все нужные аргументы.</p>
<p>В реальности, как правило, данные необходимо передавать в функцию
программно. И часто данные идут в виде какого-то объекта Python.</p>
<div class="section" id="id2">
<h6>Распаковка позиционных аргументов<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h6>
<p>Например, при форматировании строк часто надо передать методу format
несколько аргументов. И часто эти аргументы уже находятся в списке или
кортеже. Чтобы их передать методу format, приходится использовать
индексы таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;One: </span><span class="si">{}</span><span class="s1">, Two: </span><span class="si">{}</span><span class="s1">, Three: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">One</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Two</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Three</span><span class="p">:</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Вместо этого, можно воспользоваться распаковкой аргументов и сделать так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;One: </span><span class="si">{}</span><span class="s1">, Two: </span><span class="si">{}</span><span class="s1">, Three: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">))</span>
<span class="n">One</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Two</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Three</span><span class="p">:</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Еще один пример - функция config_interface (файл
func_config_interface_unpacking.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">config_interface</span><span class="p">(</span><span class="n">intf_name</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
    <span class="o">..</span><span class="p">:</span>     <span class="n">interface</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;interface </span><span class="si">{</span><span class="n">intf_name</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="o">..</span><span class="p">:</span>     <span class="n">no_shut</span> <span class="o">=</span> <span class="s1">&#39;no shutdown&#39;</span>
    <span class="o">..</span><span class="p">:</span>     <span class="n">ip_addr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ip address </span><span class="si">{</span><span class="n">ip_address</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">mask</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="o">..</span><span class="p">:</span>     <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">interface</span><span class="p">,</span> <span class="n">no_shut</span><span class="p">,</span> <span class="n">ip_addr</span><span class="p">]</span>
    <span class="o">..</span><span class="p">:</span>     <span class="k">return</span> <span class="n">result</span>
    <span class="o">..</span><span class="p">:</span>
</pre></div>
</div>
<p>Функция ожидает такие аргументы:</p>
<ul class="simple">
<li>intf_name - имя интерфейса</li>
<li>ip_address - IP-адрес</li>
<li>mask - маска</li>
</ul>
<p>Функция возвращает список строк для настройки интерфейса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">config_interface</span><span class="p">(</span><span class="s1">&#39;Fa0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;interface Fa0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;no shutdown&#39;</span><span class="p">,</span> <span class="s1">&#39;ip address 10.0.1.1 255.255.255.0&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">config_interface</span><span class="p">(</span><span class="s1">&#39;Fa0/10&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.4.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;interface Fa0/10&#39;</span><span class="p">,</span> <span class="s1">&#39;no shutdown&#39;</span><span class="p">,</span> <span class="s1">&#39;ip address 10.255.4.1 255.255.255.0&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Допустим, нужно вызвать функцию и передать ей информацию, которая
была получена из другого источника, к примеру, из БД.</p>
<p>Например, список interfaces_info, в котором находятся параметры для
настройки интерфейсов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">interfaces_info</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Fa0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">],</span>
    <span class="o">...</span><span class="p">:</span>                    <span class="p">[</span><span class="s1">&#39;Fa0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">],</span>
    <span class="o">...</span><span class="p">:</span>                    <span class="p">[</span><span class="s1">&#39;Fa0/3&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.3.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">],</span>
    <span class="o">...</span><span class="p">:</span>                    <span class="p">[</span><span class="s1">&#39;Fa0/4&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.4.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.0&#39;</span><span class="p">],</span>
    <span class="o">...</span><span class="p">:</span>                    <span class="p">[</span><span class="s1">&#39;Lo0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;255.255.255.255&#39;</span><span class="p">]]</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Если пройтись по списку в цикле и передавать вложенный список как
аргумент функции, возникнет ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">interfaces_info</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">config_interface</span><span class="p">(</span><span class="n">info</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="n">d34ced60c796</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">1</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">interfaces_info</span><span class="p">:</span>
<span class="o">----&gt;</span> <span class="mi">2</span>     <span class="nb">print</span><span class="p">(</span><span class="n">config_interface</span><span class="p">(</span><span class="n">info</span><span class="p">))</span>
      <span class="mi">3</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">config_interface</span><span class="p">()</span> <span class="n">missing</span> <span class="mi">2</span> <span class="n">required</span> <span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span> <span class="s1">&#39;ip_address&#39;</span> <span class="ow">and</span> <span class="s1">&#39;mask&#39;</span>
</pre></div>
</div>
<p>Ошибка вполне логичная: функция ожидает три аргумента, а ей передан 1
аргумент - список.</p>
<p>В такой ситуации пригодится распаковка аргументов. Достаточно добавить
<code class="docutils literal notranslate"><span class="pre">*</span></code> перед передачей списка как аргумента, и ошибки уже не будет:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">interfaces_info</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">config_interface</span><span class="p">(</span><span class="o">*</span><span class="n">info</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>
<span class="p">[</span><span class="s1">&#39;interface Fa0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;no shutdown&#39;</span><span class="p">,</span> <span class="s1">&#39;ip address 10.0.1.1 255.255.255.0&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;interface Fa0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;no shutdown&#39;</span><span class="p">,</span> <span class="s1">&#39;ip address 10.0.2.1 255.255.255.0&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;interface Fa0/3&#39;</span><span class="p">,</span> <span class="s1">&#39;no shutdown&#39;</span><span class="p">,</span> <span class="s1">&#39;ip address 10.0.3.1 255.255.255.0&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;interface Fa0/4&#39;</span><span class="p">,</span> <span class="s1">&#39;no shutdown&#39;</span><span class="p">,</span> <span class="s1">&#39;ip address 10.0.4.1 255.255.255.0&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;interface Lo0&#39;</span><span class="p">,</span> <span class="s1">&#39;no shutdown&#39;</span><span class="p">,</span> <span class="s1">&#39;ip address 10.0.0.1 255.255.255.255&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Python сам „распакует“ список info и передаст в функцию элементы списка
как аргументы.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Таким же образом можно распаковывать и кортеж.</p>
</div>
</div>
<div class="section" id="id3">
<h6>Распаковка ключевых аргументов<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h6>
<p>Аналогичным образом можно распаковывать словарь, чтобы передать его как
ключевые аргументы.</p>
<p>Функция check_passwd (файл func_check_passwd_optional_param_2.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">check_passwd</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">check_username</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_length</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">elif</span> <span class="n">check_username</span> <span class="ow">and</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1"> прошел все проверки&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">True</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Список словарей <code class="docutils literal notranslate"><span class="pre">username_passwd</span></code>, в которых указано имя пользователя и пароль:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">username_passwd</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">},</span>
    <span class="o">...</span><span class="p">:</span>                    <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;natapass&#39;</span><span class="p">},</span>
    <span class="o">...</span><span class="p">:</span>                    <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;123456789&#39;</span><span class="p">}]</span>
</pre></div>
</div>
<p>Если передать словарь функции check_passwd, возникнет ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">username_passwd</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">check_passwd</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="n">ad848f85c77f</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">1</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">username_passwd</span><span class="p">:</span>
<span class="o">----&gt;</span> <span class="mi">2</span>     <span class="n">check_passwd</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
      <span class="mi">3</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">check_passwd</span><span class="p">()</span> <span class="n">missing</span> <span class="mi">1</span> <span class="n">required</span> <span class="n">positional</span> <span class="n">argument</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span>
</pre></div>
</div>
<p>Ошибка такая, так как функция восприняла словарь как один аргумент и считает что ей не хватает только
аргумента password.</p>
<p>Если добавить <code class="docutils literal notranslate"><span class="pre">**</span></code> перед передачей словаря функции, функция нормально
отработает:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">username_passwd</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">check_passwd</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">Пароль</span> <span class="n">слишком</span> <span class="n">короткий</span>
<span class="n">Пароль</span> <span class="n">содержит</span> <span class="n">имя</span> <span class="n">пользователя</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">user</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">username_passwd</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">check_passwd</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">}</span>
<span class="n">Пароль</span> <span class="n">слишком</span> <span class="n">короткий</span>
<span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;natapass&#39;</span><span class="p">}</span>
<span class="n">Пароль</span> <span class="n">содержит</span> <span class="n">имя</span> <span class="n">пользователя</span>
<span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;123456789&#39;</span><span class="p">}</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">user</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
</pre></div>
</div>
<p>Python распаковывает словарь и передает его в функцию как ключевые аргументы.
Запись <code class="docutils literal notranslate"><span class="pre">check_passwd(**data)</span></code> превращается в вызов вида <code class="docutils literal notranslate"><span class="pre">check_passwd(username='cisco',</span> <span class="pre">password='cisco')</span></code>.</p>
</div>
</div>
<span id="document-book/09_functions/func_unpacking_and_var_args_example"></span><div class="section" id="id1">
<h5>Пример использования ключевых аргументов переменной длины и распаковки аргументов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>С помощью аргументов переменной длины и распаковки аргументов можно
передавать аргументы между функциями. Посмотрим на примере.</p>
<p>Функция check_passwd (файл func_add_user_kwargs_example.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">check_passwd</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">check_username</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_length</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">elif</span> <span class="n">check_username</span> <span class="ow">and</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1"> прошел все проверки&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">True</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Функция проверяет пароль и возвращает True, если пароль прошел проверки и False - если нет.</p>
<p>Вызов функции в ipython:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345nata&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">содержит</span> <span class="n">имя</span> <span class="n">пользователя</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345nata&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">check_username</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345nata&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">check_username</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">содержит</span> <span class="n">имя</span> <span class="n">пользователя</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Сделаем функцию add_user_to_users_file, которая запрашивает пароль
для указанного пользователя, проверяет его и запрашивает заново, если пароль не
прошел проверки или записывает пользователя и пароль в файл, если пароль прошел проверки.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">add_user_to_users_file</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">users_filename</span><span class="o">=</span><span class="s1">&#39;users.txt&#39;</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">passwd</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Введите пароль для пользователя </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s1">: &#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">check_passwd</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>             <span class="k">break</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">users_filename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">passwd</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">add_user_to_users_file</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">)</span>
<span class="n">Введите</span> <span class="n">пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span><span class="p">:</span> <span class="n">natasda</span>
<span class="n">Пароль</span> <span class="n">слишком</span> <span class="n">короткий</span>
<span class="n">Введите</span> <span class="n">пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span><span class="p">:</span> <span class="n">natasdlajsl</span><span class="p">;</span><span class="n">fjd</span>
<span class="n">Пароль</span> <span class="n">содержит</span> <span class="n">имя</span> <span class="n">пользователя</span>
<span class="n">Введите</span> <span class="n">пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span><span class="p">:</span> <span class="n">salkfdjsalkdjfsal</span><span class="p">;</span><span class="n">dfj</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">cat</span> <span class="n">users</span><span class="o">.</span><span class="n">txt</span>
<span class="n">nata</span><span class="p">,</span><span class="n">salkfdjsalkdjfsal</span><span class="p">;</span><span class="n">dfj</span>
</pre></div>
</div>
<p>В таком варианте функции add_user_to_users_file нет возможности регулировать
минимальную длину пароля и то надо ли проверять наличие имени пользователя в пароле.
В следующем варианте функции add_user_to_users_file эти возможности добавлены:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">add_user_to_users_file</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">users_filename</span><span class="o">=</span><span class="s1">&#39;users.txt&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">check_username</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">passwd</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Введите пароль для пользователя </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s1">: &#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">check_passwd</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">min_length</span><span class="p">,</span> <span class="n">check_username</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>             <span class="k">break</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">users_filename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">passwd</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">add_user_to_users_file</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Введите</span> <span class="n">пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span><span class="p">:</span> <span class="n">natas2342</span>
<span class="n">Пароль</span> <span class="n">содержит</span> <span class="n">имя</span> <span class="n">пользователя</span>
<span class="n">Введите</span> <span class="n">пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span><span class="p">:</span> <span class="n">dlfjgkd</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
</pre></div>
</div>
<p>Теперь при вызове функции можно указать параметр min_length или check_username.
Однако, пришлось повторить параметры функции check_passwd в определении функции add_user_to_users_file.
Это не очень хорошо и, когда параметров много, просто неудобно, особенно
если учитывать, что у функции check_passwd могут добавиться другие параметры.</p>
<p>Такая ситуация случается довольно часто и в Python есть распространенное решение этой задачи:
все аргументы для внутренней функции (в этом случае это check_passwd) будут приниматься в <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>.
Затем, при вызове функции check_passwd они будут распаковываться в ключевые аргументы
тем же синтаксисом <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">add_user_to_users_file</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">users_filename</span><span class="o">=</span><span class="s1">&#39;users.txt&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">passwd</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Введите пароль для пользователя </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s1">: &#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">check_passwd</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>             <span class="k">break</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">users_filename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">passwd</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">add_user_to_users_file</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Введите</span> <span class="n">пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span><span class="p">:</span> <span class="n">alskfdjlksadjf</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">add_user_to_users_file</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Введите</span> <span class="n">пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span><span class="p">:</span> <span class="mi">345</span>
<span class="n">Пароль</span> <span class="n">слишком</span> <span class="n">короткий</span>
<span class="n">Введите</span> <span class="n">пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span><span class="p">:</span> <span class="mi">309487538</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
</pre></div>
</div>
<p>В таком варианте в функцию check_passwd можно добавлять аргументы
без необходимости дублировать их в функции add_user_to_users_file.</p>
</div>
</div>
</div>
<span id="document-book/09_functions/keyword_only_args"></span><div class="section" id="id1">
<h4>Аргументы, которые можно передавать только как ключевые<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Аргументы, которые указаны после <code class="docutils literal notranslate"><span class="pre">*</span></code> можно передавать только как ключевые при
вызове функции.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Этот функционал доступен в любой версии Python3.</p>
</div>
<p>Например, в этой функции аргументы min_length и check_username можно передавать только как
ключевые.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_passwd</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">check_username</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_length</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль слишком короткий&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">check_username</span> <span class="ow">and</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">password</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Пароль содержит имя пользователя&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Пароль для пользователя </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1"> прошел все проверки&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<p>При передаче их как позиционных, возникнет исключение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345&#39;</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Пароль</span> <span class="n">для</span> <span class="n">пользователя</span> <span class="n">nata</span> <span class="n">прошел</span> <span class="n">все</span> <span class="n">проверки</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">4</span><span class="n">f346c9cf914</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">check_passwd</span><span class="p">(</span><span class="s1">&#39;nata&#39;</span><span class="p">,</span> <span class="s1">&#39;12345&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">check_passwd</span><span class="p">()</span> <span class="n">takes</span> <span class="mi">2</span> <span class="n">positional</span> <span class="n">arguments</span> <span class="n">but</span> <span class="mi">3</span> <span class="n">were</span> <span class="n">given</span>
</pre></div>
</div>
</div>
<span id="document-book/09_functions/common_gotchas"></span><div class="section" id="id1">
<h4>Распространенные проблемы/нюансы работы с функциями<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<div class="section" id="id2">
<h5>Список/словарь в который собираются данные в функции, создан за пределами функции<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Очень часто в решении заданий встречается такой нюанс: функция должна собрать какие-то данные в список/словарь
и список создан вне функции. Тогда вроде как функция работает правильно,
но при этом тест не проходит. Это происходит потому что в таком варианте функция
работает неправильно и каждый вызов добавляет элементы в тот же список:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">result</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">func</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">func</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">800</span><span class="p">]</span>
</pre></div>
</div>
<p>Исправить это можно переносом строки создания списка в функцию:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">result</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">func</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">func</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="p">[</span><span class="mi">700</span><span class="p">,</span> <span class="mi">800</span><span class="p">]</span>
</pre></div>
</div>
<p>Всё, что относится к функции лучше всегда писать внутри функции.
Тест тут не проходит потому что внутри файла задания функция вызывается первый
раз - всё правильно, а потом тест вызывает её второй раз и там вдруг в два раза больше данных чем нужно.</p>
</div>
<div class="section" id="id3">
<h5>Значения по умолчанию в параметрах создаются во время создания функции<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Пример функции, которая должна выводить текущую дату и время при каждом вызове:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">time</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">print_current_datetime</span><span class="p">(</span><span class="n">ptime</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;&gt;&gt; </span><span class="si">{</span><span class="n">ptime</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Имитируем долгое выполнение...&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">print_current_datetime</span><span class="p">()</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">Имитируем</span> <span class="n">долгое</span> <span class="n">выполнение</span><span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">23</span> <span class="mi">09</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">49.845425</span>
<span class="n">Имитируем</span> <span class="n">долгое</span> <span class="n">выполнение</span><span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">23</span> <span class="mi">09</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">49.845425</span>
<span class="n">Имитируем</span> <span class="n">долгое</span> <span class="n">выполнение</span><span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">23</span> <span class="mi">09</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">49.845425</span>
</pre></div>
</div>
<p>Так как <code class="docutils literal notranslate"><span class="pre">datetime.now()</span></code> указано в значении по умолчанию,
это значение создается во время создания функции и в итоге при каждом вызове
время одно и то же. Для корректного вывода, надо вызывать <code class="docutils literal notranslate"><span class="pre">datetime.now()</span></code>
в теле функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">print_current_datetime</span><span class="p">():</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&gt;&gt;&gt; </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Второй пример где этот нюанс может привести к неожиданным результатам,
если о нем не знать - изменяемые типы данных в значении по умолчанию.</p>
<p>Например, использование списка в значении по умолчанию:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">add_item</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[]):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">data</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>В этом случае список data создается один раз - при создании функции и
при вызове функции, данные добавляются в один и тот же список.
В итоге все повторные вызовы будут добавлять элементы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">add_item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">add_item</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">add_item</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>Если нужно сделать так, чтобы параметр data был необязательным и по умолчанию
создавался пустой список, надо сделать так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">add_item</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">data</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">add_item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">add_item</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/09_functions/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/tutorial/controlflow.html#defining-functions">Defining
Functions</a></li>
<li><a class="reference external" href="https://docs.python.org/3.6/library/functions.html">Built-in
Functions</a></li>
<li><a class="reference external" href="https://docs.python.org/3.6/howto/sorting.html">Sorting HOW TO</a></li>
<li><a class="reference external" href="https://docs.python.org/3/howto/functional.html">Functional Programming
HOWTO</a></li>
<li><a class="reference external" href="https://docs.python.org/3.6/library/stdtypes.html#range">Функция
range</a></li>
<li><a class="reference external" href="https://realpython.com/defining-your-own-python-function/">Подробнее о функциях в Python</a></li>
</ul>
</div>
<span id="document-exercises/09_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 9.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию, которая генерирует конфигурацию для access-портов.</p>
<p>Функция ожидает такие аргументы:</p>
<ol class="arabic simple">
<li>словарь с соответствием интерфейс-VLAN такого вида:</li>
</ol>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;FastEthernet0/12&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
 <span class="s2">&quot;FastEthernet0/14&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
 <span class="s2">&quot;FastEthernet0/16&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>шаблон конфигурации access-портов в виде списка команд (список access_mode_template)</li>
</ol>
<p>Функция должна возвращать список всех портов в режиме access
с конфигурацией на основе шаблона access_mode_template.
В конце строк в списке не должно быть символа перевода строки.</p>
<p>В этом задании заготовка для функции уже сделана и надо только продолжить писать само тело функции.</p>
<p>Пример итогового списка (перевод строки после каждого элемента сделан для удобства чтения):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="s2">&quot;interface FastEthernet0/12&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport access vlan 10&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport nonegotiate&quot;</span><span class="p">,</span>
<span class="s2">&quot;spanning-tree portfast&quot;</span><span class="p">,</span>
<span class="s2">&quot;spanning-tree bpduguard enable&quot;</span><span class="p">,</span>
<span class="s2">&quot;interface FastEthernet0/17&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport access vlan 150&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport nonegotiate&quot;</span><span class="p">,</span>
<span class="s2">&quot;spanning-tree portfast&quot;</span><span class="p">,</span>
<span class="s2">&quot;spanning-tree bpduguard enable&quot;</span><span class="p">,</span>
<span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>Проверить работу функции на примере словаря access_config
и списка команд access_mode_template.
Если предыдущая проверка прошла успешно, проверить работу функции еще раз на словаре
access_config_2 и убедиться, что в итоговом списке правильные номера интерфейсов
и вланов.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">access_mode_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span> <span class="s2">&quot;switchport access vlan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport nonegotiate&quot;</span><span class="p">,</span> <span class="s2">&quot;spanning-tree portfast&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spanning-tree bpduguard enable&quot;</span>
<span class="p">]</span>

<span class="n">access_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;FastEthernet0/12&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;FastEthernet0/14&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s2">&quot;FastEthernet0/16&quot;</span><span class="p">:</span> <span class="mi">17</span>
<span class="p">}</span>

<span class="n">access_config_2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;FastEthernet0/03&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;FastEthernet0/07&quot;</span><span class="p">:</span> <span class="mi">101</span><span class="p">,</span>
    <span class="s2">&quot;FastEthernet0/09&quot;</span><span class="p">:</span> <span class="mi">107</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">generate_access_config</span><span class="p">(</span><span class="n">intf_vlan_mapping</span><span class="p">,</span> <span class="n">access_template</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    intf_vlan_mapping - словарь с соответствием интерфейс-VLAN такого вида:</span>
<span class="sd">        {&quot;FastEthernet0/12&quot;: 10,</span>
<span class="sd">         &quot;FastEthernet0/14&quot;: 11,</span>
<span class="sd">         &quot;FastEthernet0/16&quot;: 17}</span>
<span class="sd">    access_template - список команд для порта в режиме access</span>

<span class="sd">    Возвращает список всех портов в режиме access с конфигурацией на основе шаблона</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 9.1a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Сделать копию функции generate_access_config из задания 9.1.</p>
<p>Дополнить скрипт: ввести дополнительный параметр, который контролирует будет ли настроен port-security:</p>
<ul class="simple">
<li>имя параметра «psecurity»</li>
<li>по умолчанию значение None</li>
<li>для настройки port-security, как значение надо передать список команд port-security (находятся в списке port_security_template)</li>
</ul>
<p>Функция должна возвращать список всех портов в режиме access
с конфигурацией на основе шаблона access_mode_template и шаблона port_security_template, если он был передан.
В конце строк в списке не должно быть символа перевода строки.</p>
<p>Проверить работу функции на примере словаря access_config,
с генерацией конфигурации port-security и без.</p>
<p>Пример вызова функции:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">generate_access_config</span><span class="p">(</span><span class="n">access_config</span><span class="p">,</span> <span class="n">access_mode_template</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">generate_access_config</span><span class="p">(</span><span class="n">access_config</span><span class="p">,</span> <span class="n">access_mode_template</span><span class="p">,</span> <span class="n">port_security_template</span><span class="p">))</span>
</pre></div>
</div>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">access_mode_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span> <span class="s2">&quot;switchport access vlan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport nonegotiate&quot;</span><span class="p">,</span> <span class="s2">&quot;spanning-tree portfast&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spanning-tree bpduguard enable&quot;</span>
<span class="p">]</span>

<span class="n">port_security_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;switchport port-security maximum 2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport port-security violation restrict&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport port-security&quot;</span>
<span class="p">]</span>

<span class="n">access_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;FastEthernet0/12&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;FastEthernet0/14&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;FastEthernet0/16&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Задание 9.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию generate_trunk_config, которая генерирует конфигурацию для trunk-портов.</p>
<p>У функции должны быть такие параметры:</p>
<ol class="arabic simple">
<li>intf_vlan_mapping: ожидает как аргумент словарь с соответствием интерфейс-VLANы такого вида:</li>
</ol>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;FastEthernet0/1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
 <span class="s2">&quot;FastEthernet0/2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
 <span class="s2">&quot;FastEthernet0/4&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">17</span><span class="p">]}</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>trunk_template: ожидает как аргумент шаблон конфигурации trunk-портов в виде списка команд (список trunk_mode_template)</li>
</ol>
<p>Функция должна возвращать список команд с конфигурацией
на основе указанных портов и шаблона trunk_mode_template.
В конце строк в списке не должно быть символа перевода строки.</p>
<p>Проверить работу функции на примере словаря trunk_config и списка команд trunk_mode_template.
Если эта проверка прошла успешно, проверить работу функции еще раз на словаре trunk_config_2
и убедится, что в итоговом списке правильные номера интерфейсов и вланов.</p>
<p>Пример итогового списка (перевод строки после каждого элемента сделан для удобства чтения):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="s2">&quot;interface FastEthernet0/1&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport mode trunk&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport trunk native vlan 999&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport trunk allowed vlan 10,20,30&quot;</span><span class="p">,</span>
<span class="s2">&quot;interface FastEthernet0/2&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport mode trunk&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport trunk native vlan 999&quot;</span><span class="p">,</span>
<span class="s2">&quot;switchport trunk allowed vlan 11,30&quot;</span><span class="p">,</span>
<span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trunk_mode_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;switchport mode trunk&quot;</span><span class="p">,</span> <span class="s2">&quot;switchport trunk native vlan 999&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport trunk allowed vlan&quot;</span>
<span class="p">]</span>

<span class="n">trunk_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;FastEthernet0/1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
    <span class="s2">&quot;FastEthernet0/2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
    <span class="s2">&quot;FastEthernet0/4&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">17</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Задание 9.2a<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Сделать копию функции generate_trunk_config из задания 9.2</p>
<p>Изменить функцию таким образом, чтобы она возвращала не список команд, а словарь:</p>
<ul class="simple">
<li>ключи: имена интерфейсов, вида «FastEthernet0/1»</li>
<li>значения: список команд, который надо выполнить на этом интерфейсе</li>
</ul>
<p>Проверить работу функции на примере словаря trunk_config и шаблона trunk_mode_template.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trunk_mode_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;switchport mode trunk&quot;</span><span class="p">,</span> <span class="s2">&quot;switchport trunk native vlan 999&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport trunk allowed vlan&quot;</span>
<span class="p">]</span>

<span class="n">trunk_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;FastEthernet0/1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
    <span class="s2">&quot;FastEthernet0/2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
    <span class="s2">&quot;FastEthernet0/4&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">17</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Задание 9.3<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию get_int_vlan_map, которая обрабатывает конфигурационный файл коммутатора
и возвращает кортеж из двух словарей:</p>
<ol class="arabic simple">
<li>словарь портов в режиме access, где ключи номера портов, а значения access VLAN (числа):</li>
</ol>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;FastEthernet0/12&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
 <span class="s2">&quot;FastEthernet0/14&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
 <span class="s2">&quot;FastEthernet0/16&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>словарь портов в режиме trunk, где ключи номера портов, а значения список разрешенных VLAN (список чисел):</li>
</ol>
<p>У функции должен быть один параметр config_filename, который ожидает как аргумент имя конфигурационного файла.</p>
<p>Проверить работу функции на примере файла config_sw1.txt</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
<div class="section" id="id6">
<h5>Задание 9.3a<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Сделать копию функции get_int_vlan_map из задания 9.3.</p>
<p>Дополнить функцию: добавить поддержку конфигурации, когда настройка access-порта выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">20</span>
 <span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
 <span class="n">duplex</span> <span class="n">auto</span>
</pre></div>
</div>
<p>То есть, порт находится в VLAN 1</p>
<p>В таком случае, в словарь портов должна добавляться информация, что порт в VLAN 1</p>
<p>У функции должен быть один параметр config_filename, который ожидает как аргумент имя конфигурационного файла.</p>
<p>Проверить работу функции на примере файла config_sw2.txt</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
<div class="section" id="id7">
<h5>Задание 9.4<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию convert_config_to_dict, которая обрабатывает конфигурационный файл коммутатора и возвращает словарь:</p>
<ul class="simple">
<li>Все команды верхнего уровня (глобального режима конфигурации), будут ключами.</li>
<li>Если у команды верхнего уровня есть подкоманды, они должны быть в значении у соответствующего ключа, в виде списка (пробелы в начале строки надо удалить).</li>
<li>Если у команды верхнего уровня нет подкоманд, то значение будет пустым списком</li>
</ul>
<p>У функции должен быть один параметр config_filename, который ожидает как аргумент имя конфигурационного файла.</p>
<p>При обработке конфигурационного файла, надо игнорировать строки, которые начинаются с «!»,
а также строки в которых содержатся слова из списка ignore.
Для проверки надо ли игнорировать строку, использовать функцию ignore_command.</p>
<p>Проверить работу функции на примере файла config_sw1.txt</p>
<p>Часть словаря, который должна возвращать функция (полный вывод можно посмотреть
в тесте test_task_9_4.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;version 15.0&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;service timestamps debug datetime msec&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;service timestamps log datetime msec&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;no service password-encryption&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;hostname sw1&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;interface FastEthernet0/0&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;switchport access vlan 10&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;interface FastEthernet0/1&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;switchport trunk encapsulation dot1q&quot;</span><span class="p">,</span>
        <span class="s2">&quot;switchport trunk allowed vlan 100,200&quot;</span><span class="p">,</span>
        <span class="s2">&quot;switchport mode trunk&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;interface FastEthernet0/2&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;switchport access vlan 20&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;duplex&quot;</span><span class="p">,</span> <span class="s2">&quot;alias&quot;</span><span class="p">,</span> <span class="s2">&quot;Current configuration&quot;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">ignore_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">ignore</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Функция проверяет содержится ли в команде слово из списка ignore.</span>

<span class="sd">    command - строка. Команда, которую надо проверить</span>
<span class="sd">    ignore - список. Список слов</span>

<span class="sd">    Возвращает</span>
<span class="sd">    * True, если в команде содержится слово из списка ignore</span>
<span class="sd">    * False - если нет</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ignore_status</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
            <span class="n">ignore_status</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">ignore_status</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/10_useful_functions/index"></span><div class="section" id="useful-functions-index">
<span id="id1"></span><h3>10. Полезные функции<a class="headerlink" href="#useful-functions-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>В этом разделе рассматриваются такие функции:</p>
<ul class="simple">
<li>print</li>
<li>range</li>
<li>sorted</li>
<li>enumerate</li>
<li>zip</li>
<li>all, any</li>
<li>lambda</li>
<li>map, filter</li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-book/10_useful_functions/print"></span><div class="section" id="print">
<span id="id1"></span><h4>Функция print<a class="headerlink" href="#print" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция <code class="docutils literal notranslate"><span class="pre">print</span></code> уже не раз использовалась в книге, но до сих пор не
рассматривался ее полный синтаксис:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Функция print выводит все элементы, разделяя их значением sep, и
завершает вывод значением end.</p>
<p>Все элементы, которые передаются как аргументы, конвертируются в строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">a</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">f</span> <span class="n">at</span> <span class="mh">0xb4de926c</span><span class="o">&gt;</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Для функций f и range результат равнозначен применению str():</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;&lt;function f at 0xb4de926c&gt;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;range(0, 10)&#39;</span>
</pre></div>
</div>
<div class="section" id="sep">
<h5>sep<a class="headerlink" href="#sep" title="Ссылка на этот заголовок">¶</a></h5>
<p>Параметр sep контролирует то, какой разделитель будет использоваться
между элементами.</p>
<p>По умолчанию используется пробел:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Можно изменить значение sep на любую другую строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">10</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="mi">1</span>
<span class="o">----------</span>
<span class="mi">2</span>
<span class="o">----------</span>
<span class="mi">3</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Обратите внимание на то, что все аргументы, которые управляют
поведением функции print, надо передавать как ключевые, а не
позиционные.</p>
</div>
<p>В некоторых ситуациях функция print может заменить метод join:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
<span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="section" id="end">
<h5>end<a class="headerlink" href="#end" title="Ссылка на этот заголовок">¶</a></h5>
<p>Параметр end контролирует то, какое значение выведется после вывода всех
элементов.
По умолчанию используется перевод строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Можно изменить значение end на любую другую строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="o">----------</span>
</pre></div>
</div>
</div>
<div class="section" id="file">
<h5>file<a class="headerlink" href="#file" title="Ссылка на этот заголовок">¶</a></h5>
<p>Параметр file контролирует то, куда выводятся значения функции print. По
умолчанию все выводится на стандартный поток вывода - sys.stdout.</p>
<p>Python позволяет передавать file как аргумент любой объект с методом
write(string). За счет этого с помощью print можно записывать строки в
файл:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;result.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Item </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">cat</span> <span class="n">result</span><span class="o">.</span><span class="n">txt</span>
<span class="n">Item</span> <span class="mi">0</span>
<span class="n">Item</span> <span class="mi">1</span>
<span class="n">Item</span> <span class="mi">2</span>
<span class="n">Item</span> <span class="mi">3</span>
<span class="n">Item</span> <span class="mi">4</span>
<span class="n">Item</span> <span class="mi">5</span>
<span class="n">Item</span> <span class="mi">6</span>
<span class="n">Item</span> <span class="mi">7</span>
<span class="n">Item</span> <span class="mi">8</span>
<span class="n">Item</span> <span class="mi">9</span>
</pre></div>
</div>
</div>
<div class="section" id="flush">
<h5>flush<a class="headerlink" href="#flush" title="Ссылка на этот заголовок">¶</a></h5>
<p>По умолчанию при записи в файл или выводе на стандартный поток вывода
вывод буферизируется. Параметр flush позволяет отключать буферизацию.</p>
<p>Пример скрипта, который выводит число от 0 до 10 каждую секунду (файл
print_nums.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Попробуйте запустить скрипт и убедиться, что числа выводятся раз в
секунду.</p>
<p>Теперь, аналогичный скрипт, но числа будут выводиться в одной строке
(файл print_nums_oneline.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Попробуйте запустить функцию. Числа не выводятся по одному в секунду, а
выводятся все через 10 секунд.</p>
<p>Это связано с тем, что при выводе на стандартный поток вывода flush
выполняется после перевода строки.</p>
<p>Чтобы скрипт отрабатывал как нужно, необходимо установить flush равным
True (файл print_nums_oneline_fixed.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/10_useful_functions/range"></span><div class="section" id="range">
<span id="id1"></span><h4>Функция range<a class="headerlink" href="#range" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция range возвращает неизменяемую последовательность чисел в виде
объекта range.</p>
<p>Синтаксис функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">range</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
<span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">[,</span> <span class="n">step</span><span class="p">])</span>
</pre></div>
</div>
<p>Параметры функции:</p>
<ul class="simple">
<li><strong>start</strong> - с какого числа начинается последовательность. По умолчанию - 0</li>
<li><strong>stop</strong> - до какого числа продолжается последовательность чисел.
Указанное число не включается в диапазон</li>
<li><strong>step</strong> - с каким шагом растут числа. По умолчанию 1</li>
</ul>
<p>Функция range хранит только информацию о значениях start, stop и step и
вычисляет значения по мере необходимости. Это значит, что независимо от
размера диапазона, который описывает функция range, она всегда будет
занимать фиксированный объем памяти.</p>
<p>Самый простой вариант range - передать только значение stop:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>Если передаются два аргумента, то первый используется как start, а
второй - как stop:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>И чтобы указать шаг последовательности надо передать три аргумента:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
</pre></div>
</div>
<p>С помощью range можно генерировать и убывающие последовательности чисел:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Для получения убывающей последовательности надо использовать
отрицательный шаг и соответственно указать start - большим числом, а
stop - меньшим.</p>
<p>В убывающей последовательности шаг тоже может быть разным:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>Функция поддерживает отрицательные значения start и stop:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">]</span>
</pre></div>
</div>
<p>Объект range поддерживает все
<a class="reference external" href="https://docs.python.org/3.6/library/stdtypes.html#sequence-types-list-tuple-range">операции</a>,
которые поддерживают последовательности в Python, кроме сложения и
умножения.</p>
<p>Проверка, входит ли число в диапазон, который описывает range:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">nums</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">nums</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="mi">7</span> <span class="ow">in</span> <span class="n">nums</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Начиная с версии Python 3.2, эта проверка выполняется за постоянное
время (O(1)).</p>
</div>
<p>Можно получить конкретный элемент диапазона:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">nums</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Range поддерживает срезы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">nums</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">nums</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Можно получить длину диапазона:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="mi">5</span>
</pre></div>
</div>
<p>А также минимальный и максимальный элемент:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="nb">min</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="nb">max</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Кроме того, объект range поддерживает метод index:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">nums</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<span id="document-book/10_useful_functions/sorted"></span><div class="section" id="sorted">
<h4>Функция sorted<a class="headerlink" href="#sorted" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция <code class="docutils literal notranslate"><span class="pre">sorted</span></code> возвращает новый отсортированный список, который
получен из итерируемого объекта, который был передан как аргумент.
Функция также поддерживает дополнительные параметры, которые позволяют
управлять сортировкой.</p>
<p>Первый аспект, на который важно обратить внимание - sorted всегда
возвращает список.</p>
<p>Если сортировать список элементов, то возвращается новый список:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">list_of_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">list_of_words</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>При сортировке кортежа также возвращается список:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">tuple_of_words</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tuple_of_words</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Сортировка множества:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">set_of_words</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">set_of_words</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Сортировка строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">string_to_sort</span> <span class="o">=</span> <span class="s1">&#39;long string&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">string_to_sort</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Если передать sorted словарь, функция вернет отсортированный список
ключей:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">dict_for_sort</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;London&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;IT_VLAN&#39;</span><span class="p">:</span> <span class="mi">320</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;User_VLAN&#39;</span><span class="p">:</span> <span class="mi">1010</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;Mngmt_VLAN&#39;</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;to_name&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;to_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="s1">&#39;G1/0/11&#39;</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dict_for_sort</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;IT_VLAN&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Mngmt_VLAN&#39;</span><span class="p">,</span>
 <span class="s1">&#39;User_VLAN&#39;</span><span class="p">,</span>
 <span class="s1">&#39;id&#39;</span><span class="p">,</span>
 <span class="s1">&#39;name&#39;</span><span class="p">,</span>
 <span class="s1">&#39;port&#39;</span><span class="p">,</span>
 <span class="s1">&#39;to_id&#39;</span><span class="p">,</span>
 <span class="s1">&#39;to_name&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="reverse">
<h5>reverse<a class="headerlink" href="#reverse" title="Ссылка на этот заголовок">¶</a></h5>
<p>Флаг reverse позволяет управлять порядком сортировки. По умолчанию
сортировка будет по возрастанию элементов.</p>
<p>Указав флаг reverse, можно поменять порядок:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">list_of_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">list_of_words</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">list_of_words</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="key">
<h5>key<a class="headerlink" href="#key" title="Ссылка на этот заголовок">¶</a></h5>
<p>С помощью параметра key можно указывать, как именно выполнять
сортировку. Параметр key ожидает функцию, с помощью которой должно быть
выполнено сравнение.</p>
<p>Например, таким образом можно отсортировать список строк по длине
строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">list_of_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">list_of_words</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Если нужно отсортировать ключи словаря, но при этом игнорировать регистр
строк:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">dict_for_sort</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;London&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;IT_VLAN&#39;</span><span class="p">:</span><span class="mi">320</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;User_VLAN&#39;</span><span class="p">:</span><span class="mi">1010</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;Mngmt_VLAN&#39;</span><span class="p">:</span><span class="mi">99</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;to_name&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;to_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;port&#39;</span><span class="p">:</span><span class="s1">&#39;G1/0/11&#39;</span>
    <span class="o">...</span><span class="p">:</span> <span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dict_for_sort</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span>
 <span class="s1">&#39;IT_VLAN&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Mngmt_VLAN&#39;</span><span class="p">,</span>
 <span class="s1">&#39;name&#39;</span><span class="p">,</span>
 <span class="s1">&#39;port&#39;</span><span class="p">,</span>
 <span class="s1">&#39;to_id&#39;</span><span class="p">,</span>
 <span class="s1">&#39;to_name&#39;</span><span class="p">,</span>
 <span class="s1">&#39;User_VLAN&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Параметру key можно передавать любые функции, не только встроенные.
Также тут удобно использовать анонимную функцию lambda.</p>
<p>С помощью параметра key можно сортировать объекты не по первому
элементу, а по любому другому. Но для этого надо использовать или
функцию lambda, или специальные функции из модуля operator.</p>
<p>Например, чтобы отсортировать список кортежей из двух элементов по
второму элементу, надо использовать такой прием:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">list_of_tuples</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;IT_VLAN&#39;</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span>
    <span class="o">...</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;Mngmt_VLAN&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span>
    <span class="o">...</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;User_VLAN&#39;</span><span class="p">,</span> <span class="mi">1010</span><span class="p">),</span>
    <span class="o">...</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;DB_VLAN&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">list_of_tuples</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="p">[(</span><span class="s1">&#39;DB_VLAN&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Mngmt_VLAN&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;IT_VLAN&#39;</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;User_VLAN&#39;</span><span class="p">,</span> <span class="mi">1010</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h5>Пример сортировки разных объектов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Сортировка выполняется по первому элементу, например, по первому символу
в списке строк, если он одинаковый, по второму и так далее.
Сортировка выполняется по коду Unicode символа. Для символов из одного
алфавита, это значит что сортировка по сути будет по алфавиту.</p>
<p>Пример сортировки списка строк:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span> <span class="s2">&quot;test2&quot;</span><span class="p">,</span> <span class="s2">&quot;text1&quot;</span><span class="p">,</span> <span class="s2">&quot;text2&quot;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;test1&#39;</span><span class="p">,</span> <span class="s1">&#39;test2&#39;</span><span class="p">,</span> <span class="s1">&#39;text1&#39;</span><span class="p">,</span> <span class="s1">&#39;text2&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Некоторые данные будут сортироваться неправильно, например, список IP-адресов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">ip_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;10.1.1.1&quot;</span><span class="p">,</span> <span class="s2">&quot;10.1.10.1&quot;</span><span class="p">,</span> <span class="s2">&quot;10.1.2.1&quot;</span><span class="p">,</span> <span class="s2">&quot;10.1.11.1&quot;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ip_list</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.10.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.11.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.2.1&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Это происходит потому используется лексикографическая сортировка.
Чтобы в данном случае сортировка была нормальной, надо или использовать отдельный
модуль с натуральной сортировкой (модуль natsort) или сортировать, например,
по двоичному/десятичному значению адреса.</p>
<p>Пример сортировки IP-адресов по двоичному значению. Сначала создаем функцию,
которая преобразует IP-адреса в двоичный формат:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">bin_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">octets</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)]</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">{:08b}</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">octets</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">bin_ip</span><span class="p">(</span><span class="s2">&quot;10.1.1.1&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;00001010000000010000000100000001&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">bin_ip</span><span class="p">(</span><span class="s2">&quot;160.1.1.1&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;10100000000000010000000100000001&#39;</span>
</pre></div>
</div>
<p>Сортировка с использованием функции bin_ip:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">ip_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;10.1.1.1&quot;</span><span class="p">,</span> <span class="s2">&quot;10.1.10.1&quot;</span><span class="p">,</span> <span class="s2">&quot;10.1.2.1&quot;</span><span class="p">,</span> <span class="s2">&quot;10.1.11.1&quot;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ip_list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">bin_ip</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.10.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.11.1&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Также дальше будет рассматриваться модуль ipaddress, который позволит создавать
специальные объекты, которые соответствуют IP-адресу и они уже сортируются правильно
по десятичному значению.</p>
</div>
</div>
</div>
<span id="document-book/10_useful_functions/enumerate"></span><div class="section" id="enumerate">
<h4>enumerate<a class="headerlink" href="#enumerate" title="Ссылка на этот заголовок">¶</a></h4>
<p>Иногда, при переборе объектов в цикле for, нужно не только получить сам
объект, но и его порядковый номер. Это можно сделать, создав
дополнительную переменную, которая будет расти на единицу с каждым
прохождением цикла. Однако, гораздо удобнее это делать с помощью
итератора <code class="docutils literal notranslate"><span class="pre">enumerate</span></code>.</p>
<p>Базовый пример:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;str1&#39;</span><span class="p">,</span> <span class="s1">&#39;str2&#39;</span><span class="p">,</span> <span class="s1">&#39;str3&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">string</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list1</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="mi">0</span> <span class="n">str1</span>
<span class="mi">1</span> <span class="n">str2</span>
<span class="mi">2</span> <span class="n">str3</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">enumerate</span></code> умеет считать не только с нуля, но и с любого значение,
которое ему указали после объекта:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;str1&#39;</span><span class="p">,</span> <span class="s1">&#39;str2&#39;</span><span class="p">,</span> <span class="s1">&#39;str3&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">string</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="mi">100</span> <span class="n">str1</span>
<span class="mi">101</span> <span class="n">str2</span>
<span class="mi">102</span> <span class="n">str3</span>
</pre></div>
</div>
<p>Иногда нужно проверить, что сгенерировал итератор, как правило, на
стадии написания скрипта. Если необходимо увидеть содержимое, которое
сгенерирует итератор, полностью, можно воспользоваться функцией list:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;str1&#39;</span><span class="p">,</span> <span class="s1">&#39;str2&#39;</span><span class="p">,</span> <span class="s1">&#39;str3&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="p">[(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;str1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="s1">&#39;str2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="s1">&#39;str3&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<div class="section" id="enumerate-eem">
<h5>Пример использования enumerate для EEM<a class="headerlink" href="#enumerate-eem" title="Ссылка на этот заголовок">¶</a></h5>
<p>В этом примере используется Cisco <a class="reference external" href="http://xgu.ru/wiki/EEM">EEM</a>. Если
в двух словах, то EEM позволяет выполнять какие-то действия (action) в
ответ на событие (event).</p>
<p>Выглядит applet EEM так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">event</span> <span class="n">manager</span> <span class="n">applet</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="n">_no_shut</span>
 <span class="n">event</span> <span class="n">syslog</span> <span class="n">pattern</span> <span class="s2">&quot;Line protocol on Interface FastEthernet0/0, changed state to down&quot;</span>
 <span class="n">action</span> <span class="mi">1</span> <span class="n">cli</span> <span class="n">command</span> <span class="s2">&quot;enable&quot;</span>
 <span class="n">action</span> <span class="mi">2</span> <span class="n">cli</span> <span class="n">command</span> <span class="s2">&quot;conf t&quot;</span>
 <span class="n">action</span> <span class="mi">3</span> <span class="n">cli</span> <span class="n">command</span> <span class="s2">&quot;interface fa0/1&quot;</span>
 <span class="n">action</span> <span class="mi">4</span> <span class="n">cli</span> <span class="n">command</span> <span class="s2">&quot;no sh&quot;</span>
</pre></div>
</div>
<p>В EEM, в ситуации, когда действий выполнить нужно много, неудобно каждый
раз набирать <code class="docutils literal notranslate"><span class="pre">action</span> <span class="pre">x</span> <span class="pre">cli</span> <span class="pre">command</span></code>. Плюс, чаще всего, уже есть
готовый кусок конфигурации, который должен выполнить EEM.</p>
<p>С помощью простого Python-скрипта можно сгенерировать команды EEM на
основании существующего списка команд (файл enumerate_eem.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">command</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;action </span><span class="si">{:04}</span><span class="s1"> cli command &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">command</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()))</span>
</pre></div>
</div>
<p>В данном примере команды считываются из файла, а затем к каждой строке
добавляется приставка, которая нужна для EEM.</p>
<p>Файл с командами выглядит так (r1_config.txt):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">en</span>
<span class="n">conf</span> <span class="n">t</span>
<span class="n">no</span> <span class="nb">int</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mf">0.300</span>
<span class="n">no</span> <span class="nb">int</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mf">0.301</span>
<span class="n">no</span> <span class="nb">int</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mf">0.302</span>
<span class="nb">int</span> <span class="nb">range</span> <span class="n">gi0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">-</span><span class="mi">2</span>
 <span class="n">channel</span><span class="o">-</span><span class="n">group</span> <span class="mi">1</span> <span class="n">mode</span> <span class="n">active</span>
<span class="n">interface</span> <span class="n">Port</span><span class="o">-</span><span class="n">channel1</span><span class="o">.</span><span class="mi">300</span>
 <span class="n">encapsulation</span> <span class="n">dot1Q</span> <span class="mi">300</span>
 <span class="n">vrf</span> <span class="n">forwarding</span> <span class="n">Management</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">10.16</span><span class="o">.</span><span class="mf">19.35</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.248</span>
</pre></div>
</div>
<p>Вывод будет таким:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ python enumerate_eem.py r1_config.txt
action 0001 cli command &quot;en&quot;
action 0002 cli command &quot;conf t&quot;
action 0003 cli command &quot;no int Gi0/0/0.300&quot;
action 0004 cli command &quot;no int Gi0/0/0.301&quot;
action 0005 cli command &quot;no int Gi0/0/0.302&quot;
action 0006 cli command &quot;int range gi0/0/0-2&quot;
action 0007 cli command &quot; channel-group 1 mode active&quot;
action 0008 cli command &quot;interface Port-channel1.300&quot;
action 0009 cli command &quot; encapsulation dot1Q 300&quot;
action 0010 cli command &quot; vrf forwarding Management&quot;
action 0011 cli command &quot; ip address 10.16.19.35 255.255.255.248&quot;
</pre></div>
</div>
</div>
</div>
<span id="document-book/10_useful_functions/zip"></span><div class="section" id="zip">
<h4>Функция zip<a class="headerlink" href="#zip" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция <code class="docutils literal notranslate"><span class="pre">zip</span></code>:</p>
<ul class="simple">
<li>на вход функции передаются последовательности</li>
<li><code class="docutils literal notranslate"><span class="pre">zip</span></code> возвращает итератор с кортежами, в котором n-ый кортеж состоит
из n-ых элементов последовательностей, которые были переданы как
аргументы</li>
<li>например, десятый кортеж будет содержать десятый элемент каждой из
переданных последовательностей</li>
<li>если на вход были переданы последовательности разной длины, то все
они будут отрезаны по самой короткой последовательности</li>
<li>порядок элементов соблюдается</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Так как <code class="docutils literal notranslate"><span class="pre">zip</span></code> - это итератор, для отображение его содержимого
используется <code class="docutils literal notranslate"><span class="pre">list</span></code></p>
</div>
<p>Пример использования <code class="docutils literal notranslate"><span class="pre">zip</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">300</span><span class="p">)]</span>
</pre></div>
</div>
<p>Использование <code class="docutils literal notranslate"><span class="pre">zip</span></code> со списками разной длины:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">300</span><span class="p">)]</span>
</pre></div>
</div>
<div class="section" id="id1">
<h5>Использование zip для создания словаря<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Пример использования <code class="docutils literal notranslate"><span class="pre">zip</span></code> для создания словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">d_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;IOS&#39;</span><span class="p">,</span> <span class="s1">&#39;IP&#39;</span><span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">d_values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;london_r1&#39;</span><span class="p">,</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">d_keys</span><span class="p">,</span> <span class="n">d_values</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span>
<span class="p">[(</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;4451&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;IOS&#39;</span><span class="p">,</span> <span class="s1">&#39;15.4&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;IP&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">d_keys</span><span class="p">,</span> <span class="n">d_values</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
 <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
 <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
 <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">d_keys</span><span class="p">,</span><span class="n">d_values</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
 <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
 <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
 <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>В примере ниже есть отдельный список, в котором хранятся ключи, и
словарь, в котором хранится в виде списка (чтобы сохранить порядок)
информация о каждом устройстве.</p>
<p>Соберем их в словарь с ключами из списка и информацией из словаря data:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">d_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;IOS&#39;</span><span class="p">,</span> <span class="s1">&#39;IP&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">....</span><span class="p">:</span> <span class="s1">&#39;r1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;london_r1&#39;</span><span class="p">,</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">],</span>
   <span class="o">....</span><span class="p">:</span> <span class="s1">&#39;r2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;london_r2&#39;</span><span class="p">,</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.0.2&#39;</span><span class="p">],</span>
   <span class="o">....</span><span class="p">:</span> <span class="s1">&#39;sw1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;london_sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span> <span class="s1">&#39;3.6.XE&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.0.101&#39;</span><span class="p">]</span>
   <span class="o">....</span><span class="p">:</span> <span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">london_co</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
   <span class="o">....</span><span class="p">:</span>     <span class="n">london_co</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">d_keys</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
   <span class="o">....</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">london_co</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;r1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
  <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
  <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">},</span>
 <span class="s1">&#39;r2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
  <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.2&#39;</span><span class="p">,</span>
  <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r2&#39;</span><span class="p">,</span>
  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
  <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">},</span>
 <span class="s1">&#39;sw1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;3.6.XE&#39;</span><span class="p">,</span>
  <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.101&#39;</span><span class="p">,</span>
  <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_sw1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
  <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span>
  <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/10_useful_functions/all_any"></span><div class="section" id="all">
<h4>Функция all<a class="headerlink" href="#all" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция <code class="docutils literal notranslate"><span class="pre">all</span></code> возвращает True, если все элементы истинные (или объект
пустой).</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">all</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">all</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">all</span><span class="p">([])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Например, с помощью <code class="docutils literal notranslate"><span class="pre">all</span></code> можно проверить, все ли октеты в IP-адресе
являются числами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">IP</span> <span class="o">=</span> <span class="s1">&#39;10.0.1.1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">all</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">IP</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">all</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s1">&#39;10.1.1.a&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="section" id="any">
<h4>Функция any<a class="headerlink" href="#any" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция <code class="docutils literal notranslate"><span class="pre">any</span></code> возвращает True, если хотя бы один элемент истинный.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">any</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">any</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">any</span><span class="p">([])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s1">&#39;10.1.1.a&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Например, с помощью any, можно заменить функцию ignore_command:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ignore_command</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Функция проверяет содержится ли в команде слово из списка ignore.</span>
<span class="sd">    * command - строка. Команда, которую надо проверить</span>
<span class="sd">    * Возвращает True, если в команде содержится слово из списка ignore, False - если нет</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;duplex&#39;</span><span class="p">,</span> <span class="s1">&#39;alias&#39;</span><span class="p">,</span> <span class="s1">&#39;Current configuration&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p>На такой вариант:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ignore_command</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Функция проверяет содержится ли в команде слово из списка ignore.</span>
<span class="sd">    command - строка. Команда, которую надо проверить</span>
<span class="sd">    Возвращает True, если в команде содержится слово из списка ignore, False - если нет</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;duplex&#39;</span><span class="p">,</span> <span class="s1">&#39;alias&#39;</span><span class="p">,</span> <span class="s1">&#39;Current configuration&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">command</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">)</span>
</pre></div>
</div>
</div>
<span id="document-book/10_useful_functions/lambda"></span><div class="section" id="id1">
<h4>Анонимная функция (лямбда-выражение)<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python лямбда-выражение позволяет создавать анонимные функции -
функции, которые не привязаны к имени.</p>
<p>В анонимной функции:</p>
<blockquote>
<div><ul class="simple">
<li>может содержаться только одно выражение</li>
<li>могут передаваться сколько угодно аргументов</li>
</ul>
</div></blockquote>
<p>Стандартная функция:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">sum_arg</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">sum_arg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Аналогичная анонимная функция, или лямбда-функция:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">sum_arg</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">sum_arg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Обратите внимание, что в определении лямбда-функции нет оператора return, так
как в этой функции может быть только одно выражение, которое всегда
возвращает значение и завершает работу функции.</p>
<p>Лямбда-функцию удобно использовать в выражениях, где требуется написать
небольшую функцию для обработки данных.</p>
<p>Например, в функции sorted лямбда-выражение можно использовать для указания ключа
для сортировки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">list_of_tuples</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;IT_VLAN&#39;</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span>
    <span class="o">...</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;Mngmt_VLAN&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span>
    <span class="o">...</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;User_VLAN&#39;</span><span class="p">,</span> <span class="mi">1010</span><span class="p">),</span>
    <span class="o">...</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;DB_VLAN&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">list_of_tuples</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[(</span><span class="s1">&#39;DB_VLAN&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Mngmt_VLAN&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;IT_VLAN&#39;</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;User_VLAN&#39;</span><span class="p">,</span> <span class="mi">1010</span><span class="p">)]</span>
</pre></div>
</div>
<p>Также лямбда-функция пригодится в функциях map и filter, которые будут
рассматриваться в следующих разделах.</p>
</div>
<span id="document-book/10_useful_functions/map"></span><div class="section" id="map">
<h4>Функция map<a class="headerlink" href="#map" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция map применяет функцию к каждому элементу последовательности и
возвращает итератор с результатами.</p>
<p>Например, с помощью map можно выполнять преобразования элементов.
Перевести все строки в верхний регистр:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">list_of_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span> <span class="n">list_of_words</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="o">&lt;</span><span class="nb">map</span> <span class="n">at</span> <span class="mh">0xb45eb7ec</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span> <span class="n">list_of_words</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;ONE&#39;</span><span class="p">,</span> <span class="s1">&#39;TWO&#39;</span><span class="p">,</span> <span class="s1">&#39;LIST&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;DICT&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">str.upper(&quot;aaa&quot;)</span></code> делает то же самое что <code class="docutils literal notranslate"><span class="pre">&quot;aaa&quot;.upper()</span></code>.</p>
</div>
<p>Конвертация в числа:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">list_of_str</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">list_of_str</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<p>Вместе с map удобно использовать лямбда-выражения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">202</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;vlan </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">vlans</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;vlan 100&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 110&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 150&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 200&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 201&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 202&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Если функция, которую использует map(), ожидает два аргумента, то
передаются два списка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">nums2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">nums</span><span class="p">,</span> <span class="n">nums2</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">2500</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="list-comprehension-map">
<h5>List comprehension вместо map<a class="headerlink" href="#list-comprehension-map" title="Ссылка на этот заголовок">¶</a></h5>
<p>Как правило, вместо map можно использовать list comprehension. Чаще
всего, вариант с list comprehension более понятный, а в некоторых
случаях даже быстрее.</p>
<blockquote>
<div><a class="reference external" href="https://stackoverflow.com/a/1247490">Ответ Alex Martelli со сравнением map и list
comprehension</a></div></blockquote>
<p>Но map может быть эффективней в том случае, когда надо сгенерировать
большое количество элементов, так как map - итератор, а list
comprehension генерирует список.</p>
<p>Примеры, аналогичные приведенным выше, в варианте с list comprehension.</p>
<p>Перевести все строки в верхний регистр:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">list_of_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">list_of_words</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;ONE&#39;</span><span class="p">,</span> <span class="s1">&#39;TWO&#39;</span><span class="p">,</span> <span class="s1">&#39;LIST&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;DICT&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Конвертация в числа:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">list_of_str</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_of_str</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<p>Форматирование строк:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span>  <span class="n">vlans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">202</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;vlan </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vlans</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;vlan 100&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 110&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 150&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 200&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 201&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan 202&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Для получения пар элементов используется zip:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">nums2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">nums2</span><span class="p">)]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">2500</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/10_useful_functions/filter"></span><div class="section" id="filter">
<h4>Функция filter<a class="headerlink" href="#filter" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция <code class="docutils literal notranslate"><span class="pre">filter</span></code> применяет функцию ко всем элементам последовательности
и возвращает итератор с теми объектами, для которых функция вернула
True.</p>
<p>Например, вернуть только те строки, в которых находятся числа:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">list_of_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span> <span class="n">list_of_strings</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="o">&lt;</span><span class="nb">filter</span> <span class="n">at</span> <span class="mh">0xb45eb1cc</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span> <span class="n">list_of_strings</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Из списка чисел оставить только нечетные:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">314</span><span class="p">,</span> <span class="mi">515</span><span class="p">]))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[</span><span class="mi">111</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">515</span><span class="p">]</span>
</pre></div>
</div>
<p>Аналогично, только четные:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">314</span><span class="p">,</span> <span class="mi">515</span><span class="p">]))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">314</span><span class="p">]</span>
</pre></div>
</div>
<p>Из списка слов оставить только те, у которых количество букв больше
двух:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">list_of_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">list_of_words</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="list-comprehension-filter">
<h5>List comprehension вместо filter<a class="headerlink" href="#list-comprehension-filter" title="Ссылка на этот заголовок">¶</a></h5>
<p>Как правило, вместо filter можно использовать list comprehension.</p>
<p>Примеры, аналогичные приведенным выше, в варианте с list comprehension.</p>
<p>Вернуть только те строки, в которых находятся числа:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">list_of_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">list_of_strings</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Нечетные/четные числа:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">314</span><span class="p">,</span> <span class="mi">515</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span> <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="p">[</span><span class="mi">111</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">515</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span> <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">314</span><span class="p">]</span>
</pre></div>
</div>
<p>Из списка слов оставить только те, у которых количество букв больше
двух:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">list_of_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">list_of_words</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/11_modules/index"></span><div class="section" id="modules-index">
<span id="id1"></span><h3>11. Модули<a class="headerlink" href="#modules-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>Модуль в Python - это обычный текстовый файл с кодом Python и
расширением <strong>.py</strong>. Он позволяет логически упорядочить и сгруппировать
код.</p>
<p>Разделение на модули может быть, например, по такой логике:</p>
<ul class="simple">
<li>разделение данных, форматирования и логики кода</li>
<li>группировка функций и других объектов по функционалу</li>
</ul>
<p>Модули хороши тем, что позволяют повторно использовать уже написанный
код и не копировать его (например, не копировать когда-то написанную
функцию).</p>
<div class="toctree-wrapper compound">
<span id="document-book/11_modules/import"></span><div class="section" id="id1">
<h4>Импорт модуля<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python есть несколько способов импорта модуля:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">module</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">module</span> <span class="pre">as</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">object</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code></li>
</ul>
<div class="section" id="import-module">
<h5><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">module</span></code><a class="headerlink" href="#import-module" title="Ссылка на этот заголовок">¶</a></h5>
<p>Вариант <strong>import module</strong>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;In&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Out&#39;</span><span class="p">,</span>
 <span class="o">...</span>
 <span class="s1">&#39;exit&#39;</span><span class="p">,</span>
 <span class="s1">&#39;get_ipython&#39;</span><span class="p">,</span>
 <span class="s1">&#39;quit&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">os</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;In&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Out&#39;</span><span class="p">,</span>
 <span class="o">...</span>
 <span class="s1">&#39;exit&#39;</span><span class="p">,</span>
 <span class="s1">&#39;get_ipython&#39;</span><span class="p">,</span>
 <span class="s1">&#39;os&#39;</span><span class="p">,</span>
 <span class="s1">&#39;quit&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>После импорта модуль os появился в выводе <code class="docutils literal notranslate"><span class="pre">dir()</span></code>. Это значит, что он
теперь в текущем именном пространстве.</p>
<p>Чтобы вызвать какую-то функцию или метод из модуля os, надо указать
<code class="docutils literal notranslate"><span class="pre">os.</span></code> и затем имя объекта:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">os</span><span class="o">.</span><span class="n">getlogin</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;natasha&#39;</span>
</pre></div>
</div>
<p>Этот способ импорта хорош тем, что объекты модуля не попадают в именное
пространство текущей программы. То есть, если создать функцию с именем
getlogin(), она не будет конфликтовать с аналогичной функцией модуля os.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Если в имени файла содержится точка, стандартный способ
импортирования не будет работать. Для таких случаев используется
<a class="reference external" href="http://stackoverflow.com/questions/1828127/how-to-reference-python-package-when-filename-contains-a-period/1828249#1828249">другой
способ</a>.</p>
</div>
</div>
<div class="section" id="import-module-as">
<h5><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">module</span> <span class="pre">as</span></code><a class="headerlink" href="#import-module-as" title="Ссылка на этот заголовок">¶</a></h5>
<p>Конструкция <strong>import module as</strong> позволяет импортировать модуль под
другим именем (как правило, более коротким):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">subprocess</span> <span class="k">as</span> <span class="nn">sp</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">sp</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="s1">&#39;ping -c 2 -n  8.8.8.8&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;PING 8.8.8.8 (8.8.8.8): 56 data bytes</span><span class="se">\n</span><span class="s1">64 bytes from 8.8.8.8: icmp_seq=0 ttl=48 time=49.880 ms</span><span class="se">\n</span><span class="s1">64 bytes from 8.8.8.8: icmp_seq=1 ttl=48 time=46.875 ms</span><span class="se">\n\n</span><span class="s1">--- 8.8.8.8 ping statistics ---</span><span class="se">\n</span><span class="s1">2 packets transmitted, 2 packets received, 0.0% packet loss</span><span class="se">\n</span><span class="s1">round-trip min/avg/max/stddev = 46.875/48.377/49.880/1.503 ms</span><span class="se">\n</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="from-module-import-object">
<h5><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">object</span></code><a class="headerlink" href="#from-module-import-object" title="Ссылка на этот заголовок">¶</a></h5>
<p>Вариант <strong>from module import object</strong> удобно использовать, когда из
всего модуля нужны только одна-две функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">getlogin</span><span class="p">,</span> <span class="n">getcwd</span>
</pre></div>
</div>
<p>Теперь эти функции доступны в текущем именном пространстве:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;In&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Out&#39;</span><span class="p">,</span>
 <span class="o">...</span>
 <span class="s1">&#39;exit&#39;</span><span class="p">,</span>
 <span class="s1">&#39;get_ipython&#39;</span><span class="p">,</span>
 <span class="s1">&#39;getcwd&#39;</span><span class="p">,</span>
 <span class="s1">&#39;getlogin&#39;</span><span class="p">,</span>
 <span class="s1">&#39;quit&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Их можно вызывать без имени модуля:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">getlogin</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;natasha&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">getcwd</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;/Users/natasha/Desktop/Py_net_eng/code_test&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="from-module-import">
<h5><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code><a class="headerlink" href="#from-module-import" title="Ссылка на этот заголовок">¶</a></h5>
<p>Вариант <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code> импортирует все имена модуля в
текущее именное пространство:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;EX_CANTCREAT&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EX_CONFIG&#39;</span><span class="p">,</span>
 <span class="o">...</span>
 <span class="s1">&#39;wait&#39;</span><span class="p">,</span>
 <span class="s1">&#39;wait3&#39;</span><span class="p">,</span>
 <span class="s1">&#39;wait4&#39;</span><span class="p">,</span>
 <span class="s1">&#39;waitpid&#39;</span><span class="p">,</span>
 <span class="s1">&#39;walk&#39;</span><span class="p">,</span>
 <span class="s1">&#39;write&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">dir</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">218</span>
</pre></div>
</div>
<p>В модуле os очень много объектов, поэтому вывод сокращен. В конце
указана длина списка имен текущего именного пространства.</p>
<p>Такой вариант импорта лучше не использовать. При таком импорте по коду
непонятно, что какая-то функция взята, например, из модуля os. Это
заметно усложняет понимание кода.</p>
</div>
</div>
<span id="document-book/11_modules/create"></span><div class="section" id="id1">
<h4>Создание своих модулей<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Модуль - это файл с расширением .py и кодом Python.</p>
<p>Пример создания своих модулей и импорта функции из одного модуля в другой.</p>
<p>Файл check_ip_function.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipaddress</span>


<span class="k">def</span> <span class="nf">check_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="n">ip1</span> <span class="o">=</span> <span class="s1">&#39;10.1.1.1&#39;</span>
<span class="n">ip2</span> <span class="o">=</span> <span class="s1">&#39;10.1.1&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Проверка IP...&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ip1</span><span class="p">,</span> <span class="n">check_ip</span><span class="p">(</span><span class="n">ip1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ip2</span><span class="p">,</span> <span class="n">check_ip</span><span class="p">(</span><span class="n">ip2</span><span class="p">))</span>
</pre></div>
</div>
<p>В файле check_ip_function.py создана функция check_ip,
которая проверяет, что аргумент является IP-адресом.
Тут проверка выполняется с помощью модуля ipaddress,
который будет рассматриваться в следующем разделе.</p>
<p>Функция ipaddress.ip_address сама проверяет правильность IP-адреса
и генерирует исключение ValueError, если адрес не прошел проверку.
Функция check_ip возвращает True, если адрес прошел проверку и False - если нет.</p>
<p>Если запустить скрипт check_ip_function.py вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python check_ip_function.py
Проверка IP...
10.1.1.1 True
10.1.1 False
</pre></div>
</div>
<p>Второй скрипт импортирует функцию check_ip и использует ее для того
чтобы из списка адресов отобрать только те, которые прошли проверку
(файл get_correct_ip.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">check_ip_function</span> <span class="kn">import</span> <span class="n">check_ip</span>


<span class="k">def</span> <span class="nf">return_correct_ip</span><span class="p">(</span><span class="n">ip_addresses</span><span class="p">):</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">ip_addresses</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">check_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
            <span class="n">correct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">correct</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Проверка списка IP-адресов&#39;</span><span class="p">)</span>
<span class="n">ip_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;8.8.8.8&#39;</span><span class="p">,</span> <span class="s1">&#39;2.2.2&#39;</span><span class="p">]</span>
<span class="n">correct</span> <span class="o">=</span> <span class="n">return_correct_ip</span><span class="p">(</span><span class="n">ip_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">correct</span><span class="p">)</span>
</pre></div>
</div>
<p>В первой строке выполняется импорт функции check_ip из модуля
check_ip_function.py.</p>
<p>Результат выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python get_correct_ip.py
Проверка IP...
10.1.1.1 True
10.1.1 False
Проверка списка IP-адресов
[&#39;10.1.1.1&#39;, &#39;8.8.8.8&#39;]
</pre></div>
</div>
<p>Обратите внимание, что выведена не только информация из скрипта get_correct_ip.py,
но и информация из скрипта check_ip_function.py.
Так происходит из-за того, что любая разновидность import выполняет весь скрипт.
То есть, даже когда импорт выглядит как <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">check_ip_function</span> <span class="pre">import</span> <span class="pre">check_ip</span></code>,
выполняется весь скрипт check_ip_function.py, а не только функция check_ip.
В итоге будут выводиться все сообщения импортируемого скрипта.</p>
<p>Сообщения из импортируемого скрипта не страшны, они мешают и только, хуже когда
скрипт выполнял что-то типа подключения к оборудованию и при импорте функции из него,
придется ждать пока это подключение выполнится.</p>
<p>В Python есть возможность указать, что некоторые строки не должны выполняться при импорте.
Это рассматривается в следующем подразделе.</p>
<p>Функцию return_correct_ip можно заменить filter или генератором списка,
выше используется более длинный, но скорее всего, пока что более понятный
вариант:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">check_ip</span><span class="p">,</span> <span class="n">ip_list</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;8.8.8.8&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="p">[</span><span class="n">ip</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">ip_list</span> <span class="k">if</span> <span class="n">check_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">)]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;8.8.8.8&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">return_correct_ip</span><span class="p">(</span><span class="n">ip_addresses</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="p">[</span><span class="n">ip</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">ip_addresses</span> <span class="k">if</span> <span class="n">check_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">)]</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">return_correct_ip</span><span class="p">(</span><span class="n">ip_list</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;8.8.8.8&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<span id="document-book/11_modules/if_name_main"></span><div class="section" id="if-name-main">
<h4><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;</span></code><a class="headerlink" href="#if-name-main" title="Ссылка на этот заголовок">¶</a></h4>
<p>Достаточно часто скрипт может выполняться и самостоятельно, и может быть
импортирован как модуль другим скриптом.
Так как импорт скрипта запускает этот скрипт, часто надо указать,
что какие-то строки не должны выполняться при импорте.</p>
<p>В предыдущем примере было два скрипта: check_ip_function.py и get_correct_ip.py.
И при запуске get_correct_ip.py, отображались print из check_ip_function.py.</p>
<p>В Python есть специальный прием, который позволяет указать, что какой-то
код не должен выполняться при импорте: все строки, которые находятся
в блоке <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code> не выполняются при импорте.</p>
<p>Переменная <code class="docutils literal notranslate"><span class="pre">__name__</span></code> - это специальная переменная, которая будет
равна <code class="docutils literal notranslate"><span class="pre">&quot;__main__&quot;</span></code>, только если файл запускается как основная программа, и
выставляется равной имени модуля при импорте модуля.
То есть, условие <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code> проверяет, был ли
файл запущен напрямую.</p>
<p>Как правило, в блок <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code> заносят все вызовы функций
и вывод информации на стандартный поток вывода.
То есть, в скрипте check_ip_function.py в этом блоке будет все, кроме импорта
и функции return_correct_ip:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipaddress</span>


<span class="k">def</span> <span class="nf">check_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ip1</span> <span class="o">=</span> <span class="s1">&#39;10.1.1.1&#39;</span>
    <span class="n">ip2</span> <span class="o">=</span> <span class="s1">&#39;10.1.1&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Проверка IP...&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ip1</span><span class="p">,</span> <span class="n">check_ip</span><span class="p">(</span><span class="n">ip1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ip2</span><span class="p">,</span> <span class="n">check_ip</span><span class="p">(</span><span class="n">ip2</span><span class="p">))</span>
</pre></div>
</div>
<p>Результат выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python check_ip_function.py
Проверка IP...
10.1.1.1 True
10.1.1 False
</pre></div>
</div>
<p>При запуске скрипта check_ip_function.py напрямую, выполняются все строки,
так как переменная <code class="docutils literal notranslate"><span class="pre">__name__</span></code> в этом случае равна <code class="docutils literal notranslate"><span class="pre">'__main__'</span></code>.</p>
<p>Скрипт get_correct_ip.py остается без изменений</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">check_ip_function</span> <span class="kn">import</span> <span class="n">check_ip</span>


<span class="k">def</span> <span class="nf">return_correct_ip</span><span class="p">(</span><span class="n">ip_addresses</span><span class="p">):</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">ip_addresses</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">check_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
            <span class="n">correct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">correct</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Проверка списка IP-адресов&#39;</span><span class="p">)</span>
<span class="n">ip_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;8.8.8.8&#39;</span><span class="p">,</span> <span class="s1">&#39;2.2.2&#39;</span><span class="p">]</span>
<span class="n">correct</span> <span class="o">=</span> <span class="n">return_correct_ip</span><span class="p">(</span><span class="n">ip_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">correct</span><span class="p">)</span>
</pre></div>
</div>
<p>Выполнение скрипта get_correct_ip.py выглядит таким образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python get_correct_ip.py
Проверка списка IP-адресов
[&#39;10.1.1.1&#39;, &#39;8.8.8.8&#39;]
</pre></div>
</div>
<p>Теперь вывод содержит только информацию из скрипта get_correct_ip.py.</p>
<p>В целом, лучше привыкнуть писать весь код, который вызывает функции и
выводит что-то на стандартный поток вывода, внутри блока
<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с 9 раздела, для заданий есть программные тесты,
с помощью которых можно проверить правильность выполнения заданий.
Для корректной работы с тестами, надо всегда писать вызов функции
в файле задания внутри блока <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code>.
Отсутствие этого блока будет вызывать ошибки, не во всех заданиях,
однако это все равно позволит избежать проблем.</p>
</div>
</div>
<span id="document-book/11_modules/module_search"></span><div class="section" id="id1">
<h4>Пути поиска модулей<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>При импорте модуля, Python сначала ищет модуль в стандартной библиотеке. Если
модуль не найден в стандартной библиотеке, поиск модуля идет в каталогах,
которые указаны в sys.path.</p>
<p>Содержимое sys.path состоит из:</p>
<ul class="simple">
<li>текущего каталога</li>
<li>каталогов, которые указаны в переменной PYTHONPATH</li>
<li>пути по умолчанию (зависят от установки Python)</li>
</ul>
<p>Пути поиска модулей хранятся в переменной sys.path:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">sys</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/usr/local/bin&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/usr/local/lib/python36.zip&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/usr/local/lib/python3.6&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/usr/local/lib/python3.6/lib-dynload&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/home/vagrant/.local/lib/python3.6/site-packages&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/usr/local/lib/python3.6/site-packages&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/usr/local/lib/python3.6/site-packages/IPython/extensions&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/home/vagrant/.ipython&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Аналогичный вывод, но внутри виртуального окружения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">sys</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;/home/vagrant/venv/pyneng-py3-8-0/bin&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/home/vagrant/venv/pyneng-py3-8-0/lib/python38.zip&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/home/vagrant/venv/pyneng-py3-8-0/lib/python3.8&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/home/vagrant/venv/pyneng-py3-8-0/lib/python3.8/lib-dynload&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/usr/local/lib/python3.8&#39;</span><span class="p">,</span>
 <span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/home/vagrant/venv/pyneng-py3-8-0/lib/python3.8/site-packages&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/home/vagrant/venv/pyneng-py3-8-0/lib/python3.8/site-packages/IPython/extensions&#39;</span><span class="p">,</span>
 <span class="s1">&#39;/home/vagrant/.ipython&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="id2">
<h5>Добавление своих скриптов в пути поиска модулей<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Добавить свой скрипт в пути поиска модулей нужно в том случае,
если этот скрипт нужно использовать в других скриптах, которые
находятся в разных каталогах.</p>
<p>Для добавления модулей в пути поиска есть несколько вариантов:</p>
<ol class="arabic simple">
<li>Переместить скрипт в каталог site-packages</li>
<li>Создать специальный файл с расширением pth в каталоге site-packages и написать
в этом файлы пути поиска модулей</li>
</ol>
<p>Конкретный путь каталога site-packages зависит от версии Python и того используете ли вы
виртуальное окружение.
Например, в последнем выводе <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> путь будет <code class="docutils literal notranslate"><span class="pre">'/home/vagrant/venv/pyneng-py3-8-0/lib/python3.8/site-packages'</span></code>.
Если переместить туда скрипт, его можно будет импортировать из любого другого скрипта.</p>
<p>Так как переносить файлы не всегда удобно, есть второй вариант - файлы pth.
Для этого варианта надо создать файл с любым именем в каталоге site-packages,
например, <code class="docutils literal notranslate"><span class="pre">my_scripts.pth</span></code> и написать в нем пути к нужным скриптам:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">pyneng</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="mi">11</span><span class="n">_modules</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">pyneng</span><span class="o">/</span><span class="n">exercises</span><span class="o">/</span><span class="mi">09</span><span class="n">_functions</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">pyneng</span><span class="o">/</span><span class="n">exercises</span><span class="o">/</span><span class="mi">11</span><span class="n">_modules</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">pyneng</span><span class="o">/</span><span class="n">exercises</span><span class="o">/</span><span class="mi">12</span><span class="n">_userful_modules</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Обратите внимание, что тут речь именно об использовании функций какого-то
вашего скрипта в других скриптах, не о запуске модуля из любого места в
файловой системе как утилиты. Это тоже можно сделать, <a class="reference external" href="https://advpyneng.readthedocs.io/ru/latest/book/03_click/setuptools.html">коротко о том как
установить скрипт с CLI интерфейсом как утилиту в ОС</a>.
Например, так устанавливалась утилита pyneng.</p>
</div>
</div>
</div>
<span id="document-book/11_modules/code_structure"></span><div class="section" id="id1">
<h4>Рекомендации по поводу расположения функций в коде<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>В <a class="reference external" href="https://pep8.org/">PEP8</a> нет рекомендаций по этому поводу.</p>
<p>Если скрипт в одном файле, обычно порядок такой:</p>
<ol class="arabic simple">
<li>shebang, file encoding</li>
<li>docstring модуля</li>
<li>импорт (модули стандартной библиотеки, сторонние модули, свои скрипты)</li>
<li>константы</li>
<li>все функции в условно произвольном порядке, тут уже надо самостоятельно решить как удобнее</li>
<li>функции/код для создания CLI если есть</li>
<li>Часто, если есть код который надо писать глобально создают функцию main</li>
<li><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;:</span></code> и вызов функции main или глобального кода, который вызывает функции</li>
</ol>
<p>При этом среди функций обычно выбирают для себя какой-то порядок, чтобы он был
плюс-минус однотипным в разных файлах. Например, сначала пишутся общие функцие,
которые не зависят от других функций в файле, потом те что зависят. При этом
обычно есть какой-то порядок выполнения действий: подключились на оборудование
и считали вывод, парсим его, записали результат в файл - тогда соблюдаем этот
порядок в функциях.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last"><a class="reference external" href="https://docs.python-guide.org/writing/structure/">О структуре больших проектов</a>.
И еще одна ссылка по этой же теме, с <a class="reference external" href="https://realpython.com/python-application-layouts/">примерами структуры проектов Flask/Django</a>.</p>
</div>
</div>
<span id="document-exercises/11_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 11.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию parse_cdp_neighbors, которая обрабатывает вывод команды show cdp neighbors.</p>
<p>У функции должен быть один параметр command_output, который ожидает как аргумент вывод команды одной строкой (не имя файла). Для этого надо считать все содержимое файла в строку,
а затем передать строку как аргумент функции (как передать вывод команды показано в коде ниже).</p>
<p>Функция должна возвращать словарь, который описывает соединения между устройствами.</p>
<p>Например, если как аргумент был передан такой вывод:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R4</span><span class="o">&gt;</span><span class="n">show</span> <span class="n">cdp</span> <span class="n">neighbors</span>

<span class="n">Device</span> <span class="n">ID</span>    <span class="n">Local</span> <span class="n">Intrfce</span>   <span class="n">Holdtme</span>     <span class="n">Capability</span>       <span class="n">Platform</span>    <span class="n">Port</span> <span class="n">ID</span>
<span class="n">R5</span>           <span class="n">Fa</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>          <span class="mi">122</span>           <span class="n">R</span> <span class="n">S</span> <span class="n">I</span>           <span class="mi">2811</span>       <span class="n">Fa</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">R6</span>           <span class="n">Fa</span> <span class="mi">0</span><span class="o">/</span><span class="mi">2</span>          <span class="mi">143</span>           <span class="n">R</span> <span class="n">S</span> <span class="n">I</span>           <span class="mi">2811</span>       <span class="n">Fa</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
</pre></div>
</div>
<p>Функция должна вернуть такой словарь:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/1&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R5&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/1&quot;</span><span class="p">),</span>
 <span class="p">(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/2&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R6&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/0&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<p>В словаре интерфейсы должны быть записаны без пробела между типом и именем. То есть так Fa0/0, а не так Fa 0/0.</p>
<p>Проверить работу функции на содержимом файла sh_cdp_n_sw1.txt. При этом функция работать
и на других файлах (тест проверяет работу функции на выводе из sh_cdp_n_sw1.txt и sh_cdp_n_r3.txt).</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_cdp_neighbors</span><span class="p">(</span><span class="n">command_output</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Тут мы передаем вывод команды одной строкой потому что именно в таком виде</span>
<span class="sd">    будет получен вывод команды с оборудования. Принимая как аргумент вывод</span>
<span class="sd">    команды, вместо имени файла, мы делаем функцию более универсальной: она может</span>
<span class="sd">    работать и с файлами и с выводом с оборудования.</span>
<span class="sd">    Плюс учимся работать с таким выводом.</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;sh_cdp_n_sw1.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">parse_cdp_neighbors</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Задание 11.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию create_network_map, которая обрабатывает
вывод команды show cdp neighbors из нескольких файлов и объединяет его в одну
общую топологию.</p>
<p>У функции должен быть один параметр filenames, который ожидает как аргумент
список с именами файлов, в которых находится вывод команды show cdp neighbors.</p>
<p>Функция должна возвращать словарь, который описывает соединения между
устройствами. Структура словаря такая же, как в задании 11.1:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/1&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R5&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/1&quot;</span><span class="p">),</span>
 <span class="p">(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/2&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R6&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/0&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Cгенерировать топологию, которая соответствует выводу из файлов:</p>
<ul class="simple">
<li>sh_cdp_n_sw1.txt</li>
<li>sh_cdp_n_r1.txt</li>
<li>sh_cdp_n_r2.txt</li>
<li>sh_cdp_n_r3.txt</li>
</ul>
<p>Не копировать код функций parse_cdp_neighbors и draw_topology.
Если функция parse_cdp_neighbors не может обработать вывод одного из файлов
с выводом команды, надо исправить код функции в задании 11.1.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">infiles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;sh_cdp_n_sw1.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sh_cdp_n_r1.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sh_cdp_n_r2.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sh_cdp_n_r3.txt&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 11.2a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p>Для выполнения этого задания, должен быть установлен graphviz:
<code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">graphviz</span></code></p>
<p class="last">И модуль python для работы с graphviz:
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">graphviz</span></code></p>
</div>
<p>С помощью функции create_network_map из задания 11.2 создать словарь topology
с описанием топологии для файлов:</p>
<ul class="simple">
<li>sh_cdp_n_sw1.txt</li>
<li>sh_cdp_n_r1.txt</li>
<li>sh_cdp_n_r2.txt</li>
<li>sh_cdp_n_r3.txt</li>
</ul>
<p>С помощью функции draw_topology из файла draw_network_graph.py нарисовать
схему для словаря topology, полученного с помощью create_network_map.
Как работать с функцией draw_topology надо разобраться самостоятельно,
почитав описание функции в файле draw_network_graph.py.
Полученная схема будет записана в файл svg - его можно открыть браузером.</p>
<p>С текущим словарем topology на схеме нарисованы лишние соединения. Они
возникают потому что в одном файле CDP (sh_cdp_n_r1.txt) описывается соединение</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>а в другом (sh_cdp_n_sw1.txt)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/1&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>В этом задании надо создать новую функцию unique_network_map, которая из этих
двух соединений будет оставлять только одно, для корректного рисования схемы.
При этом все равно какое из соединений оставить.</p>
<p>У функции unique_network_map должен быть один параметр topology_dict,
который ожидает как аргумент словарь.
Это должен быть словарь полученный в результате выполнения
функции create_network_map из задания 11.2.</p>
<p>Пример словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/1&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/2&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/1&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;SW2&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/11&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;R3&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/3&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;R3&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/1&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;R3&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/2&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R5&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/1&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/2&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/3&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R3&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/5&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R6&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/1&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Функция должна возвращать словарь, который описывает соединения между
устройствами. В словаре надо избавиться от «дублирующих» соединений
и оставлять только одно из них.</p>
<p>Структура итогового словаря такая же, как в задании 11.2:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/1&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R5&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/1&quot;</span><span class="p">),</span>
 <span class="p">(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/2&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R6&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa0/0&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<p>После создания функции, попробовать еще раз нарисовать топологию,
теперь уже для словаря, который возвращает функция unique_network_map.</p>
<p>Результат должен выглядеть так же, как схема в файле task_11_2a_topology.svg</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/pyneng-examples-exercises/master/exercises/11_modules/task_11_2a_topology.png" src="https://raw.githubusercontent.com/natenka/pyneng-examples-exercises/master/exercises/11_modules/task_11_2a_topology.png" />
</div>
<p>При этом:</p>
<ul class="simple">
<li>Расположение устройств на схеме может быть другим</li>
<li>Соединения должны соответствовать схеме</li>
</ul>
<p>Не копировать код функций create_network_map и draw_topology.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">infiles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;sh_cdp_n_sw1.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sh_cdp_n_r1.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sh_cdp_n_r2.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sh_cdp_n_r3.txt&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/12_useful_modules/index"></span><div class="section" id="useful-modules-index">
<span id="id1"></span><h3>12. Полезные модули<a class="headerlink" href="#useful-modules-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>В этом разделе описаны такие модули:</p>
<ul class="simple">
<li>subprocess</li>
<li>os</li>
<li>ipaddress</li>
<li>pprint</li>
<li>tabulate</li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-book/12_useful_modules/subprocess"></span><div class="section" id="subprocess">
<h4>Модуль subprocess<a class="headerlink" href="#subprocess" title="Ссылка на этот заголовок">¶</a></h4>
<p>Модуль subprocess позволяет создавать новые процессы.
При этом он может подключаться к
<a class="reference external" href="http://xgu.ru/wiki/stdin">стандартным потокам ввода/вывода/ошибок</a>
и получать код возврата.</p>
<p>С помощью subprocess можно, например, выполнять любые команды Linux из
скрипта.
И в зависимости от ситуации получать вывод или только проверять, что
команда выполнилась без ошибок.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В Python 3.5 cинтаксис модуля subprocess изменился.</p>
</div>
<div class="section" id="subprocess-run">
<h5>Функция <code class="docutils literal notranslate"><span class="pre">subprocess.run</span></code><a class="headerlink" href="#subprocess-run" title="Ссылка на этот заголовок">¶</a></h5>
<p>Функция <code class="docutils literal notranslate"><span class="pre">subprocess.run</span></code> - основной способ работы с модулем
subprocess.</p>
<p>Самый простой вариант использования функции - запуск её таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">)</span>
<span class="n">ipython_as_mngmt_console</span><span class="o">.</span><span class="n">md</span>  <span class="n">README</span><span class="o">.</span><span class="n">md</span>         <span class="n">version_control</span><span class="o">.</span><span class="n">md</span>
<span class="n">module_search</span><span class="o">.</span><span class="n">md</span>             <span class="n">useful_functions</span>
<span class="n">naming_conventions</span>           <span class="n">useful_modules</span>
</pre></div>
</div>
<p>В переменной result теперь содержится специальный объект
CompletedProcess. Из этого объекта можно получить информацию о
выполнении процесса, например, о коде возврата:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">CompletedProcess</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="n">returncode</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Код 0 означает, что программа выполнилась успешно.</p>
<p>Если необходимо вызвать команду с аргументами, её
нужно передавать таким образом (как список):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="s1">&#39;-ls&#39;</span><span class="p">])</span>
<span class="n">total</span> <span class="mi">28</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>   <span class="mi">56</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">ipython_as_mngmt_console</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">1638</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">module_search</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">4096</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">naming_conventions</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>  <span class="mi">277</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">README</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">4096</span> <span class="n">Jun</span> <span class="mi">16</span> <span class="mi">05</span><span class="p">:</span><span class="mi">11</span> <span class="n">useful_functions</span>
<span class="mi">4</span> <span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">4096</span> <span class="n">Jun</span> <span class="mi">17</span> <span class="mi">16</span><span class="p">:</span><span class="mi">28</span> <span class="n">useful_modules</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>   <span class="mi">49</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">version_control</span><span class="o">.</span><span class="n">md</span>
</pre></div>
</div>
<p>При попытке выполнить команду с использованием wildcard-выражений,
например, использовать <code class="docutils literal notranslate"><span class="pre">*</span></code>, возникнет ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="s1">&#39;-ls&#39;</span><span class="p">,</span> <span class="s1">&#39;*md&#39;</span><span class="p">])</span>
<span class="n">ls</span><span class="p">:</span> <span class="n">cannot</span> <span class="n">access</span> <span class="o">*</span><span class="n">md</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
</pre></div>
</div>
<p>Чтобы вызывать команды, в которых используются wildcard-выражения, нужно
добавлять аргумент shell и вызывать команду таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;ls -ls *md&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>   <span class="mi">56</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">ipython_as_mngmt_console</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">1638</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">module_search</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>  <span class="mi">277</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">README</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>   <span class="mi">49</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">version_control</span><span class="o">.</span><span class="n">md</span>
</pre></div>
</div>
<p>Ещё одна особенность функции <code class="docutils literal notranslate"><span class="pre">run</span></code> - она ожидает завершения выполнения
команды. Если попробовать, например, запустить команду ping, то этот
аспект будет заметен:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ping&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;8.8.8.8&#39;</span><span class="p">])</span>
<span class="n">PING</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span> <span class="p">(</span><span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">43</span> <span class="n">time</span><span class="o">=</span><span class="mf">55.1</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">43</span> <span class="n">time</span><span class="o">=</span><span class="mf">54.7</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">3</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">43</span> <span class="n">time</span><span class="o">=</span><span class="mf">54.4</span> <span class="n">ms</span>

<span class="o">---</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
<span class="mi">3</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">3</span> <span class="n">received</span><span class="p">,</span> <span class="mi">0</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span><span class="p">,</span> <span class="n">time</span> <span class="mi">2004</span><span class="n">ms</span>
<span class="n">rtt</span> <span class="nb">min</span><span class="o">/</span><span class="n">avg</span><span class="o">/</span><span class="nb">max</span><span class="o">/</span><span class="n">mdev</span> <span class="o">=</span> <span class="mf">54.498</span><span class="o">/</span><span class="mf">54.798</span><span class="o">/</span><span class="mf">55.116</span><span class="o">/</span><span class="mf">0.252</span> <span class="n">ms</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h5>Получение результата выполнения команды<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>По умолчанию функция run возвращает результат выполнения команды на
стандартный поток вывода.
Если нужно получить результат выполнения команды, надо добавить аргумент
stdout и указать ему значение subprocess.PIPE:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="s1">&#39;-ls&#39;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь можно получить результат выполнения команды таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="sa">b</span><span class="s1">&#39;total 28</span><span class="se">\n</span><span class="s1">4 -rw-r--r-- 1 vagrant vagrant   56 Jun  7 19:35 ipython_as_mngmt_console.md</span><span class="se">\n</span><span class="s1">4 -rw-r--r-- 1 vagrant vagrant 1638 Jun  7 19:35 module_search.md</span><span class="se">\n</span><span class="s1">4 drwxr-xr-x 2 vagrant vagrant 4096 Jun  7 19:35 naming_conventions</span><span class="se">\n</span><span class="s1">4 -rw-r--r-- 1 vagrant vagrant  277 Jun  7 19:35 README.md</span><span class="se">\n</span><span class="s1">4 drwxr-xr-x 2 vagrant vagrant 4096 Jun 16 05:11 useful_functions</span><span class="se">\n</span><span class="s1">4 drwxr-xr-x 2 vagrant vagrant 4096 Jun 17 16:30 useful_modules</span><span class="se">\n</span><span class="s1">4 -rw-r--r-- 1 vagrant vagrant   49 Jun  7 19:35 version_control.md</span><span class="se">\n</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Обратите внимание на букву b перед строкой. Она означает, что модуль
вернул вывод в виде байтовой строки.
Для перевода её в unicode есть два варианта:</p>
<ul class="simple">
<li>выполнить decode полученной строки</li>
<li>указать аргумент encoding</li>
</ul>
<p>Вариант с decode:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<span class="n">total</span> <span class="mi">28</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>   <span class="mi">56</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">ipython_as_mngmt_console</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">1638</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">module_search</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">4096</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">naming_conventions</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>  <span class="mi">277</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">README</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">4096</span> <span class="n">Jun</span> <span class="mi">16</span> <span class="mi">05</span><span class="p">:</span><span class="mi">11</span> <span class="n">useful_functions</span>
<span class="mi">4</span> <span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">4096</span> <span class="n">Jun</span> <span class="mi">17</span> <span class="mi">16</span><span class="p">:</span><span class="mi">30</span> <span class="n">useful_modules</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>   <span class="mi">49</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">version_control</span><span class="o">.</span><span class="n">md</span>
</pre></div>
</div>
<p>Вариант с encoding:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="s1">&#39;-ls&#39;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">total</span> <span class="mi">28</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>   <span class="mi">56</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">ipython_as_mngmt_console</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">1638</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">module_search</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">4096</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">naming_conventions</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>  <span class="mi">277</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">README</span><span class="o">.</span><span class="n">md</span>
<span class="mi">4</span> <span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">4096</span> <span class="n">Jun</span> <span class="mi">16</span> <span class="mi">05</span><span class="p">:</span><span class="mi">11</span> <span class="n">useful_functions</span>
<span class="mi">4</span> <span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">4096</span> <span class="n">Jun</span> <span class="mi">17</span> <span class="mi">16</span><span class="p">:</span><span class="mi">31</span> <span class="n">useful_modules</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span>   <span class="mi">49</span> <span class="n">Jun</span>  <span class="mi">7</span> <span class="mi">19</span><span class="p">:</span><span class="mi">35</span> <span class="n">version_control</span><span class="o">.</span><span class="n">md</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Отключение вывода<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Иногда достаточно получения кода возврата и нужно отключить вывод
результата выполнения на стандартный поток вывода, и при этом сам
результат не нужен.
Это можно сделать, передав функции run аргумент stdout со значением
subprocess.DEVNULL:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="s1">&#39;-ls&#39;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="kc">None</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>
<span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Работа со стандартным потоком ошибок<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если команда была выполнена с ошибкой или не отработала корректно, вывод
команды попадет на стандартный поток ошибок.</p>
<p>Получить этот вывод можно так же, как и стандартный поток вывода:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ping&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь в result.stdout пустая строка, а в result.stderr находится
стандартный поток вывода:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="kc">None</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="n">ping</span><span class="p">:</span> <span class="n">unknown</span> <span class="n">host</span> <span class="n">a</span>


<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>
<span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Примеры использования модуля<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Пример использования модуля subprocess (файл subprocess_run_basic.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">reply</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ping&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;8.8.8.8&#39;</span><span class="p">])</span>

<span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Alive&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unreachable&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Результат выполнения будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python subprocess_run_basic.py
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=43 time=54.0 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=43 time=54.4 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=43 time=53.9 ms

--- 8.8.8.8 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2005ms
rtt min/avg/max/mdev = 53.962/54.145/54.461/0.293 ms
Alive
</pre></div>
</div>
<p>То есть, результат выполнения команды выводится на стандартный поток
вывода.</p>
<p>Функция ping_ip проверяет доступность IP-адреса и возвращает True и
stdout, если адрес доступен, или False и stderr, если адрес недоступен
(файл subprocess_ping_function.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>


<span class="k">def</span> <span class="nf">ping_ip</span><span class="p">(</span><span class="n">ip_address</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ping IP address and return tuple:</span>
<span class="sd">    On success:</span>
<span class="sd">        * True</span>
<span class="sd">        * command output (stdout)</span>
<span class="sd">    On failure:</span>
<span class="sd">        * False</span>
<span class="sd">        * error output (stderr)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ping&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">],</span>
                           <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                           <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                           <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">reply</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">reply</span><span class="o">.</span><span class="n">stderr</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ping_ip</span><span class="p">(</span><span class="s1">&#39;8.8.8.8&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ping_ip</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Результат выполнения будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python subprocess_ping_function.py
(True, &#39;PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=43 time=63.8 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=43 time=55.6 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=43 time=55.9 ms\n\n--- 8.8.8.8 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2003ms\nrtt min/avg/max/mdev = 55.643/58.492/63.852/3.802 ms\n&#39;)
(False, &#39;ping: unknown host a\n&#39;)
</pre></div>
</div>
</div>
</div>
<span id="document-book/12_useful_modules/os"></span><div class="section" id="os">
<h4>Модуль os<a class="headerlink" href="#os" title="Ссылка на этот заголовок">¶</a></h4>
<p>Модуль <code class="docutils literal notranslate"><span class="pre">os</span></code> позволяет работать с файловой системой, с окружением,
управлять процессами.</p>
<p>В этом подразделе рассматриваются лишь несколько полезных возможностей. За более полным
описанием возможностей модуля можно обратиться к
<a class="reference external" href="https://docs.python.org/3/library/os.html">документации</a> или
<a class="reference external" href="https://pymotw.com/3/os/">статье на сайте PyMOTW</a>.</p>
<p>Модуль os позволяет создавать каталоги:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">os</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">ls</span> <span class="o">-</span><span class="n">ls</span>
<span class="n">total</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">nata</span>  <span class="n">nata</span>  <span class="mi">68</span> <span class="n">Jan</span> <span class="mi">23</span> <span class="mi">18</span><span class="p">:</span><span class="mi">58</span> <span class="n">test</span><span class="o">/</span>
</pre></div>
</div>
<p>Кроме того, в модуле есть соответствующие проверки на существование.
Например, если попробовать повторно создать каталог, возникнет ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">FileExistsError</span>                           <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">cbf3b897c095</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>

<span class="ne">FileExistsError</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">17</span><span class="p">]</span> <span class="n">File</span> <span class="n">exists</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span>
</pre></div>
</div>
<p>В таком случае пригодится проверка <code class="docutils literal notranslate"><span class="pre">os.path.exists</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Метод listdir позволяет посмотреть содержимое каталога:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;cover3.png&#39;</span><span class="p">,</span> <span class="s1">&#39;dir2&#39;</span><span class="p">,</span> <span class="s1">&#39;dir3&#39;</span><span class="p">,</span> <span class="s1">&#39;README.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>С помощью проверок <code class="docutils literal notranslate"><span class="pre">os.path.isdir</span></code> и <code class="docutils literal notranslate"><span class="pre">os.path.isfile</span></code> можно получить
отдельно список файлов и список каталогов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">d</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">dirs</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;dir2&#39;</span><span class="p">,</span> <span class="s1">&#39;dir3&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">files</span> <span class="o">=</span> <span class="p">[</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">files</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;cover3.png&#39;</span><span class="p">,</span> <span class="s1">&#39;README.txt&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Также в модуле есть отдельные методы для работы с путями:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;Programming/PyNEng/book/25_additional_info/README.md&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="s1">&#39;README.md&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="s1">&#39;Programming/PyNEng/book/25_additional_info&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;Programming/PyNEng/book/25_additional_info&#39;</span><span class="p">,</span> <span class="s1">&#39;README.md&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<span id="document-book/12_useful_modules/ipaddress"></span><div class="section" id="ipaddress">
<h4>Модуль ipaddress<a class="headerlink" href="#ipaddress" title="Ссылка на этот заголовок">¶</a></h4>
<p>Модуль ipaddress упрощает работу с IP-адресами.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">С версии Python 3.3 модуль ipaddress входит в стандартную библиотеку
Python.</p>
</div>
<div class="section" id="ipaddress-ip-address">
<h5><code class="docutils literal notranslate"><span class="pre">ipaddress.ip_address</span></code><a class="headerlink" href="#ipaddress-ip-address" title="Ссылка на этот заголовок">¶</a></h5>
<p>Функция <code class="docutils literal notranslate"><span class="pre">ipaddress.ip_address</span></code> позволяет создавать объект
IPv4Address или IPv6Address соответственно:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">ipaddress</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">ipv4</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="s1">&#39;10.0.1.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">ipv4</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;10.0.1.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">ipv4</span><span class="p">)</span>
<span class="mf">10.0</span><span class="o">.</span><span class="mf">1.1</span>
</pre></div>
</div>
<p>У объекта есть несколько методов и атрибутов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">ipv4</span><span class="o">.</span>
<span class="n">ipv4</span><span class="o">.</span><span class="n">compressed</span>       <span class="n">ipv4</span><span class="o">.</span><span class="n">is_loopback</span>      <span class="n">ipv4</span><span class="o">.</span><span class="n">is_unspecified</span>   <span class="n">ipv4</span><span class="o">.</span><span class="n">version</span>
<span class="n">ipv4</span><span class="o">.</span><span class="n">exploded</span>         <span class="n">ipv4</span><span class="o">.</span><span class="n">is_multicast</span>     <span class="n">ipv4</span><span class="o">.</span><span class="n">max_prefixlen</span>
<span class="n">ipv4</span><span class="o">.</span><span class="n">is_global</span>        <span class="n">ipv4</span><span class="o">.</span><span class="n">is_private</span>       <span class="n">ipv4</span><span class="o">.</span><span class="n">packed</span>
<span class="n">ipv4</span><span class="o">.</span><span class="n">is_link_local</span>    <span class="n">ipv4</span><span class="o">.</span><span class="n">is_reserved</span>      <span class="n">ipv4</span><span class="o">.</span><span class="n">reverse_pointer</span>
</pre></div>
</div>
<p>С помощью атрибутов <code class="docutils literal notranslate"><span class="pre">is_</span></code> можно проверить, к какому диапазону принадлежит
адрес:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">ipv4</span><span class="o">.</span><span class="n">is_loopback</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">ipv4</span><span class="o">.</span><span class="n">is_multicast</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">ipv4</span><span class="o">.</span><span class="n">is_reserved</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">ipv4</span><span class="o">.</span><span class="n">is_private</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>С полученными объектами можно выполнять различные операции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="s1">&#39;10.0.1.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">ip2</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="s1">&#39;10.0.2.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">&gt;</span> <span class="n">ip2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">ip2</span> <span class="o">&gt;</span> <span class="n">ip1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">==</span> <span class="n">ip2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">!=</span> <span class="n">ip2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ip1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;10.0.1.1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="n">ip1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="mi">167772417</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">+</span> <span class="mi">5</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;10.0.1.6&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">-</span> <span class="mi">5</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;10.0.0.252&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="ipaddress-ip-network">
<h5><code class="docutils literal notranslate"><span class="pre">ipaddress.ip_network</span></code><a class="headerlink" href="#ipaddress-ip-network" title="Ссылка на этот заголовок">¶</a></h5>
<p>Функция <code class="docutils literal notranslate"><span class="pre">ipaddress.ip_network</span></code> позволяет создать объект, который
описывает сеть (IPv4 или IPv6):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">subnet1</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="s1">&#39;80.0.1.0/28&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Как и у адреса, у сети есть различные атрибуты и методы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">subnet1</span><span class="o">.</span><span class="n">broadcast_address</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.15&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">subnet1</span><span class="o">.</span><span class="n">with_netmask</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="s1">&#39;80.0.1.0/255.255.255.240&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">subnet1</span><span class="o">.</span><span class="n">with_hostmask</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="s1">&#39;80.0.1.0/0.0.0.15&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">subnet1</span><span class="o">.</span><span class="n">prefixlen</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="mi">28</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">subnet1</span><span class="o">.</span><span class="n">num_addresses</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="mi">16</span>
</pre></div>
</div>
<p>Метод <code class="docutils literal notranslate"><span class="pre">hosts</span></code> возвращает генератор, поэтому, чтобы посмотреть все хосты,
надо применить функцию <code class="docutils literal notranslate"><span class="pre">list</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">subnet1</span><span class="o">.</span><span class="n">hosts</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span>
<span class="p">[</span><span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.1&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.2&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.3&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.4&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.5&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.6&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.7&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.8&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.9&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.10&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.11&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.12&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.13&#39;</span><span class="p">),</span>
 <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.14&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Метод subnets позволяет разбивать на подсети. По умолчанию он разбивает
сеть на две подсети:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">subnet1</span><span class="o">.</span><span class="n">subnets</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="p">[</span><span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.0/29&#39;</span><span class="p">),</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.8/29&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Параметр prefixlen_diff позволяет указать количество бит
для подсетей:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">subnet1</span><span class="o">.</span><span class="n">subnets</span><span class="p">(</span><span class="n">prefixlen_diff</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span>
<span class="p">[</span><span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.0/30&#39;</span><span class="p">),</span>
 <span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.4/30&#39;</span><span class="p">),</span>
 <span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.8/30&#39;</span><span class="p">),</span>
 <span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.12/30&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>С помощью параметра new_prefix можно указать, какая маска должна
быть у подсетей:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">subnet1</span><span class="o">.</span><span class="n">subnets</span><span class="p">(</span><span class="n">new_prefix</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span>
<span class="p">[</span><span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.0/30&#39;</span><span class="p">),</span>
 <span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.4/30&#39;</span><span class="p">),</span>
 <span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.8/30&#39;</span><span class="p">),</span>
 <span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.12/30&#39;</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">subnet1</span><span class="o">.</span><span class="n">subnets</span><span class="p">(</span><span class="n">new_prefix</span><span class="o">=</span><span class="mi">29</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="p">[</span><span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.0/29&#39;</span><span class="p">),</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;80.0.1.8/29&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>По IP-адресам в сети можно проходиться в цикле:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">subnet1</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.0</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.1</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.2</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.3</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.4</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.5</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.6</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.7</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.8</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.9</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.10</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.11</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.12</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.13</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.14</span>
<span class="mf">80.0</span><span class="o">.</span><span class="mf">1.15</span>
</pre></div>
</div>
<p>Или обращаться к конкретному адресу:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">subnet1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.0&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">subnet1</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;80.0.1.5&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Таким образом можно проверять, находится ли IP-адрес в сети:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="s1">&#39;80.0.1.3&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">ip1</span> <span class="ow">in</span> <span class="n">subnet1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="ipaddress-ip-interface">
<h5><code class="docutils literal notranslate"><span class="pre">ipaddress.ip_interface</span></code><a class="headerlink" href="#ipaddress-ip-interface" title="Ссылка на этот заголовок">¶</a></h5>
<p>Функция <code class="docutils literal notranslate"><span class="pre">ipaddress.ip_interface</span></code> позволяет создавать объект
IPv4Interface или IPv6Interface соответственно:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">int1</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_interface</span><span class="p">(</span><span class="s1">&#39;10.0.1.1/24&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Используя методы объекта IPv4Interface, можно получать адрес, маску или
сеть интерфейса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">int1</span><span class="o">.</span><span class="n">ip</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;10.0.1.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">int1</span><span class="o">.</span><span class="n">network</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;10.0.1.0/24&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">int1</span><span class="o">.</span><span class="n">netmask</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;255.255.255.0&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h5>Пример использования модуля<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Так как в модуль встроены проверки корректности адресов, можно ими
пользоваться, например, чтобы проверить, является ли адрес адресом сети
или хоста:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">IP1</span> <span class="o">=</span> <span class="s1">&#39;10.0.1.1/24&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">IP2</span> <span class="o">=</span> <span class="s1">&#39;10.0.1.0/24&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">check_if_ip_is_network</span><span class="p">(</span><span class="n">ip_address</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">try</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="n">ip_address</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">True</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
   <span class="o">....</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">....</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">check_if_ip_is_network</span><span class="p">(</span><span class="n">IP1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">check_if_ip_is_network</span><span class="p">(</span><span class="n">IP2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/12_useful_modules/tabulate"></span><div class="section" id="tabulate">
<h4>Модуль tabulate<a class="headerlink" href="#tabulate" title="Ссылка на этот заголовок">¶</a></h4>
<p>tabulate - это модуль, который позволяет красиво отображать
табличные данные. Он не входит в стандартную библиотеку Python,
поэтому tabulate нужно установить:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">tabulate</span>
</pre></div>
</div>
<p>Модуль поддерживает такие типы табличных данных:</p>
<ul class="simple">
<li>список списков (в общем случае iterable of iterables)</li>
<li>список словарей (или любой другой итерируемый объект со словарями). Ключи используются как имена столбцов</li>
<li>словарь с итерируемыми объектами. Ключи используются как имена столбцов</li>
</ul>
<p>Для генерации таблицы используется функция tabulate:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">sh_ip_int_br</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;15.0.15.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
   <span class="o">...</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.12.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
   <span class="o">...</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;FastEthernet0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.13.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
   <span class="o">...</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;Loopback0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
   <span class="o">...</span><span class="p">:</span>  <span class="p">(</span><span class="s1">&#39;Loopback100&#39;</span><span class="p">,</span> <span class="s1">&#39;100.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">)]</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">sh_ip_int_br</span><span class="p">))</span>
<span class="o">---------------</span>  <span class="o">---------</span>  <span class="o">--</span>  <span class="o">--</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span>  <span class="mf">15.0</span><span class="o">.</span><span class="mf">15.1</span>  <span class="n">up</span>  <span class="n">up</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.1</span>  <span class="n">up</span>  <span class="n">up</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">2</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.1</span>  <span class="n">up</span>  <span class="n">up</span>
<span class="n">Loopback0</span>        <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>   <span class="n">up</span>  <span class="n">up</span>
<span class="n">Loopback100</span>      <span class="mf">100.0</span><span class="o">.</span><span class="mf">0.1</span>  <span class="n">up</span>  <span class="n">up</span>
<span class="o">---------------</span>  <span class="o">---------</span>  <span class="o">--</span>  <span class="o">--</span>
</pre></div>
</div>
<div class="section" id="headers">
<h5>headers<a class="headerlink" href="#headers" title="Ссылка на этот заголовок">¶</a></h5>
<p>Параметр headers позволяет передавать дополнительный аргумент, в котором
указаны имена столбцов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Interface&#39;</span><span class="p">,</span> <span class="s1">&#39;IP&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="s1">&#39;Protocol&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">sh_ip_int_br</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">columns</span><span class="p">))</span>
<span class="n">Interface</span>        <span class="n">IP</span>         <span class="n">Status</span>    <span class="n">Protocol</span>
<span class="o">---------------</span>  <span class="o">---------</span>  <span class="o">--------</span>  <span class="o">----------</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span>  <span class="mf">15.0</span><span class="o">.</span><span class="mf">15.1</span>  <span class="n">up</span>        <span class="n">up</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.1</span>  <span class="n">up</span>        <span class="n">up</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">2</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.1</span>  <span class="n">up</span>        <span class="n">up</span>
<span class="n">Loopback0</span>        <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>   <span class="n">up</span>        <span class="n">up</span>
<span class="n">Loopback100</span>      <span class="mf">100.0</span><span class="o">.</span><span class="mf">0.1</span>  <span class="n">up</span>        <span class="n">up</span>
</pre></div>
</div>
<p>Достаточно часто первый набор данных - это заголовки. Тогда достаточно
указать headers равным «firstrow»:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">data</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span>
<span class="p">[(</span><span class="s1">&#39;Interface&#39;</span><span class="p">,</span> <span class="s1">&#39;IP&#39;</span><span class="p">,</span> <span class="s1">&#39;Status&#39;</span><span class="p">,</span> <span class="s1">&#39;Protocol&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;15.0.15.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.12.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;FastEthernet0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.13.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;Loopback0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;Loopback100&#39;</span><span class="p">,</span> <span class="s1">&#39;100.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;firstrow&#39;</span><span class="p">))</span>
<span class="n">Interface</span>        <span class="n">IP</span>         <span class="n">Status</span>    <span class="n">Protocol</span>
<span class="o">---------------</span>  <span class="o">---------</span>  <span class="o">--------</span>  <span class="o">----------</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span>  <span class="mf">15.0</span><span class="o">.</span><span class="mf">15.1</span>  <span class="n">up</span>        <span class="n">up</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.1</span>  <span class="n">up</span>        <span class="n">up</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">2</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.1</span>  <span class="n">up</span>        <span class="n">up</span>
<span class="n">Loopback0</span>        <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>   <span class="n">up</span>        <span class="n">up</span>
<span class="n">Loopback100</span>      <span class="mf">100.0</span><span class="o">.</span><span class="mf">0.1</span>  <span class="n">up</span>        <span class="n">up</span>
</pre></div>
</div>
<p>Если данные в виде списка словарей, надо указать headers равным «keys»:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">list_of_dict</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span>
<span class="p">[{</span><span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;15.0.15.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Interface&#39;</span><span class="p">:</span> <span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.0.12.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Interface&#39;</span><span class="p">:</span> <span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.0.13.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Interface&#39;</span><span class="p">:</span> <span class="s1">&#39;FastEthernet0/2&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Interface&#39;</span><span class="p">:</span> <span class="s1">&#39;Loopback0&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;100.0.0.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Interface&#39;</span><span class="p">:</span> <span class="s1">&#39;Loopback100&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">}]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">list_of_dict</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">))</span>
<span class="n">Interface</span>        <span class="n">IP</span>         <span class="n">Status</span>    <span class="n">Protocol</span>
<span class="o">---------------</span>  <span class="o">---------</span>  <span class="o">--------</span>  <span class="o">----------</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span>  <span class="mf">15.0</span><span class="o">.</span><span class="mf">15.1</span>  <span class="n">up</span>        <span class="n">up</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.1</span>  <span class="n">up</span>        <span class="n">up</span>
<span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">2</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.1</span>  <span class="n">up</span>        <span class="n">up</span>
<span class="n">Loopback0</span>        <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>   <span class="n">up</span>        <span class="n">up</span>
<span class="n">Loopback100</span>      <span class="mf">100.0</span><span class="o">.</span><span class="mf">0.1</span>  <span class="n">up</span>        <span class="n">up</span>
</pre></div>
</div>
<p>Отображение словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">vlans</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sw1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span> <span class="s2">&quot;sw2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="s2">&quot;sw3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">vlans</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;keys&quot;</span><span class="p">))</span>
  <span class="n">sw1</span>    <span class="n">sw2</span>    <span class="n">sw3</span>
<span class="o">-----</span>  <span class="o">-----</span>  <span class="o">-----</span>
   <span class="mi">10</span>      <span class="mi">1</span>      <span class="mi">1</span>
   <span class="mi">20</span>      <span class="mi">2</span>      <span class="mi">2</span>
   <span class="mi">30</span>     <span class="mi">10</span>      <span class="mi">3</span>
   <span class="mi">40</span>             <span class="mi">4</span>
                  <span class="mi">5</span>
                 <span class="mi">10</span>
                 <span class="mi">11</span>
                 <span class="mi">12</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h5>Стиль таблицы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>tabulate поддерживает разные стили отображения таблицы.</p>
<p>Формат grid:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">list_of_dict</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;grid&quot;</span><span class="p">))</span>
<span class="o">+-----------------+-----------+----------+------------+</span>
<span class="o">|</span> <span class="n">Interface</span>       <span class="o">|</span> <span class="n">IP</span>        <span class="o">|</span> <span class="n">Status</span>   <span class="o">|</span> <span class="n">Protocol</span>   <span class="o">|</span>
<span class="o">+=================+===========+==========+============+</span>
<span class="o">|</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="o">|</span> <span class="mf">15.0</span><span class="o">.</span><span class="mf">15.1</span> <span class="o">|</span> <span class="n">up</span>       <span class="o">|</span> <span class="n">up</span>         <span class="o">|</span>
<span class="o">+-----------------+-----------+----------+------------+</span>
<span class="o">|</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="o">|</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.1</span> <span class="o">|</span> <span class="n">up</span>       <span class="o">|</span> <span class="n">up</span>         <span class="o">|</span>
<span class="o">+-----------------+-----------+----------+------------+</span>
<span class="o">|</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">2</span> <span class="o">|</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.1</span> <span class="o">|</span> <span class="n">up</span>       <span class="o">|</span> <span class="n">up</span>         <span class="o">|</span>
<span class="o">+-----------------+-----------+----------+------------+</span>
<span class="o">|</span> <span class="n">Loopback0</span>       <span class="o">|</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>  <span class="o">|</span> <span class="n">up</span>       <span class="o">|</span> <span class="n">up</span>         <span class="o">|</span>
<span class="o">+-----------------+-----------+----------+------------+</span>
<span class="o">|</span> <span class="n">Loopback100</span>     <span class="o">|</span> <span class="mf">100.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">|</span> <span class="n">up</span>       <span class="o">|</span> <span class="n">up</span>         <span class="o">|</span>
<span class="o">+-----------------+-----------+----------+------------+</span>
</pre></div>
</div>
<p>Таблица в формате Markdown:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">list_of_dict</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;pipe&#39;</span><span class="p">))</span>
<span class="o">|</span> <span class="n">Interface</span>       <span class="o">|</span> <span class="n">IP</span>        <span class="o">|</span> <span class="n">Status</span>   <span class="o">|</span> <span class="n">Protocol</span>   <span class="o">|</span>
<span class="o">|</span><span class="p">:</span><span class="o">----------------|</span><span class="p">:</span><span class="o">----------|</span><span class="p">:</span><span class="o">---------|</span><span class="p">:</span><span class="o">-----------|</span>
<span class="o">|</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="o">|</span> <span class="mf">15.0</span><span class="o">.</span><span class="mf">15.1</span> <span class="o">|</span> <span class="n">up</span>       <span class="o">|</span> <span class="n">up</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="o">|</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.1</span> <span class="o">|</span> <span class="n">up</span>       <span class="o">|</span> <span class="n">up</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">2</span> <span class="o">|</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.1</span> <span class="o">|</span> <span class="n">up</span>       <span class="o">|</span> <span class="n">up</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">Loopback0</span>       <span class="o">|</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>  <span class="o">|</span> <span class="n">up</span>       <span class="o">|</span> <span class="n">up</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">Loopback100</span>     <span class="o">|</span> <span class="mf">100.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">|</span> <span class="n">up</span>       <span class="o">|</span> <span class="n">up</span>         <span class="o">|</span>
</pre></div>
</div>
<p>Таблица в формате HTML:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">list_of_dict</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">))</span>
<span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">thead</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Interface</span>      <span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">IP</span>       <span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Status</span>  <span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Protocol</span>  <span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">thead</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tbody</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="mf">15.0</span><span class="o">.</span><span class="mf">15.1</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">up</span>      <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">up</span>        <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">12.1</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">up</span>      <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">up</span>        <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">13.1</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">up</span>      <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">up</span>        <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Loopback0</span>      <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">up</span>      <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">up</span>        <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Loopback100</span>    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="mf">100.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">up</span>      <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">up</span>        <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tbody</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Выравнивание столбцов<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Можно указывать выравнивание для столбцов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">list_of_dict</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;pipe&#39;</span><span class="p">,</span> <span class="n">stralign</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">))</span>
<span class="o">|</span>    <span class="n">Interface</span>    <span class="o">|</span>    <span class="n">IP</span>     <span class="o">|</span>  <span class="n">Status</span>  <span class="o">|</span>  <span class="n">Protocol</span>  <span class="o">|</span>
<span class="o">|</span><span class="p">:</span><span class="o">---------------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">---------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">--------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">----------</span><span class="p">:</span><span class="o">|</span>
<span class="o">|</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">0</span> <span class="o">|</span> <span class="mf">15.0</span><span class="o">.</span><span class="mf">15.1</span> <span class="o">|</span>    <span class="n">up</span>    <span class="o">|</span>     <span class="n">up</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="o">|</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.1</span> <span class="o">|</span>    <span class="n">up</span>    <span class="o">|</span>     <span class="n">up</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">2</span> <span class="o">|</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.1</span> <span class="o">|</span>    <span class="n">up</span>    <span class="o">|</span>     <span class="n">up</span>     <span class="o">|</span>
<span class="o">|</span>    <span class="n">Loopback0</span>    <span class="o">|</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>  <span class="o">|</span>    <span class="n">up</span>    <span class="o">|</span>     <span class="n">up</span>     <span class="o">|</span>
<span class="o">|</span>   <span class="n">Loopback100</span>   <span class="o">|</span> <span class="mf">100.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">|</span>    <span class="n">up</span>    <span class="o">|</span>     <span class="n">up</span>     <span class="o">|</span>
</pre></div>
</div>
<p>Обратите внимание, что тут не только столбцы отобразились с
выравниванием по центру, но и соответственно изменился синтаксис
Markdown.</p>
</div>
</div>
<span id="document-book/12_useful_modules/pprint"></span><div class="section" id="pprint">
<h4>Модуль pprint<a class="headerlink" href="#pprint" title="Ссылка на этот заголовок">¶</a></h4>
<p>Модуль pprint позволяет красиво отображать объекты Python. При этом
сохраняется структура объекта и отображение, которое выводит pprint,
можно использовать для создания объекта.
Модуль pprint входит в стандартную библиотеку Python.</p>
<p>Самый простой вариант использования модуля - функция <code class="docutils literal notranslate"><span class="pre">pprint</span></code>.
Например, словарь с вложенными словарями отобразится так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">london_co</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;r1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Wal</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">k</span><span class="s1">&#39;, &#39;</span><span class="n">vendor</span><span class="s1">&#39;: &#39;</span><span class="n">Cisco</span><span class="s1">&#39;, &#39;</span><span class="n">model</span><span class="s1">&#39;: &#39;</span><span class="mi">4451</span><span class="s1">&#39;, &#39;</span><span class="n">IOS</span><span class="s1">&#39;: &#39;</span><span class="mf">15.4</span><span class="s1">&#39;, &#39;</span><span class="n">IP</span><span class="s1">&#39;: &#39;</span><span class="mf">10.255</span><span class="o">.</span><span class="mf">0.1</span><span class="s1">&#39;}</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">,</span> <span class="s1">&#39;r2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r2&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor</span>
   <span class="o">...</span><span class="p">:</span> <span class="s1">&#39;: &#39;</span><span class="n">Cisco</span><span class="s1">&#39;, &#39;</span><span class="n">model</span><span class="s1">&#39;: &#39;</span><span class="mi">4451</span><span class="s1">&#39;, &#39;</span><span class="n">IOS</span><span class="s1">&#39;: &#39;</span><span class="mf">15.4</span><span class="s1">&#39;, &#39;</span><span class="n">IP</span><span class="s1">&#39;: &#39;</span><span class="mf">10.255</span><span class="o">.</span><span class="mf">0.2</span><span class="s1">&#39;}, &#39;</span><span class="n">sw1</span><span class="s1">&#39;: {&#39;</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">hostname</span><span class="s1">&#39;: &#39;</span><span class="n">london_sw1</span><span class="s1">&#39;, &#39;</span><span class="n">location</span><span class="s1">&#39;: &#39;</span><span class="mi">21</span> <span class="n">New</span> <span class="n">Globe</span> <span class="n">Walk</span><span class="s1">&#39;, &#39;</span><span class="n">vendor</span><span class="s1">&#39;: &#39;</span><span class="n">Cisco</span>
   <span class="o">...</span><span class="p">:</span> <span class="s1">&#39;, &#39;</span><span class="n">model</span><span class="s1">&#39;: &#39;</span><span class="mi">3850</span><span class="s1">&#39;, &#39;</span><span class="n">IOS</span><span class="s1">&#39;: &#39;</span><span class="mf">3.6</span><span class="o">.</span><span class="n">XE</span><span class="s1">&#39;, &#39;</span><span class="n">IP</span><span class="s1">&#39;: &#39;</span><span class="mf">10.255</span><span class="o">.</span><span class="mf">0.101</span><span class="s1">&#39;}}</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">pprint</span><span class="p">(</span><span class="n">london_co</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;r1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
        <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">},</span>
 <span class="s1">&#39;r2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;15.4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_r2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;4451&#39;</span><span class="p">,</span>
        <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">},</span>
 <span class="s1">&#39;sw1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;IOS&#39;</span><span class="p">:</span> <span class="s1">&#39;3.6.XE&#39;</span><span class="p">,</span>
         <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="s1">&#39;10.255.0.101&#39;</span><span class="p">,</span>
         <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;london_sw1&#39;</span><span class="p">,</span>
         <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;21 New Globe Walk&#39;</span><span class="p">,</span>
         <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span>
         <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}}</span>
</pre></div>
</div>
<p>Список списков:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;15.0.15.1&#39;</span><span class="p">,</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up</span>
    <span class="o">...</span><span class="p">:</span> <span class="s1">&#39;], [&#39;</span><span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span><span class="s1">&#39;, &#39;</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">1.1</span><span class="s1">&#39;, &#39;</span><span class="n">YES</span><span class="s1">&#39;, &#39;</span><span class="n">manual</span><span class="s1">&#39;, &#39;</span><span class="n">up</span><span class="s1">&#39;, &#39;</span><span class="n">up</span><span class="s1">&#39;], [&#39;</span><span class="n">FastE</span>
    <span class="o">...</span><span class="p">:</span> <span class="n">thernet0</span><span class="o">/</span><span class="mi">2</span><span class="s1">&#39;, &#39;</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">2.1</span><span class="s1">&#39;, &#39;</span><span class="n">YES</span><span class="s1">&#39;, &#39;</span><span class="n">manual</span><span class="s1">&#39;, &#39;</span><span class="n">up</span><span class="s1">&#39;, &#39;</span><span class="n">down</span><span class="s1">&#39;]]</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">pprint</span><span class="p">(</span><span class="n">interfaces</span><span class="p">)</span>
<span class="p">[[</span><span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;15.0.15.1&#39;</span><span class="p">,</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">],</span>
 <span class="p">[</span><span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">],</span>
 <span class="p">[</span><span class="s1">&#39;FastEthernet0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<p>Строка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">tunnel</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">interface Tunnel0</span><span class="se">\n</span><span class="s1"> ip address 10.10.10.1 255.255.255.0</span><span class="se">\n</span><span class="s1"> ip mtu 1416</span><span class="se">\n</span><span class="s1"> ip ospf hello-interval 5</span><span class="se">\n</span><span class="s1"> tunnel source FastEthernet1/0</span><span class="se">\n</span><span class="s1"> tunnel protection ipsec profile DMVPN</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">pprint</span><span class="p">(</span><span class="n">tunnel</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
 <span class="s1">&#39;interface Tunnel0</span><span class="se">\n</span><span class="s1">&#39;</span>
 <span class="s1">&#39; ip address 10.10.10.1 255.255.255.0</span><span class="se">\n</span><span class="s1">&#39;</span>
 <span class="s1">&#39; ip mtu 1416</span><span class="se">\n</span><span class="s1">&#39;</span>
 <span class="s1">&#39; ip ospf hello-interval 5</span><span class="se">\n</span><span class="s1">&#39;</span>
 <span class="s1">&#39; tunnel source FastEthernet1/0</span><span class="se">\n</span><span class="s1">&#39;</span>
 <span class="s1">&#39; tunnel protection ipsec profile DMVPN</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id1">
<h5>Ограничение вложенности<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>У функции pprint есть дополнительный параметр depth, который позволяет
ограничивать глубину отображения структуры данных.</p>
<p>Например, есть такой словарь:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;interface Tunnel0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39; ip unnumbered Loopback0&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; tunnel mode mpls traffic-eng&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; tunnel destination 10.2.2.2&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; tunnel mpls traffic-eng priority 7 7&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; tunnel mpls traffic-eng bandwidth 5000&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; tunnel mpls traffic-eng path-option 10 dynamic&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; no routing dynamic&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;ip access-list standard LDP&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39; deny   10.0.0.0 0.0.255.255&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; permit 10.0.0.0 0.255.255.255&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;router bgp 100&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39; address-family vpnv4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;  neighbor 10.2.2.2 activat</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">e</span><span class="s1">&#39;,</span>
   <span class="o">...</span><span class="p">:</span>    <span class="s1">&#39;  neighbor 10.2.2.2 send-community both&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>    <span class="s1">&#39;  exit-address-family&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; bgp bestpath igp-metric ignore&#39;</span><span class="p">:</span> <span class="p">[],</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; bgp log-neighbor-changes&#39;</span><span class="p">:</span> <span class="p">[],</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; neighbor 10.2.2.2 next-hop-self&#39;</span><span class="p">:</span> <span class="p">[],</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; neighbor 10.2.2.2 remote-as 100&#39;</span><span class="p">:</span> <span class="p">[],</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; neighbor 10.2.2.2 update-source Loopback0&#39;</span><span class="p">:</span> <span class="p">[],</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; neighbor 10.4.4.4 remote-as 40&#39;</span><span class="p">:</span> <span class="p">[]},</span>
   <span class="o">...</span><span class="p">:</span>  <span class="s1">&#39;router ospf 1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39; mpls ldp autoconfig area 0&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; mpls traffic-eng router-id Loopback0&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; mpls traffic-eng area 0&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>   <span class="s1">&#39; network 10.0.0.0 0.255.255.255 area 0&#39;</span><span class="p">]}</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Можно отобразить только ключи, указав глубину равной 1:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;interface Tunnel0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span>
 <span class="s1">&#39;ip access-list standard LDP&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span>
 <span class="s1">&#39;router bgp 100&#39;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span>
 <span class="s1">&#39;router ospf 1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]}</span>
</pre></div>
</div>
<p>Скрытые уровни вложенности заменяются <code class="docutils literal notranslate"><span class="pre">...</span></code>.</p>
<p>Если указать глубину равной 2, отобразится следующий уровень:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;interface Tunnel0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39; ip unnumbered Loopback0&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; tunnel mode mpls traffic-eng&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; tunnel destination 10.2.2.2&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; tunnel mpls traffic-eng priority 7 7&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; tunnel mpls traffic-eng bandwidth 5000&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; tunnel mpls traffic-eng path-option 10 dynamic&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; no routing dynamic&#39;</span><span class="p">],</span>
 <span class="s1">&#39;ip access-list standard LDP&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39; deny   10.0.0.0 0.0.255.255&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39; permit 10.0.0.0 0.255.255.255&#39;</span><span class="p">],</span>
 <span class="s1">&#39;router bgp 100&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39; address-family vpnv4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span>
                    <span class="s1">&#39; bgp bestpath igp-metric ignore&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39; bgp log-neighbor-changes&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39; neighbor 10.2.2.2 next-hop-self&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39; neighbor 10.2.2.2 remote-as 100&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39; neighbor 10.2.2.2 update-source Loopback0&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39; neighbor 10.4.4.4 remote-as 40&#39;</span><span class="p">:</span> <span class="p">[]},</span>
 <span class="s1">&#39;router ospf 1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39; mpls ldp autoconfig area 0&#39;</span><span class="p">,</span>
                   <span class="s1">&#39; mpls traffic-eng router-id Loopback0&#39;</span><span class="p">,</span>
                   <span class="s1">&#39; mpls traffic-eng area 0&#39;</span><span class="p">,</span>
                   <span class="s1">&#39; network 10.0.0.0 0.255.255.255 area 0&#39;</span><span class="p">]}</span>
</pre></div>
</div>
</div>
<div class="section" id="pformat">
<h5>pformat<a class="headerlink" href="#pformat" title="Ссылка на этот заголовок">¶</a></h5>
<p>pformat - это функция, которая отображает результат в виде строки. Ее
удобно использовать, если необходимо записать структуру данных в
какой-то файл, например, для логирования.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pformat</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">formatted_result</span> <span class="o">=</span> <span class="n">pformat</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">formatted_result</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;interface Tunnel0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39; ip unnumbered Loopback0&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; tunnel mode mpls traffic-eng&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; tunnel destination 10.2.2.2&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; tunnel mpls traffic-eng priority 7 7&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; tunnel mpls traffic-eng bandwidth 5000&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; tunnel mpls traffic-eng path-option 10 dynamic&#39;</span><span class="p">,</span>
                       <span class="s1">&#39; no routing dynamic&#39;</span><span class="p">],</span>
 <span class="s1">&#39;ip access-list standard LDP&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39; deny   10.0.0.0 0.0.255.255&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39; permit 10.0.0.0 0.255.255.255&#39;</span><span class="p">],</span>
 <span class="s1">&#39;router bgp 100&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39; address-family vpnv4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;  neighbor 10.2.2.2 activate&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;  neighbor 10.2.2.2 &#39;</span>
                                              <span class="s1">&#39;send-community both&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;  exit-address-family&#39;</span><span class="p">],</span>
                    <span class="s1">&#39; bgp bestpath igp-metric ignore&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39; bgp log-neighbor-changes&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39; neighbor 10.2.2.2 next-hop-self&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39; neighbor 10.2.2.2 remote-as 100&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39; neighbor 10.2.2.2 update-source Loopback0&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39; neighbor 10.4.4.4 remote-as 40&#39;</span><span class="p">:</span> <span class="p">[]},</span>
 <span class="s1">&#39;router ospf 1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39; mpls ldp autoconfig area 0&#39;</span><span class="p">,</span>
                   <span class="s1">&#39; mpls traffic-eng router-id Loopback0&#39;</span><span class="p">,</span>
                   <span class="s1">&#39; mpls traffic-eng area 0&#39;</span><span class="p">,</span>
                   <span class="s1">&#39; network 10.0.0.0 0.255.255.255 area 0&#39;</span><span class="p">]}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Сортировка словарей<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>pprint сортирует словари при выводе, что не всегда удобно. Начиная с
версии Python 3.8, появилась возможность отключить сортировку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;16.4&quot;</span><span class="p">,</span> <span class="s2">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.1.1.1&quot;</span><span class="p">,</span> <span class="s2">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco IOS&quot;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">pprint</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;16.4&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco IOS&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">pprint</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">sort_dicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;16.4&#39;</span><span class="p">,</span> <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco IOS&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/12_useful_modules/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<div class="section" id="pprint">
<h5>pprint<a class="headerlink" href="#pprint" title="Ссылка на этот заголовок">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/library/pprint.html">pprint — Data pretty printer</a></li>
<li><a class="reference external" href="https://pymotw.com/3/pprint/">PyMOTW. pprint — Pretty-Print Data Structures</a></li>
</ul>
</div>
<div class="section" id="tabulate">
<h5>tabulate<a class="headerlink" href="#tabulate" title="Ссылка на этот заголовок">¶</a></h5>
<p><a class="reference external" href="https://bitbucket.org/astanin/python-tabulate">Документация tabulate</a></p>
<p>Статьи от автора tabulate:</p>
<ul class="simple">
<li><a class="reference external" href="https://txt.arboreus.com/2013/03/13/pretty-print-tables-in-python.html">Pretty printing tables in Python</a></li>
<li><a class="reference external" href="https://txt.arboreus.com/2013/12/12/tabulate-0-7-1-with-latex-tables-named-tuples-etc.html">Tabulate 0.7.1 with LaTeX &amp; MediaWiki tables</a></li>
</ul>
<p>Stack Overflow:</p>
<ul class="simple">
<li><a class="reference external" href="https://stackoverflow.com/questions/9535954/printing-lists-as-tabular-data">Printing Lists as Tabular Data</a>.
Обратите внимание на <a class="reference external" href="https://stackoverflow.com/a/26937531">ответ</a> - в нём указаны другие аналоги tabulate.</li>
</ul>
</div>
</div>
<span id="document-exercises/12_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 12.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию ping_ip_addresses, которая проверяет пингуются ли IP-адреса.
Функция ожидает как аргумент список IP-адресов.</p>
<p>Функция должна возвращать кортеж с двумя списками:</p>
<ul class="simple">
<li>список доступных IP-адресов</li>
<li>список недоступных IP-адресов</li>
</ul>
<p>Для проверки доступности IP-адреса, используйте команду ping.</p>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
</div>
<div class="section" id="id3">
<h5>Задание 12.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Функция ping_ip_addresses из задания 12.1 принимает только список адресов,
но было бы удобно иметь возможность указывать адреса с помощью диапазона, например, 192.168.100.1-10.</p>
<p>В этом задании необходимо создать функцию convert_ranges_to_ip_list,
которая конвертирует список IP-адресов в разных форматах в список, где каждый IP-адрес указан отдельно.</p>
<p>Функция ожидает как аргумент список IP-адресов и/или диапазонов IP-адресов.</p>
<p>Элементы списка могут быть в формате:</p>
<ul class="simple">
<li>10.1.1.1</li>
<li>10.1.1.1-10.1.1.10</li>
<li>10.1.1.1-10</li>
</ul>
<p>Если адрес указан в виде диапазона, надо развернуть диапазон в отдельные адреса, включая последний адрес диапазона.
Для упрощения задачи, можно считать, что в диапазоне всегда меняется только последний октет адреса.</p>
<p>Функция возвращает список IP-адресов.</p>
<p>Например, если передать функции convert_ranges_to_ip_list такой список:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;8.8.4.4&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.1.1-3&#39;</span><span class="p">,</span> <span class="s1">&#39;172.21.41.128-172.21.41.132&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Функция должна вернуть такой список:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;8.8.4.4&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.1.2&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.1.3&#39;</span><span class="p">,</span> <span class="s1">&#39;172.21.41.128&#39;</span><span class="p">,</span>
 <span class="s1">&#39;172.21.41.129&#39;</span><span class="p">,</span> <span class="s1">&#39;172.21.41.130&#39;</span><span class="p">,</span> <span class="s1">&#39;172.21.41.131&#39;</span><span class="p">,</span> <span class="s1">&#39;172.21.41.132&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Задание 12.3<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию print_ip_table, которая отображает таблицу доступных
и недоступных IP-адресов.</p>
<p>Функция ожидает как аргументы два списка:</p>
<ul class="simple">
<li>список доступных IP-адресов</li>
<li>список недоступных IP-адресов</li>
</ul>
<p>Результат работы функции - вывод на стандартный поток вывода таблицы вида:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Reachable</span>    <span class="n">Unreachable</span>
<span class="o">-----------</span>  <span class="o">-------------</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>     <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.7</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.2</span>     <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.8</span>
             <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.9</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/13_iterator_generator/index"></span><div class="section" id="iterator-generator-index">
<span id="id1"></span><h3>13. Итераторы, итерируемые объекты и генераторы<a class="headerlink" href="#iterator-generator-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>В этом разделе рассматриваются:</p>
<ul class="simple">
<li>итерируемые объекты (iterable)</li>
<li>итераторы (iterator)</li>
<li>генераторные выражения (generator expression)</li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-book/13_iterator_generator/iterable"></span><div class="section" id="iterable">
<span id="id1"></span><h4>Итерируемый объект<a class="headerlink" href="#iterable" title="Ссылка на этот заголовок">¶</a></h4>
<p>Итерация - это общий термин, который описывает процедуру взятия
элементов чего-то по очереди.</p>
<p>В более общем смысле, это последовательность инструкций, которая
повторяется определенное количество раз или до выполнения указанного
условия.</p>
<p>Итерируемый объект (iterable) - это объект, который способен возвращать
элементы по одному. Кроме того, это объект, из которого можно получить
итератор.</p>
<p>Примеры итерируемых объектов:</p>
<ul class="simple">
<li>все последовательности: список, строка, кортеж</li>
<li>словари</li>
<li>файлы</li>
</ul>
<p>В Python за получение итератора отвечает функция iter():</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">lista</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">iter</span><span class="p">(</span><span class="n">lista</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">list_iterator</span> <span class="n">at</span> <span class="mh">0xb4ede28c</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Функция <code class="docutils literal notranslate"><span class="pre">iter()</span></code> отработает на любом объекте, у которого есть метод
<code class="docutils literal notranslate"><span class="pre">__iter__</span></code> или метод <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>.</p>
<p>Метод <code class="docutils literal notranslate"><span class="pre">__iter__</span></code> возвращает итератор. Если этого метода нет,
функция iter() проверяет, нет ли метода <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> - метода,
который позволяет получать элементы по индексу.</p>
<p>Если метод <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> есть, возвращается итератор, который
проходится по элементам, используя индекс (начиная с 0).</p>
<p>На практике использование метода <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> означает, что все
последовательности элементов - это итерируемые объекты. Например,
список, кортеж, строка. Хотя у этих типов данных есть и метод
<code class="docutils literal notranslate"><span class="pre">__iter__</span></code>.</p>
</div>
<span id="document-book/13_iterator_generator/iterator"></span><div class="section" id="id1">
<h4>Итераторы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Итератор (iterator) - это объект, который возвращает свои элементы по
одному за раз.</p>
<p>С точки зрения Python - это любой объект, у которого есть метод
<code class="docutils literal notranslate"><span class="pre">__next__</span></code>. Этот метод возвращает следующий элемент, если он есть, или
возвращает исключение StopIteration, когда элементы закончились.</p>
<p>Кроме того, итератор запоминает, на каком объекте он остановился в
последнюю итерацию.</p>
<p>В Python у каждого итератора присутствует метод <code class="docutils literal notranslate"><span class="pre">__iter__</span></code> - то есть,
любой итератор является итерируемым объектом. Этот метод просто
возвращает сам итератор.</p>
<p>Пример создания итератора из списка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">i</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь можно использовать функцию next(), которая вызывает метод
<code class="docutils literal notranslate"><span class="pre">__next__</span></code>, чтобы взять следующий элемент:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mi">2</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="o">------------------------------------------------------------</span>
<span class="ne">StopIteration</span>              <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="n">bed2471d02c1</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="ne">StopIteration</span><span class="p">:</span>
</pre></div>
</div>
<p>После того, как элементы закончились, возвращается исключение
StopIteration.</p>
<p>Для того, чтобы итератор снова начал возвращать элементы, его надо
заново создать.</p>
<p>Аналогичные действия выполняются, когда цикл for проходится по списку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
</pre></div>
</div>
<p>Когда мы перебираем элементы списка, к списку сначала применяется
функция iter(), чтобы создать итератор, а затем вызывается его метод
<code class="docutils literal notranslate"><span class="pre">__next__</span></code> до тех пор, пока не возникнет исключение StopIteration.</p>
<p>Итераторы полезны тем, что они отдают элементы по одному. Например, при
работе с файлом это полезно тем, что в памяти будет находиться не весь
файл, а только одна строка файла.</p>
<div class="section" id="id2">
<h5>Файл как итератор<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Один из самых распространенных примеров итератора - файл.</p>
<p>Файл r1.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
</pre></div>
</div>
<p>Если открыть файл обычной функцией open, мы получим объект, который
представляет файл:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;r1.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Этот объект является итератором, что можно проверить, вызвав метод
<code class="docutils literal notranslate"><span class="pre">__next__</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;!</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="s1">&#39;service timestamps debug datetime msec localtime show-timezone year</span><span class="se">\n</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Аналогичным образом можно перебирать строки в цикле for:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [13]: for line in f:
    ...:     print(line.rstrip())
    ...:
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
</pre></div>
</div>
<p>При работе с файлами, использование файла как итератора не просто
позволяет перебирать файл построчно - в каждую итерацию загружена только
одна строка. Это очень важно при работе с большими файлами на тысячи и
сотни тысяч строк, например, с лог-файлами.</p>
<p>Поэтому при работе с файлами в Python чаще всего используется
конструкция вида:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [14]: with open(&#39;r1.txt&#39;) as f:
    ...:     for line in f:
    ...:         print(line.rstrip())
    ...:
!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
</pre></div>
</div>
</div>
</div>
<span id="document-book/13_iterator_generator/generator"></span><div class="section" id="generator">
<h4>Генератор (generator)<a class="headerlink" href="#generator" title="Ссылка на этот заголовок">¶</a></h4>
<p>Генераторы - это специальный класс функций, который позволяет легко
создавать свои итераторы. В отличие от обычных функций, генератор не
просто возвращает значение и завершает работу, а возвращает итератор,
который отдает элементы по одному.</p>
<p>Обычная функция завершает работу, если:</p>
<ul class="simple">
<li>встретилось выражение <code class="docutils literal notranslate"><span class="pre">return</span></code></li>
<li>закончился код функции (это срабатывает как выражение <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">None</span></code>)</li>
<li>возникло исключение</li>
</ul>
<p>После выполнения функции управление возвращается, и программа
выполняется дальше. Все аргументы, которые передавались в функцию,
локальные переменные, все это теряется. Остается только результат,
который вернула функция.</p>
<p>Функция может возвращать список элементов, несколько объектов или
возвращать разные результаты в зависимости от аргументов, но она всегда
возвращает какой-то один результат.</p>
<p>Генератор же генерирует значения. При этом значения возвращаются по
запросу, и после возврата одного значения выполнение функции-генератора
приостанавливается до запроса следующего значения. Между запросами
генератор сохраняет свое состояние.</p>
<p>Python позволяет создавать генераторы двумя способами:</p>
<ul class="simple">
<li>генераторное выражение</li>
<li>функция-генератор</li>
</ul>
<p>Ниже пример генераторного выражения, а по функциям-генераторам -
<a class="reference external" href="https://natenka.github.io/python/fluent-python-generator/">отдельная
заметка</a></p>
<div class="section" id="generator-expression">
<h5>generator expression (генераторное выражение)<a class="headerlink" href="#generator-expression" title="Ссылка на этот заголовок">¶</a></h5>
<p>Генераторное выражение использует такой же синтаксис, как list
comprehensions, но возвращает итератор, а не список.</p>
<p>Генераторное выражение выглядит точно так же, как list comprehensions,
но используются круглые скобки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">genexpr</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">genexpr</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="o">&lt;</span><span class="n">genexpr</span><span class="o">&gt;</span> <span class="n">at</span> <span class="mh">0xb571ec8c</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">genexpr</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">genexpr</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">genexpr</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Обратите внимание, что это не tuple comprehensions, а генераторное
выражение.</p>
<p>Оно полезно в том случае, когда надо работать с большим итерируемым
объектом или бесконечным итератором.</p>
</div>
</div>
<span id="document-book/13_iterator_generator/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация Python:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#sequence-types-list-tuple-range">Sequence
types</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#iterator-types">Iterator
types</a></li>
<li><a class="reference external" href="https://docs.python.org/3/howto/functional.html">Functional Programming
HOWTO</a></li>
</ul>
<p>Статьи:</p>
<ul class="simple">
<li><a class="reference external" href="http://nvie.com/posts/iterators-vs-generators/">Iterables vs. Iterators vs.
Generators</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/Part_III"></span><div class="section" id="iii">
<h2>III. Регулярные выражения<a class="headerlink" href="#iii" title="Ссылка на этот заголовок">¶</a></h2>
<p>Регулярное выражение - это последовательность из обычных и специальных
символов. Эта последовательность задает шаблон, который позже
используется для поиска подстрок.</p>
<p>При работе с сетевым оборудованием регулярные выражения могут
использоваться, например, для:</p>
<ul class="simple">
<li>получения информации из вывода команд show</li>
<li>отбора части строк из вывода команд show, которые совпадают с шаблоном</li>
<li>проверки, есть ли определенные настройки в конфигурации</li>
</ul>
<p>Несколько примеров:</p>
<ul class="simple">
<li>обработав вывод команды show version, можно собрать информацию про версию ОС и uptime оборудования.</li>
<li>получить из log-файла те строки, которые соответствуют шаблону.</li>
<li>получить из конфигурации те интерфейсы, на которых нет описания (description)</li>
</ul>
<p>Кроме того, в самом сетевом оборудовании регулярные выражения можно
использовать для фильтрации вывода любых команд show.</p>
<p>В целом, использование регулярных выражений будет связано с получением
части текста из большого вывода. Но это не единственное, в чем они могут
пригодиться. Например, с помощью регулярных выражений можно выполнять
замены в строках или разделение строки на части.</p>
<p>Эти области применения пересекаются с методами, которые применяются к
строкам. И, если задача понятно и просто решается с помощью методов
строк, лучше использовать их. Такой код будет проще понять и, кроме
того, методы строк быстрее работают.</p>
<p>Но методы строк могут справиться не со всеми задачами или могут сильно
усложнить решение задачи. В этом случае могут помочь регулярные
выражения.</p>
<div class="toctree-wrapper compound">
<span id="document-book/14_regex/index"></span><div class="section" id="regex-index">
<span id="id1"></span><h3>14. Синтаксис регулярных выражений<a class="headerlink" href="#regex-index" title="Ссылка на этот заголовок">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-book/14_regex/syntax"></span><div class="section" id="id1">
<h4>Синтаксис регулярных выражений<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python для работы с регулярными выражениями используется модуль re.
Соответственно, для начала работы с регулярными выражениями надо его
импортировать.</p>
<p>В Python некоторые символы строки надо экранировать, чтобы они воспринимались
правильно. К таким символам относится, например, <code class="docutils literal notranslate"><span class="pre">\</span></code>.
Чтобы написать правильно строку, в которой находятся два символа <code class="docutils literal notranslate"><span class="pre">\\</span></code>,
оба символа надо экранировать и в итоге получится строка вида: <code class="docutils literal notranslate"><span class="pre">\\\\data</span></code>.
Вместо этого, можно использовать <a class="reference external" href="https://docs.python.org/3/library/re.html#raw-string-notation">raw-строку</a>
и тогда каждый символ будет восприниматься как написано.
Raw-строки отличаются от обычных тем, что при создании строки,
в начале пишется буква <code class="docutils literal notranslate"><span class="pre">r</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">data&quot;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">data&#39;</span>
</pre></div>
</div>
<p>Так как в регулярных выражениях постоянно используется <code class="docutils literal notranslate"><span class="pre">\</span></code>,
всегда используйте raw-строки для описания регулярных выражений.
Некоторые выражения правильно отработают и без raw-строк, но, использование
raw-строк для регулярных выражений это хороший тон.</p>
<p>В этом разделе для всех примеров будет использоваться
функция <code class="docutils literal notranslate"><span class="pre">search</span></code>. А в следующем подразделе будут рассматриваться
остальные функции модуля re.</p>
<p>Синтаксис функции <code class="docutils literal notranslate"><span class="pre">search</span></code> такой:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
</pre></div>
</div>
<p>У функции <code class="docutils literal notranslate"><span class="pre">search</span></code> два обязательных параметра:</p>
<ul class="simple">
<li>regex - регулярное выражение</li>
<li>string - строка, в которой ищется совпадение</li>
</ul>
<p>Если совпадение было найдено, функция вернет специальный объект Match.
Если же совпадения не было, функция вернет None.</p>
<p>При этом особенность функции <code class="docutils literal notranslate"><span class="pre">search</span></code> в том, что она ищет только первое
совпадение. То есть, если в строке есть несколько подстрок, которые
соответствуют регулярному выражению, <code class="docutils literal notranslate"><span class="pre">search</span></code> вернет только первое
найденное совпадение.</p>
<p>Чтобы получить представление о регулярных выражениях, рассмотрим
несколько примеров.</p>
<p>Самый простой пример регулярного выражения - подстрока:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">re</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">int_line</span> <span class="o">=</span> <span class="s1">&#39;  MTU 1500 bytes, BW 10000 Kbit, DLY 1000 usec,&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;MTU&#39;</span><span class="p">,</span> <span class="n">int_line</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Технически тут не нужна raw-строка, так как тут регулярное выражение
это обычная подстрока MTU, но лучше сразу привыкать к тому, что
в регулярных выражениях надо использовать raw строки.</p>
</div>
<p>В этом примере:</p>
<ul class="simple">
<li>сначала импортируется модуль re</li>
<li>затем идет пример строки int_line</li>
<li>и в 3 строке функции search передается выражение, которое надо искать,
и строка int_line, в которой ищется совпадение</li>
</ul>
<p>В данном случае мы ищем, есть ли подстрока „MTU“ в строке int_line.
Если она есть, в переменной match будет находиться специальный объект
Match:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">_sre</span><span class="o">.</span><span class="n">SRE_Match</span> <span class="nb">object</span><span class="p">;</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">match</span><span class="o">=</span><span class="s1">&#39;MTU&#39;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>У объекта Match есть несколько методов, которые позволяют получать
разную информацию о полученном совпадении. Например, метод group
показывает, что в строке совпало с описанным выражением.</p>
<p>В данном случае это подстрока „MTU“:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;MTU&#39;</span>
</pre></div>
</div>
<p>Если совпадения не было, в переменной match будет значение None:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">int_line</span> <span class="o">=</span> <span class="s1">&#39;  MTU 1500 bytes, BW 10000 Kbit, DLY 1000 usec,&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;MU&#39;</span><span class="p">,</span> <span class="n">int_line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
<span class="kc">None</span>
</pre></div>
</div>
<p>Полностью возможности регулярных выражений проявляются при использовании
специальных символов. Например, символ <code class="docutils literal notranslate"><span class="pre">\d</span></code> означает цифру, а <code class="docutils literal notranslate"><span class="pre">+</span></code>
означает повторение предыдущего символа один или более раз. Если их
совместить <code class="docutils literal notranslate"><span class="pre">\d+</span></code>, получится выражение, которое означает одну или более
цифр.</p>
<p>Используя это выражение, можно получить часть строки, в которой описана
пропускная способность:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">int_line</span> <span class="o">=</span> <span class="s1">&#39;  MTU 1500 bytes, BW 10000 Kbit, DLY 1000 usec,&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;BW \d+&#39;</span><span class="p">,</span> <span class="n">int_line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;BW 10000&#39;</span>
</pre></div>
</div>
<p>Особенно полезны регулярные выражения в получении определенных подстрок
из строки. Например, необходимо получить VLAN, MAC и порты из вывода
такого лог-сообщения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">log2</span> <span class="o">=</span> <span class="s1">&#39;Oct  3 12:49:15.941: %SW_MATM-4-MACFLAP_NOTIF: Host f04d.a206.7fd6 in vlan 1 is flapping between port Gi0/5 and port Gi0/16&#39;</span>
</pre></div>
</div>
<p>Это можно сделать с помощью такого регулярного выражения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host (\S+) in vlan (\d+) is flapping between port (\S+) and port (\S+)&#39;</span><span class="p">,</span> <span class="n">log2</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;f04d.a206.7fd6&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/5&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/16&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Метод groups возвращает только те части исходной строки, которые попали
в круглые скобки. Таким образом, заключив часть выражения в скобки,
можно указать, какие части строки надо запомнить.</p>
<p>Выражение <code class="docutils literal notranslate"><span class="pre">\d+</span></code> уже использовалось ранее - оно описывает одну или
более цифр. А выражение <code class="docutils literal notranslate"><span class="pre">\S+</span></code> описывает все символы, кроме whitespace
(пробел, таб и другие).</p>
<p>В следующих подразделах рассматриваются специальные символы, которые
используются в регулярных выражениях.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Если вы знаете, что означают специальные символы в регулярных
выражениях, можно пропустить следующий подраздел и сразу
переключиться на подраздел о модуле re.</p>
</div>
</div>
<span id="document-book/14_regex/spec_sym_sets"></span><div class="section" id="id1">
<h4>Наборы символов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python есть специальные обозначения для наборов символов:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">\d</span></code> - любая цифра</li>
<li><code class="docutils literal notranslate"><span class="pre">\D</span></code> - любое нечисловое значение</li>
<li><code class="docutils literal notranslate"><span class="pre">\s</span></code> - пробельные символы</li>
<li><code class="docutils literal notranslate"><span class="pre">\S</span></code> - все, кроме пробельных символов</li>
<li><code class="docutils literal notranslate"><span class="pre">\w</span></code> - любая буква, цифра или нижнее подчеркивание</li>
<li><code class="docutils literal notranslate"><span class="pre">\W</span></code> - все, кроме букв, цифр или нижнего подчеркивания</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Это не все наборы символов, которые поддерживает Python. Подробнее
смотрите в
<a class="reference external" href="https://docs.python.org/3/library/re.html">документации</a>.</p>
</div>
<p>Наборы символов позволяют писать более короткие выражения без
необходимости перечислять все нужные символы.</p>
<p>Например, получим время из строки лог-файла:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;*Jul  7 06:15:18.695: %LINEPROTO-5-UPDOWN: Line protocol on Interface Ethernet0/3, changed state to down&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d\d:\d\d:\d\d&#39;</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;06:15:18&#39;</span>
</pre></div>
</div>
<p>Выражение <code class="docutils literal notranslate"><span class="pre">\d\d:\d\d:\d\d</span></code> описывает 3 пары чисел, разделенных
двоеточиями.</p>
<p>Получение MAC-адреса из лог-сообщения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">log2</span> <span class="o">=</span> <span class="s1">&#39;Jun  3 14:39:05.941: %SW_MATM-4-MACFLAP_NOTIF: Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w\w\w\w\.\w\w\w\w\.\w\w\w\w&#39;</span><span class="p">,</span> <span class="n">log2</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;f03a.b216.7ad7&#39;</span>
</pre></div>
</div>
<p>Выражение <code class="docutils literal notranslate"><span class="pre">\w\w\w\w\.\w\w\w\w\.\w\w\w\w</span></code> описывает 12 букв или цифр,
которые разделены на три группы по четыре символа точками.</p>
<p>Группы символов очень удобны, но пока что приходится вручную указывать
повторение символа. В следующем подразделе рассматриваются символы
повторения, которые упростят описание выражений.</p>
</div>
<span id="document-book/14_regex/spec_sym_repetition"></span><div class="section" id="id1">
<h4>Символы повторения<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">regex+</span></code> - одно или более повторений предшествующего элемента</li>
<li><code class="docutils literal notranslate"><span class="pre">regex*</span></code> - ноль или более повторений предшествующего элемента</li>
<li><code class="docutils literal notranslate"><span class="pre">regex?</span></code> - ноль или одно повторение предшествующего элемента</li>
<li><code class="docutils literal notranslate"><span class="pre">regex{n}</span></code> - ровно n повторений предшествующего элемента</li>
<li><code class="docutils literal notranslate"><span class="pre">regex{n,m}</span></code> - от n до m повторений предшествующего элемента</li>
<li><code class="docutils literal notranslate"><span class="pre">regex{n,}</span></code> - n или более повторений предшествующего элемента</li>
</ul>
<div class="section" id="id2">
<h5><code class="docutils literal notranslate"><span class="pre">+</span></code><a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Плюс указывает, что предыдущее выражение может повторяться сколько
угодно раз, но, как минимум, один раз.</p>
<p>Например, тут повторение относится к букве a:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;100     aab1.a1a1.a5d3    FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;a+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;aa&#39;</span>
</pre></div>
</div>
<p>А в этом выражении повторяется строка „a1“:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [3]: line = &#39;100     aab1.a1a1.a5d3    FastEthernet0/1&#39;

In [4]: re.search(r&#39;(a1)+&#39;, line).group()
Out[4]: &#39;a1a1&#39;

В выражении ``(a1)+`` скобки используются для того, чтобы указать,
что повторение относится к последовательности символов &#39;a1&#39;.
</pre></div>
</div>
<p>IP-адрес можно описать выражением <code class="docutils literal notranslate"><span class="pre">\d+\.\d+\.\d+\.\d+</span></code>. Тут плюс
используется, чтобы указать, что цифр может быть несколько. А также
встречается выражение <code class="docutils literal notranslate"><span class="pre">\.</span></code>.</p>
<p>Оно необходимо из-за того, что точка является специальным символом (она
обозначает любой символ). И чтобы указать, что нас интересует именно
точка, надо ее экранировать - поместить перед точкой обратный слеш.</p>
<p>Используя это выражение, можно получить IP-адрес из строки
sh_ip_int_br:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">sh_ip_int_br</span> <span class="o">=</span> <span class="s1">&#39;Ethernet0/1    192.168.200.1   YES NVRAM  up          up&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+\.\d+\.\d+\.\d+&#39;</span><span class="p">,</span> <span class="n">sh_ip_int_br</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;192.168.200.1&#39;</span>
</pre></div>
</div>
<p>Еще один пример выражения: <code class="docutils literal notranslate"><span class="pre">\d+\s+\S+</span></code> - оно описывает строку, в
которой идут сначала цифры, после них пробельные символы,
а затем непробельные символы (все, кроме пробела, таба и других подобных символов).
С его помощью можно получить VLAN и MAC-адрес из строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;1500     aab1.a1a1.a5d3    FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+\s+\S+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;1500     aab1.a1a1.a5d3&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5><code class="docutils literal notranslate"><span class="pre">*</span></code><a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Звездочка указывает, что предыдущее выражение может повторяться 0 или
более раз.</p>
<p>Например, если звездочка стоит после символа, она означает повторение
этого символа.</p>
<p>Выражение <code class="docutils literal notranslate"><span class="pre">ba*</span></code> означает b, а затем ноль или более повторений a:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;100     a011.baaa.a5d3    FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ba*&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;baaa&#39;</span>
</pre></div>
</div>
<p>Если в строке line до подстроки baaa встретится b, то совпадением будет
b:</p>
<div class="code py highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;100     ab11.baaa.a5d3    FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ba*&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="s1">&#39;b&#39;</span>
</pre></div>
</div>
<p>Допустим, необходимо написать регулярное выражение, которое описывает
электронные адреса в двух форматах: <a class="reference external" href="mailto:user&#37;&#52;&#48;example&#46;com">user<span>&#64;</span>example<span>&#46;</span>com</a> и <a class="reference external" href="mailto:user&#46;test&#37;&#52;&#48;example&#46;com">user<span>&#46;</span>test<span>&#64;</span>example<span>&#46;</span>com</a>. То
есть, в левой части адреса может быть или одно слово, или два слова,
разделенные точкой.</p>
<p>Первый вариант на примере адреса без точки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">email1</span> <span class="o">=</span> <span class="s1">&#39;user1@gmail.com&#39;</span>
</pre></div>
</div>
<p>Этот адрес можно описать таким выражением <code class="docutils literal notranslate"><span class="pre">\w+&#64;\w+\.\w+</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+@\w+\.\w+&#39;</span><span class="p">,</span> <span class="n">email1</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="s1">&#39;user1@gmail.com&#39;</span>
</pre></div>
</div>
<p>Но такое выражение не подходит для электронного адреса с точкой:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">email2</span> <span class="o">=</span> <span class="s1">&#39;user2.test@gmail.com&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+@\w+\.\w+&#39;</span><span class="p">,</span> <span class="n">email2</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;test@gmail.com&#39;</span>
</pre></div>
</div>
<p>Регулярное выражение для адреса с точкой:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+\.\w+@\w+\.\w+&#39;</span><span class="p">,</span> <span class="n">email2</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;user2.test@gmail.com&#39;</span>
</pre></div>
</div>
<p>Чтобы описать оба варианта адресов, надо указать, что точка в адресе
опциональна:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;\w+\.*\w+@\w+\.\w+&#39;</span>
</pre></div>
</div>
<p>Такое регулярное выражение описывает оба варианта:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">email1</span> <span class="o">=</span> <span class="s1">&#39;user1@gmail.com&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">email2</span> <span class="o">=</span> <span class="s1">&#39;user2.test@gmail.com&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+\.*\w+@\w+\.\w+&#39;</span><span class="p">,</span> <span class="n">email1</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="s1">&#39;user1@gmail.com&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+\.*\w+@\w+\.\w+&#39;</span><span class="p">,</span> <span class="n">email2</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="s1">&#39;user2.test@gmail.com&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5><code class="docutils literal notranslate"><span class="pre">?</span></code><a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>В последнем примере регулярное выражение указывает, что точка
необязательна, но в то же время определяет, что она может
появиться много раз.</p>
<p>В этой ситуации логичней использовать знак вопроса. Он обозначает ноль
или одно повторение предыдущего выражения или символа. Теперь регулярное
выражение выглядит так <code class="docutils literal notranslate"><span class="pre">\w+\.?\w+&#64;\w+\.\w+</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">mail_log</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jun 18 14:10:35 client-ip=154.10.180.10 from=user1@gmail.com, size=551&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>             <span class="s1">&#39;Jun 18 14:11:05 client-ip=150.10.180.10 from=user2.test@gmail.com, size=768&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">mail_log</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+\.?\w+@\w+\.\w+&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found email: &quot;</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
     <span class="o">...</span><span class="p">:</span>
<span class="n">Found</span> <span class="n">email</span><span class="p">:</span>  <span class="n">user1</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span>
<span class="n">Found</span> <span class="n">email</span><span class="p">:</span>  <span class="n">user2</span><span class="o">.</span><span class="n">test</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</div>
<div class="section" id="n">
<h5><code class="docutils literal notranslate"><span class="pre">{n}</span></code><a class="headerlink" href="#n" title="Ссылка на этот заголовок">¶</a></h5>
<p>С помощью фигурных скобок можно указать, сколько раз должно повторяться
предшествующее выражение.</p>
<p>Например, выражение <code class="docutils literal notranslate"><span class="pre">\w{4}\.\w{4}\.\w{4}</span></code> описывает 12 букв или цифр,
которые разделены на три группы по четыре символа точками. Таким образом
можно получить MAC-адрес:</p>
<div class="code py highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;100     aab1.a1a1.a5d3    FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w</span><span class="si">{4}</span><span class="s1">\.\w</span><span class="si">{4}</span><span class="s1">\.\w</span><span class="si">{4}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="s1">&#39;aab1.a1a1.a5d3&#39;</span>
</pre></div>
</div>
<p>В фигурных скобках можно указывать и диапазон повторений. Например,
попробуем получить все номера VLAN из строки mac_table:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">mac_table</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    ...: sw1#sh mac address-table</span>
<span class="s1">    ...:           Mac Address Table</span>
<span class="s1">    ...: -------------------------------------------</span>
<span class="s1">    ...:</span>
<span class="s1">    ...: Vlan    Mac Address       Type        Ports</span>
<span class="s1">    ...: ----    -----------       --------    -----</span>
<span class="s1">    ...:  100    a1b2.ac10.7000    DYNAMIC     Gi0/1</span>
<span class="s1">    ...:  200    a0d4.cb20.7000    DYNAMIC     Gi0/2</span>
<span class="s1">    ...:  300    acb4.cd30.7000    DYNAMIC     Gi0/3</span>
<span class="s1">    ...: 1100    a2bb.ec40.7000    DYNAMIC     Gi0/4</span>
<span class="s1">    ...:  500    aa4b.c550.7000    DYNAMIC     Gi0/5</span>
<span class="s1">    ...: 1200    a1bb.1c60.7000    DYNAMIC     Gi0/6</span>
<span class="s1">    ...: 1300    aa0b.cc70.7000    DYNAMIC     Gi0/7</span>
<span class="s1">    ...: &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Так как search ищет только первое совпадение, в выражение <code class="docutils literal notranslate"><span class="pre">\d{1,4}</span></code>
попадет номер VLAN:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mac_table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d{1,4}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;VLAN: &#39;</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">1</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">100</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">200</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">300</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">1100</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">500</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">1200</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">1300</span>
</pre></div>
</div>
<p>Выражение <code class="docutils literal notranslate"><span class="pre">\d{1,4}</span></code> описывает от одной до четырех цифр.</p>
<p>Обратите внимание, что в выводе команды с оборудования нет VLAN с номером 1.
При этом регулярное выражение получило откуда-то число 1.
Цифра 1 попала в вывод из имени хоста в строке <code class="docutils literal notranslate"><span class="pre">sw1#sh</span> <span class="pre">mac</span> <span class="pre">address-table</span></code>.</p>
<p>Чтобы исправить это, достаточно дополнить выражение и указать, что после
цифр должен идти хотя бы один пробел:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mac_table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d{1,4} +&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;VLAN: &#39;</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">100</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">200</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">300</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">1100</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">500</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">1200</span>
<span class="n">VLAN</span><span class="p">:</span>  <span class="mi">1300</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/14_regex/spec_sym"></span><div class="section" id="id1">
<h4>Специальные символы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">.</span></code> - любой символ, кроме символа новой строки</li>
<li><code class="docutils literal notranslate"><span class="pre">^</span></code> - начало строки</li>
<li><code class="docutils literal notranslate"><span class="pre">$</span></code> - конец строки</li>
<li><code class="docutils literal notranslate"><span class="pre">[abc]</span></code> - любой символ в скобках</li>
<li><code class="docutils literal notranslate"><span class="pre">[^abc]</span></code> - любой символ, кроме тех, что в скобках</li>
<li><code class="docutils literal notranslate"><span class="pre">a|b</span></code> - элемент a или b</li>
<li><code class="docutils literal notranslate"><span class="pre">(regex)</span></code> - выражение рассматривается как один элемент. Кроме того,
подстрока, которая совпала с выражением, запоминается</li>
</ul>
<div class="section" id="id2">
<h5><code class="docutils literal notranslate"><span class="pre">.</span></code><a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Точка обозначает любой символ.</p>
<p>Чаще всего точка используется с символами повторения <code class="docutils literal notranslate"><span class="pre">+</span></code> и <code class="docutils literal notranslate"><span class="pre">*</span></code>,
чтобы указать, что между определенными выражениями могут находиться
любые символы.</p>
<p>Например, с помощью выражения <code class="docutils literal notranslate"><span class="pre">Interface.+Port</span> <span class="pre">ID.+</span></code> можно описать
строку с интерфейсами в выводе sh cdp neighbors detail:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">cdp</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">   ...: SW1#show cdp neighbors detail</span>
<span class="s1">   ...: -------------------------</span>
<span class="s1">   ...: Device ID: SW2</span>
<span class="s1">   ...: Entry address(es):</span>
<span class="s1">   ...:   IP address: 10.1.1.2</span>
<span class="s1">   ...: Platform: cisco WS-C2960-8TC-L,  Capabilities: Switch IGMP</span>
<span class="s1">   ...: Interface: GigabitEthernet1/0/16,  Port ID (outgoing port): GigabitEthernet0/1</span>
<span class="s1">   ...: Holdtime : 164 sec</span>
<span class="s1">   ...: &#39;&#39;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Interface.+Port ID.+&#39;</span><span class="p">,</span> <span class="n">cdp</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;Interface: GigabitEthernet1/0/16,  Port ID (outgoing port): GigabitEthernet0/1&#39;</span>
</pre></div>
</div>
<p>В результат попала только одна строка, так как точка обозначает любой
символ, кроме символа перевода строки. Кроме того, символы повторения
<code class="docutils literal notranslate"><span class="pre">+</span></code> и <code class="docutils literal notranslate"><span class="pre">*</span></code> по умолчанию захватывают максимально длинную строку. Этот
аспект рассматривается в подразделе «Жадность символов повторения».</p>
</div>
<div class="section" id="id3">
<h5><code class="docutils literal notranslate"><span class="pre">^</span></code><a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Символ <code class="docutils literal notranslate"><span class="pre">^</span></code> означает начало строки. Выражению <code class="docutils literal notranslate"><span class="pre">^\d+</span></code> соответствует
подстрока:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;100     aa12.35fe.a5d3    FastEthernet0/1&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\d+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;100&#39;</span>
</pre></div>
</div>
<p>Символы с начала строки и до решетки (включая решетку):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">prompt</span> <span class="o">=</span> <span class="s1">&#39;SW1#show cdp neighbors detail&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^.+#&#39;</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;SW1#&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5><code class="docutils literal notranslate"><span class="pre">$</span></code><a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Символ <code class="docutils literal notranslate"><span class="pre">$</span></code> обозначает конец строки.</p>
<p>Выражение <code class="docutils literal notranslate"><span class="pre">\S+$</span></code> описывает любые символы, кроме whitespace в конце
строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;100     aa12.35fe.a5d3    FastEthernet0/1&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\S+$&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet0/1&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5><code class="docutils literal notranslate"><span class="pre">[]</span></code><a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Символы, которые перечислены в квадратных скобках, означают, что любой
из этих символов будет совпадением. Таким образом можно описывать разные
регистры:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;100     aa12.35fe.a5d3    FastEthernet0/1&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[Ff]ast&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;Fast&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[Ff]ast[Ee]thernet&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet&#39;</span>
</pre></div>
</div>
<p>С помощью квадратных скобок можно указать, какие символы могут
встречаться на конкретной позиции. Например, выражение <code class="docutils literal notranslate"><span class="pre">^.+[&gt;#]</span></code>
описывает символы с начала строки и до решетки или знака больше (включая
их). С помощью такого выражения можно получить имя устройства:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SW1#show cdp neighbors detail&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>             <span class="s1">&#39;SW1&gt;sh ip int br&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>             <span class="s1">&#39;r1-london-core# sh ip route&#39;</span><span class="p">]</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^.+[&gt;#]&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">SW1</span><span class="c1">#</span>
<span class="n">SW1</span><span class="o">&gt;</span>
<span class="n">r1</span><span class="o">-</span><span class="n">london</span><span class="o">-</span><span class="n">core</span><span class="c1">#</span>
</pre></div>
</div>
<p>В квадратных скобках можно указывать диапазоны символов. Например, таким
образом можно указать, что нас интересует любая цифра от 0 до 9:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;100     aa12.35fe.a5d3    FastEthernet0/1&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[0-9]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="s1">&#39;100&#39;</span>
</pre></div>
</div>
<p>Аналогичным образом можно указать буквы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;100     aa12.35fe.a5d3    FastEthernet0/1&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-z]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;aa&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[A-Z]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="s1">&#39;F&#39;</span>
</pre></div>
</div>
<p>В квадратных скобках можно указывать несколько диапазонов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;100     aa12.35fe.a5d3    FastEthernet0/1&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-f0-9]+\.[a-f0-9]+\.[a-f0-9]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="s1">&#39;aa12.35fe.a5d3&#39;</span>
</pre></div>
</div>
<p>Выражение <code class="docutils literal notranslate"><span class="pre">[a-f0-9]+\.[a-f0-9]+\.[a-f0-9]+</span></code> описывает три группы
символов, разделенных точкой. Символами в каждой группе могут быть буквы
a-f или цифры 0-9. Это выражение описывает MAC-адрес.</p>
<p>Еще одна особенность квадратных скобок - специальные символы внутри
квадратных скобок теряют свое специальное значение и обозначают просто
символ. Например, точка внутри квадратных скобок будет обозначать точку,
а не любой символ.</p>
<p>Выражение <code class="docutils literal notranslate"><span class="pre">[a-f0-9]+[./][a-f0-9]+</span></code> описывает три группы символов:</p>
<ol class="arabic simple">
<li>буквы a-f или цифры от 0 до 9</li>
<li>точка или слеш</li>
<li>буквы a-f или цифры от 0 до 9</li>
</ol>
<p>Для строки line совпадением будет такая подстрока:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;100     aa12.35fe.a5d3    FastEthernet0/1&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-f0-9]+[./][a-f0-9]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="s1">&#39;aa12.35fe&#39;</span>
</pre></div>
</div>
<p>Если после открывающейся квадратной скобки указан символ <code class="docutils literal notranslate"><span class="pre">^</span></code>,
совпадением будет любой символ, кроме указанных в скобках:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;FastEthernet0/0    15.0.15.1       YES manual up         up&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="s1">&#39;0/0    15.0.15.1       &#39;</span>
</pre></div>
</div>
<p>В данном случае выражение описывает все, кроме букв.</p>
</div>
<div class="section" id="id6">
<h5><code class="docutils literal notranslate"><span class="pre">|</span></code><a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Вертикальная черта работает как „или“:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;100     aa12.35fe.a5d3    FastEthernet0/1&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Fast|0/1&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="s1">&#39;Fast&#39;</span>
</pre></div>
</div>
<p>Обратите внимание на то, как срабатывает <code class="docutils literal notranslate"><span class="pre">|</span></code> - Fast и 0/1
воспринимаются как целое выражение. То есть, в итоге выражение означает,
что мы ищем Fast или 0/1, а не то, что мы ищем Fas, затем t или 0 и 0/1.</p>
</div>
<div class="section" id="id7">
<h5><code class="docutils literal notranslate"><span class="pre">()</span></code><a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скобки используются для группировки выражений. Как и в математических
выражениях, с помощью скобок можно указать, к каким элементам
применяется операция.</p>
<p>Например, выражение <code class="docutils literal notranslate"><span class="pre">[0-9]([a-f]|[0-9])[0-9]</span></code> описывает три символа:
цифра, потом буква или цифра и цифра:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;100     aa12.35fe.a5d3    FastEthernet0/1&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[0-9]([a-f]|[0-9])[0-9]&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="s1">&#39;100&#39;</span>
</pre></div>
</div>
<p>Скобки позволяют указывать, какое выражение является одним целым. Это
особенно полезно при использовании символов повторения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;FastEthernet0/0    15.0.15.1       YES manual up         up&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([0-9]+\.)+[0-9]+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="s1">&#39;15.0.15.1&#39;</span>
</pre></div>
</div>
<p>Скобки позволяют не только группировать выражения. Строка, которая
совпала с выражением в скобках, запоминается. Ее можно получить отдельно
с помощью специальных методов groups и group(n). Это рассматривается в
подразделе «Группировка выражений».</p>
</div>
</div>
<span id="document-book/14_regex/greedy_re"></span><div class="section" id="id1">
<h4>Жадность символов повторения<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>По умолчанию символы повторения в регулярных выражениях жадные (greedy).
Это значит, что результирующая подстрока, которая соответствует шаблону,
будет наиболее длинной.</p>
<p>Пример жадного поведения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">re</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&lt;text line&gt; some text&gt;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;.*&gt;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;&lt;text line&gt; some text&gt;&#39;</span>
</pre></div>
</div>
<p>То есть, в данном случае выражение захватило максимально возможный кусок
символов, заключенный в &lt;&gt;.</p>
<p>Если нужно отключить жадность, достаточно добавить знак вопроса после
символов повторения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&lt;text line&gt; some text&gt;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;.*?&gt;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;&lt;text line&gt;&#39;</span>
</pre></div>
</div>
<p>Зачастую жадность наоборот полезна. Например, без отключения жадности
последнего плюса, выражение <code class="docutils literal notranslate"><span class="pre">\d+\s+\S+</span></code> описывает такую строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;1500     aab1.a1a1.a5d3    FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+\s+\S+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s1">&#39;1500     aab1.a1a1.a5d3&#39;</span>
</pre></div>
</div>
<p>Символ <code class="docutils literal notranslate"><span class="pre">\S</span></code> обозначает все, кроме пробельных символов. Поэтому выражение
<code class="docutils literal notranslate"><span class="pre">\S+</span></code> с жадным символом повторения описывает максимально длинную
строку до первого whitespace символа. В данном случае - до первого
пробела.</p>
<p>Если отключить жадность, результат будет таким:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+\s+\S+?&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;1500     a&#39;</span>
</pre></div>
</div>
</div>
<span id="document-book/14_regex/re_groups"></span><div class="section" id="id1">
<h4>Группировка выражений<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Группировка выражений указывает, что последовательность символов надо
рассматривать как одно целое. Однако это не единственное преимущество
группировки.</p>
<p>Кроме этого, с помощью групп можно получать только определенную часть
строки, которая была описана выражением. Это очень полезно в ситуациях,
когда надо описать строку достаточно подробно, чтобы отобрать нужные
строки, но в то же время из самой строки надо получить только
определенное значение.</p>
<p>Например, из log-файла надо отобрать строки, в которых встречается
«%SW_MATM-4-MACFLAP_NOTIF», а затем из каждой такой строки получить
MAC-адрес, VLAN и интерфейсы. В этом случае регулярное выражение просто
должно описывать строку, а все части строки, которые надо получить в
результате, просто заключаются в скобки.</p>
<p>В Python есть два варианта использования групп:</p>
<ul class="simple">
<li>Нумерованные группы</li>
<li>Именованные группы</li>
</ul>
<div class="section" id="id2">
<h5>Нумерованные группы<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Группа определяется помещением выражения в круглые скобки <code class="docutils literal notranslate"><span class="pre">()</span></code>.</p>
<p>Внутри выражения группы нумеруются слева направо, начиная с 1.
Затем к группам можно обращаться по номерам и получать текст, который
соответствует выражению в группе.</p>
<p>Пример использования групп:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;FastEthernet0/1            10.0.12.1       YES manual up                    up&quot;</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\S+)\s+([\w.]+)\s+.*&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>В данном примере указаны две группы:</p>
<ul class="simple">
<li>первая группа - любые символы, кроме пробельных</li>
<li>вторая группа - любая буква или цифра (символ <code class="docutils literal notranslate"><span class="pre">\w</span></code>) или точка</li>
</ul>
<p>Вторую группу можно было описать так же, как и первую. Другой
вариант сделан просто для примера</p>
<p>Теперь можно обращаться к группам по номеру. Группа 0 - это строка,
которая соответствует всему шаблону:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet0/1            10.0.12.1       YES manual up                    up&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="s1">&#39;10.0.12.1&#39;</span>
</pre></div>
</div>
<p>При необходимости можно перечислить несколько номеров групп:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.12.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;10.0.12.1&#39;</span><span class="p">,</span> <span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.12.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Начиная с версии Python 3.6, к группам можно обращаться таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet0/1            10.0.12.1       YES manual up                    up&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;10.0.12.1&#39;</span>
</pre></div>
</div>
<p>Для вывода всех подстрок, которые соответствуют указанным группам,
используется метод groups:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.12.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Именованные группы<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Когда выражение сложное, не очень удобно определять номер группы.
Плюс, при дополнении выражения, может получиться так, что порядок
групп изменился, и придется изменить и код, который ссылается на группы.</p>
<p>Именованные группы позволяют задавать группе имя.</p>
<p>Синтаксис именованной группы <code class="docutils literal notranslate"><span class="pre">(?P&lt;name&gt;regex)</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;FastEthernet0/1            10.0.12.1       YES manual up                    up&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;intf&gt;\S+)\s+(?P&lt;address&gt;[\d.]+)\s+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь к этим группам можно обращаться по имени:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;intf&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="s1">&#39;FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="s1">&#39;10.0.12.1&#39;</span>
</pre></div>
</div>
<p>Также очень полезно то, что с помощью метода groupdict(), можно получить
словарь, где ключи - имена групп, а значения - подстроки, которые им
соответствуют:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;10.0.12.1&#39;</span><span class="p">,</span> <span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>И в таком случае можно добавить группы в регулярное выражение и
полагаться на их имя, а не на порядок:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;intf&gt;\S+)\s+(?P&lt;address&gt;[\d\.]+)\s+\w+\s+\w+\s+(?P&lt;status&gt;up|down)\s+(?P&lt;protocol&gt;up|down)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;10.0.12.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
 <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/14_regex/group_example"></span><div class="section" id="show-ip-dhcp-snooping">
<h4>Разбор вывода команды show ip dhcp snooping с помощью именованных групп<a class="headerlink" href="#show-ip-dhcp-snooping" title="Ссылка на этот заголовок">¶</a></h4>
<p>Рассмотрим еще один пример использования именованных групп.
В этом примере задача в том, чтобы получить из вывода команды show ip
dhcp snooping binding поля: MAC-адрес, IP-адрес, VLAN и интерфейс.</p>
<p>В файле dhcp_snooping.txt находится вывод команды show ip dhcp snooping
binding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MacAddress</span>          <span class="n">IpAddress</span>     <span class="n">Lease</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>  <span class="n">Type</span>           <span class="n">VLAN</span>  <span class="n">Interface</span>
<span class="o">------------------</span>  <span class="o">------------</span>  <span class="o">----------</span>  <span class="o">-------------</span>  <span class="o">----</span>  <span class="o">--------------------</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BB</span><span class="p">:</span><span class="mi">3</span><span class="n">D</span><span class="p">:</span><span class="n">D6</span><span class="p">:</span><span class="mi">58</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.2</span>     <span class="mi">86250</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">10</span>    <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="n">A3</span><span class="p">:</span><span class="mi">3</span><span class="n">E</span><span class="p">:</span><span class="mi">5</span><span class="n">B</span><span class="p">:</span><span class="mi">69</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">5.2</span>      <span class="mi">63951</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">5</span>     <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">10</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="n">B3</span><span class="p">:</span><span class="mi">7</span><span class="n">E</span><span class="p">:</span><span class="mi">9</span><span class="n">B</span><span class="p">:</span><span class="mi">60</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">5.4</span>      <span class="mi">63253</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">5</span>     <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">9</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.6</span>     <span class="mi">76260</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">10</span>    <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">3</span>
<span class="n">Total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">bindings</span><span class="p">:</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Для начала попробуем разобрать одну строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;00:09:BB:3D:D6:58  10.1.10.2 86250   dhcp-snooping   10  FastEthernet0/1&#39;</span>
</pre></div>
</div>
<p>В регулярном выражении именованные группы используются для тех частей
вывода, которые нужно запомнить:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;mac&gt;\S+) +(?P&lt;ip&gt;\S+) +\d+ +\S+ +(?P&lt;vlan&gt;\d+) +(?P&lt;port&gt;\S+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>Комментарии к регулярному выражению:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">(?P&lt;mac&gt;\S+)</span> <span class="pre">+</span></code> - в группу с именем „mac“ попадают любые символы,
кроме пробельных. Получается, что выражение описывает
последовательность любых символов до пробела</li>
<li><code class="docutils literal notranslate"><span class="pre">(?P&lt;ip&gt;\S+)</span> <span class="pre">+</span></code> - тут аналогично: последовательность любых
непробельных символов до пробела. Имя группы „ip“</li>
<li><code class="docutils literal notranslate"><span class="pre">\d+</span> <span class="pre">+</span></code> - числовая последовательность (одна или более цифр), а
затем один или более пробелов</li>
<li>сюда попадет значение Lease</li>
<li><code class="docutils literal notranslate"><span class="pre">\S+</span> <span class="pre">+</span></code>- последовательность любых символов, кроме пробельных</li>
<li>сюда попадает тип соответствия (в данном случае все они
dhcp-snooping)</li>
<li><code class="docutils literal notranslate"><span class="pre">(?P&lt;vlan&gt;\d+)</span> <span class="pre">+</span></code> - именованная группа „vlan“. Сюда попадают только
числовые последовательности с одним или более символами</li>
<li><code class="docutils literal notranslate"><span class="pre">(?P&lt;port&gt;.\S+)</span></code> - именованная группа „port“. Сюда попадают любые
символы, кроме whitespace</li>
</ul>
<p>В результате, метод groupdict вернет такой словарь:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.1.10.2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;mac&#39;</span><span class="p">:</span> <span class="s1">&#39;00:09:BB:3D:D6:58&#39;</span><span class="p">,</span>
 <span class="s1">&#39;vlan&#39;</span><span class="p">:</span> <span class="s1">&#39;10&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Так как регулярное выражение отработало как нужно, можно создавать
скрипт.
В скрипте перебираются все строки файла dhcp_snooping.txt, и на
стандартный поток вывода выводится информация об устройствах.</p>
<p>Файл parse_dhcp_snooping.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1">#&#39;00:09:BB:3D:D6:58   10.1.10.2        86250       dhcp-snooping   10    FastEthernet0/1&#39;</span>
<span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?P&lt;mac&gt;\S+) +(?P&lt;ip&gt;\S+) +\d+ +\S+ +(?P&lt;vlan&gt;\d+) +(?P&lt;port&gt;\S+)&#39;</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;dhcp_snooping.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;К коммутатору подключено </span><span class="si">{}</span><span class="s1"> устройства&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Параметры устройства </span><span class="si">{}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:10}</span><span class="s1">: </span><span class="si">{:10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">comp</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
</pre></div>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_dhcp_snooping.py
К коммутатору подключено 4 устройства
Параметры устройства 1:
    int:    FastEthernet0/1
    ip:    10.1.10.2
    mac:    00:09:BB:3D:D6:58
    vlan:    10
Параметры устройства 2:
    int:    FastEthernet0/10
    ip:    10.1.5.2
    mac:    00:04:A3:3E:5B:69
    vlan:    5
Параметры устройства 3:
    int:    FastEthernet0/9
    ip:    10.1.5.4
    mac:    00:05:B3:7E:9B:60
    vlan:    5
Параметры устройства 4:
    int:    FastEthernet0/3
    ip:    10.1.10.6
    mac:    00:09:BC:3F:A6:50
    vlan:    10
</pre></div>
</div>
</div>
<span id="document-book/14_regex/non-capturing_groups"></span><div class="section" id="id1">
<h4>Группа без захвата<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>По умолчанию все, что попало в группу, запоминается. Это называется
группа с захватом.</p>
<p>Иногда скобки нужны для указания части выражения, которое
повторяется. И, при этом, не нужно запоминать выражение.</p>
<p>Например, надо получить MAC-адрес, VLAN и порты из такого лог-сообщения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;Jun  3 14:39:05.941: %SW_MATM-4-MACFLAP_NOTIF: Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>
</pre></div>
</div>
<p>Регулярное выражение, которое описывает нужные подстроки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;((\w</span><span class="si">{4}</span><span class="s1">\.)</span><span class="si">{2}</span><span class="s1">\w</span><span class="si">{4}</span><span class="s1">).+vlan (\d+).+port (\S+).+port (\S+)&#39;</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
</pre></div>
</div>
<p>Выражение состоит из таких частей:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">((\w{4}\.){2}\w{4})</span></code> - сюда попадет MAC-адрес</li>
<li><code class="docutils literal notranslate"><span class="pre">\w{4}\.</span></code> - эта часть описывает 4 буквы или цифры и точку</li>
<li><code class="docutils literal notranslate"><span class="pre">(\w{4}\.){2}</span></code> - тут скобки нужны, чтобы указать, что 4 буквы
или цифры и точка повторяются два раза</li>
<li><code class="docutils literal notranslate"><span class="pre">\w{4}</span></code> - затем 4 буквы или цифры</li>
<li><code class="docutils literal notranslate"><span class="pre">.+vlan</span> <span class="pre">(\d+)</span></code> - в группу попадет номер VLAN</li>
<li><code class="docutils literal notranslate"><span class="pre">.+port</span> <span class="pre">(\S+)</span></code> - первый интерфейс</li>
<li><code class="docutils literal notranslate"><span class="pre">.+port</span> <span class="pre">(\S+)</span></code> - второй интерфейс</li>
</ul>
<p>Метод groups вернет такой результат:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;f03a.b216.7ad7&#39;</span><span class="p">,</span> <span class="s1">&#39;b216.&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/5&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/15&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Второй элемент, по сути, лишний. Он попал в вывод из-за скобок в
выражении <code class="docutils literal notranslate"><span class="pre">(\w{4}\.){2}</span></code>.</p>
<p>В этом случае нужно отключить захват в группе. Это делается добавлением
<code class="docutils literal notranslate"><span class="pre">?:</span></code> после открывающейся скобки группы.</p>
<p>Теперь выражение выглядит так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;((?:\w</span><span class="si">{4}</span><span class="s1">\.)</span><span class="si">{2}</span><span class="s1">\w</span><span class="si">{4}</span><span class="s1">).+vlan (\d+).+port (\S+).+port (\S+)&#39;</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
</pre></div>
</div>
<p>И, соответственно, группы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;f03a.b216.7ad7&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/5&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/15&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<span id="document-book/14_regex/group_reference"></span><div class="section" id="id1">
<h4>Повторение захваченного результата<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>При работе с группами можно использовать результат, который попал в
группу, дальше в этом же выражении.</p>
<p>Например, в выводе sh ip bgp последний столбец описывает атрибут AS Path
(через какие автономные системы прошел маршрут):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">bgp</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">   ...: R9# sh ip bgp | be Network</span>
<span class="s1">   ...:    Network          Next Hop       Metric LocPrf Weight Path</span>
<span class="s1">   ...: *  192.168.66.0/24  192.168.79.7                       0 500 500 500 i</span>
<span class="s1">   ...: *&gt;                  192.168.89.8                       0 800 700 i</span>
<span class="s1">   ...: *  192.168.67.0/24  192.168.79.7         0             0 700 700 700 i</span>
<span class="s1">   ...: *&gt;                  192.168.89.8                       0 800 700 i</span>
<span class="s1">   ...: *  192.168.88.0/24  192.168.79.7                       0 700 700 700 i</span>
<span class="s1">   ...: *&gt;                  192.168.89.8         0             0 800 800 i</span>
<span class="s1">   ...: &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Допустим, надо получить те префиксы, у которых в пути несколько раз
повторяется один и тот же номер AS.</p>
<p>Это можно сделать с помощью ссылки на результат, который был захвачен
группой. Например, такое выражение отображает все строки, в которых один
и тот же номер повторяется хотя бы два раза:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+) \1&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="o">*</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">66.0</span><span class="o">/</span><span class="mi">24</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">79.7</span>                       <span class="mi">0</span> <span class="mi">500</span> <span class="mi">500</span> <span class="mi">500</span> <span class="n">i</span>
<span class="o">*</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">67.0</span><span class="o">/</span><span class="mi">24</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">79.7</span>         <span class="mi">0</span>             <span class="mi">0</span> <span class="mi">700</span> <span class="mi">700</span> <span class="mi">700</span> <span class="n">i</span>
<span class="o">*</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">88.0</span><span class="o">/</span><span class="mi">24</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">79.7</span>                       <span class="mi">0</span> <span class="mi">700</span> <span class="mi">700</span> <span class="mi">700</span> <span class="n">i</span>
<span class="o">*&gt;</span>                  <span class="mf">192.168</span><span class="o">.</span><span class="mf">89.8</span>         <span class="mi">0</span>             <span class="mi">0</span> <span class="mi">800</span> <span class="mi">800</span> <span class="n">i</span>
</pre></div>
</div>
<p>В этом выражении обозначение <code class="docutils literal notranslate"><span class="pre">\1</span></code> подставляет результат, который попал
в группу. Номер один указывает на конкретную группу. В данном случае это
группа 1, она же единственная.</p>
<p>Аналогичным образом можно описать строки, в которых один и тот же номер
встречается три раза:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+) \1 \1&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="o">*</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">66.0</span><span class="o">/</span><span class="mi">24</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">79.7</span>                       <span class="mi">0</span> <span class="mi">500</span> <span class="mi">500</span> <span class="mi">500</span> <span class="n">i</span>
<span class="o">*</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">67.0</span><span class="o">/</span><span class="mi">24</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">79.7</span>         <span class="mi">0</span>             <span class="mi">0</span> <span class="mi">700</span> <span class="mi">700</span> <span class="mi">700</span> <span class="n">i</span>
<span class="o">*</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">88.0</span><span class="o">/</span><span class="mi">24</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">79.7</span>                       <span class="mi">0</span> <span class="mi">700</span> <span class="mi">700</span> <span class="mi">700</span> <span class="n">i</span>
</pre></div>
</div>
<p>Аналогичным образом можно ссылаться на результат, который попал в
именованную группу:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">129</span><span class="p">]:</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
     <span class="o">...</span><span class="p">:</span>     <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;as&gt;\d+) (?P=as)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>
<span class="o">*</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">66.0</span><span class="o">/</span><span class="mi">24</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">79.7</span>                       <span class="mi">0</span> <span class="mi">500</span> <span class="mi">500</span> <span class="mi">500</span> <span class="n">i</span>
<span class="o">*</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">67.0</span><span class="o">/</span><span class="mi">24</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">79.7</span>         <span class="mi">0</span>             <span class="mi">0</span> <span class="mi">700</span> <span class="mi">700</span> <span class="mi">700</span> <span class="n">i</span>
<span class="o">*</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">88.0</span><span class="o">/</span><span class="mi">24</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">79.7</span>                       <span class="mi">0</span> <span class="mi">700</span> <span class="mi">700</span> <span class="mi">700</span> <span class="n">i</span>
<span class="o">*&gt;</span>                   <span class="mf">192.168</span><span class="o">.</span><span class="mf">89.8</span>         <span class="mi">0</span>             <span class="mi">0</span> <span class="mi">800</span> <span class="mi">800</span> <span class="n">i</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-book/15_module_re/index"></span><div class="section" id="re">
<span id="module-re-index"></span><h3>15. Модуль re<a class="headerlink" href="#re" title="Ссылка на этот заголовок">¶</a></h3>
<p>В Python для работы с регулярными выражениями используется модуль
<strong>re</strong>.</p>
<p>Основные функции модуля <strong>re</strong>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">match</span></code> - ищет последовательность в начале строки</li>
<li><code class="docutils literal notranslate"><span class="pre">search</span></code> - ищет первое совпадение с шаблоном</li>
<li><code class="docutils literal notranslate"><span class="pre">findall</span></code> - ищет все совпадения с шаблоном. Возвращает результирующие строки в виде списка</li>
<li><code class="docutils literal notranslate"><span class="pre">finditer</span></code> - ищет все совпадения с шаблоном. Возвращает итератор</li>
<li><code class="docutils literal notranslate"><span class="pre">compile</span></code> - компилирует регулярное выражение. К этому
объекту затем можно применять все перечисленные функции</li>
<li><code class="docutils literal notranslate"><span class="pre">fullmatch</span></code> - вся строка должна соответствовать описанному регулярному выражению</li>
</ul>
<p>Кроме функций для поиска совпадений, в модуле есть такие функции:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">re.sub</span></code> - для замены в строках</li>
<li><code class="docutils literal notranslate"><span class="pre">re.split</span></code> - для разделения строки на части</li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-book/15_module_re/match_object"></span><div class="section" id="match">
<h4>Объект Match<a class="headerlink" href="#match" title="Ссылка на этот заголовок">¶</a></h4>
<p>В модуле re несколько функций возвращают объект Match, если было найдено
совпадение:</p>
<ul class="simple">
<li>search</li>
<li>match</li>
<li>finditer возвращает итератор с объектами Match</li>
</ul>
<p>В этом подразделе рассматриваются методы объекта Match.</p>
<p>Пример объекта Match:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;Jun  3 14:39:05.941: %SW_MATM-4-MACFLAP_NOTIF: Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host (\S+) in vlan (\d+) .* port (\S+) and port (\S+)&#39;</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">match</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">_sre</span><span class="o">.</span><span class="n">SRE_Match</span> <span class="nb">object</span><span class="p">;</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">47</span><span class="p">,</span> <span class="mi">124</span><span class="p">),</span> <span class="n">match</span><span class="o">=</span><span class="s1">&#39;Host f03a.b216.7ad7 in vlan 10 is flapping betwee&gt;&#39;</span>
</pre></div>
</div>
<p>Вывод в 3 строке просто отображает информацию об объекте. Поэтому не
стоит полагаться на то, что отображается в части match, так как
отображаемая строка обрезается по фиксированному количеству знаков.</p>
<div class="section" id="group">
<h5><code class="docutils literal notranslate"><span class="pre">group</span></code><a class="headerlink" href="#group" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод group возвращает подстроку, которая совпала с выражением или с
выражением в группе.</p>
<p>Если метод вызывается без аргументов, отображается вся подстрока:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>
</pre></div>
</div>
<p>Аналогичный вывод возвращает группа 0:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>
</pre></div>
</div>
<p>Другие номера отображают только содержимое соответствующей группы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;f03a.b216.7ad7&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;10&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;Gi0/5&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s1">&#39;Gi0/15&#39;</span>
</pre></div>
</div>
<p>Если вызвать метод group с номером группы, который больше, чем
количество существующих групп, возникнет ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="o">-----------------------------------------------------------------</span>
<span class="ne">IndexError</span>                      <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">18</span><span class="o">-</span><span class="mi">9</span><span class="n">df93fa7b44b</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="ne">IndexError</span><span class="p">:</span> <span class="n">no</span> <span class="n">such</span> <span class="n">group</span>
</pre></div>
</div>
<p>Если вызвать метод с несколькими номерами групп, результатом будет
кортеж со строками, которые соответствуют совпадениям:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;f03a.b216.7ad7&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/5&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>В группу может ничего не попасть, тогда ей будет соответствовать пустая
строка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;Jun  3 14:39:05.941: %SW_MATM-4-MACFLAP_NOTIF: Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host (\S+) in vlan (\D*)&#39;</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>Если группа описывает часть шаблона и совпадений было несколько, метод
отобразит последнее совпадение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;Jun  3 14:39:05.941: %SW_MATM-4-MACFLAP_NOTIF: Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host (\w</span><span class="si">{4}</span><span class="s1">\.)+&#39;</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;b216.&#39;</span>
</pre></div>
</div>
<p>Такой вывод получился из-за того, что выражение в скобках описывает 4
буквы или цифры, точка и после этого стоит плюс. Соответственно, сначала с
выражением в скобках совпала первая часть MAC-адреса, потом вторая. Но
запоминается и возвращается только последнее выражение.</p>
<p>Если в выражении использовались именованные группы, методу group можно
передать имя группы и получить соответствующую подстроку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;Jun  3 14:39:05.941: %SW_MATM-4-MACFLAP_NOTIF: Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host (?P&lt;mac&gt;\S+) &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;in vlan (?P&lt;vlan&gt;\d+) .* &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;port (?P&lt;int1&gt;\S+) &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;and port (?P&lt;int2&gt;\S+)&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="n">log</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;mac&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="s1">&#39;f03a.b216.7ad7&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;int2&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="s1">&#39;Gi0/15&#39;</span>
</pre></div>
</div>
<p>При этом группы доступны и по номеру:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="s1">&#39;Gi0/5&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="s1">&#39;Gi0/15&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="groups">
<h5><code class="docutils literal notranslate"><span class="pre">groups</span></code><a class="headerlink" href="#groups" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">groups</span></code> возвращает кортеж со строками, в котором элементы - это
те подстроки, которые попали в соответствующие группы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;Jun  3 14:39:05.941: %SW_MATM-4-MACFLAP_NOTIF: Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host (\S+) &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;in vlan (\d+) .* &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;port (\S+) &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;and port (\S+)&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="n">log</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;f03a.b216.7ad7&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/5&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/15&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>У метода groups есть опциональный параметр - default. Он срабатывает в
ситуации, когда все, что попадает в группу, опционально.</p>
<p>Например, при такой строке, совпадение будет и в первой группе, и во
второй:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;100     aab1.a1a1.a5d3    FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+) +(\w+)?&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;aab1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Если же в строке нет ничего после пробела, в группу ничего не попадет.
Но совпадение будет, так как в регулярном выражении описано, что группа
опциональна:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;100     &#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+) +(\w+)?&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Соответственно, для второй группы значением будет None.</p>
<p>Если передать методу groups значение default, оно будет возвращаться вместо None:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;100     &#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+) +(\w+)?&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;No match&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;No match&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="groupdict">
<h5><code class="docutils literal notranslate"><span class="pre">groupdict</span></code><a class="headerlink" href="#groupdict" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">groupdict</span></code> возвращает словарь, в котором ключи - имена групп, а
значения - соответствующие строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;Jun  3 14:39:05.941: %SW_MATM-4-MACFLAP_NOTIF: Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host (?P&lt;mac&gt;\S+) &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;in vlan (?P&lt;vlan&gt;\d+) .* &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;port (?P&lt;int1&gt;\S+) &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;and port (?P&lt;int2&gt;\S+)&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="n">log</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;int1&#39;</span><span class="p">:</span> <span class="s1">&#39;Gi0/5&#39;</span><span class="p">,</span> <span class="s1">&#39;int2&#39;</span><span class="p">:</span> <span class="s1">&#39;Gi0/15&#39;</span><span class="p">,</span> <span class="s1">&#39;mac&#39;</span><span class="p">:</span> <span class="s1">&#39;f03a.b216.7ad7&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan&#39;</span><span class="p">:</span> <span class="s1">&#39;10&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="start-end">
<h5><code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">end</span></code><a class="headerlink" href="#start-end" title="Ссылка на этот заголовок">¶</a></h5>
<p>Методы <code class="docutils literal notranslate"><span class="pre">start</span></code> и <code class="docutils literal notranslate"><span class="pre">end</span></code> возвращают индексы начала и конца совпадения с
регулярным выражением.</p>
<p>Если методы вызываются без аргументов, они возвращают индексы для всего
совпадения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;  10     aab1.a1a1.a5d3    FastEthernet0/1  &#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+) +([0-9a-f.]+) +(\S+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="mi">2</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="mi">42</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">line</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">():</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="s1">&#39;10     aab1.a1a1.a5d3    FastEthernet0/1&#39;</span>
</pre></div>
</div>
<p>Методам можно передавать номер или имя группы. Тогда они возвращают
индексы для этой группы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="mi">9</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="mi">23</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">line</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="s1">&#39;aab1.a1a1.a5d3&#39;</span>
</pre></div>
</div>
<p>Аналогично для именованных групп:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;Jun  3 14:39:05.941: %SW_MATM-4-MACFLAP_NOTIF: Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host (?P&lt;mac&gt;\S+) &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;in vlan (?P&lt;vlan&gt;\d+) .* &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;port (?P&lt;int1&gt;\S+) &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;and port (?P&lt;int2&gt;\S+)&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="n">log</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">&#39;mac&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="mi">52</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="s1">&#39;mac&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="mi">66</span>
</pre></div>
</div>
</div>
<div class="section" id="span">
<h5><code class="docutils literal notranslate"><span class="pre">span</span></code><a class="headerlink" href="#span" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">span</span></code> возвращает кортеж с индексом начала и конца подстроки. Он
работает аналогично методам <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">end</span></code>, но возвращает пару чисел.</p>
<p>Без аргументов метод span возвращает индексы для всего совпадения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;  10     aab1.a1a1.a5d3    FastEthernet0/1  &#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+) +([0-9a-f.]+) +(\S+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>Но ему также можно передать номер группы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;  10     aab1.a1a1.a5d3    FastEthernet0/1  &#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+) +([0-9a-f.]+) +(\S+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>
</pre></div>
</div>
<p>Аналогично для именованных групп:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;Jun  3 14:39:05.941: %SW_MATM-4-MACFLAP_NOTIF: Host f03a.b216.7ad7 in vlan 10 is flapping between port Gi0/5 and port Gi0/15&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host (?P&lt;mac&gt;\S+) &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;in vlan (?P&lt;vlan&gt;\d+) .* &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;port (?P&lt;int1&gt;\S+) &#39;</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;and port (?P&lt;int2&gt;\S+)&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>                   <span class="n">log</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="s1">&#39;mac&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mi">66</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="s1">&#39;vlan&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">77</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/15_module_re/search"></span><div class="section" id="search">
<h4>Функция search<a class="headerlink" href="#search" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция <code class="docutils literal notranslate"><span class="pre">search</span></code>:</p>
<ul class="simple">
<li>используется для поиска подстроки, которая соответствует шаблону</li>
<li>возвращает объект Match, если подстрока найдена</li>
<li>возвращает <code class="docutils literal notranslate"><span class="pre">None</span></code>, если подстрока не найдена</li>
</ul>
<p>Функция search подходит в том случае, когда надо найти только одно
совпадение в строке, например, когда регулярное выражение описывает всю
строку или часть строки.</p>
<p>Рассмотрим пример использования функции search в разборе лог-файла.</p>
<p>В файле log.txt находятся лог-сообщения с информацией о том, что один и
тот же MAC слишком быстро переучивается то на одном, то на другом
интерфейсе. Одна из причин таких сообщений - петля в сети.</p>
<p>Содержимое файла log.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">SW_MATM</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">MACFLAP_NOTIF</span><span class="p">:</span> <span class="n">Host</span> <span class="mf">01e2</span><span class="o">.</span><span class="mi">4</span><span class="n">c18</span><span class="o">.</span><span class="mi">0156</span> <span class="ow">in</span> <span class="n">vlan</span> <span class="mi">10</span> <span class="ow">is</span> <span class="n">flapping</span> <span class="n">between</span> <span class="n">port</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">16</span> <span class="ow">and</span> <span class="n">port</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">24</span>
<span class="o">%</span><span class="n">SW_MATM</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">MACFLAP_NOTIF</span><span class="p">:</span> <span class="n">Host</span> <span class="mf">01e2</span><span class="o">.</span><span class="mi">4</span><span class="n">c18</span><span class="o">.</span><span class="mi">0156</span> <span class="ow">in</span> <span class="n">vlan</span> <span class="mi">10</span> <span class="ow">is</span> <span class="n">flapping</span> <span class="n">between</span> <span class="n">port</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">16</span> <span class="ow">and</span> <span class="n">port</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">24</span>
<span class="o">%</span><span class="n">SW_MATM</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">MACFLAP_NOTIF</span><span class="p">:</span> <span class="n">Host</span> <span class="mf">01e2</span><span class="o">.</span><span class="mi">4</span><span class="n">c18</span><span class="o">.</span><span class="mi">0156</span> <span class="ow">in</span> <span class="n">vlan</span> <span class="mi">10</span> <span class="ow">is</span> <span class="n">flapping</span> <span class="n">between</span> <span class="n">port</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">and</span> <span class="n">port</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">19</span>
<span class="o">%</span><span class="n">SW_MATM</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">MACFLAP_NOTIF</span><span class="p">:</span> <span class="n">Host</span> <span class="mf">01e2</span><span class="o">.</span><span class="mi">4</span><span class="n">c18</span><span class="o">.</span><span class="mi">0156</span> <span class="ow">in</span> <span class="n">vlan</span> <span class="mi">10</span> <span class="ow">is</span> <span class="n">flapping</span> <span class="n">between</span> <span class="n">port</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">24</span> <span class="ow">and</span> <span class="n">port</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">16</span>
</pre></div>
</div>
<p>При этом MAC-адрес может прыгать между несколькими портами. В таком
случае очень важно знать, с каких портов прилетает MAC.</p>
<p>Попробуем вычислить, между какими портами и в каком VLAN образовалась
проблема.
Проверка регулярного выражения с одной строкой из log-файла:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">re</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;%SW_MATM-4-MACFLAP_NOTIF: Host 01e2.4c18.0156 in vlan 10 is flapping between port Gi0/16 and port Gi0/24&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host \S+ &#39;</span>
   <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;in vlan (\d+) &#39;</span>
   <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;is flapping between port &#39;</span>
   <span class="o">...</span><span class="p">:</span>                   <span class="sa">r</span><span class="s1">&#39;(\S+) and port (\S+)&#39;</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Регулярное выражение для удобства чтения разбито на части. В нём есть три группы:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">(\d+)</span></code> - описывает номер VLAN</li>
<li><code class="docutils literal notranslate"><span class="pre">(\S+)</span> <span class="pre">and</span> <span class="pre">port</span> <span class="pre">(\S+)</span></code> - в это выражение попадают номера портов</li>
</ul>
<p>В итоге, в группы попали такие части строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/16&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/24&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>В итоговом скрипте файл log.txt обрабатывается построчно, и из каждой
строки собирается информация о портах. Так как порты могут
дублироваться, сразу добавляем их в множество, чтобы получить подборку
уникальных интерфейсов (файл parse_log_search.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">regex</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host \S+ &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;in vlan (\d+) &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;is flapping between port &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;(\S+) and port (\S+)&#39;</span><span class="p">)</span>

<span class="n">ports</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">vlan</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Петля между портами </span><span class="si">{}</span><span class="s1"> в VLAN </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ports</span><span class="p">),</span> <span class="n">vlan</span><span class="p">))</span>
</pre></div>
</div>
<p>Результат выполнения скрипта такой:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_log_search.py
Петля между портами Gi0/19, Gi0/24, Gi0/16 в VLAN 10
</pre></div>
</div>
<div class="section" id="show-cdp-neighbors-detail">
<h5>Обработка вывода show cdp neighbors detail<a class="headerlink" href="#show-cdp-neighbors-detail" title="Ссылка на этот заголовок">¶</a></h5>
<p>Попробуем получить параметры устройств из вывода sh cdp neighbors
detail.</p>
<p>Пример вывода информации для одного соседа:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SW1</span><span class="c1">#show cdp neighbors detail</span>
<span class="o">-------------------------</span>
<span class="n">Device</span> <span class="n">ID</span><span class="p">:</span> <span class="n">SW2</span>
<span class="n">Entry</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.2</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">cisco</span> <span class="n">WS</span><span class="o">-</span><span class="n">C2960</span><span class="o">-</span><span class="mi">8</span><span class="n">TC</span><span class="o">-</span><span class="n">L</span><span class="p">,</span>  <span class="n">Capabilities</span><span class="p">:</span> <span class="n">Switch</span> <span class="n">IGMP</span>
<span class="n">Interface</span><span class="p">:</span> <span class="n">GigabitEthernet1</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span>  <span class="n">Port</span> <span class="n">ID</span> <span class="p">(</span><span class="n">outgoing</span> <span class="n">port</span><span class="p">):</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Holdtime</span> <span class="p">:</span> <span class="mi">164</span> <span class="n">sec</span>

<span class="n">Version</span> <span class="p">:</span>
<span class="n">Cisco</span> <span class="n">IOS</span> <span class="n">Software</span><span class="p">,</span> <span class="n">C2960</span> <span class="n">Software</span> <span class="p">(</span><span class="n">C2960</span><span class="o">-</span><span class="n">LANBASEK9</span><span class="o">-</span><span class="n">M</span><span class="p">),</span> <span class="n">Version</span> <span class="mf">12.2</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span><span class="n">SE9</span><span class="p">,</span> <span class="n">RELEASE</span> <span class="n">SOFTWARE</span> <span class="p">(</span><span class="n">fc1</span><span class="p">)</span>
<span class="n">Technical</span> <span class="n">Support</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">cisco</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">techsupport</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">1986</span><span class="o">-</span><span class="mi">2014</span> <span class="n">by</span> <span class="n">Cisco</span> <span class="n">Systems</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span>
<span class="n">Compiled</span> <span class="n">Mon</span> <span class="mi">03</span><span class="o">-</span><span class="n">Mar</span><span class="o">-</span><span class="mi">14</span> <span class="mi">22</span><span class="p">:</span><span class="mi">53</span> <span class="n">by</span> <span class="n">prod_rel_team</span>

<span class="n">advertisement</span> <span class="n">version</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">VTP</span> <span class="n">Management</span> <span class="n">Domain</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
<span class="n">Native</span> <span class="n">VLAN</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Duplex</span><span class="p">:</span> <span class="n">full</span>
<span class="n">Management</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.2</span>
</pre></div>
</div>
<p>Задача получить такие поля:</p>
<ul class="simple">
<li>имя соседа (Device ID: SW2)</li>
<li>IP-адрес соседа (IP address: 10.1.1.2)</li>
<li>платформу соседа (Platform: cisco WS-C2960-8TC-L)</li>
<li>версию IOS (Cisco IOS Software, C2960 Software (C2960-LANBASEK9-M), Version 12.2(55)SE9, RELEASE SOFTWARE (fc1))</li>
</ul>
<p>И для удобства надо получить данные в виде словаря. Пример итогового
словаря для коммутатора SW2:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;SW2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;10.1.1.2&#39;</span><span class="p">,</span>
         <span class="s1">&#39;platform&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco WS-C2960-8TC-L&#39;</span><span class="p">,</span>
         <span class="s1">&#39;ios&#39;</span><span class="p">:</span> <span class="s1">&#39;C2960 Software (C2960-LANBASEK9-M), Version 12.2(55)SE9&#39;</span><span class="p">}}</span>
</pre></div>
</div>
<p>Пример проверяется на файле sh_cdp_neighbors_sw1.txt.</p>
<p>Первый вариант решения (файл parse_sh_cdp_neighbors_detail_ver1.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>


<span class="k">def</span> <span class="nf">parse_cdp</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Device ID&#39;</span><span class="p">):</span>
                <span class="n">neighbor</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Device ID: (\S+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">neighbor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;  IP address&#39;</span><span class="p">):</span>
                <span class="n">ip</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;IP address: (\S+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">neighbor</span><span class="p">][</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ip</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Platform&#39;</span><span class="p">):</span>
                <span class="n">platform</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Platform: (\S+ \S+),&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">neighbor</span><span class="p">][</span><span class="s1">&#39;platform&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Cisco IOS Software&#39;</span><span class="p">):</span>
                <span class="n">ios</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Cisco IOS Software, (.+), RELEASE&#39;</span><span class="p">,</span>
                                <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">neighbor</span><span class="p">][</span><span class="s1">&#39;ios&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ios</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="n">pprint</span><span class="p">(</span><span class="n">parse_cdp</span><span class="p">(</span><span class="s1">&#39;sh_cdp_neighbors_sw1.txt&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Тут нужные строки отбираются с помощью метода строк startswith. И в
строке с помощью регулярного выражения получается требуемая часть
строки.
В итоге все собирается в словарь.</p>
<p>Результат выглядит так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_sh_cdp_neighbors_detail_ver1.py
{&#39;R1&#39;: {&#39;ios&#39;: &#39;3800 Software (C3825-ADVENTERPRISEK9-M), Version 12.4(24)T1&#39;,
        &#39;ip&#39;: &#39;10.1.1.1&#39;,
        &#39;platform&#39;: &#39;Cisco 3825&#39;},
 &#39;R2&#39;: {&#39;ios&#39;: &#39;2900 Software (C3825-ADVENTERPRISEK9-M), Version 15.2(2)T1&#39;,
        &#39;ip&#39;: &#39;10.2.2.2&#39;,
        &#39;platform&#39;: &#39;Cisco 2911&#39;},
 &#39;SW2&#39;: {&#39;ios&#39;: &#39;C2960 Software (C2960-LANBASEK9-M), Version 12.2(55)SE9&#39;,
         &#39;ip&#39;: &#39;10.1.1.2&#39;,
         &#39;platform&#39;: &#39;cisco WS-C2960-8TC-L&#39;}}
</pre></div>
</div>
<p>Все получилось как нужно, но эту задачу можно решить более компактно.</p>
<p>Вторая версия решения (файл parse_sh_cdp_neighbors_detail_ver2.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>


<span class="k">def</span> <span class="nf">parse_cdp</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Device ID: (?P&lt;device&gt;\S+)&#39;</span>
             <span class="sa">r</span><span class="s1">&#39;|IP address: (?P&lt;ip&gt;\S+)&#39;</span>
             <span class="sa">r</span><span class="s1">&#39;|Platform: (?P&lt;platform&gt;\S+ \S+),&#39;</span>
             <span class="sa">r</span><span class="s1">&#39;|Cisco IOS Software, (?P&lt;ios&gt;.+), RELEASE&#39;</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">lastgroup</span> <span class="o">==</span> <span class="s1">&#39;device&#39;</span><span class="p">:</span>
                    <span class="n">device</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">lastgroup</span><span class="p">)</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">device</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">elif</span> <span class="n">device</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="n">match</span><span class="o">.</span><span class="n">lastgroup</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span>
                        <span class="n">match</span><span class="o">.</span><span class="n">lastgroup</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="n">pprint</span><span class="p">(</span><span class="n">parse_cdp</span><span class="p">(</span><span class="s1">&#39;sh_cdp_neighbors_sw1.txt&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Пояснения ко второму варианту:</p>
<ul class="simple">
<li>в регулярном выражении описаны все варианты строк через знак или <code class="docutils literal notranslate"><span class="pre">|</span></code></li>
<li>без проверки строки ищется совпадение</li>
<li>если совпадение найдено, проверяется метод lastgroup</li>
<li>метод lastgroup возвращает имя последней именованной группы в регулярном
выражении, для которой было найдено совпадение</li>
<li>если было найдено совпадение для группы device, в переменную device записывается значение,
которое попало в эту группу</li>
<li>иначе в словарь записывается соответствие „имя группы“: соответствующее значение</li>
</ul>
<p>Результат будет таким же:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_sh_cdp_neighbors_detail_ver2.py
{&#39;R1&#39;: {&#39;ios&#39;: &#39;3800 Software (C3825-ADVENTERPRISEK9-M), Version 12.4(24)T1&#39;,
        &#39;ip&#39;: &#39;10.1.1.1&#39;,
        &#39;platform&#39;: &#39;Cisco 3825&#39;},
 &#39;R2&#39;: {&#39;ios&#39;: &#39;2900 Software (C3825-ADVENTERPRISEK9-M), Version 15.2(2)T1&#39;,
        &#39;ip&#39;: &#39;10.2.2.2&#39;,
        &#39;platform&#39;: &#39;Cisco 2911&#39;},
 &#39;SW2&#39;: {&#39;ios&#39;: &#39;C2960 Software (C2960-LANBASEK9-M), Version 12.2(55)SE9&#39;,
         &#39;ip&#39;: &#39;10.1.1.2&#39;,
         &#39;platform&#39;: &#39;cisco WS-C2960-8TC-L&#39;}}
</pre></div>
</div>
</div>
</div>
<span id="document-book/15_module_re/match"></span><div class="section" id="match">
<h4>Функция match<a class="headerlink" href="#match" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция <code class="docutils literal notranslate"><span class="pre">match()</span></code>:</p>
<ul class="simple">
<li>используется для поиска в начале строки подстроки, которая соответствует шаблону</li>
<li>возвращает объект Match, если подстрока найдена</li>
<li>возвращает <code class="docutils literal notranslate"><span class="pre">None</span></code>, если подстрока не найдена</li>
</ul>
<p>Функция match отличается от search тем, что match всегда ищет совпадение
в начале строки. Например, если повторить пример, который использовался
для функции search, но уже с match:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">re</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">log</span> <span class="o">=</span> <span class="s1">&#39;%SW_MATM-4-MACFLAP_NOTIF: Host 01e2.4c18.0156 in vlan 10 is flapping between port Gi0/16 and port Gi0/24&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host \S+ &#39;</span>
   <span class="o">...</span><span class="p">:</span>                  <span class="sa">r</span><span class="s1">&#39;in vlan (\d+) &#39;</span>
   <span class="o">...</span><span class="p">:</span>                  <span class="sa">r</span><span class="s1">&#39;is flapping between port &#39;</span>
   <span class="o">...</span><span class="p">:</span>                  <span class="sa">r</span><span class="s1">&#39;(\S+) and port (\S+)&#39;</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Результатом будет None:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
<span class="kc">None</span>
</pre></div>
</div>
<p>Так получилось из-за того, что match ищет слово Host в начале строки. Но
это сообщение находится в середине.</p>
<p>В данном случае можно легко исправить выражение, чтобы функция match
находила совпадение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\S+: Host \S+ &#39;</span>
   <span class="o">...</span><span class="p">:</span>                  <span class="sa">r</span><span class="s1">&#39;in vlan (\d+) &#39;</span>
   <span class="o">...</span><span class="p">:</span>                  <span class="sa">r</span><span class="s1">&#39;is flapping between port &#39;</span>
   <span class="o">...</span><span class="p">:</span>                  <span class="sa">r</span><span class="s1">&#39;(\S+) and port (\S+)&#39;</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Перед словом Host добавлено выражение <code class="docutils literal notranslate"><span class="pre">\S+:</span></code>. Теперь совпадение будет
найдено:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">_sre</span><span class="o">.</span><span class="n">SRE_Match</span> <span class="nb">object</span><span class="p">;</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">104</span><span class="p">),</span> <span class="n">match</span><span class="o">=</span><span class="s1">&#39;%SW_MATM-4-MACFLAP_NOTIF: Host 01e2.4c18.0156 in &#39;</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/16&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/24&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Пример аналогичен тому, который использовался в функции search, с
небольшими изменениями (файл parse_log_match.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">regex</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\S+: Host \S+ &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;in vlan (\d+) &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;is flapping between port &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;(\S+) and port (\S+)&#39;</span><span class="p">)</span>

<span class="n">ports</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">vlan</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Петля между портами </span><span class="si">{}</span><span class="s1"> в VLAN </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ports</span><span class="p">),</span> <span class="n">vlan</span><span class="p">))</span>
</pre></div>
</div>
<p>Результат:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_log_match.py
Петля между портами Gi0/19, Gi0/24, Gi0/16 в VLAN 10
</pre></div>
</div>
</div>
<span id="document-book/15_module_re/finditer"></span><div class="section" id="finditer">
<h4>Функция finditer<a class="headerlink" href="#finditer" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция <code class="docutils literal notranslate"><span class="pre">finditer()</span></code>:</p>
<ul class="simple">
<li>используется для поиска всех непересекающихся совпадений в шаблоне</li>
<li>возвращает итератор с объектами Match</li>
<li>finditer возвращает итератор даже в том случае, когда совпадение не найдено</li>
</ul>
<p>Функция finditer отлично подходит для обработки тех команд, вывод
которых отображается столбцами. Например, sh ip int br, sh mac
address-table и др. В этом случае его можно применять ко всему выводу
команды.</p>
<p>Пример вывода sh ip int br:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">sh_ip_int_br</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">   ...: R1#show ip interface brief</span>
<span class="s1">   ...: Interface             IP-Address      OK? Method Status           Protocol</span>
<span class="s1">   ...: FastEthernet0/0       15.0.15.1       YES manual up               up</span>
<span class="s1">   ...: FastEthernet0/1       10.0.12.1       YES manual up               up</span>
<span class="s1">   ...: FastEthernet0/2       10.0.13.1       YES manual up               up</span>
<span class="s1">   ...: FastEthernet0/3       unassigned      YES unset  up               up</span>
<span class="s1">   ...: Loopback0             10.1.1.1        YES manual up               up</span>
<span class="s1">   ...: Loopback100           100.0.0.1       YES manual up               up</span>
<span class="s1">   ...: &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Регулярное выражение для обработки вывода:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\S+) +&#39;</span>
   <span class="o">...</span><span class="p">:</span>                      <span class="sa">r</span><span class="s1">&#39;([\d.]+) +&#39;</span>
   <span class="o">...</span><span class="p">:</span>                      <span class="sa">r</span><span class="s1">&#39;\w+ +\w+ +&#39;</span>
   <span class="o">...</span><span class="p">:</span>                      <span class="sa">r</span><span class="s1">&#39;(up|down|administratively down) +&#39;</span>
   <span class="o">...</span><span class="p">:</span>                      <span class="sa">r</span><span class="s1">&#39;(up|down)&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>                      <span class="n">sh_ip_int_br</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>В переменной result находится итератор:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">callable_iterator</span> <span class="n">at</span> <span class="mh">0xb583f46c</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>В итераторе находятся объекты Match:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
    <span class="o">...</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">_sre</span><span class="o">.</span><span class="n">SRE_Match</span> <span class="nb">object</span><span class="p">;</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">103</span><span class="p">,</span> <span class="mi">171</span><span class="p">),</span> <span class="n">match</span><span class="o">=</span><span class="s1">&#39;FastEthernet0/0       15.0.15.1       YES manual &gt;</span>
<span class="o">&lt;</span><span class="n">_sre</span><span class="o">.</span><span class="n">SRE_Match</span> <span class="nb">object</span><span class="p">;</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">172</span><span class="p">,</span> <span class="mi">240</span><span class="p">),</span> <span class="n">match</span><span class="o">=</span><span class="s1">&#39;FastEthernet0/1       10.0.12.1       YES manual &gt;</span>
<span class="o">&lt;</span><span class="n">_sre</span><span class="o">.</span><span class="n">SRE_Match</span> <span class="nb">object</span><span class="p">;</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">241</span><span class="p">,</span> <span class="mi">309</span><span class="p">),</span> <span class="n">match</span><span class="o">=</span><span class="s1">&#39;FastEthernet0/2       10.0.13.1       YES manual &gt;</span>
<span class="o">&lt;</span><span class="n">_sre</span><span class="o">.</span><span class="n">SRE_Match</span> <span class="nb">object</span><span class="p">;</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">379</span><span class="p">,</span> <span class="mi">447</span><span class="p">),</span> <span class="n">match</span><span class="o">=</span><span class="s1">&#39;Loopback0             10.1.1.1        YES manual &gt;</span>
<span class="o">&lt;</span><span class="n">_sre</span><span class="o">.</span><span class="n">SRE_Match</span> <span class="nb">object</span><span class="p">;</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">448</span><span class="p">,</span> <span class="mi">516</span><span class="p">),</span> <span class="n">match</span><span class="o">=</span><span class="s1">&#39;Loopback100           100.0.0.1       YES manual &gt;&#39;</span>
</pre></div>
</div>
<p>Теперь в списке groups находятся кортежи со строками, которые попали в
группы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">groups</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span>
<span class="p">[(</span><span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;15.0.15.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.12.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;FastEthernet0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.13.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;Loopback0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;Loopback100&#39;</span><span class="p">,</span> <span class="s1">&#39;100.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Аналогичный результат можно получить с помощью генератора списков:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(\S+) +([\d.]+) +\w+ +\w+ +(up|down|administratively down) +(up|down)&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">sh_ip_int_br</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span>
<span class="p">[(</span><span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">,</span> <span class="s1">&#39;15.0.15.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;FastEthernet0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.12.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;FastEthernet0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.13.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;Loopback0&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;Loopback100&#39;</span><span class="p">,</span> <span class="s1">&#39;100.0.0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Теперь разберем тот же лог-файл, который использовался в подразделах
search и match.</p>
<p>В этом случае вывод можно не перебирать построчно, а передать все
содержимое файла (файл parse_log_finditer.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">regex</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host \S+ &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;in vlan (\d+) &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;is flapping between port &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;(\S+) and port (\S+)&#39;</span><span class="p">)</span>

<span class="n">ports</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()):</span>
        <span class="n">vlan</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Петля между портами </span><span class="si">{}</span><span class="s1"> в VLAN </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ports</span><span class="p">),</span> <span class="n">vlan</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">В реальной жизни log-файл может быть очень большим. В таком случае,
его лучше обрабатывать построчно.</p>
</div>
<p>Вывод будет таким же:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_log_finditer.py
Петля между портами Gi0/19, Gi0/24, Gi0/16 в VLAN 10
</pre></div>
</div>
<div class="section" id="show-cdp-neighbors-detail">
<h5>Обработка вывода show cdp neighbors detail<a class="headerlink" href="#show-cdp-neighbors-detail" title="Ссылка на этот заголовок">¶</a></h5>
<p>С помощью finditer можно обработать вывод sh cdp neighbors detail, так
же, как и в подразделе re.search.</p>
<p>Скрипт почти полностью аналогичен варианту с re.search (файл
parse_sh_cdp_neighbors_detail_finditer.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>


<span class="k">def</span> <span class="nf">parse_cdp</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Device ID: (?P&lt;device&gt;\S+)&#39;</span>
             <span class="sa">r</span><span class="s1">&#39;|IP address: (?P&lt;ip&gt;\S+)&#39;</span>
             <span class="sa">r</span><span class="s1">&#39;|Platform: (?P&lt;platform&gt;\S+ \S+),&#39;</span>
             <span class="sa">r</span><span class="s1">&#39;|Cisco IOS Software, (?P&lt;ios&gt;.+), RELEASE&#39;</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">match_iter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">match_iter</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">lastgroup</span> <span class="o">==</span> <span class="s1">&#39;device&#39;</span><span class="p">:</span>
                <span class="n">device</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">lastgroup</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">device</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="n">device</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="n">match</span><span class="o">.</span><span class="n">lastgroup</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">lastgroup</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">parse_cdp</span><span class="p">(</span><span class="s1">&#39;sh_cdp_neighbors_sw1.txt&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Теперь совпадения ищутся во всем файле, а не в каждой строке отдельно:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">match_iter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>Затем перебираются совпадения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">match_iter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">match_iter</span><span class="p">:</span>
</pre></div>
</div>
<p>Остальное аналогично.</p>
<p>Результат будет таким:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_sh_cdp_neighbors_detail_finditer.py
{&#39;R1&#39;: {&#39;ios&#39;: &#39;3800 Software (C3825-ADVENTERPRISEK9-M), Version 12.4(24)T1&#39;,
        &#39;ip&#39;: &#39;10.1.1.1&#39;,
        &#39;platform&#39;: &#39;Cisco 3825&#39;},
 &#39;R2&#39;: {&#39;ios&#39;: &#39;2900 Software (C3825-ADVENTERPRISEK9-M), Version 15.2(2)T1&#39;,
        &#39;ip&#39;: &#39;10.2.2.2&#39;,
        &#39;platform&#39;: &#39;Cisco 2911&#39;},
 &#39;SW2&#39;: {&#39;ios&#39;: &#39;C2960 Software (C2960-LANBASEK9-M), Version 12.2(55)SE9&#39;,
         &#39;ip&#39;: &#39;10.1.1.2&#39;,
         &#39;platform&#39;: &#39;cisco WS-C2960-8TC-L&#39;}}
</pre></div>
</div>
<p>Хотя результат аналогичный, с finditer больше возможностей, так как
можно указывать не только то, что должно находиться в нужной строке, но
и в строках вокруг.</p>
<p>Например, можно точнее указать, какой именно IP-адрес надо взять:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Device</span> <span class="n">ID</span><span class="p">:</span> <span class="n">SW2</span>
<span class="n">Entry</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.2</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">cisco</span> <span class="n">WS</span><span class="o">-</span><span class="n">C2960</span><span class="o">-</span><span class="mi">8</span><span class="n">TC</span><span class="o">-</span><span class="n">L</span><span class="p">,</span>  <span class="n">Capabilities</span><span class="p">:</span> <span class="n">Switch</span> <span class="n">IGMP</span>

<span class="o">...</span>

<span class="n">Native</span> <span class="n">VLAN</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Duplex</span><span class="p">:</span> <span class="n">full</span>
<span class="n">Management</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.2</span>
</pre></div>
</div>
<p>Например, если нужно взять первый IP-адрес, можно так дополнить
регулярное выражение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">regex</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Device ID: (?P&lt;device&gt;\S+)&#39;</span>
         <span class="sa">r</span><span class="s1">&#39;|Entry address.*\n +IP address: (?P&lt;ip&gt;\S+)&#39;</span>
         <span class="sa">r</span><span class="s1">&#39;|Platform: (?P&lt;platform&gt;\S+ \S+),&#39;</span>
         <span class="sa">r</span><span class="s1">&#39;|Cisco IOS Software, (?P&lt;ios&gt;.+), RELEASE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/15_module_re/findall"></span><div class="section" id="findall">
<h4>Функция findall<a class="headerlink" href="#findall" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция <code class="docutils literal notranslate"><span class="pre">findall()</span></code>:</p>
<ul class="simple">
<li>используется для поиска всех непересекающихся совпадений в шаблоне</li>
<li>возвращает:<ul>
<li>список строк, которые описаны регулярным выражением,
если в регулярном выражении нет групп</li>
<li>список строк, которые совпали с регулярным выражением в группе, если в
регулярном выражении одна группа</li>
<li>список кортежей, в которых находятся строки,
которые совпали с выражением в группе, если групп несколько</li>
</ul>
</li>
</ul>
<p>Рассмотрим работу findall на примере вывода команды sh mac
address-table:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">mac_address_table</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;CAM_table.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">mac_address_table</span><span class="p">)</span>
<span class="n">sw1</span><span class="c1">#sh mac address-table</span>
          <span class="n">Mac</span> <span class="n">Address</span> <span class="n">Table</span>
<span class="o">-------------------------------------------</span>

<span class="n">Vlan</span>    <span class="n">Mac</span> <span class="n">Address</span>       <span class="n">Type</span>        <span class="n">Ports</span>
<span class="o">----</span>    <span class="o">-----------</span>       <span class="o">--------</span>    <span class="o">-----</span>
 <span class="mi">100</span>    <span class="n">a1b2</span><span class="o">.</span><span class="n">ac10</span><span class="o">.</span><span class="mi">7000</span>    <span class="n">DYNAMIC</span>     <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
 <span class="mi">200</span>    <span class="n">a0d4</span><span class="o">.</span><span class="n">cb20</span><span class="o">.</span><span class="mi">7000</span>    <span class="n">DYNAMIC</span>     <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>
 <span class="mi">300</span>    <span class="n">acb4</span><span class="o">.</span><span class="n">cd30</span><span class="o">.</span><span class="mi">7000</span>    <span class="n">DYNAMIC</span>     <span class="n">Gi0</span><span class="o">/</span><span class="mi">3</span>
 <span class="mi">100</span>    <span class="n">a2bb</span><span class="o">.</span><span class="n">ec40</span><span class="o">.</span><span class="mi">7000</span>    <span class="n">DYNAMIC</span>     <span class="n">Gi0</span><span class="o">/</span><span class="mi">4</span>
 <span class="mi">500</span>    <span class="n">aa4b</span><span class="o">.</span><span class="n">c550</span><span class="o">.</span><span class="mi">7000</span>    <span class="n">DYNAMIC</span>     <span class="n">Gi0</span><span class="o">/</span><span class="mi">5</span>
 <span class="mi">200</span>    <span class="n">a1bb</span><span class="o">.</span><span class="mi">1</span><span class="n">c60</span><span class="o">.</span><span class="mi">7000</span>    <span class="n">DYNAMIC</span>     <span class="n">Gi0</span><span class="o">/</span><span class="mi">6</span>
 <span class="mi">300</span>    <span class="n">aa0b</span><span class="o">.</span><span class="n">cc70</span><span class="o">.</span><span class="mi">7000</span>    <span class="n">DYNAMIC</span>     <span class="n">Gi0</span><span class="o">/</span><span class="mi">7</span>
</pre></div>
</div>
<p>Первый пример - регулярное выражение без групп. В этом случае findall
возвращает список строк, которые совпали с регулярным выражением.</p>
<p>Например, с помощью findall можно получить список строк с соответствиями
vlan - mac - interface и избавиться от заголовка в выводе команды:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+ +\S+ +\w+ +\S+&#39;</span><span class="p">,</span> <span class="n">mac_address_table</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;100    a1b2.ac10.7000    DYNAMIC     Gi0/1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;200    a0d4.cb20.7000    DYNAMIC     Gi0/2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;300    acb4.cd30.7000    DYNAMIC     Gi0/3&#39;</span><span class="p">,</span>
 <span class="s1">&#39;100    a2bb.ec40.7000    DYNAMIC     Gi0/4&#39;</span><span class="p">,</span>
 <span class="s1">&#39;500    aa4b.c550.7000    DYNAMIC     Gi0/5&#39;</span><span class="p">,</span>
 <span class="s1">&#39;200    a1bb.1c60.7000    DYNAMIC     Gi0/6&#39;</span><span class="p">,</span>
 <span class="s1">&#39;300    aa0b.cc70.7000    DYNAMIC     Gi0/7&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Обратите внимание, что findall возвращает список строк, а не объект
Match.</p>
<p>Как только в регулярном выражении появляется группа, findall ведет
себя по-другому.
Если в выражении используется одна группа, findall возвращает список
строк, которые совпали с выражением в группе:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+ +(\S+) +\w+ +\S+&#39;</span><span class="p">,</span> <span class="n">mac_address_table</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;a1b2.ac10.7000&#39;</span><span class="p">,</span>
 <span class="s1">&#39;a0d4.cb20.7000&#39;</span><span class="p">,</span>
 <span class="s1">&#39;acb4.cd30.7000&#39;</span><span class="p">,</span>
 <span class="s1">&#39;a2bb.ec40.7000&#39;</span><span class="p">,</span>
 <span class="s1">&#39;aa4b.c550.7000&#39;</span><span class="p">,</span>
 <span class="s1">&#39;a1bb.1c60.7000&#39;</span><span class="p">,</span>
 <span class="s1">&#39;aa0b.cc70.7000&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>При этом findall ищет совпадение всей строки, но возвращает результат,
похожий на метод groups() в объекте Match.</p>
<p>Если же групп несколько, findall вернет список кортежей:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+) +(\S+) +\w+ +(\S+)&#39;</span><span class="p">,</span> <span class="n">mac_address_table</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span>
<span class="p">[(</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;a1b2.ac10.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="s1">&#39;a0d4.cb20.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;acb4.cd30.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/3&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;a2bb.ec40.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/4&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;500&#39;</span><span class="p">,</span> <span class="s1">&#39;aa4b.c550.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/5&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="s1">&#39;a1bb.1c60.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/6&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;aa0b.cc70.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/7&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Если такие особенности работы функции findall мешают получить
необходимый результат, то лучше использовать функцию finditer, но иногда
такое поведение подходит и удобно использовать.</p>
<p>Пример использования findall в разборе лог-файла (файл
parse_log_findall.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">regex</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host \S+ &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;in vlan (\d+) &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;is flapping between port &#39;</span>
         <span class="sa">r</span><span class="s1">&#39;(\S+) and port (\S+)&#39;</span><span class="p">)</span>

<span class="n">ports</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">port1</span><span class="p">,</span> <span class="n">port2</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">port1</span><span class="p">)</span>
        <span class="n">ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">port2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Петля между портами </span><span class="si">{}</span><span class="s1"> в VLAN </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ports</span><span class="p">),</span> <span class="n">vlan</span><span class="p">))</span>
</pre></div>
</div>
<p>Результат:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_log_findall.py
Петля между портами Gi0/19, Gi0/16, Gi0/24 в VLAN 10
</pre></div>
</div>
</div>
<span id="document-book/15_module_re/compile"></span><div class="section" id="compile">
<h4>Функция compile<a class="headerlink" href="#compile" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python есть возможность заранее скомпилировать регулярное выражение, а
затем использовать его. Это особенно полезно в тех случаях, когда
регулярное выражение много используется в скрипте.</p>
<p>Использование компилированного выражения может ускорить обработку, и,
как правило, такой вариант удобней использовать, так как в программе
разделяется создание регулярного выражения и его использование. Кроме
того, при использовании функции <code class="docutils literal notranslate"><span class="pre">re.compile</span></code> создается объект <code class="docutils literal notranslate"><span class="pre">RegexObject</span></code>,
у которого есть несколько дополнительных возможностей, которых нет в
объекте <code class="docutils literal notranslate"><span class="pre">MatchObject</span></code>.</p>
<p>Для компиляции регулярного выражения используется функция <code class="docutils literal notranslate"><span class="pre">re.compile</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+ +\S+ +\w+ +\S+&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Она возвращает объект RegexObject:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">regex</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+ +\S+ +\w+ +\S+&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>
</pre></div>
</div>
<p>У объекта RegexObject доступны такие методы и атрибуты:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;findall&#39;</span><span class="p">,</span>
 <span class="s1">&#39;finditer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;flags&#39;</span><span class="p">,</span>
 <span class="s1">&#39;fullmatch&#39;</span><span class="p">,</span>
 <span class="s1">&#39;groupindex&#39;</span><span class="p">,</span>
 <span class="s1">&#39;groups&#39;</span><span class="p">,</span>
 <span class="s1">&#39;match&#39;</span><span class="p">,</span>
 <span class="s1">&#39;pattern&#39;</span><span class="p">,</span>
 <span class="s1">&#39;scanner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;search&#39;</span><span class="p">,</span>
 <span class="s1">&#39;split&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sub&#39;</span><span class="p">,</span>
 <span class="s1">&#39;subn&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Обратите внимание, что у объекта Regex доступны методы search, match,
finditer, findall. Это те же функции, которые доступны в модуле
глобально, но теперь их надо применять к объекту.</p>
<p>Пример использования метода search:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">67</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39; 100    a1b2.ac10.7000    DYNAMIC     Gi0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь search надо вызывать как метод объекта regex. И передать как
аргумент строку.</p>
<p>Результатом будет объект Match:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="n">match</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">_sre</span><span class="o">.</span><span class="n">SRE_Match</span> <span class="nb">object</span><span class="p">;</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">43</span><span class="p">),</span> <span class="n">match</span><span class="o">=</span><span class="s1">&#39;100    a1b2.ac10.7000    DYNAMIC     Gi0/1&#39;</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="s1">&#39;100    a1b2.ac10.7000    DYNAMIC     Gi0/1&#39;</span>
</pre></div>
</div>
<p>Пример компиляции регулярного выражения и его использования на примере
разбора лог-файла (файл parse_log_compile.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host \S+ &#39;</span>
                   <span class="sa">r</span><span class="s1">&#39;in vlan (\d+) &#39;</span>
                   <span class="sa">r</span><span class="s1">&#39;is flapping between port &#39;</span>
                   <span class="sa">r</span><span class="s1">&#39;(\S+) and port (\S+)&#39;</span><span class="p">)</span>

<span class="n">ports</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">regex</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()):</span>
        <span class="n">vlan</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Петля между портами </span><span class="si">{}</span><span class="s1"> в VLAN </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ports</span><span class="p">),</span> <span class="n">vlan</span><span class="p">))</span>
</pre></div>
</div>
<p>Это модифицированный пример с использованием finditer. Тут изменилось
описание регулярного выражения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Host \S+ &#39;</span>
                   <span class="sa">r</span><span class="s1">&#39;in vlan (\d+) &#39;</span>
                   <span class="sa">r</span><span class="s1">&#39;is flapping between port &#39;</span>
                   <span class="sa">r</span><span class="s1">&#39;(\S+) and port (\S+)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>И вызов finditer теперь выполняется как метод объекта regex:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">regex</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()):</span>
</pre></div>
</div>
<div class="section" id="re-compile">
<h5>Параметры, которые доступны только при использовании re.compile<a class="headerlink" href="#re-compile" title="Ссылка на этот заголовок">¶</a></h5>
<p>При использовании функции re.compile в методах search, match, findall,
finditer и fullmatch появляются дополнительные параметры:</p>
<ul class="simple">
<li>pos - позволяет указывать индекс в строке, с которого надо начать искать совпадение</li>
<li>endpos - указывает, до какого индекса надо выполнять поиск</li>
</ul>
<p>Их использование аналогично выполнению среза строки.</p>
<p>Например, таким будет результат без указания параметров pos, endpos:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">75</span><span class="p">]:</span> <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+ +\S+ +\w+ +\S+&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">76</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39; 100    a1b2.ac10.7000    DYNAMIC     Gi0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">77</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">78</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">78</span><span class="p">]:</span> <span class="s1">&#39;100    a1b2.ac10.7000    DYNAMIC     Gi0/1&#39;</span>
</pre></div>
</div>
<p>В этом случае указывается начальная позиция поиска:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="s1">&#39;00    a1b2.ac10.7000    DYNAMIC     Gi0/1&#39;</span>
</pre></div>
</div>
<p>Указание начальной позиции аналогично срезу строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">81</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="s1">&#39;00    a1b2.ac10.7000    DYNAMIC     Gi0/1&#39;</span>
</pre></div>
</div>
<p>И последний пример - использование двух индексов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">90</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39; 100    a1b2.ac10.7000    DYNAMIC     Gi0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">91</span><span class="p">]:</span> <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+ +\S+ +\w+ +\S+&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">92</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="s1">&#39;00    a1b2.ac10.7000    DYNAMIC     Gi&#39;</span>
</pre></div>
</div>
<p>И аналогичный срез строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">94</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">40</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">95</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">95</span><span class="p">]:</span> <span class="s1">&#39;00    a1b2.ac10.7000    DYNAMIC     Gi&#39;</span>
</pre></div>
</div>
<p>В методах match, findall, finditer и fullmatch параметры pos и endpos
работают аналогично.</p>
</div>
</div>
<span id="document-book/15_module_re/flags"></span><div class="section" id="id1">
<h4>Флаги<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>При использовании функций или создании скомпилированного регулярного
выражения можно указывать дополнительные флаги, которые влияют на
поведение регулярного выражения.</p>
<p>Модуль re поддерживает такие флаги (в скобках короткий вариант
обозначения флага):</p>
<ul class="simple">
<li>re.ASCII (re.A)</li>
<li>re.IGNORECASE (re.I)</li>
<li>re.MULTILINE (re.M)</li>
<li>re.DOTALL (re.S)</li>
<li>re.VERBOSE (re.X)</li>
<li>re.LOCALE (re.L)</li>
<li>re.DEBUG</li>
</ul>
<p>В этом подразделе для примера рассматривается флаг re.DOTALL. Информация
об остальных флагах доступна в
<a class="reference external" href="https://docs.python.org/3/library/re.html#re.A">документации</a>.</p>
<div class="section" id="re-dotall">
<h5>re.DOTALL<a class="headerlink" href="#re-dotall" title="Ссылка на этот заголовок">¶</a></h5>
<p>С помощью регулярных выражений можно работать и с многострочной строкой.</p>
<p>Например, из строки sh_cdp надо получить имя устройства, платформу и IOS:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">sh_cdp</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">   ...: Device ID: SW2</span>
<span class="s1">   ...: Entry address(es):</span>
<span class="s1">   ...:   IP address: 10.1.1.2</span>
<span class="s1">   ...: Platform: cisco WS-C2960-8TC-L,  Capabilities: Switch IGMP</span>
<span class="s1">   ...: Interface: GigabitEthernet1/0/16,  Port ID (outgoing port): GigabitEthernet0/1</span>
<span class="s1">   ...: Holdtime : 164 sec</span>
<span class="s1">   ...:</span>
<span class="s1">   ...: Version :</span>
<span class="s1">   ...: Cisco IOS Software, C2960 Software (C2960-LANBASEK9-M), Version 12.2(55)SE9, RELEASE SOFTWARE (fc1)</span>
<span class="s1">   ...: Technical Support: http://www.cisco.com/techsupport</span>
<span class="s1">   ...: Copyright (c) 1986-2014 by Cisco Systems, Inc.</span>
<span class="s1">   ...: Compiled Mon 03-Mar-14 22:53 by prod_rel_team</span>
<span class="s1">   ...:</span>
<span class="s1">   ...: advertisement version: 2</span>
<span class="s1">   ...: VTP Management Domain: &#39;&#39;</span>
<span class="s1">   ...: Native VLAN: 1</span>
<span class="s1">   ...: Duplex: full</span>
<span class="s1">   ...: Management address(es):</span>
<span class="s1">   ...:   IP address: 10.1.1.2</span>
<span class="s1">   ...: &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Конечно, в этом случае можно разделить строку на части и работать с
каждой строкой отдельно, но можно получить нужные данные и без разделения.</p>
<p>В этом выражении описаны строки с нужными данными:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Device ID: (\S+).+Platform: \w+ (\S+),.+Cisco IOS Software.+ Version (\S+),&#39;</span>
</pre></div>
</div>
<p>В таком случае, совпадения не будет, потому что по умолчанию точка означает
любой символ, кроме перевода строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">sh_cdp</span><span class="p">))</span>
<span class="kc">None</span>
</pre></div>
</div>
<p>Изменить поведение по умолчанию, можно с помощью флага re.DOTALL:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">sh_cdp</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;WS-C2960-8TC-L&#39;</span><span class="p">,</span> <span class="s1">&#39;12.2(55)SE9&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Так как теперь в точку входит и перевод строки, комбинация <code class="docutils literal notranslate"><span class="pre">.+</span></code> захватывает все,
между нужными данными.</p>
<p>Теперь попробуем с помощью этого регулярного выражения, получить информацию про
всех соседей из файла sh_cdp_neighbors_sw1.txt (вывод сокращен).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SW1</span><span class="c1">#show cdp neighbors detail</span>
<span class="o">-------------------------</span>
<span class="n">Device</span> <span class="n">ID</span><span class="p">:</span> <span class="n">SW2</span>
<span class="n">Entry</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.2</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">cisco</span> <span class="n">WS</span><span class="o">-</span><span class="n">C2960</span><span class="o">-</span><span class="mi">8</span><span class="n">TC</span><span class="o">-</span><span class="n">L</span><span class="p">,</span>  <span class="n">Capabilities</span><span class="p">:</span> <span class="n">Switch</span> <span class="n">IGMP</span>
<span class="n">Interface</span><span class="p">:</span> <span class="n">GigabitEthernet1</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span>  <span class="n">Port</span> <span class="n">ID</span> <span class="p">(</span><span class="n">outgoing</span> <span class="n">port</span><span class="p">):</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Holdtime</span> <span class="p">:</span> <span class="mi">164</span> <span class="n">sec</span>

<span class="n">Version</span> <span class="p">:</span>
<span class="n">Cisco</span> <span class="n">IOS</span> <span class="n">Software</span><span class="p">,</span> <span class="n">C2960</span> <span class="n">Software</span> <span class="p">(</span><span class="n">C2960</span><span class="o">-</span><span class="n">LANBASEK9</span><span class="o">-</span><span class="n">M</span><span class="p">),</span> <span class="n">Version</span> <span class="mf">12.2</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span><span class="n">SE9</span><span class="p">,</span> <span class="n">RELEASE</span> <span class="n">SOFTWARE</span> <span class="p">(</span><span class="n">fc1</span><span class="p">)</span>
<span class="n">Technical</span> <span class="n">Support</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">cisco</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">techsupport</span>

<span class="o">-------------------------</span>
<span class="n">Device</span> <span class="n">ID</span><span class="p">:</span> <span class="n">R1</span>
<span class="n">Entry</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">Cisco</span> <span class="mi">3825</span><span class="p">,</span>  <span class="n">Capabilities</span><span class="p">:</span> <span class="n">Router</span> <span class="n">Switch</span> <span class="n">IGMP</span>
<span class="n">Interface</span><span class="p">:</span> <span class="n">GigabitEthernet1</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">22</span><span class="p">,</span>  <span class="n">Port</span> <span class="n">ID</span> <span class="p">(</span><span class="n">outgoing</span> <span class="n">port</span><span class="p">):</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Holdtime</span> <span class="p">:</span> <span class="mi">156</span> <span class="n">sec</span>

<span class="n">Version</span> <span class="p">:</span>
<span class="n">Cisco</span> <span class="n">IOS</span> <span class="n">Software</span><span class="p">,</span> <span class="mi">3800</span> <span class="n">Software</span> <span class="p">(</span><span class="n">C3825</span><span class="o">-</span><span class="n">ADVENTERPRISEK9</span><span class="o">-</span><span class="n">M</span><span class="p">),</span> <span class="n">Version</span> <span class="mf">12.4</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="n">T1</span><span class="p">,</span> <span class="n">RELEASE</span> <span class="n">SOFTWARE</span> <span class="p">(</span><span class="n">fc3</span><span class="p">)</span>
<span class="n">Technical</span> <span class="n">Support</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">cisco</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">techsupport</span>

<span class="o">-------------------------</span>
<span class="n">Device</span> <span class="n">ID</span><span class="p">:</span> <span class="n">R2</span>
<span class="n">Entry</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span><span class="p">:</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">2.2</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">Cisco</span> <span class="mi">2911</span><span class="p">,</span>  <span class="n">Capabilities</span><span class="p">:</span> <span class="n">Router</span> <span class="n">Switch</span> <span class="n">IGMP</span>
<span class="n">Interface</span><span class="p">:</span> <span class="n">GigabitEthernet1</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">21</span><span class="p">,</span>  <span class="n">Port</span> <span class="n">ID</span> <span class="p">(</span><span class="n">outgoing</span> <span class="n">port</span><span class="p">):</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Holdtime</span> <span class="p">:</span> <span class="mi">156</span> <span class="n">sec</span>

<span class="n">Version</span> <span class="p">:</span>
<span class="n">Cisco</span> <span class="n">IOS</span> <span class="n">Software</span><span class="p">,</span> <span class="mi">2900</span> <span class="n">Software</span> <span class="p">(</span><span class="n">C3825</span><span class="o">-</span><span class="n">ADVENTERPRISEK9</span><span class="o">-</span><span class="n">M</span><span class="p">),</span> <span class="n">Version</span> <span class="mf">15.2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="n">T1</span><span class="p">,</span> <span class="n">RELEASE</span> <span class="n">SOFTWARE</span> <span class="p">(</span><span class="n">fc3</span><span class="p">)</span>
<span class="n">Technical</span> <span class="n">Support</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">cisco</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">techsupport</span>
</pre></div>
</div>
<p>Поиск всех совпадений с регулярным выражением:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sh_cdp_neighbors_sw1.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">sh_cdp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Device ID: (\S+).+Platform: \w+ (\S+),.+Cisco IOS Software.+ Version (\S+),&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">sh_cdp</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
    <span class="o">...</span><span class="p">:</span>
<span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;2911&#39;</span><span class="p">,</span> <span class="s1">&#39;15.2(2)T1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>На первый взгляд, кажется, что вместо трех устройств, в вывод попало только одно.
Однако, если присмотреться к результатам, окажется, что кортеже находится
Device ID от первого соседа, а платформа и IOS от последнего.</p>
<p>Короткий вариант вывода, чтобы легче было ориентироваться в результатах:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Device</span> <span class="n">ID</span>        <span class="n">Local</span> <span class="n">Intrfce</span>     <span class="n">Holdtme</span>    <span class="n">Capability</span>  <span class="n">Platform</span>  <span class="n">Port</span> <span class="n">ID</span>
<span class="n">SW2</span>              <span class="n">Gi</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">16</span>         <span class="mi">171</span>              <span class="n">R</span> <span class="n">S</span>   <span class="n">C2960</span>     <span class="n">Gi</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">R1</span>               <span class="n">Gi</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">22</span>         <span class="mi">158</span>              <span class="n">R</span>     <span class="n">C3825</span>     <span class="n">Gi</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">R2</span>               <span class="n">Gi</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">21</span>         <span class="mi">177</span>              <span class="n">R</span>     <span class="n">C2911</span>     <span class="n">Gi</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
</pre></div>
</div>
<p>Так получилось из-за того, что между нужными частями вывода, указана комбинация <code class="docutils literal notranslate"><span class="pre">.+</span></code>.
Без флага <code class="docutils literal notranslate"><span class="pre">re.DOTALL</span></code> такое выражение захватило бы все до перевода строки, но
с флагом оно захватывает максимально длинный кусок текста, так как <code class="docutils literal notranslate"><span class="pre">+</span></code> жадный.
В итоге регулярное выражение описывает строку от первого Device ID до последнего
места где встречается <code class="docutils literal notranslate"><span class="pre">Cisco</span> <span class="pre">IOS</span> <span class="pre">Software.+</span> <span class="pre">Version</span></code>.</p>
<p>Такая ситуация возникает очень часто при использовании <code class="docutils literal notranslate"><span class="pre">re.DOTALL</span></code> и чтобы исправить ее,
надо не забыть отключить жадность:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Device ID: (\S+).+?Platform: \w+ (\S+),.+?Cisco IOS Software.+? Version (\S+),&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">sh_cdp</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
    <span class="o">...</span><span class="p">:</span>
<span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;WS-C2960-8TC-L&#39;</span><span class="p">,</span> <span class="s1">&#39;12.2(55)SE9&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;3825&#39;</span><span class="p">,</span> <span class="s1">&#39;12.4(24)T1&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;2911&#39;</span><span class="p">,</span> <span class="s1">&#39;15.2(2)T1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/15_module_re/split"></span><div class="section" id="re-split">
<h4>Функция re.split<a class="headerlink" href="#re-split" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция split работает аналогично методу split в строках,
но в функции re.split можно использовать регулярные выражения, а
значит, разделять строку на части по более сложным условиям.</p>
<p>Например, строку ospf_route надо разбить на элементы по пробелам (как в
методе str.split):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">ospf_route</span> <span class="o">=</span> <span class="s1">&#39;O     10.0.24.0/24 [110/41] via 10.0.13.3, 3d18h, FastEthernet0/0&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39; +&#39;</span><span class="p">,</span> <span class="n">ospf_route</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.0.24.0/24&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[110/41]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;via&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.0.13.3,&#39;</span><span class="p">,</span>
 <span class="s1">&#39;3d18h,&#39;</span><span class="p">,</span>
 <span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Аналогичным образом можно избавиться и от запятых:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[ ,]+&#39;</span><span class="p">,</span> <span class="n">ospf_route</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.0.24.0/24&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[110/41]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;via&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.0.13.3&#39;</span><span class="p">,</span>
 <span class="s1">&#39;3d18h&#39;</span><span class="p">,</span>
 <span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>И, если нужно, от квадратных скобок:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[ ,\[\]]+&#39;</span><span class="p">,</span> <span class="n">ospf_route</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.24.0/24&#39;</span><span class="p">,</span> <span class="s1">&#39;110/41&#39;</span><span class="p">,</span> <span class="s1">&#39;via&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.13.3&#39;</span><span class="p">,</span> <span class="s1">&#39;3d18h&#39;</span><span class="p">,</span> <span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>У функции split есть особенность работы с группами (выражения в
круглых скобках).
Если указать то же выражение с помощью круглых скобок, в итоговый
список попадут и разделители.</p>
<p>Например, в выражении как разделитель добавлено слово via:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(via|[ ,\[\]])+&#39;</span><span class="p">,</span> <span class="n">ospf_route</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span>
 <span class="s1">&#39; &#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.0.24.0/24&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[&#39;</span><span class="p">,</span>
 <span class="s1">&#39;110/41&#39;</span><span class="p">,</span>
 <span class="s1">&#39; &#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.0.13.3&#39;</span><span class="p">,</span>
 <span class="s1">&#39; &#39;</span><span class="p">,</span>
 <span class="s1">&#39;3d18h&#39;</span><span class="p">,</span>
 <span class="s1">&#39; &#39;</span><span class="p">,</span>
 <span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Для отключения такого поведения надо сделать группу noncapture.
То есть, отключить запоминание элементов группы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?:via|[ ,\[\]])+&#39;</span><span class="p">,</span> <span class="n">ospf_route</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.24.0/24&#39;</span><span class="p">,</span> <span class="s1">&#39;110/41&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.13.3&#39;</span><span class="p">,</span> <span class="s1">&#39;3d18h&#39;</span><span class="p">,</span> <span class="s1">&#39;FastEthernet0/0&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<span id="document-book/15_module_re/sub"></span><div class="section" id="re-sub">
<h4>Функция re.sub<a class="headerlink" href="#re-sub" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функция re.sub работает аналогично методу replace в строках.
Но в функции re.sub можно использовать регулярные выражения, а значит,
делать замены по более сложным условиям.</p>
<p>Заменим запятые, квадратные скобки и слово via на пробел в строке
ospf_route:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">ospf_route</span> <span class="o">=</span> <span class="s1">&#39;O    10.0.24.0/24 [110/41] via 10.0.13.3, 3d18h, FastEthernet0/0&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(via|[,\[\]])&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">ospf_route</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;O        10.0.24.0/24  110/41    10.0.13.3  3d18h  FastEthernet0/0&#39;</span>
</pre></div>
</div>
<p>С помощью re.sub можно трансформировать строку.
Например, преобразовать строку mac_table таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">mac_table</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">   ...:  100    aabb.cc10.7000    DYNAMIC     Gi0/1</span>
<span class="s1">   ...:  200    aabb.cc20.7000    DYNAMIC     Gi0/2</span>
<span class="s1">   ...:  300    aabb.cc30.7000    DYNAMIC     Gi0/3</span>
<span class="s1">   ...:  100    aabb.cc40.7000    DYNAMIC     Gi0/4</span>
<span class="s1">   ...:  500    aabb.cc50.7000    DYNAMIC     Gi0/5</span>
<span class="s1">   ...:  200    aabb.cc60.7000    DYNAMIC     Gi0/6</span>
<span class="s1">   ...:  300    aabb.cc70.7000    DYNAMIC     Gi0/7</span>
<span class="s1">   ...: &#39;&#39;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39; *(\d+) +&#39;</span>
   <span class="o">...</span><span class="p">:</span>              <span class="sa">r</span><span class="s1">&#39;([a-f0-9]+)\.&#39;</span>
   <span class="o">...</span><span class="p">:</span>              <span class="sa">r</span><span class="s1">&#39;([a-f0-9]+)\.&#39;</span>
   <span class="o">...</span><span class="p">:</span>              <span class="sa">r</span><span class="s1">&#39;([a-f0-9]+) +\w+ +&#39;</span>
   <span class="o">...</span><span class="p">:</span>              <span class="sa">r</span><span class="s1">&#39;(\S+)&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>              <span class="sa">r</span><span class="s1">&#39;\1 \2:\3:\4 \5&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>              <span class="n">mac_table</span><span class="p">))</span>
   <span class="o">...</span><span class="p">:</span>

<span class="mi">100</span> <span class="n">aabb</span><span class="p">:</span><span class="n">cc10</span><span class="p">:</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
<span class="mi">200</span> <span class="n">aabb</span><span class="p">:</span><span class="n">cc20</span><span class="p">:</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">2</span>
<span class="mi">300</span> <span class="n">aabb</span><span class="p">:</span><span class="n">cc30</span><span class="p">:</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">3</span>
<span class="mi">100</span> <span class="n">aabb</span><span class="p">:</span><span class="n">cc40</span><span class="p">:</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">4</span>
<span class="mi">500</span> <span class="n">aabb</span><span class="p">:</span><span class="n">cc50</span><span class="p">:</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">5</span>
<span class="mi">200</span> <span class="n">aabb</span><span class="p">:</span><span class="n">cc60</span><span class="p">:</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">6</span>
<span class="mi">300</span> <span class="n">aabb</span><span class="p">:</span><span class="n">cc70</span><span class="p">:</span><span class="mi">7000</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">7</span>
</pre></div>
</div>
<p>Регулярное выражение разделено на группы:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">(\d+)</span></code> - первая группа. Сюда попадет номер VLAN</li>
<li><code class="docutils literal notranslate"><span class="pre">([a-f0-9]+).([a-f0-9]+).([a-f0-9]+)</span></code> - три следующие группы (2,
3, 4) описывают MAC-адрес</li>
<li><code class="docutils literal notranslate"><span class="pre">(\S+)</span></code> - пятая группа. Описывает интерфейс.</li>
</ul>
<p>Во втором регулярном выражении эти группы используются.
Для того, чтобы сослаться на группу, используется обратный слеш и
номер группы.
Чтобы не пришлось экранировать обратный слеш, используется raw строка.</p>
<p>В итоге вместо номеров групп будут подставлены соответствующие
подстроки.
Для примера, также изменен формат записи MAC-адреса.</p>
</div>
<span id="document-book/15_module_re/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Регулярные выражения в Python:</p>
<ul class="simple">
<li><a class="reference external" href="https://habrahabr.ru/post/349860/">Регулярные выражения в Python от простого к сложному. Подробности,
примеры, картинки, упражнения</a></li>
<li><a class="reference external" href="https://docs.python.org/3.6/howto/regex.html">Regular Expression
HOWTO</a></li>
<li><a class="reference external" href="https://pymotw.com/3/re/">Python 3 Module of the Week. Модуль re</a></li>
</ul>
<p>Сайты для проверки регулярных выражений:</p>
<ul class="simple">
<li><a class="reference external" href="https://regex101.com/">regex101</a></li>
<li><a class="reference external" href="http://www.pyregex.com/">для Python</a> - тут можно указывать и методы
search, match, findall, и флаги.
<a class="reference external" href="http://www.pyregex.com/?id=eyJyZWdleCI6IihcXGQrKSArKFthLWYsMC05LFxcLl0rKSArXFx3KyArKD9QPGludGY%2BXFxTKykuKiIsImZsYWdzIjowLCJtYXRjaF90eXBlIjoic2VhcmNoIiwidGVzdF9zdHJpbmciOiIxMDAgICAgYWFiYi5jYzEwLjcwMDAgICAgRFlOQU1JQyAgICAgR2kwLzFcbiAgMjAwICAgIGFhYmIuY2MyMC43MDAwICAgIERZTkFNSUMgICAgIEdpMC8yIn0%3D">Пример регулярного выражения</a>.
К сожалению, иногда не все выражения воспринимает.</li>
<li><a class="reference external" href="http://pythex.org/">Еще один сайт для Python</a> - не поддерживает методы, но хорошо
работает и отработал те выражения, на которые ругнулся предыдущий сайт.
Подходит для однострочного текста отлично. С многострочным надо
учитывать, что в Python будет другая ситуация.</li>
</ul>
<p>Общие руководства по использованию регулярных выражений:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.rexegg.com/">Множество примеров использования регулярных выражений от основ до
более сложных тем</a></li>
<li><a class="reference external" href="https://www.amazon.com/dp/0596528124">Книга Mastering Regular
Expressions</a></li>
</ul>
<p>Помощь в изучении регулярных выражений:</p>
<ul class="simple">
<li><a class="reference external" href="https://regexper.com/">Визуализация регулярного выражения</a></li>
<li><a class="reference external" href="https://regexcrossword.com/">Regex Cross­word</a></li>
</ul>
</div>
<span id="document-exercises/15_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 15.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию get_ip_from_cfg, которая ожидает как аргумент имя файла,
в котором находится конфигурация устройства.</p>
<p>Функция должна обрабатывать конфигурацию и возвращать IP-адреса и маски,
которые настроены на интерфейсах, в виде списка кортежей:</p>
<ul class="simple">
<li>первый элемент кортежа - IP-адрес</li>
<li>второй элемент кортежа - маска</li>
</ul>
<p>Например (взяты произвольные адреса):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s2">&quot;10.0.1.1&quot;</span><span class="p">,</span> <span class="s2">&quot;255.255.255.0&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;10.0.2.1&quot;</span><span class="p">,</span> <span class="s2">&quot;255.255.255.0&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Для получения такого результата, используйте регулярные выражения.</p>
<p>Проверить работу функции на примере файла config_r1.txt.</p>
<p>Обратите внимание, что в данном случае, можно не проверять корректность IP-адреса,
диапазоны адресов и так далее, так как обрабатывается вывод команды, а не ввод пользователя.</p>
</div>
<div class="section" id="a">
<h5>Задание 15.1a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать функцию get_ip_from_cfg из задания 15.1 и переделать ее таким образом, чтобы она возвращала словарь:</p>
<ul class="simple">
<li>ключ: имя интерфейса</li>
<li>значение: кортеж с двумя строками:<ul>
<li>IP-адрес</li>
<li>маска</li>
</ul>
</li>
</ul>
<p>В словарь добавлять только те интерфейсы, на которых настроены IP-адреса.</p>
<p>Например (взяты произвольные адреса):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;FastEthernet0/1&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;10.0.1.1&quot;</span><span class="p">,</span> <span class="s2">&quot;255.255.255.0&quot;</span><span class="p">),</span>
 <span class="s2">&quot;FastEthernet0/2&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;10.0.2.1&quot;</span><span class="p">,</span> <span class="s2">&quot;255.255.255.0&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Для получения такого результата, используйте регулярные выражения.</p>
<p>Проверить работу функции на примере файла config_r1.txt.</p>
<p>Обратите внимание, что в данном случае, можно не проверять корректность IP-адреса,
диапазоны адресов и так далее, так как обрабатывается вывод команды, а не ввод пользователя.</p>
</div>
<div class="section" id="b">
<h5>Задание 15.1b<a class="headerlink" href="#b" title="Ссылка на этот заголовок">¶</a></h5>
<p>Проверить работу функции get_ip_from_cfg из задания 15.1a на конфигурации config_r2.txt.</p>
<p>Обратите внимание, что на интерфейсе e0/1 назначены два IP-адреса:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">1</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">2.2</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">10.254</span><span class="o">.</span><span class="mf">2.2</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span> <span class="n">secondary</span>
</pre></div>
</div>
<p>А в словаре, который возвращает функция get_ip_from_cfg, интерфейсу Ethernet0/1
соответствует только один из них (второй).</p>
<p>Скопировать функцию get_ip_from_cfg из задания 15.1a и переделать ее таким образом, чтобы она возвращала список кортежей для каждого интерфейса.
Если на интерфейсе назначен только один адрес, в списке будет один кортеж.
Если же на интерфейсе настроены несколько IP-адресов, то в списке будет несколько кортежей.</p>
<p>Проверьте функцию на конфигурации config_r2.txt и убедитесь, что интерфейсу
Ethernet0/1 соответствует список из двух кортежей.</p>
<p>Обратите внимание, что в данном случае, можно не проверять корректность IP-адреса,
диапазоны адресов и так далее, так как обрабатывается вывод команды, а не ввод пользователя.</p>
</div>
<div class="section" id="id3">
<h5>Задание 15.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию parse_sh_ip_int_br, которая ожидает как аргумент
имя файла, в котором находится вывод команды show ip int br</p>
<p>Функция должна обрабатывать вывод команды show ip int br и возвращать такие поля:</p>
<ul class="simple">
<li>Interface</li>
<li>IP-Address</li>
<li>Status</li>
<li>Protocol</li>
</ul>
<p>Информация должна возвращаться в виде списка кортежей:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s2">&quot;FastEthernet0/0&quot;</span><span class="p">,</span> <span class="s2">&quot;10.0.1.1&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">),</span>
 <span class="p">(</span><span class="s2">&quot;FastEthernet0/1&quot;</span><span class="p">,</span> <span class="s2">&quot;10.0.2.1&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">),</span>
 <span class="p">(</span><span class="s2">&quot;FastEthernet0/2&quot;</span><span class="p">,</span> <span class="s2">&quot;unassigned&quot;</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Для получения такого результата, используйте регулярные выражения.</p>
<p>Проверить работу функции на примере файла sh_ip_int_br.txt.</p>
</div>
<div class="section" id="id4">
<h5>Задание 15.2a<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию convert_to_dict, которая ожидает два аргумента:</p>
<ul class="simple">
<li>список с названиями полей</li>
<li>список кортежей со значениями</li>
</ul>
<p>Функция возвращает результат в виде списка словарей, где ключи - взяты из первого списка,
а значения подставлены из второго.</p>
<p>Например, если функции передать как аргументы список headers и список</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;12.4(24)T1&quot;</span><span class="p">,</span> <span class="s2">&quot;Cisco 3825&quot;</span><span class="p">),</span>
 <span class="p">(</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="s2">&quot;15.2(2)T1&quot;</span><span class="p">,</span> <span class="s2">&quot;Cisco 2911&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Функция должна вернуть такой список со словарями:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s2">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;12.4(24)T1&quot;</span><span class="p">,</span> <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco 3825&quot;</span><span class="p">},</span>
 <span class="p">{</span><span class="s2">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="s2">&quot;ios&quot;</span><span class="p">:</span> <span class="s2">&quot;15.2(2)T1&quot;</span><span class="p">,</span> <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="s2">&quot;Cisco 2911&quot;</span><span class="p">}]</span>
</pre></div>
</div>
<p>Функция не должна быть привязана к конкретным данным или количеству заголовков/данных в кортежах.</p>
<p>Проверить работу функции:</p>
<ul class="simple">
<li>первый аргумент - список headers</li>
<li>второй аргумент - список data</li>
</ul>
<p>Ограничение: Все задания надо выполнять используя только пройденные темы.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hostname&quot;</span><span class="p">,</span> <span class="s2">&quot;ios&quot;</span><span class="p">,</span> <span class="s2">&quot;platform&quot;</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;12.4(24)T1&quot;</span><span class="p">,</span> <span class="s2">&quot;Cisco 3825&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="s2">&quot;15.2(2)T1&quot;</span><span class="p">,</span> <span class="s2">&quot;Cisco 2911&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;12.2(55)SE9&quot;</span><span class="p">,</span> <span class="s2">&quot;Cisco WS-C2960-8TC-L&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Задание 15.3<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию convert_ios_nat_to_asa, которая конвертирует правила NAT из синтаксиса cisco IOS в cisco ASA.</p>
<p>Функция ожидает такие аргументы:</p>
<ul class="simple">
<li>имя файла, в котором находится правила NAT Cisco IOS</li>
<li>имя файла, в который надо записать полученные правила NAT для ASA</li>
</ul>
<p>Функция ничего не возвращает.</p>
<p>Проверить функцию на файле cisco_nat_config.txt.</p>
<p>Пример правил NAT cisco IOS</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">nat</span> <span class="n">inside</span> <span class="n">source</span> <span class="n">static</span> <span class="n">tcp</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">2.84</span> <span class="mi">22</span> <span class="n">interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="mi">20022</span>
<span class="n">ip</span> <span class="n">nat</span> <span class="n">inside</span> <span class="n">source</span> <span class="n">static</span> <span class="n">tcp</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">9.5</span> <span class="mi">22</span> <span class="n">interface</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span> <span class="mi">20023</span>
</pre></div>
</div>
<p>И соответствующие правила NAT для ASA:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">object</span> <span class="n">network</span> <span class="n">LOCAL_10</span><span class="o">.</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">84</span>
 <span class="n">host</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">2.84</span>
 <span class="n">nat</span> <span class="p">(</span><span class="n">inside</span><span class="p">,</span><span class="n">outside</span><span class="p">)</span> <span class="n">static</span> <span class="n">interface</span> <span class="n">service</span> <span class="n">tcp</span> <span class="mi">22</span> <span class="mi">20022</span>
<span class="nb">object</span> <span class="n">network</span> <span class="n">LOCAL_10</span><span class="o">.</span><span class="mf">1.9</span><span class="o">.</span><span class="mi">5</span>
 <span class="n">host</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">9.5</span>
 <span class="n">nat</span> <span class="p">(</span><span class="n">inside</span><span class="p">,</span><span class="n">outside</span><span class="p">)</span> <span class="n">static</span> <span class="n">interface</span> <span class="n">service</span> <span class="n">tcp</span> <span class="mi">22</span> <span class="mi">20023</span>
</pre></div>
</div>
<p>В файле с правилами для ASA:</p>
<ul class="simple">
<li>не должно быть пустых строк между правилами</li>
<li>перед строками «object network» не должны быть пробелы</li>
<li>перед остальными строками должен быть один пробел</li>
</ul>
<p>Во всех правилах для ASA интерфейсы будут одинаковыми (inside,outside).</p>
</div>
<div class="section" id="id6">
<h5>Задание 15.4<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию get_ints_without_description, которая ожидает как аргумент
имя файла, в котором находится конфигурация устройства.</p>
<p>Функция должна обрабатывать конфигурацию и возвращать список имен интерфейсов,
на которых нет описания (команды description).</p>
<p>Пример интерфейса с описанием:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span>
 <span class="n">description</span> <span class="n">To</span> <span class="n">P_r9</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">19.1</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
 <span class="n">mpls</span> <span class="n">traffic</span><span class="o">-</span><span class="n">eng</span> <span class="n">tunnels</span>
 <span class="n">ip</span> <span class="n">rsvp</span> <span class="n">bandwidth</span>
</pre></div>
</div>
<p>Интерфейс без описания:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="n">Loopback0</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
</pre></div>
</div>
<p>Проверить работу функции на примере файла config_r1.txt.</p>
</div>
<div class="section" id="id7">
<h5>Задание 15.5<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию generate_description_from_cdp, которая ожидает как аргумент
имя файла, в котором находится вывод команды show cdp neighbors.</p>
<p>Функция должна обрабатывать вывод команды show cdp neighbors и генерировать на основании вывода команды описание для интерфейсов.</p>
<p>Например, если у R1 такой вывод команды:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="o">&gt;</span><span class="n">show</span> <span class="n">cdp</span> <span class="n">neighbors</span>
<span class="n">Capability</span> <span class="n">Codes</span><span class="p">:</span> <span class="n">R</span> <span class="o">-</span> <span class="n">Router</span><span class="p">,</span> <span class="n">T</span> <span class="o">-</span> <span class="n">Trans</span> <span class="n">Bridge</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">Source</span> <span class="n">Route</span> <span class="n">Bridge</span>
                  <span class="n">S</span> <span class="o">-</span> <span class="n">Switch</span><span class="p">,</span> <span class="n">H</span> <span class="o">-</span> <span class="n">Host</span><span class="p">,</span> <span class="n">I</span> <span class="o">-</span> <span class="n">IGMP</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="n">Repeater</span>

<span class="n">Device</span> <span class="n">ID</span>        <span class="n">Local</span> <span class="n">Intrfce</span>     <span class="n">Holdtme</span>    <span class="n">Capability</span>  <span class="n">Platform</span>  <span class="n">Port</span> <span class="n">ID</span>
<span class="n">SW1</span>              <span class="n">Eth</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span>           <span class="mi">140</span>          <span class="n">S</span> <span class="n">I</span>      <span class="n">WS</span><span class="o">-</span><span class="n">C3750</span><span class="o">-</span>  <span class="n">Eth</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
<p>Для интерфейса Eth 0/0 надо сгенерировать такое описание <code class="docutils literal notranslate"><span class="pre">description</span> <span class="pre">Connected</span> <span class="pre">to</span> <span class="pre">SW1</span> <span class="pre">port</span> <span class="pre">Eth</span> <span class="pre">0/1</span></code>.</p>
<p>Функция должна возвращать словарь, в котором ключи - имена интерфейсов, а значения - команда задающая описание интерфейса:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Eth 0/0&quot;</span><span class="p">:</span> <span class="s2">&quot;description Connected to SW1 port Eth 0/1&quot;</span>
</pre></div>
</div>
<p>Проверить работу функции на файле sh_cdp_n_sw1.txt.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/Part_IV"></span><div class="section" id="iv">
<h2>IV. Запись и передача данных<a class="headerlink" href="#iv" title="Ссылка на этот заголовок">¶</a></h2>
<p>В этой части книги рассматриваются вопросы сохранения и передачи данных.
Данными могут быть, например:</p>
<ul class="simple">
<li>вывод команд</li>
<li>обработанный вывод команд в виде словаря, списка и подобного</li>
<li>информация полученная из системы мониторинга</li>
</ul>
<p>До сих пор рассматривался только самый простой вариант - запись
информации в обычный текстовый файл.</p>
<p>В этой части рассматривается чтение и запись данных в форматах CSV, JSON
и YAML:</p>
<ul class="simple">
<li>CSV - это табличный формат представления данных. Он может быть
получен, например, при экспорте данных из таблицы или базе данных.
Аналогичным образом данные могут быть записаны в этом формате для
последующего импорта в таблицу.</li>
<li>JSON - это формат, который очень часто используется в API. Кроме
того, этот формат позволит сохранить такие структуры данных как
словари или списки в структурированном формате и затем прочитать их
из файла в формате JSON и получить те же структуры данных в Python.</li>
<li>Формат YAML очень часто используется для описания сценариев.
Например, он используется в Ansible. Кроме того, в этом формате
удобно записывать вручную параметры, которые должны считывать
скрипты.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Python позволяет записывать объекты самого языка в файлы и считывать
их с помощью модуля Pickle, но этот аспект в книге не
рассматривается.</p>
</div>
<p>Также в этой части рассматриваются базы данных. Хотя данные можно
записать с соблюдением структуры и в CSV или JSON, запрашивать нужную
информацию из файлов в этом формате не всегда удобно. Особенно, когда
речь идет о более сложных запросах, в которых указаны несколько
критериев.</p>
<p>Для задач такого рода отлично подходят базы данных. В разделе 25
рассматривается СУБД SQLite, а также основы языка SQL.</p>
<div class="toctree-wrapper compound">
<span id="document-book/16_unicode/index"></span><div class="section" id="unicode">
<span id="unicode-index"></span><h3>16. Unicode<a class="headerlink" href="#unicode" title="Ссылка на этот заголовок">¶</a></h3>
<p>Программы, которые мы пишем, не изолированы в себе. Они скачивают данные
из Интернета, читают и записывают данные на диск, передают данные через
сеть.</p>
<p>Поэтому очень важно понимать разницу между тем, как компьютер хранит и
передает данные, и как эти данные воспринимает человек. Мы воспринимаем
текст, а компьютер - байты.</p>
<p>В Python 3, соответственно, есть две концепции:</p>
<ul class="simple">
<li>текст - неизменяемая последовательность Unicode-символов.
Для хранения этих символов используется тип строка (str)</li>
<li>данные - неизменяемая последовательность байтов. Для хранения используется тип bytes</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Более корректно будет сказать, что текст - это неизменяемая
последовательность кодов (codepoints) Unicode.</p>
</div>
<div class="toctree-wrapper compound">
<span id="document-book/16_unicode/unicode_standard"></span><div class="section" id="id1">
<h4>Стандарт Юникод<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Юникод - это стандарт, который описывает представление и кодировку почти
всех языков и других символов.</p>
<p>Несколько фактов про Юникод:</p>
<ul class="simple">
<li>стандарт версии 12.1 (май 2019) описывает 137 994 кодов</li>
<li>каждый код - это номер, который соответствует определенному символу</li>
<li>стандарт также определяет кодировки - способ представления кода символа в байтах</li>
</ul>
<p>Каждому символу в Юникод соответствует определенный код. Это число,
которое обычно записывается таким образом: <code class="docutils literal notranslate"><span class="pre">U+0073</span></code>, где 0073 - это
шестнадцатеричные цифры.</p>
<p>Кроме кода, у каждого символа есть свое уникальное имя. Например, букве
«s» соответствует код <code class="docutils literal notranslate"><span class="pre">U+0073</span></code> и имя «LATIN SMALL LETTER S».</p>
<p>Примеры кодов, имен и соответствующих символов:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">U+0073</span></code>, «LATIN SMALL LETTER S» - s</li>
<li><code class="docutils literal notranslate"><span class="pre">U+00F6</span></code>, «LATIN SMALL LETTER O WITH DIAERESIS» - ö</li>
<li><code class="docutils literal notranslate"><span class="pre">U+1F383</span></code>, «JACK-O-LANTERN» - 🎃</li>
<li><code class="docutils literal notranslate"><span class="pre">U+2615</span></code>, «HOT BEVERAGE» - ☕</li>
<li><code class="docutils literal notranslate"><span class="pre">U+1f600</span></code>, «GRINNING FACE» - 😀</li>
</ul>
<div class="section" id="id2">
<h5>Кодировки<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Кодировки позволяют записывать код символа в байтах.</p>
<p>Юникод поддерживает несколько кодировок:</p>
<ul class="simple">
<li>UTF-8</li>
<li>UTF-16</li>
<li>UTF-32</li>
</ul>
<p>Одна из самых популярных кодировок на сегодняшний день - UTF-8. Эта
кодировка использует переменное количество байт для записи символов
Юникод.</p>
<p>Примеры символов Юникод и их представление в байтах в кодировке UTF-8:</p>
<ul class="simple">
<li>H - <code class="docutils literal notranslate"><span class="pre">48</span></code></li>
<li>i - <code class="docutils literal notranslate"><span class="pre">69</span></code></li>
<li>🛀 - <code class="docutils literal notranslate"><span class="pre">01</span> <span class="pre">f6</span> <span class="pre">c0</span></code></li>
<li>🚀 - <code class="docutils literal notranslate"><span class="pre">01</span> <span class="pre">f6</span> <span class="pre">80</span></code></li>
<li>☃ - <code class="docutils literal notranslate"><span class="pre">26</span> <span class="pre">03</span></code></li>
</ul>
</div>
</div>
<span id="document-book/16_unicode/python_3_unicode"></span><div class="section" id="python-3">
<h4>Юникод в Python 3<a class="headerlink" href="#python-3" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python 3 есть:</p>
<ul class="simple">
<li>строки - неизменяемая последовательность Unicode-символов.
Для хранения этих символов используется тип строка (str)</li>
<li>байты - неизменяемая последовательность байтов. Для хранения
используется тип bytes</li>
</ul>
<div class="section" id="id1">
<h5>Строки<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Примеры строк:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">hi</span> <span class="o">=</span> <span class="s1">&#39;привет&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">hi</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="s1">&#39;привет&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">hi</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">str</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">beautiful</span> <span class="o">=</span> <span class="s1">&#39;schön&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">beautiful</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="s1">&#39;schön&#39;</span>
</pre></div>
</div>
<p>Так как строки - это последовательность кодов Юникод, можно записать
строку разными способами.</p>
<p>Символ Юникод можно записать, используя его имя:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;</span><span class="se">\N{LATIN SMALL LETTER O WITH DIAERESIS}</span><span class="s2">&quot;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s1">&#39;ö&#39;</span>
</pre></div>
</div>
<p>Или использовав такой формат:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s2">&quot;</span><span class="se">\u00F6</span><span class="s2">&quot;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;ö&#39;</span>
</pre></div>
</div>
<p>Строку можно записать как последовательность кодов Юникод:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">hi1</span> <span class="o">=</span> <span class="s1">&#39;привет&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">hi2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u043f\u0440\u0438\u0432\u0435\u0442</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">hi2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="s1">&#39;привет&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">hi1</span> <span class="o">==</span> <span class="n">hi2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">hi2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="mi">6</span>
</pre></div>
</div>
<p>Функция ord возвращает значение кода Unicode для символа:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;ö&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mi">246</span>
</pre></div>
</div>
<p>Функция chr возвращает символ Юникод, который соответствует коду:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">246</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;ö&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Байты<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Тип bytes - это неизменяемая последовательность байтов.</p>
<p>Байты обозначаются так же, как строки, но с добавлением буквы «b» перед
строкой:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">b1</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xd0\xb4\xd0\xb0</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">b2</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xd0\xb4\xd0\xb0</span><span class="s2">&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">b3</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\xd0\xb4\xd0\xb0</span><span class="s1">&#39;&#39;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="nb">bytes</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="mi">4</span>
</pre></div>
</div>
<p>В Python байты, которые соответствуют символам ASCII, отображаются как
эти символы, а не как соответствующие им байты. Это может немного
путать, но всегда можно распознать тип bytes по букве b:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">bytes1</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;hello&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">bytes1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;hello&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytes1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="mi">5</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">bytes1</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="s1">&#39;68656c6c6f&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">bytes2</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x68\x65\x6c\x6c\x6f</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">bytes2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;hello&#39;</span>
</pre></div>
</div>
<p>Если попытаться написать не ASCII-символ в байтовом литерале, возникнет
ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">bytes3</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;привет&#39;</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;ipython-input-44-dc8b23504fa7&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
    <span class="n">bytes3</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;привет&#39;</span>
            <span class="o">^</span>
<span class="ne">SyntaxError</span><span class="p">:</span> <span class="nb">bytes</span> <span class="n">can</span> <span class="n">only</span> <span class="n">contain</span> <span class="n">ASCII</span> <span class="n">literal</span> <span class="n">characters</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/16_unicode/python_3_convert"></span><div class="section" id="id1">
<h4>Конвертация между байтами и строками<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Избежать работы с байтами нельзя. Например, при работе с сетью или
файловой системой, чаще всего, результат возвращается в байтах.</p>
<p>Соответственно, надо знать, как выполнять преобразование байтов в строку
и наоборот. Для этого и нужна кодировка.</p>
<p>Кодировку можно представлять как ключ шифрования, который указывает:</p>
<ul class="simple">
<li>как «зашифровать» строку в байты (str -&gt; bytes). Используется метод encode (похож на encrypt)</li>
<li>как «расшифровать» байты в строку (bytes -&gt; str). Используется метод decode (похож на decrypt)</li>
</ul>
<p>Эта аналогия позволяет понять, что преобразования строка-байты и
байты-строка должны использовать одинаковую кодировку.</p>
<div class="section" id="encode-decode">
<h5>encode, decode<a class="headerlink" href="#encode-decode" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для преобразования строки в байты используется метод <strong>encode</strong>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">hi</span> <span class="o">=</span> <span class="s1">&#39;привет&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">hi</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xd0\xbf\xd1\x80\xd0\xb8\xd0\xb2\xd0\xb5\xd1\x82</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">hi_bytes</span> <span class="o">=</span> <span class="n">hi</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Чтобы получить строку из байт, используется метод <strong>decode</strong>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">hi_bytes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xd0\xbf\xd1\x80\xd0\xb8\xd0\xb2\xd0\xb5\xd1\x82</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">hi_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;привет&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="str-encode-bytes-decode">
<h5>str.encode, bytes.decode<a class="headerlink" href="#str-encode-bytes-decode" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод encode есть также в классе str (как и другие методы работы со
строками):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">hi</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;привет&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xd0\xbf\xd1\x80\xd0\xb8\xd0\xb2\xd0\xb5\xd1\x82</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>А метод decode есть у класса bytes (как и другие методы):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">hi_bytes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xd0\xbf\xd1\x80\xd0\xb8\xd0\xb2\xd0\xb5\xd1\x82</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">hi_bytes</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s1">&#39;привет&#39;</span>
</pre></div>
</div>
<p>В этих методах кодировка может указываться как ключевой аргумент
(примеры выше) или как позиционный:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">hi_bytes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xd0\xbf\xd1\x80\xd0\xb8\xd0\xb2\xd0\xb5\xd1\x82</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">hi_bytes</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;привет&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Как работать с Юникодом и байтами<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Есть очень простое правило, придерживаясь которого, можно избежать, как
минимум, части проблем. Оно называется «Юникод-сэндвич»:</p>
<ul class="simple">
<li>байты, которые программа считывает, надо как можно раньше преобразовать в Юникод (строку)</li>
<li>внутри программы работать с Юникод</li>
<li>Юникод надо преобразовать в байты как можно позже, перед передачей</li>
</ul>
</div>
</div>
<span id="document-book/16_unicode/convert_examples"></span><div class="section" id="id1">
<h4>Примеры конвертации между байтами и строками<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Рассмотрим несколько примеров работы с байтами и конвертации байт в
строки.</p>
<div class="section" id="subprocess">
<h5>subprocess<a class="headerlink" href="#subprocess" title="Ссылка на этот заголовок">¶</a></h5>
<p>Модуль subprocess возвращает результат команды в виде байт:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ping&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;8.8.8.8&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>                         <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.</span><span class="se">\n</span><span class="s1">64 bytes from 8.8.8.8: icmp_seq=1 ttl=43 time=59.4 ms</span><span class="se">\n</span><span class="s1">64 bytes from 8.8.8.8: icmp_seq=2 ttl=43 time=54.4 ms</span><span class="se">\n</span><span class="s1">64 bytes from 8.8.8.8: icmp_seq=3 ttl=43 time=55.1 ms</span><span class="se">\n\n</span><span class="s1">--- 8.8.8.8 ping statistics ---</span><span class="se">\n</span><span class="s1">3 packets transmitted, 3 received, 0% packet loss, time 2002ms</span><span class="se">\n</span><span class="s1">rtt min/avg/max/mdev = 54.470/56.346/59.440/2.220 ms</span><span class="se">\n</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>Если дальше необходимо работать с этим выводом, надо сразу
конвертировать его в строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">output</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="n">PING</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span> <span class="p">(</span><span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">43</span> <span class="n">time</span><span class="o">=</span><span class="mf">59.4</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">43</span> <span class="n">time</span><span class="o">=</span><span class="mf">54.4</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">3</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">43</span> <span class="n">time</span><span class="o">=</span><span class="mf">55.1</span> <span class="n">ms</span>

<span class="o">---</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
<span class="mi">3</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">3</span> <span class="n">received</span><span class="p">,</span> <span class="mi">0</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span><span class="p">,</span> <span class="n">time</span> <span class="mi">2002</span><span class="n">ms</span>
<span class="n">rtt</span> <span class="nb">min</span><span class="o">/</span><span class="n">avg</span><span class="o">/</span><span class="nb">max</span><span class="o">/</span><span class="n">mdev</span> <span class="o">=</span> <span class="mf">54.470</span><span class="o">/</span><span class="mf">56.346</span><span class="o">/</span><span class="mf">59.440</span><span class="o">/</span><span class="mf">2.220</span> <span class="n">ms</span>
</pre></div>
</div>
<p>Модуль subprocess поддерживает еще один вариант преобразования -
параметр encoding. Если указать его при вызове функции run, результат
будет получен в виде строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ping&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;8.8.8.8&#39;</span><span class="p">],</span>
   <span class="o">...</span><span class="p">:</span>                         <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.</span><span class="se">\n</span><span class="s1">64 bytes from 8.8.8.8: icmp_seq=1 ttl=43 time=55.5 ms</span><span class="se">\n</span><span class="s1">64 bytes from 8.8.8.8: icmp_seq=2 ttl=43 time=54.6 ms</span><span class="se">\n</span><span class="s1">64 bytes from 8.8.8.8: icmp_seq=3 ttl=43 time=53.3 ms</span><span class="se">\n\n</span><span class="s1">--- 8.8.8.8 ping statistics ---</span><span class="se">\n</span><span class="s1">3 packets transmitted, 3 received, 0% packet loss, time 2003ms</span><span class="se">\n</span><span class="s1">rtt min/avg/max/mdev = 53.368/54.534/55.564/0.941 ms</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">PING</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span> <span class="p">(</span><span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">43</span> <span class="n">time</span><span class="o">=</span><span class="mf">55.5</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">43</span> <span class="n">time</span><span class="o">=</span><span class="mf">54.6</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">3</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">43</span> <span class="n">time</span><span class="o">=</span><span class="mf">53.3</span> <span class="n">ms</span>

<span class="o">---</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
<span class="mi">3</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">3</span> <span class="n">received</span><span class="p">,</span> <span class="mi">0</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span><span class="p">,</span> <span class="n">time</span> <span class="mi">2003</span><span class="n">ms</span>
<span class="n">rtt</span> <span class="nb">min</span><span class="o">/</span><span class="n">avg</span><span class="o">/</span><span class="nb">max</span><span class="o">/</span><span class="n">mdev</span> <span class="o">=</span> <span class="mf">53.368</span><span class="o">/</span><span class="mf">54.534</span><span class="o">/</span><span class="mf">55.564</span><span class="o">/</span><span class="mf">0.941</span> <span class="n">ms</span>
</pre></div>
</div>
</div>
<div class="section" id="telnetlib">
<h5>telnetlib<a class="headerlink" href="#telnetlib" title="Ссылка на этот заголовок">¶</a></h5>
<p>В зависимости от модуля, преобразование между строками и байтами может
выполняться автоматически, а может требоваться явно.</p>
<p>Например, в модуле telnetlib необходимо передавать байты в методах
read_until и write:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">telnetlib</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">(</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">)</span>

<span class="n">t</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Username:&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;cisco</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">t</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Password:&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;cisco</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;sh ip int br</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">read_very_eager</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>И возвращает метод байты, поэтому в предпоследней строке используется
decode.</p>
</div>
<div class="section" id="pexpect">
<h5>pexpect<a class="headerlink" href="#pexpect" title="Ссылка на этот заголовок">¶</a></h5>
<p>Модуль pexpect как аргумент ожидает строку, а возвращает байты:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">pexpect</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">output</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;ls -ls&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">output</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;total 8</span><span class="se">\r\n</span><span class="s1">4 drwxr-xr-x 2 vagrant vagrant 4096 Aug 28 12:16 concurrent_futures</span><span class="se">\r\n</span><span class="s1">4 drwxr-xr-x 2 vagrant vagrant 4096 Aug  3 07:59 iterator_generator</span><span class="se">\r\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="s1">&#39;total 8</span><span class="se">\r\n</span><span class="s1">4 drwxr-xr-x 2 vagrant vagrant 4096 Aug 28 12:16 concurrent_futures</span><span class="se">\r\n</span><span class="s1">4 drwxr-xr-x 2 vagrant vagrant 4096 Aug  3 07:59 iterator_generator</span><span class="se">\r\n</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>И также поддерживает вариант передачи кодировки через параметр encoding:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">output</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;ls -ls&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">output</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="s1">&#39;total 8</span><span class="se">\r\n</span><span class="s1">4 drwxr-xr-x 2 vagrant vagrant 4096 Aug 28 12:16 concurrent_futures</span><span class="se">\r\n</span><span class="s1">4 drwxr-xr-x 2 vagrant vagrant 4096 Aug  3 07:59 iterator_generator</span><span class="se">\r\n</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Работа с файлами<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>До сих пор при работе с файлами использовалась такая конструкция:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>Но на самом деле, при чтении файла происходит конвертация байт в строки.
И при этом использовалась кодировка по умолчанию:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">locale</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">locale</span><span class="o">.</span><span class="n">getpreferredencoding</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;UTF-8&#39;</span>
</pre></div>
</div>
<p>Кодировка по умолчанию в файле:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;r1.txt&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">f</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">_io</span><span class="o">.</span><span class="n">TextIOWrapper</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;r1.txt&#39;</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>При работе с файлами лучше явно указывать кодировку, так как в разных ОС
она может отличаться:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [4]: with open(&#39;r1.txt&#39;, encoding=&#39;utf-8&#39;) as f:
   ...:     for line in f:
   ...:         print(line, end=&#39;&#39;)
   ...:
!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Выводы<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Эти примеры показаны тут для того, чтобы показать, что разные модули
могут по-разному подходить к вопросу конвертации между строками и
байтами. И разные функции и методы этих модулей могут ожидать аргументы
и возвращать значения разных типов. Однако все эти вещи написаны в
документации.</p>
</div>
</div>
<span id="document-book/16_unicode/errors"></span><div class="section" id="id1">
<h4>Ошибки при конвертации<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>При конвертации между строками и байтами очень важно точно знать, какая
кодировка используется, а также знать о возможностях разных кодировок.</p>
<p>Например, кодировка ASCII не может преобразовать в байты кириллицу:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">hi_unicode</span> <span class="o">=</span> <span class="s1">&#39;привет&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">hi_unicode</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">UnicodeEncodeError</span>                        <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">33</span><span class="o">-</span><span class="n">ec69c9fd2dae</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">hi_unicode</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>

<span class="ne">UnicodeEncodeError</span><span class="p">:</span> <span class="s1">&#39;ascii&#39;</span> <span class="n">codec</span> <span class="n">can</span><span class="s1">&#39;t encode characters in position 0-5: ordinal not in range(128)</span>
</pre></div>
</div>
<p>Аналогично, если строка «привет» преобразована в байты, и попробовать
преобразовать ее в строку с помощью ascii, тоже получим ошибку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">hi_unicode</span> <span class="o">=</span> <span class="s1">&#39;привет&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">hi_bytes</span> <span class="o">=</span> <span class="n">hi_unicode</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">hi_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">UnicodeDecodeError</span>                        <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">36</span><span class="o">-</span><span class="n">aa0ada5e44e9</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">hi_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>

<span class="ne">UnicodeDecodeError</span><span class="p">:</span> <span class="s1">&#39;ascii&#39;</span> <span class="n">codec</span> <span class="n">can</span><span class="s1">&#39;t decode byte 0xd0 in position 0: ordinal not in range(128)</span>
</pre></div>
</div>
<p>Еще один вариант ошибки, когда используются разные кодировки для
преобразований:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">de_hi_unicode</span> <span class="o">=</span> <span class="s1">&#39;grüezi&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">utf_16</span> <span class="o">=</span> <span class="n">de_hi_unicode</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-16&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">utf_16</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">UnicodeDecodeError</span>                        <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">39</span><span class="o">-</span><span class="mi">4</span><span class="n">b4c731e69e4</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">utf_16</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="ne">UnicodeDecodeError</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span> <span class="n">codec</span> <span class="n">can</span><span class="s1">&#39;t decode byte 0xff in position 0: invalid start byte</span>
</pre></div>
</div>
<p>Наличие ошибок - это хорошо. Они явно говорят, в чем проблема.
Хуже, когда получается так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">hi_unicode</span> <span class="o">=</span> <span class="s1">&#39;привет&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">hi_bytes</span> <span class="o">=</span> <span class="n">hi_unicode</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">hi_bytes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xd0\xbf\xd1\x80\xd0\xb8\xd0\xb2\xd0\xb5\xd1\x82</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">hi_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-16&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="s1">&#39;뿐胑룐닐뗐苑&#39;</span>
</pre></div>
</div>
<div class="section" id="id2">
<h5>Обработка ошибок<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>У методов encode и decode есть режимы обработки ошибок, которые
указывают, как реагировать на ошибку преобразования.</p>
<div class="section" id="errors-encode">
<h6>Параметр errors в encode<a class="headerlink" href="#errors-encode" title="Ссылка на этот заголовок">¶</a></h6>
<p>По умолчанию encode использует режим <code class="docutils literal notranslate"><span class="pre">strict</span></code> - при возникновении ошибок
кодировки генерируется исключение UnicodeError. Примеры такого поведения
были выше.</p>
<p>Вместо этого режима можно использовать replace, чтобы заменить символ
знаком вопроса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">de_hi_unicode</span> <span class="o">=</span> <span class="s1">&#39;grüezi&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">de_hi_unicode</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;gr?ezi&#39;</span>
</pre></div>
</div>
<p>Или namereplace, чтобы заменить символ именем:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">de_hi_unicode</span> <span class="o">=</span> <span class="s1">&#39;grüezi&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">de_hi_unicode</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;namereplace&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;gr</span><span class="se">\\</span><span class="s1">N{LATIN SMALL LETTER U WITH DIAERESIS}ezi&#39;</span>
</pre></div>
</div>
<p>Кроме того, можно полностью игнорировать символы, которые нельзя
закодировать:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">de_hi_unicode</span> <span class="o">=</span> <span class="s1">&#39;grüezi&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">de_hi_unicode</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;grezi&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="errors-decode">
<h6>Параметр errors в decode<a class="headerlink" href="#errors-decode" title="Ссылка на этот заголовок">¶</a></h6>
<p>В методе decode по умолчанию тоже используется режим strict и
генерируется исключение UnicodeDecodeError.</p>
<p>Если изменить режим на ignore, как и в encode, символы будут просто
игнорироваться:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">de_hi_unicode</span> <span class="o">=</span> <span class="s1">&#39;grüezi&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">de_hi_utf8</span> <span class="o">=</span> <span class="n">de_hi_unicode</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">de_hi_utf8</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;gr</span><span class="se">\xc3\xbc</span><span class="s1">ezi&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">de_hi_utf8</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="s1">&#39;grezi&#39;</span>
</pre></div>
</div>
<p>Режим replace заменит символы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">de_hi_unicode</span> <span class="o">=</span> <span class="s1">&#39;grüezi&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">de_hi_utf8</span> <span class="o">=</span> <span class="n">de_hi_unicode</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">de_hi_utf8</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="s1">&#39;gr��ezi&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-book/16_unicode/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация Python:</p>
<ul class="simple">
<li>🐍 <a class="reference external" href="https://docs.python.org/3.0/whatsnew/3.0.html#text-vs-data-instead-of-unicode-vs-8-bit">What’s New In Python 3: Text Vs. Data Instead Of Unicode Vs.
8-bit</a></li>
<li>🐍 <a class="reference external" href="https://docs.python.org/3/howto/unicode.html">Unicode HOWTO</a></li>
</ul>
<p>Статьи:</p>
<ul class="simple">
<li>🐍 <a class="reference external" href="https://nedbatchelder.com/text/unipain.html">Pragmatic Unicode</a>
- статья, презентация и видео</li>
<li>🐍 <a class="reference external" href="http://www.diveintopython3.net/strings.html">Раздел «Strings» книги «Dive Into Python
3»</a> - очень хорошо
написано о Unicode, кодировках и как все это работает в Python</li>
</ul>
<p>Без привязки к Python:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/">The Absolute Minimum Every Software Developer Absolutely, Positively
Must Know About Unicode and Character Sets (No
Excuses!)</a></li>
<li><a class="reference external" href="http://www.unicode.org/">The Unicode Consortium</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Unicode">Unicode (Wikipedia)</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/UTF-8">UTF-8 (Wikipedia)</a></li>
</ul>
</div>
</div>
</div>
<span id="document-book/17_serialization/index"></span><div class="section" id="csv-json-yaml">
<span id="serialization-index"></span><h3>17. Работа с файлами в формате CSV, JSON, YAML<a class="headerlink" href="#csv-json-yaml" title="Ссылка на этот заголовок">¶</a></h3>
<p>Сериализация данных - это сохранение данных в каком-то формате, чаще
всего, структурированном.</p>
<p>Например, это могут быть:</p>
<ul class="simple">
<li>файлы в формате YAML или JSON</li>
<li>файлы в формате CSV</li>
<li>база данных</li>
</ul>
<p>Кроме того, Python позволяет записывать объекты самого языка (этот
аспект в курсе не рассматривается, но, если вам интересно, посмотрите на
модуль Pickle).</p>
<p>В этом разделе рассматриваются форматы CSV, JSON, YAML, а в следующем
разделе - базы данных.</p>
<p>Для чего могут пригодится форматы YAML, JSON, CSV:</p>
<ul class="simple">
<li>у вас могут быть данные об IP-адресах и подобной информации,
которую нужно обработать, в таблицах<ul>
<li>таблицу можно экспортировать в формат CSV и обрабатывать её с помощью Python</li>
</ul>
</li>
<li>управляющий софт может возвращать данные в JSON. Соответственно,
преобразовав эти данные в объект Python, с ними можно работать и делать что угодно</li>
<li>YAML очень удобно использовать для описания параметров,
так как у него довольно приятный синтаксис<ul>
<li>например, это могут быть параметры настройки различных объектов (IP-адреса, VLAN и др.)</li>
<li>как минимум, знание формата YAML пригодится при использовании Ansible</li>
</ul>
</li>
</ul>
<p>Для каждого из этих форматов в Python есть модуль, который существенно
упрощает работу с ними.</p>
<div class="toctree-wrapper compound">
<span id="document-book/17_serialization/csv"></span><div class="section" id="csv">
<h4>Работа с файлами в формате CSV<a class="headerlink" href="#csv" title="Ссылка на этот заголовок">¶</a></h4>
<p><strong>CSV (comma-separated value)</strong> - это формат представления табличных
данных (например, это могут быть данные из таблицы или данные из БД).</p>
<p>В этом формате каждая строка файла - это строка таблицы. Несмотря на
название формата, разделителем может быть не только запятая.</p>
<p>И хотя у форматов с другим разделителем может быть и собственное
название, например, TSV (tab separated values), тем не менее, под
форматом CSV понимают, как правило, любые разделители.</p>
<p>Пример файла в формате CSV (sw_data.csv):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostname</span><span class="p">,</span><span class="n">vendor</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">location</span>
<span class="n">sw1</span><span class="p">,</span><span class="n">Cisco</span><span class="p">,</span><span class="mi">3750</span><span class="p">,</span><span class="n">London</span>
<span class="n">sw2</span><span class="p">,</span><span class="n">Cisco</span><span class="p">,</span><span class="mi">3850</span><span class="p">,</span><span class="n">Liverpool</span>
<span class="n">sw3</span><span class="p">,</span><span class="n">Cisco</span><span class="p">,</span><span class="mi">3650</span><span class="p">,</span><span class="n">Liverpool</span>
<span class="n">sw4</span><span class="p">,</span><span class="n">Cisco</span><span class="p">,</span><span class="mi">3650</span><span class="p">,</span><span class="n">London</span>
</pre></div>
</div>
<p>В стандартной библиотеке Python есть модуль csv, который позволяет
работать с файлами в CSV формате.</p>
<div class="section" id="id1">
<h5>Чтение<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Пример чтения файла в формате CSV (файл csv_read.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>Вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python csv_read.py
[&#39;hostname&#39;, &#39;vendor&#39;, &#39;model&#39;, &#39;location&#39;]
[&#39;sw1&#39;, &#39;Cisco&#39;, &#39;3750&#39;, &#39;London&#39;]
[&#39;sw2&#39;, &#39;Cisco&#39;, &#39;3850&#39;, &#39;Liverpool&#39;]
[&#39;sw3&#39;, &#39;Cisco&#39;, &#39;3650&#39;, &#39;Liverpool&#39;]
[&#39;sw4&#39;, &#39;Cisco&#39;, &#39;3650&#39;, &#39;London&#39;]
</pre></div>
</div>
<p>В первом списке находятся названия столбцов, а в остальных
соответствующие значения.</p>
<p>Обратите внимание, что сам csv.reader возвращает итератор:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">csv</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">_csv</span><span class="o">.</span><span class="n">reader</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x10385b050</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>При необходимости его можно превратить в список таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">reader</span><span class="p">))</span>
   <span class="o">...</span><span class="p">:</span>
<span class="p">[[</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span> <span class="s1">&#39;Liverpool&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3650&#39;</span><span class="p">,</span> <span class="s1">&#39;Liverpool&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3650&#39;</span><span class="p">,</span> <span class="s1">&#39;London&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<p>Чаще всего заголовки столбцов удобней получить отдельным объектом. Это
можно сделать таким образом (файл csv_read_headers.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Headers: &#39;</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>Иногда в результате обработки гораздо удобней получить словари, в
которых ключи - это названия столбцов, а значения - значения столбцов.</p>
<p>Для этого в модуле есть <strong>DictReader</strong> (файл csv_read_dict.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python csv_read_dict.py
{&#39;hostname&#39;: &#39;sw1&#39;, &#39;vendor&#39;: &#39;Cisco&#39;, &#39;model&#39;: &#39;3750&#39;, &#39;location&#39;: &#39;London, Globe Str 1 &#39;}
sw1 3750
{&#39;hostname&#39;: &#39;sw2&#39;, &#39;vendor&#39;: &#39;Cisco&#39;, &#39;model&#39;: &#39;3850&#39;, &#39;location&#39;: &#39;Liverpool&#39;}
sw2 3850
{&#39;hostname&#39;: &#39;sw3&#39;, &#39;vendor&#39;: &#39;Cisco&#39;, &#39;model&#39;: &#39;3650&#39;, &#39;location&#39;: &#39;Liverpool&#39;}
sw3 3650
{&#39;hostname&#39;: &#39;sw4&#39;, &#39;vendor&#39;: &#39;Cisco&#39;, &#39;model&#39;: &#39;3650&#39;, &#39;location&#39;: &#39;London, Grobe Str 1&#39;}
sw4 3650
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">До Python 3.8 возвращался отдельный тип упорядоченные словари (OrderedDict).</p>
</div>
</div>
<div class="section" id="id2">
<h5>Запись<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Аналогичным образом с помощью модуля csv можно и записать файл в формате
CSV (файл csv_write.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Best str&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span> <span class="s1">&#39;Liverpool, Better str&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3650&#39;</span><span class="p">,</span> <span class="s1">&#39;Liverpool, Better str&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3650&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Best str&#39;</span><span class="p">]]</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data_new.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data_new.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>В примере выше строки из списка сначала записываются в файл, а затем
содержимое файла выводится на стандартный поток вывода.</p>
<p>Вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python csv_write.py
hostname,vendor,model,location
sw1,Cisco,3750,&quot;London, Best str&quot;
sw2,Cisco,3850,&quot;Liverpool, Better str&quot;
sw3,Cisco,3650,&quot;Liverpool, Better str&quot;
sw4,Cisco,3650,&quot;London, Best str&quot;
</pre></div>
</div>
<p>Обратите внимание на интересную особенность: строки в последнем столбце
взяты в кавычки, а остальные значения - нет.</p>
<p>Так получилось из-за того, что во всех строках последнего столбца есть
запятая. И кавычки указывают на то, что именно является целой строкой.
Когда запятая находится в кавычках, модуль csv не воспринимает её как
разделитель.</p>
<p>Иногда лучше, чтобы все строки были в кавычках. Конечно, в данном случае
достаточно простой пример, но когда в строках больше значений, то
кавычки позволяют указать, где начинается и заканчивается значение.</p>
<p>Модуль csv позволяет управлять этим. Для того, чтобы все строки
записывались в CSV-файл с кавычками, надо изменить скрипт таким образом
(файл csv_write_quoting.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Best str&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span> <span class="s1">&#39;Liverpool, Better str&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3650&#39;</span><span class="p">,</span> <span class="s1">&#39;Liverpool, Better str&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3650&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Best str&#39;</span><span class="p">]]</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data_new.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data_new.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>Теперь вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python csv_write_quoting.py
&quot;hostname&quot;,&quot;vendor&quot;,&quot;model&quot;,&quot;location&quot;
&quot;sw1&quot;,&quot;Cisco&quot;,&quot;3750&quot;,&quot;London, Best str&quot;
&quot;sw2&quot;,&quot;Cisco&quot;,&quot;3850&quot;,&quot;Liverpool, Better str&quot;
&quot;sw3&quot;,&quot;Cisco&quot;,&quot;3650&quot;,&quot;Liverpool, Better str&quot;
&quot;sw4&quot;,&quot;Cisco&quot;,&quot;3650&quot;,&quot;London, Best str&quot;
</pre></div>
</div>
<p>Теперь все значения с кавычками. И поскольку номер модели задан как
строка в изначальном списке, тут он тоже в кавычках.</p>
<p>Кроме метода writerow, поддерживается метод writerows. Ему можно
передать любой итерируемый объект.</p>
<p>Например, предыдущий пример можно записать таким образом (файл
csv_writerows.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Best str&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span> <span class="s1">&#39;Liverpool, Better str&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3650&#39;</span><span class="p">,</span> <span class="s1">&#39;Liverpool, Better str&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;3650&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Best str&#39;</span><span class="p">]]</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data_new.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data_new.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<div class="section" id="dictwriter">
<h6>DictWriter<a class="headerlink" href="#dictwriter" title="Ссылка на этот заголовок">¶</a></h6>
<p>С помощью DictWriter можно записать словари в формат CSV.</p>
<p>В целом DictWriter работает так же, как writer, но так как словари не
упорядочены, надо указывать явно в каком порядке будут идти столбцы в
файле. Для этого используется параметр fieldnames (файл
csv_write_dict.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London&#39;</span><span class="p">,</span>
    <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;3750&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;Liverpool&#39;</span><span class="p">,</span>
    <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;3850&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;Liverpool&#39;</span><span class="p">,</span>
    <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;3650&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;London&#39;</span><span class="p">,</span>
    <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;3650&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span>
<span class="p">}]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;csv_write_dictwriter.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h5>Указание разделителя<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Иногда в качестве разделителя используются другие значения. В таком
случае должна быть возможность подсказать модулю, какой именно
разделитель использовать.</p>
<p>Например, если в файле используется разделитель <code class="docutils literal notranslate"><span class="pre">;</span></code> (файл
sw_data2.csv):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostname</span><span class="p">;</span><span class="n">vendor</span><span class="p">;</span><span class="n">model</span><span class="p">;</span><span class="n">location</span>
<span class="n">sw1</span><span class="p">;</span><span class="n">Cisco</span><span class="p">;</span><span class="mi">3750</span><span class="p">;</span><span class="n">London</span>
<span class="n">sw2</span><span class="p">;</span><span class="n">Cisco</span><span class="p">;</span><span class="mi">3850</span><span class="p">;</span><span class="n">Liverpool</span>
<span class="n">sw3</span><span class="p">;</span><span class="n">Cisco</span><span class="p">;</span><span class="mi">3650</span><span class="p">;</span><span class="n">Liverpool</span>
<span class="n">sw4</span><span class="p">;</span><span class="n">Cisco</span><span class="p">;</span><span class="mi">3650</span><span class="p">;</span><span class="n">London</span>
</pre></div>
</div>
<p>Достаточно просто указать, какой разделитель используется в reader (файл
csv_read_delimiter.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_data2.csv&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/17_serialization/json"></span><div class="section" id="json">
<h4>Работа с файлами в формате JSON<a class="headerlink" href="#json" title="Ссылка на этот заголовок">¶</a></h4>
<p><strong>JSON (JavaScript Object Notation)</strong> - это текстовый формат для
хранения и обмена данными.</p>
<p><a class="reference external" href="https://ru.wikipedia.org/wiki/JSON">JSON</a> по синтаксису очень похож
на Python и достаточно удобен для восприятия.</p>
<p>Как и в случае с CSV, в Python есть модуль, который позволяет легко
записывать и читать данные в формате JSON.</p>
<div class="section" id="id1">
<h5>Чтение<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Файл sw_templates.json:</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;access&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport access vlan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport nonegotiate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spanning-tree portfast&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spanning-tree bpduguard enable&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;trunk&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;switchport trunk encapsulation dot1q&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport mode trunk&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport trunk native vlan 999&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport trunk allowed vlan&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Для чтения в модуле json есть два метода:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">json.load</span></code> - метод считывает файл в формате JSON и возвращает объекты Python</li>
<li><code class="docutils literal notranslate"><span class="pre">json.loads</span></code> - метод считывает строку в формате JSON и возвращает объекты Python</li>
</ul>
<div class="section" id="json-load">
<h6><code class="docutils literal notranslate"><span class="pre">json.load</span></code><a class="headerlink" href="#json-load" title="Ссылка на этот заголовок">¶</a></h6>
<p>Чтение файла в формате JSON в объект Python (файл json_read_load.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">templates</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">templates</span><span class="p">)</span>

<span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">commands</span> <span class="ow">in</span> <span class="n">templates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">commands</span><span class="p">))</span>
</pre></div>
</div>
<p>Вывод будет таким:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>$ python json_read_load.py
{&#39;access&#39;: [&#39;switchport mode access&#39;, &#39;switchport access vlan&#39;, &#39;switchport nonegotiate&#39;, &#39;spanning-tree portfast&#39;, &#39;spanning-tree bpduguard enable&#39;], &#39;trunk&#39;: [&#39;switchport trunk encapsulation dot1q&#39;, &#39;switchport mode trunk&#39;, &#39;switchport trunk native vlan 999&#39;, &#39;switchport trunk allowed vlan&#39;]}
access
switchport mode access
switchport access vlan
switchport nonegotiate
spanning-tree portfast
spanning-tree bpduguard enable
trunk
switchport trunk encapsulation dot1q
switchport mode trunk
switchport trunk native vlan 999
switchport trunk allowed vlan
</pre></div>
</div>
</div>
<div class="section" id="json-loads">
<h6><code class="docutils literal notranslate"><span class="pre">json.loads</span></code><a class="headerlink" href="#json-loads" title="Ссылка на этот заголовок">¶</a></h6>
<p>Считывание строки в формате JSON в объект Python (файл
json_read_loads.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">file_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">templates</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">templates</span><span class="p">)</span>

<span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">commands</span> <span class="ow">in</span> <span class="n">templates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">commands</span><span class="p">))</span>
</pre></div>
</div>
<p>Результат будет аналогичен предыдущему выводу.</p>
</div>
</div>
<div class="section" id="id2">
<h5>Запись<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Запись файла в формате JSON также осуществляется достаточно легко.</p>
<p>Для записи информации в формате JSON в модуле json также два метода:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">json.dump</span></code> - метод записывает объект Python в файл в формате JSON</li>
<li><code class="docutils literal notranslate"><span class="pre">json.dumps</span></code> - метод возвращает строку в формате JSON</li>
</ul>
<div class="section" id="json-dumps">
<h6><code class="docutils literal notranslate"><span class="pre">json.dumps</span></code><a class="headerlink" href="#json-dumps" title="Ссылка на этот заголовок">¶</a></h6>
<p>Преобразование объекта в строку в формате JSON (json_write_dumps.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="n">trunk_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;switchport trunk encapsulation dot1q&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport mode trunk&#39;</span><span class="p">,</span>
    <span class="s1">&#39;switchport trunk native vlan 999&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport trunk allowed vlan&#39;</span>
<span class="p">]</span>

<span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport access vlan&#39;</span><span class="p">,</span>
    <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span> <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
    <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span>
<span class="p">]</span>

<span class="n">to_json</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trunk&#39;</span><span class="p">:</span> <span class="n">trunk_template</span><span class="p">,</span> <span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="n">access_template</span><span class="p">}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">to_json</span><span class="p">))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>Метод <code class="docutils literal notranslate"><span class="pre">json.dumps</span></code> подходит для ситуаций, когда надо вернуть строку в
формате JSON. Например, чтобы передать ее API.</p>
</div>
<div class="section" id="json-dump">
<h6><code class="docutils literal notranslate"><span class="pre">json.dump</span></code><a class="headerlink" href="#json-dump" title="Ссылка на этот заголовок">¶</a></h6>
<p>Запись объекта Python в файл в формате JSON (файл json_write_dump.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="n">trunk_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;switchport trunk encapsulation dot1q&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport mode trunk&#39;</span><span class="p">,</span>
    <span class="s1">&#39;switchport trunk native vlan 999&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport trunk allowed vlan&#39;</span>
<span class="p">]</span>

<span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport access vlan&#39;</span><span class="p">,</span>
    <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span> <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
    <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span>
<span class="p">]</span>

<span class="n">to_json</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trunk&#39;</span><span class="p">:</span> <span class="n">trunk_template</span><span class="p">,</span> <span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="n">access_template</span><span class="p">}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">to_json</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>Когда нужно записать информацию в формате JSON в файл, лучше
использовать метод dump.</p>
</div>
<div class="section" id="id3">
<h6>Дополнительные параметры методов записи<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h6>
<p>Методам dump и dumps можно передавать дополнительные параметры для
управления форматом вывода.</p>
<p>По умолчанию эти методы записывают информацию в компактном
представлении. Как правило, когда данные используются другими
программами, визуальное представление данных не важно. Если же данные в
файле нужно будет считать человеку, такой формат не очень удобно
воспринимать.</p>
<p>К счастью, модуль json позволяет управлять подобными вещами.</p>
<p>Передав дополнительные параметры методу dump (или методу dumps), можно
получить более удобный для чтения вывод (файл json_write_indent.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="n">trunk_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;switchport trunk encapsulation dot1q&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport mode trunk&#39;</span><span class="p">,</span>
    <span class="s1">&#39;switchport trunk native vlan 999&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport trunk allowed vlan&#39;</span>
<span class="p">]</span>

<span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport access vlan&#39;</span><span class="p">,</span>
    <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span> <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
    <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span>
<span class="p">]</span>

<span class="n">to_json</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trunk&#39;</span><span class="p">:</span> <span class="n">trunk_template</span><span class="p">,</span> <span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="n">access_template</span><span class="p">}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">to_json</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>Теперь содержимое файла sw_templates.json выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;access&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport access vlan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport nonegotiate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spanning-tree portfast&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spanning-tree bpduguard enable&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;trunk&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;switchport trunk encapsulation dot1q&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport mode trunk&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport trunk native vlan 999&quot;</span><span class="p">,</span>
    <span class="s2">&quot;switchport trunk allowed vlan&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h6>Изменение типа данных<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h6>
<p>Еще один важный аспект преобразования данных в формат JSON: данные не
всегда будут того же типа, что исходные данные в Python.</p>
<p>Например, кортежи при записи в JSON превращаются в списки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [1]: import json

In [2]: trunk_template = (&#39;switchport trunk encapsulation dot1q&#39;,
   ...:                   &#39;switchport mode trunk&#39;,
   ...:                   &#39;switchport trunk native vlan 999&#39;,
   ...:                   &#39;switchport trunk allowed vlan&#39;)

In [3]: print(type(trunk_template))
&lt;class &#39;tuple&#39;&gt;

In [4]: with open(&#39;trunk_template.json&#39;, &#39;w&#39;) as f:
   ...:     json.dump(trunk_template, f, sort_keys=True, indent=2)
   ...:

In [5]: cat trunk_template.json
[
  &quot;switchport trunk encapsulation dot1q&quot;,
  &quot;switchport mode trunk&quot;,
  &quot;switchport trunk native vlan 999&quot;,
  &quot;switchport trunk allowed vlan&quot;
]
In [6]: templates = json.load(open(&#39;trunk_template.json&#39;))

In [7]: type(templates)
Out[7]: list

In [8]: print(templates)
[&#39;switchport trunk encapsulation dot1q&#39;, &#39;switchport mode trunk&#39;, &#39;switchport trunk native vlan 999&#39;, &#39;switchport trunk allowed vlan&#39;]
</pre></div>
</div>
<p>Так происходит из-за того, что в JSON используются другие типы данных и
не для всех типов данных Python есть соответствия.</p>
<p>Таблица конвертации данных Python в JSON:</p>
<table border="1" class="docutils">
<colgroup>
<col width="60%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Python</th>
<th class="head">JSON</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>dict</td>
<td>object</td>
</tr>
<tr class="row-odd"><td>list, tuple</td>
<td>array</td>
</tr>
<tr class="row-even"><td>str</td>
<td>string</td>
</tr>
<tr class="row-odd"><td>int, float</td>
<td>number</td>
</tr>
<tr class="row-even"><td>True</td>
<td>true</td>
</tr>
<tr class="row-odd"><td>False</td>
<td>false</td>
</tr>
<tr class="row-even"><td>None</td>
<td>null</td>
</tr>
</tbody>
</table>
<p>Таблица конвертации JSON в данные Python:</p>
<table border="1" class="docutils">
<colgroup>
<col width="63%" />
<col width="37%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">JSON</th>
<th class="head">Python</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>object</td>
<td>dict</td>
</tr>
<tr class="row-odd"><td>array</td>
<td>list</td>
</tr>
<tr class="row-even"><td>string</td>
<td>str</td>
</tr>
<tr class="row-odd"><td>number (int)</td>
<td>int</td>
</tr>
<tr class="row-even"><td>number (real)</td>
<td>float</td>
</tr>
<tr class="row-odd"><td>true</td>
<td>True</td>
</tr>
<tr class="row-even"><td>false</td>
<td>False</td>
</tr>
<tr class="row-odd"><td>null</td>
<td>None</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id5">
<h6>Ограничение по типам данных<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h6>
<p>В формат JSON нельзя записать словарь, у которого ключи - кортежи:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">to_json</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;trunk&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">):</span> <span class="n">trunk_template</span><span class="p">,</span> <span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="n">access_template</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">to_json</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="o">...</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="n">key</span> <span class="p">(</span><span class="s1">&#39;trunk&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">string</span>
</pre></div>
</div>
<p>С помощью дополнительного параметра можно игнорировать подобные
ключи:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">to_json</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;trunk&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">):</span> <span class="n">trunk_template</span><span class="p">,</span> <span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="n">access_template</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">to_json</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">skipkeys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">cat</span> <span class="n">sw_templates</span><span class="o">.</span><span class="n">json</span>
<span class="p">{</span><span class="s2">&quot;access&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;switchport mode access&quot;</span><span class="p">,</span> <span class="s2">&quot;switchport access vlan&quot;</span><span class="p">,</span> <span class="s2">&quot;switchport nonegotiate&quot;</span><span class="p">,</span> <span class="s2">&quot;spanning-tree portfast&quot;</span><span class="p">,</span> <span class="s2">&quot;spanning-tree bpduguard enable&quot;</span><span class="p">]}</span>
</pre></div>
</div>
<p>Кроме того, в JSON ключами словаря могут быть только строки. Но, если в
словаре Python использовались числа, ошибки не будет. Вместо этого
выполнится конвертация чисел в строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="s1">&#39;{&quot;1&quot;: 100, &quot;2&quot;: 200}&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-book/17_serialization/yaml"></span><div class="section" id="yaml">
<h4>Работа с файлами в формате YAML<a class="headerlink" href="#yaml" title="Ссылка на этот заголовок">¶</a></h4>
<p><strong>YAML (YAML Ain’t Markup Language)</strong> - еще один текстовый формат для
записи данных.</p>
<p>YAML более приятен для восприятия человеком, чем JSON, поэтому его часто
используют для описания сценариев в ПО. Например, в Ansible.</p>
<div class="section" id="id1">
<h5>Синтаксис YAML<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Как и Python, YAML использует отступы для указания структуры документа.
Но в YAML можно использовать только пробелы и нельзя использовать знаки
табуляции.</p>
<p>Еще одна схожесть с Python: комментарии начинаются с символа # и
продолжаются до конца строки.</p>
<div class="section" id="id2">
<h6>Список<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h6>
<p>Список может быть записан в одну строку:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span><span class="p">,</span> <span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">switchport</span> <span class="n">nonegotiate</span><span class="p">,</span> <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">portfast</span><span class="p">,</span> <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">bpduguard</span> <span class="n">enable</span><span class="p">]</span>
</pre></div>
</div>
<p>Или каждый элемент списка в своей строке:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">nonegotiate</span>
<span class="o">-</span> <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">portfast</span>
<span class="o">-</span> <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">bpduguard</span> <span class="n">enable</span>
</pre></div>
</div>
<p>Когда список записан таким блоком, каждая строка должна начинаться с
<code class="docutils literal notranslate"><span class="pre">-</span></code> (минуса и пробела), и все строки в списке должны быть на одном
уровне отступа.</p>
</div>
<div class="section" id="id3">
<h6>Словарь<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h6>
<p>Словарь также может быть записан в одну строку:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">vlan</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">IT</span> <span class="p">}</span>
</pre></div>
</div>
<p>Или блоком:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vlan</span><span class="p">:</span> <span class="mi">100</span>
<span class="n">name</span><span class="p">:</span> <span class="n">IT</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h6>Строки<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h6>
<p>Строки в YAML не обязательно брать в кавычки. Это удобно, но иногда всё
же следует использовать кавычки. Например, когда в строке используется
какой-то специальный символ (специальный для YAML).</p>
<p>Такую строку, например, нужно взять в кавычки, чтобы она была корректно
воспринята YAML:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">command</span><span class="p">:</span> <span class="s2">&quot;sh interface | include Queueing strategy:&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h6>Комбинация элементов<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h6>
<p>Словарь, в котором есть два ключа: access и trunk. Значения, которые
соответствуют этим ключам - списки команд:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">access</span><span class="p">:</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">nonegotiate</span>
<span class="o">-</span> <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">portfast</span>
<span class="o">-</span> <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">bpduguard</span> <span class="n">enable</span>

<span class="n">trunk</span><span class="p">:</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">encapsulation</span> <span class="n">dot1q</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">mode</span> <span class="n">trunk</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">native</span> <span class="n">vlan</span> <span class="mi">999</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span>
</pre></div>
</div>
<p>Список словарей:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">BS</span><span class="p">:</span> <span class="mi">1550</span>
  <span class="n">IT</span><span class="p">:</span> <span class="mi">791</span>
  <span class="nb">id</span><span class="p">:</span> <span class="mi">11</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">Liverpool</span>
  <span class="n">to_id</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">to_name</span><span class="p">:</span> <span class="n">LONDON</span>
<span class="o">-</span> <span class="n">BS</span><span class="p">:</span> <span class="mi">1510</span>
  <span class="n">IT</span><span class="p">:</span> <span class="mi">793</span>
  <span class="nb">id</span><span class="p">:</span> <span class="mi">12</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">Bristol</span>
  <span class="n">to_id</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">to_name</span><span class="p">:</span> <span class="n">LONDON</span>
<span class="o">-</span> <span class="n">BS</span><span class="p">:</span> <span class="mi">1650</span>
  <span class="n">IT</span><span class="p">:</span> <span class="mi">892</span>
  <span class="nb">id</span><span class="p">:</span> <span class="mi">14</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">Coventry</span>
  <span class="n">to_id</span><span class="p">:</span> <span class="mi">2</span>
  <span class="n">to_name</span><span class="p">:</span> <span class="n">Manchester</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pyyaml">
<h5>Модуль PyYAML<a class="headerlink" href="#pyyaml" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для работы с YAML в Python используется модуль PyYAML. Он не входит в
стандартную библиотеку модулей, поэтому его нужно установить:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyyaml</span>
</pre></div>
</div>
<p>Работа с ним аналогична модулям csv и json.</p>
<div class="section" id="id6">
<h6>Чтение из YAML<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h6>
<p>Попробуем преобразовать данные из файла YAML в объекты Python.</p>
<p>Файл info.yaml:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">BS</span><span class="p">:</span> <span class="mi">1550</span>
  <span class="n">IT</span><span class="p">:</span> <span class="mi">791</span>
  <span class="nb">id</span><span class="p">:</span> <span class="mi">11</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">Liverpool</span>
  <span class="n">to_id</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">to_name</span><span class="p">:</span> <span class="n">LONDON</span>
<span class="o">-</span> <span class="n">BS</span><span class="p">:</span> <span class="mi">1510</span>
  <span class="n">IT</span><span class="p">:</span> <span class="mi">793</span>
  <span class="nb">id</span><span class="p">:</span> <span class="mi">12</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">Bristol</span>
  <span class="n">to_id</span><span class="p">:</span> <span class="mi">1</span>
  <span class="n">to_name</span><span class="p">:</span> <span class="n">LONDON</span>
<span class="o">-</span> <span class="n">BS</span><span class="p">:</span> <span class="mi">1650</span>
  <span class="n">IT</span><span class="p">:</span> <span class="mi">892</span>
  <span class="nb">id</span><span class="p">:</span> <span class="mi">14</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">Coventry</span>
  <span class="n">to_id</span><span class="p">:</span> <span class="mi">2</span>
  <span class="n">to_name</span><span class="p">:</span> <span class="n">Manchester</span>
</pre></div>
</div>
<p>Чтение из YAML (файл yaml_read.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;info.yaml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">templates</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">templates</span><span class="p">)</span>
</pre></div>
</div>
<p>Результат:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python yaml_read.py
[{&#39;BS&#39;: 1550,
  &#39;IT&#39;: 791,
  &#39;id&#39;: 11,
  &#39;name&#39;: &#39;Liverpool&#39;,
  &#39;to_id&#39;: 1,
  &#39;to_name&#39;: &#39;LONDON&#39;},
 {&#39;BS&#39;: 1510,
  &#39;IT&#39;: 793,
  &#39;id&#39;: 12,
  &#39;name&#39;: &#39;Bristol&#39;,
  &#39;to_id&#39;: 1,
  &#39;to_name&#39;: &#39;LONDON&#39;},
 {&#39;BS&#39;: 1650,
  &#39;IT&#39;: 892,
  &#39;id&#39;: 14,
  &#39;name&#39;: &#39;Coventry&#39;,
  &#39;to_id&#39;: 2,
  &#39;to_name&#39;: &#39;Manchester&#39;}]
</pre></div>
</div>
<p>Формат YAML очень удобен для хранения различных параметров, особенно,
если они заполняются вручную.</p>
</div>
<div class="section" id="id7">
<h6>Запись в YAML<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h6>
<p>Запись объектов Python в YAML (файл yaml_write.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yaml</span>

<span class="n">trunk_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;switchport trunk encapsulation dot1q&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport mode trunk&#39;</span><span class="p">,</span>
    <span class="s1">&#39;switchport trunk native vlan 999&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport trunk allowed vlan&#39;</span>
<span class="p">]</span>

<span class="n">access_template</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport access vlan&#39;</span><span class="p">,</span>
    <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span> <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
    <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span>
<span class="p">]</span>

<span class="n">to_yaml</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trunk&#39;</span><span class="p">:</span> <span class="n">trunk_template</span><span class="p">,</span> <span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="n">access_template</span><span class="p">}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">to_yaml</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sw_templates.yaml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>Файл sw_templates.yaml выглядит таким образом:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">access</span><span class="p">:</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">nonegotiate</span>
<span class="o">-</span> <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">portfast</span>
<span class="o">-</span> <span class="n">spanning</span><span class="o">-</span><span class="n">tree</span> <span class="n">bpduguard</span> <span class="n">enable</span>
<span class="n">trunk</span><span class="p">:</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">encapsulation</span> <span class="n">dot1q</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">mode</span> <span class="n">trunk</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">native</span> <span class="n">vlan</span> <span class="mi">999</span>
<span class="o">-</span> <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-book/17_serialization/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>В этом разделе рассматривались только базовые операции чтения и записи,
без дополнительных параметров. Подробнее можно почитать в документации
модулей.</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/library/csv.html">CSV</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/json.html">JSON</a></li>
<li><a class="reference external" href="http://pyyaml.org/wiki/PyYAMLDocumentation">YAML</a></li>
</ul>
<p>Кроме того, на сайте <a class="reference external" href="https://pymotw.com/3/index.html">PyMOTW</a> очень
хорошо расписываются все модули Python, которые входят в стандартную
библиотеку (устанавливаются вместе с самим Python):</p>
<ul class="simple">
<li><a class="reference external" href="https://pymotw.com/3/csv/index.html">CSV</a></li>
<li><a class="reference external" href="https://pymotw.com/3/json/index.html">JSON</a></li>
</ul>
<p>Пример получения данных в формате JSON через GitHub API:</p>
<ul class="simple">
<li><a class="reference external" href="https://pyneng.github.io/pyneng-3/GitHub-API-JSON-example/">Пример работы с GitHub API с помощью requests</a></li>
<li><a class="reference external" href="https://pyneng.github.io/pyneng-3/json-module/">Запись кириллицы и других не ASCII символов в формате JSON</a></li>
</ul>
</div>
<span id="document-exercises/17_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 17.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию write_dhcp_snooping_to_csv, которая обрабатывает
вывод команды show dhcp snooping binding из разных файлов и записывает обработанные данные в csv файл.</p>
<p>Аргументы функции:</p>
<ul class="simple">
<li>filenames - список с именами файлов с выводом show dhcp snooping binding</li>
<li>output - имя файла в формате csv, в который будет записан результат</li>
</ul>
<p>Функция ничего не возвращает.</p>
<p>Например, если как аргумент был передан список с одним файлом sw3_dhcp_snooping.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MacAddress</span>          <span class="n">IpAddress</span>        <span class="n">Lease</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>  <span class="n">Type</span>           <span class="n">VLAN</span>  <span class="n">Interface</span>
<span class="o">------------------</span>  <span class="o">---------------</span>  <span class="o">----------</span>  <span class="o">-------------</span>  <span class="o">----</span>  <span class="o">--------------------</span>
<span class="mi">00</span><span class="p">:</span><span class="n">E9</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>   <span class="mf">100.1</span><span class="o">.</span><span class="mf">1.6</span>        <span class="mi">76260</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">3</span>    <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">20</span>
<span class="mi">00</span><span class="p">:</span><span class="n">E9</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>   <span class="mf">100.1</span><span class="o">.</span><span class="mf">1.7</span>        <span class="mi">76260</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">3</span>    <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">21</span>
<span class="n">Total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">bindings</span><span class="p">:</span> <span class="mi">2</span>
</pre></div>
</div>
<p>В итоговом csv файле должно быть такое содержимое:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">switch</span><span class="p">,</span><span class="n">mac</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">vlan</span><span class="p">,</span><span class="n">interface</span>
<span class="n">sw3</span><span class="p">,</span><span class="mi">00</span><span class="p">:</span><span class="n">E9</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span><span class="mf">100.1</span><span class="o">.</span><span class="mf">1.6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">20</span>
<span class="n">sw3</span><span class="p">,</span><span class="mi">00</span><span class="p">:</span><span class="n">E9</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span><span class="mf">100.1</span><span class="o">.</span><span class="mf">1.7</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">21</span>
</pre></div>
</div>
<p>Первый столбец в csv файле имя коммутатора надо получить из имени файла, остальные - из содержимого в файлах.</p>
<p>Проверить работу функции на содержимом файлов sw1_dhcp_snooping.txt, sw2_dhcp_snooping.txt, sw3_dhcp_snooping.txt.</p>
</div>
<div class="section" id="id3">
<h5>Задание 17.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>В этом задании нужно:</p>
<ul class="simple">
<li>взять содержимое нескольких файлов с выводом команды sh version</li>
<li>распарсить вывод команды с помощью регулярных выражений и получить информацию об устройстве</li>
<li>записать полученную информацию в файл в CSV формате</li>
</ul>
<p>Для выполнения задания нужно создать две функции.</p>
<p>Функция parse_sh_version:</p>
<ul class="simple">
<li>ожидает как аргумент вывод команды sh version одной строкой (не имя файла)</li>
<li>обрабатывает вывод, с помощью регулярных выражений</li>
<li>возвращает кортеж из трёх элементов:<ul>
<li>ios - в формате «12.4(5)T»</li>
<li>image - в формате «flash:c2800-advipservicesk9-mz.124-5.T.bin»</li>
<li>uptime - в формате «5 days, 3 hours, 3 minutes»</li>
</ul>
</li>
</ul>
<p>У функции write_inventory_to_csv должно быть два параметра:</p>
<ul class="simple">
<li>data_filenames - ожидает как аргумент список имен файлов с выводом sh version</li>
<li>csv_filename - ожидает как аргумент имя файла (например, routers_inventory.csv),
в который будет записана информация в формате CSV</li>
</ul>
<p>Функция write_inventory_to_csv записывает содержимое в файл, в формате CSV и ничего не возвращает</p>
<p>Функция write_inventory_to_csv должна делать следующее:</p>
<ul class="simple">
<li>обработать информацию из каждого файла с выводом sh version:<ul>
<li>sh_version_r1.txt, sh_version_r2.txt, sh_version_r3.txt</li>
</ul>
</li>
<li>с помощью функции parse_sh_version, из каждого вывода должна быть получена информация ios, image, uptime</li>
<li>из имени файла нужно получить имя хоста</li>
<li>после этого вся информация должна быть записана в CSV файл</li>
</ul>
<p>В файле routers_inventory.csv должны быть такие столбцы: <code class="docutils literal notranslate"><span class="pre">hostname,</span> <span class="pre">ios,</span> <span class="pre">image,</span> <span class="pre">uptime</span></code></p>
<p>В скрипте, с помощью модуля glob, создан список файлов, имя которых начинается на sh_vers.
вы можете раскомментировать строку print(sh_version_files), чтобы посмотреть содержимое списка.</p>
<p>Кроме того, создан список заголовков (headers), который должен быть записан в CSV.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>

<span class="n">sh_version_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;sh_vers*&quot;</span><span class="p">)</span>
<span class="c1">#print(sh_version_files)</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hostname&quot;</span><span class="p">,</span> <span class="s2">&quot;ios&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;uptime&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Задание 17.3<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию parse_sh_cdp_neighbors, которая обрабатывает
вывод команды show cdp neighbors.</p>
<p>Функция ожидает, как аргумент, вывод команды одной строкой (не имя файла).
Функция должна возвращать словарь, который описывает соединения между устройствами.</p>
<p>Например, если как аргумент был передан такой вывод:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R4</span><span class="o">&gt;</span><span class="n">show</span> <span class="n">cdp</span> <span class="n">neighbors</span>

<span class="n">Device</span> <span class="n">ID</span>    <span class="n">Local</span> <span class="n">Intrfce</span>   <span class="n">Holdtme</span>     <span class="n">Capability</span>       <span class="n">Platform</span>    <span class="n">Port</span> <span class="n">ID</span>
<span class="n">R5</span>           <span class="n">Fa</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>          <span class="mi">122</span>           <span class="n">R</span> <span class="n">S</span> <span class="n">I</span>           <span class="mi">2811</span>       <span class="n">Fa</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">R6</span>           <span class="n">Fa</span> <span class="mi">0</span><span class="o">/</span><span class="mi">2</span>          <span class="mi">143</span>           <span class="n">R</span> <span class="n">S</span> <span class="n">I</span>           <span class="mi">2811</span>       <span class="n">Fa</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span>
</pre></div>
</div>
<p>Функция должна вернуть такой словарь:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;R4&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Fa 0/1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;R5&quot;</span><span class="p">:</span> <span class="s2">&quot;Fa 0/1&quot;</span><span class="p">},</span>
        <span class="s2">&quot;Fa 0/2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;R6&quot;</span><span class="p">:</span> <span class="s2">&quot;Fa 0/0&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>Интерфейсы должны быть записаны с пробелом. То есть, так Fa 0/0, а не так Fa0/0.</p>
<p>Проверить работу функции на содержимом файла sh_cdp_n_sw1.txt</p>
</div>
<div class="section" id="a">
<h5>Задание 17.3a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию generate_topology_from_cdp, которая обрабатывает вывод команды show cdp neighbor из нескольких файлов и записывает итоговую топологию в один словарь.</p>
<p>Функция generate_topology_from_cdp должна быть создана с параметрами:</p>
<ul class="simple">
<li>list_of_files - список файлов из которых надо считать вывод команды sh cdp neighbor</li>
<li>save_to_filename - имя файла в формате YAML, в который сохранится топология.<ul>
<li>значение по умолчанию - None. По умолчанию, топология не сохраняется в файл</li>
<li>топология сохраняется только, если save_to_filename как аргумент указано имя файла</li>
</ul>
</li>
</ul>
<p>Функция должна возвращать словарь, который описывает соединения между устройствами, независимо от того сохраняется ли топология в файл.</p>
<p>Структура словаря должна быть такой:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;R4&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Fa 0/1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;R5&quot;</span><span class="p">:</span> <span class="s2">&quot;Fa 0/1&quot;</span><span class="p">},</span>
        <span class="s2">&quot;Fa 0/2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;R6&quot;</span><span class="p">:</span> <span class="s2">&quot;Fa 0/0&quot;</span><span class="p">}},</span>
 <span class="s2">&quot;R5&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Fa 0/1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;R4&quot;</span><span class="p">:</span> <span class="s2">&quot;Fa 0/1&quot;</span><span class="p">}},</span>
 <span class="s2">&quot;R6&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Fa 0/0&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;R4&quot;</span><span class="p">:</span> <span class="s2">&quot;Fa 0/2&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>Интерфейсы должны быть записаны с пробелом. То есть, так Fa 0/0, а не так Fa0/0.</p>
<p>Проверить работу функции generate_topology_from_cdp на списке файлов:</p>
<ul class="simple">
<li>sh_cdp_n_sw1.txt</li>
<li>sh_cdp_n_r1.txt</li>
<li>sh_cdp_n_r2.txt</li>
<li>sh_cdp_n_r3.txt</li>
<li>sh_cdp_n_r4.txt</li>
<li>sh_cdp_n_r5.txt</li>
<li>sh_cdp_n_r6.txt</li>
</ul>
<p>Проверить работу параметра save_to_filename и записать итоговый словарь в файл topology.yaml.</p>
</div>
<div class="section" id="b">
<h5>Задание 17.3b<a class="headerlink" href="#b" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию transform_topology, которая преобразует топологию в формат подходящий для функции draw_topology.</p>
<p>Функция ожидает как аргумент имя файла в формате YAML, в котором хранится топология.</p>
<p>Функция должна считать данные из YAML файла, преобразовать их соответственно, чтобы функция возвращала словарь такого вида:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa 0/1&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R5&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa 0/1&quot;</span><span class="p">),</span>
 <span class="p">(</span><span class="s2">&quot;R4&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa 0/2&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R6&quot;</span><span class="p">,</span> <span class="s2">&quot;Fa 0/0&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Функция transform_topology должна не только менять формат представления топологии,
но и удалять «дублирующиеся» соединения (их лучше всего видно на схеме, которую
генерирует функция draw_topology из файла draw_network_graph.py).
Тут «дублирующиеся» соединения, это ситуация когда в словаре есть два соединения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/1&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/1&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Из-за того что один и тот же линк описывается дважды, на схеме будут лишние соединения.
Задача оставить только один из этих линков в итоговом словаре, не важно какой.</p>
<p>Проверить работу функции на файле topology.yaml (должен быть создан в задании 17.3a).
На основании полученного словаря надо сгенерировать изображение топологии
с помощью функции draw_topology.
Не копировать код функции draw_topology из файла draw_network_graph.py.</p>
<p>Результат должен выглядеть так же, как схема в файле task_17_3b_topology.svg</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/natenka/pyneng-examples-exercises/master/exercises/17_serialization/task_17_3b_topology.png" src="https://raw.githubusercontent.com/natenka/pyneng-examples-exercises/master/exercises/17_serialization/task_17_3b_topology.png" />
</div>
<p>При этом:</p>
<ul class="simple">
<li>Интерфейсы должны быть записаны с пробелом Fa 0/0</li>
<li>Расположение устройств на схеме может быть другим</li>
<li>Соединения должны соответствовать схеме</li>
<li>На схеме не должно быть дублирующихся линков</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p>Для выполнения этого задания, должен быть установлен graphviz:
apt-get install graphviz</p>
<p class="last">И модуль python для работы с graphviz:
pip install graphviz</p>
</div>
</div>
<div class="section" id="id5">
<h5>Задание 17.4<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию write_last_log_to_csv.</p>
<p>Аргументы функции:</p>
<ul class="simple">
<li>source_log - имя файла в формате csv, из которого читаются данные (пример mail_log.csv)</li>
<li>output - имя файла в формате csv, в который будет записан результат</li>
</ul>
<p>Функция ничего не возвращает.</p>
<p>Функция write_last_log_to_csv обрабатывает csv файл mail_log.csv.
В файле mail_log.csv находятся логи изменения имени пользователя. При этом, email
пользователь менять не может, только имя.</p>
<p>Функция write_last_log_to_csv должна отбирать из файла mail_log.csv только
самые свежие записи для каждого пользователя и записывать их в другой csv файл.
В файле output первой строкой должны быть заголовки столбцов, такие же как в файле source_log.</p>
<p>Для части пользователей запись только одна и тогда в итоговый файл надо записать только ее.
Для некоторых пользователей есть несколько записей с разными именами.
Например пользователь с email <a class="reference external" href="mailto:c3po&#37;&#52;&#48;gmail&#46;com">c3po<span>&#64;</span>gmail<span>&#46;</span>com</a> несколько раз менял имя:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="o">=</span><span class="mi">3</span><span class="n">PO</span><span class="p">,</span><span class="n">c3po</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span><span class="p">,</span><span class="mi">16</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2019</span> <span class="mi">17</span><span class="p">:</span><span class="mi">10</span>
<span class="n">C3PO</span><span class="p">,</span><span class="n">c3po</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span><span class="p">,</span><span class="mi">16</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2019</span> <span class="mi">17</span><span class="p">:</span><span class="mi">15</span>
<span class="n">C</span><span class="o">-</span><span class="mi">3</span><span class="n">PO</span><span class="p">,</span><span class="n">c3po</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span><span class="p">,</span><span class="mi">16</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2019</span> <span class="mi">17</span><span class="p">:</span><span class="mi">24</span>
</pre></div>
</div>
<p>Из этих трех записей, в итоговый файл должна быть записана только одна - самая свежая:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="o">-</span><span class="mi">3</span><span class="n">PO</span><span class="p">,</span><span class="n">c3po</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span><span class="p">,</span><span class="mi">16</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2019</span> <span class="mi">17</span><span class="p">:</span><span class="mi">24</span>
</pre></div>
</div>
<p>Для сравнения дат удобно использовать объекты datetime из модуля datetime.
Чтобы упростить работу с датами, создана функция convert_str_to_datetime - она
конвертирует строку с датой в формате 11/10/2019 14:05 в объект datetime.
Полученные объекты datetime можно сравнивать между собой.
Вторая функция convert_datetime_to_str делает обратную операцию - превращает
объект datetime в строку.</p>
<p>Функции convert_str_to_datetime и convert_datetime_to_str использовать не обязательно.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>


<span class="k">def</span> <span class="nf">convert_str_to_datetime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Конвертирует строку с датой в формате 11/10/2019 14:05 в объект datetime.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">convert_datetime_to_str</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Конвертирует строку с датой в формате 11/10/2019 14:05 в объект datetime.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">datetime_obj</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/Part_V"></span><div class="section" id="v">
<h2>V. Работа с сетевым оборудованием<a class="headerlink" href="#v" title="Ссылка на этот заголовок">¶</a></h2>
<p>В этой части рассматриаются:</p>
<ul class="simple">
<li>подключение к оборудованию по SSH и Telnet</li>
<li>одновременное подключение к нескольким устройствам</li>
<li>создание шаблонов конфигурации с помощью Jinja2</li>
<li>обработка вывода команд с помощью TextFSM</li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-book/18_ssh_telnet/index"></span><div class="section" id="ssh-telnet-index">
<span id="id1"></span><h3>18. Подключение к оборудованию<a class="headerlink" href="#ssh-telnet-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>В этом разделе рассматривается как подключиться к оборудованию по
протоколам:</p>
<ul class="simple">
<li>SSH</li>
<li>Telnet</li>
</ul>
<p>В Python есть несколько модулей, которые позволяют подключаться к
оборудованию и выполнять команды:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">pexpect</span></code> - это реализация expect на Python<ul>
<li>этот модуль позволяет работать с любой интерактивной сессией: ssh, telnet, sftp и др.</li>
<li>кроме того, он позволяет выполнять
различные команды в ОС (это можно делать и с помощью других модулей)</li>
<li>несмотря на то, что pexpect может быть менее удобным в использовании,
чем другие модули, он реализует более общий функционал и это позволяет
использовать его в ситуациях, когда другие модули не работают</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">telnetlib</span></code> - этот модуль позволяет подключаться по Telnet<ul>
<li>в версии 1.0 netmiko также появилась поддержка Telnet, поэтому, если netmiko
поддерживает то оборудование, которое используется у вас, удобней будет использовать его</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">paramiko</span></code> - это модуль, который позволяет подключаться по SSHv2<ul>
<li>он более удобен в использовании, чем pexpect, но с более
узкой функциональностью (поддерживает только SSH)</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">netmiko</span></code> - это модуль, который упрощает использование paramiko для сетевых устройств<ul>
<li>netmiko это «обертка» вокруг paramiko, которая ориентирована на работу
с сетевым оборудованием</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">scrapli</span></code> - это модуль, который позволяет подключаться к сетевому оборудованию
используя Telnet, SSH или NETCONF.</li>
</ul>
<p>В этом разделе рассматриваются все 5 модулей, а также как подключаться к
нескольким устройствам параллельно.
В примерах раздела используются три маршрутизатора. К ним нет никаких
требований, только настроенный SSH.</p>
<p>Параметры, которые используются в разделе:</p>
<ul class="simple">
<li>пользователь: cisco</li>
<li>пароль: cisco</li>
<li>пароль на режим enable: cisco</li>
<li>SSH версии 2</li>
<li>IP-адреса: 192.168.100.1, 192.168.100.2, 192.168.100.3</li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-book/18_ssh_telnet/password"></span><div class="section" id="id1">
<h4>Ввод пароля<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>При подключении к оборудованию вручную, как правило, пароль также
вводится вручную.</p>
<p>При автоматизации подключения надо решить, каким образом будет
передаваться пароль:</p>
<ul class="simple">
<li>Запрашивать пароль при старте скрипта и считывать ввод пользователя.
Минус в том, что будет видно, какие символы вводит пользователь</li>
<li>Записывать логин и пароль в каком-то файле (это не очень безопасно).</li>
</ul>
<p>Как правило, один и тот же пользователь использует одинаковый логин и
пароль для подключения к оборудованию.
И, как правило, будет достаточно запросить логин и пароль при старте
скрипта, а затем использовать их для подключения на разные устройства.</p>
<p>К сожалению, если использовать <code class="docutils literal notranslate"><span class="pre">input()</span></code>, набираемый пароль будет
виден. А хотелось бы, чтобы при вводе пароля вводимые символы не
отображались.</p>
<div class="section" id="getpass">
<h5>Модуль getpass<a class="headerlink" href="#getpass" title="Ссылка на этот заголовок">¶</a></h5>
<p>Модуль getpass позволяет запрашивать пароль, не отображая вводимые
символы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">getpass</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">()</span>
<span class="n">Password</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
<span class="n">testpass</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Переменные окружения<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Еще один вариант хранения пароля (а можно и пользователя) - переменные
окружения.</p>
<p>Например, таким образом логин и пароль записываются в переменные:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export SSH_USER=user
$ export SSH_PASSWORD=userpass
</pre></div>
</div>
<p>А затем в Python считываются значения в переменные в скрипте:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SSH_USER&#39;</span><span class="p">)</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SSH_PASSWORD&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/18_ssh_telnet/pexpect"></span><div class="section" id="pexpect">
<h4>Модуль pexpect<a class="headerlink" href="#pexpect" title="Ссылка на этот заголовок">¶</a></h4>
<p>Модуль pexpect позволяет автоматизировать интерактивные подключения,
такие как:</p>
<ul class="simple">
<li>telnet</li>
<li>ssh</li>
<li>ftp</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Pexpect - это реализация expect на Python.</p>
</div>
<p>Для начала, модуль pexpect нужно установить:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pexpect</span>
</pre></div>
</div>
<p>Логика работы pexpect такая:</p>
<ul class="simple">
<li>запускается какая-то программа</li>
<li>pexpect ожидает определенный вывод (приглашение, запрос пароля и подобное)</li>
<li>получив вывод, он отправляет команды/данные</li>
<li>последние два действия повторяются столько, сколько нужно</li>
</ul>
<p>При этом сам pexpect не реализует различные утилиты, а использует уже
готовые.</p>
<div class="section" id="pexpect-spawn">
<h5><code class="docutils literal notranslate"><span class="pre">pexpect.spawn</span></code><a class="headerlink" href="#pexpect-spawn" title="Ссылка на этот заголовок">¶</a></h5>
<p>Класс <code class="docutils literal notranslate"><span class="pre">spawn</span></code> позволяет взаимодействовать с вызванной
программой, отправляя данные и ожидая ответ.</p>
<p>Например, таким образом можно инициировать соединение SSH:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">ssh</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;ssh cisco@192.168.100.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>После выполнения этой строки, подключение готово. Теперь необходимо
указать какую строку ожидать. В данном случае, надо дождаться запроса о
пароле:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;[Pp]assword&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Обратите внимание как описана строка, которую ожидает pexpect:
<code class="docutils literal notranslate"><span class="pre">[Pp]assword</span></code>. Это регулярное выражение, которое описывает строку
password или Password. То есть, методу expect можно передавать
регулярное выражение как аргумент.</p>
<p>Метод expect вернул число 0 в результате работы. Это число указывает,
что совпадение было найдено и что это элемент с индексом ноль. Индекс
тут фигурирует из-за того, что expect можно передавать список строк.
Например, можно передать список с двумя элементами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">ssh</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;ssh cisco@192.168.100.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;Password&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Обратите внимание, что теперь возвращается 1. Это значит, что
совпадением было слово Password.</p>
<p>Теперь можно отправлять пароль. Для этого используется команда sendline:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;cisco&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="mi">6</span>
</pre></div>
</div>
<p>Команда sendline отправляет строку, автоматически добавляет к ней
перевод строки на основе значения os.linesep, а затем возвращает число
указывающее сколько байт было записано.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В pexpect есть несколько вариантов отправки команд, не только
sendline.</p>
</div>
<p>Для того чтобы попасть в режим enable цикл expect-sendline повторяется:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;[&gt;#]&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;enable&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="mi">7</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;[Pp]assword&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;cisco&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="mi">6</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;[&gt;#]&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Теперь можно отправлять команду:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;sh ip int br&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="mi">13</span>
</pre></div>
</div>
<p>После отправки команды, pexpect надо указать до какого момента считать
вывод. Указываем, что считать надо до #:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Вывод команды находится в атрибуте before:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">before</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;sh ip int br</span><span class="se">\r\n</span><span class="s1">Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\r\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/2                19.1.1.1        YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3                192.168.230.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">R1&#39;</span>
</pre></div>
</div>
<p>Так как результат выводится в виде последовательности байтов, надо
конвертировать ее в строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [18]: show_output = ssh.before.decode(&#39;utf-8&#39;)

In [19]: print(show_output)
sh ip int br
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.1   YES NVRAM  up                    up
Ethernet0/1                192.168.200.1   YES NVRAM  up                    up
Ethernet0/2                19.1.1.1        YES NVRAM  up                    up
Ethernet0/3                192.168.230.1   YES NVRAM  up                    up
Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up
Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up
Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up
R1
</pre></div>
</div>
<p>Завершается сессия вызовом метода close:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="shell">
<h5>Специальные символы в shell<a class="headerlink" href="#shell" title="Ссылка на этот заголовок">¶</a></h5>
<p>Pexpect не интерпретирует специальные символы shell, такие как <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">|</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>.</p>
<p>Для того, чтобы, например, команда <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-ls</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">SUMMARY</span></code> отработала,
нужно запустить shell таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">pexpect</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;/bin/bash -c &quot;ls -ls | grep pexpect&quot;&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">pexpect</span><span class="o">.</span><span class="n">EOF</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">before</span><span class="p">)</span>
<span class="sa">b</span><span class="s1">&#39;4 -rw-r--r-- 1 vagrant vagrant 3203 Jul 14 07:15 1_pexpect.py</span><span class="se">\r\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">before</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<span class="mi">4</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">vagrant</span> <span class="n">vagrant</span> <span class="mi">3203</span> <span class="n">Jul</span> <span class="mi">14</span> <span class="mi">07</span><span class="p">:</span><span class="mi">15</span> <span class="mi">1</span><span class="n">_pexpect</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<div class="section" id="pexpect-eof">
<h5>pexpect.EOF<a class="headerlink" href="#pexpect-eof" title="Ссылка на этот заголовок">¶</a></h5>
<p>В предыдущем примере встретилось использование pexpect.EOF.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">EOF (end of file) — конец файла</p>
</div>
<p>Это специальное значение, которое позволяет отреагировать на завершение
исполнения команды или сессии, которая была запущена в spawn.</p>
<p>При вызове команды <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-ls</span></code> pexpect не получает интерактивный сеанс.
Команда выполняется и всё, на этом завершается её работа.</p>
<p>Поэтому если запустить её и указать в expect приглашение, возникнет
ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;/bin/bash -c &quot;ls -ls | grep SUMMARY&quot;&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;nattaur&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="n">EOF</span>                                       <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">9</span><span class="o">-</span><span class="mi">9</span><span class="n">c71777698c2</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">p</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s1">&#39;nattaur&#39;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Если передать в expect EOF, ошибки не будет.</p>
</div>
<div class="section" id="pexpect-expect">
<h5>Метод pexpect.expect<a class="headerlink" href="#pexpect-expect" title="Ссылка на этот заголовок">¶</a></h5>
<p>В pexpect.expect как шаблон может использоваться:</p>
<ul class="simple">
<li>регулярное выражение</li>
<li>EOF - этот шаблон позволяет среагировать на исключение EOF</li>
<li>TIMEOUT - исключение timeout (по умолчанию значение timeout = 30 секунд)</li>
<li>compiled re</li>
</ul>
<p>Еще одна очень полезная возможность pexpect.expect: можно передавать не
одно значение, а список.</p>
<p>Например:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;/bin/bash -c &quot;ls -ls | grep netmiko&quot;&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="s1">&#39;py3_convert&#39;</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">EOF</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Тут несколько важных моментов:</p>
<ul class="simple">
<li>когда pexpect.expect вызывается со списком, можно указывать разные ожидаемые строки</li>
<li>кроме строк, можно указывать исключения</li>
<li>pexpect.expect возвращает номер элемента списка, который сработал<ul>
<li>в данном случае номер 2, так как исключение EOF находится в списке под номером два</li>
</ul>
</li>
<li>за счет такого формата можно делать ответвления в программе,
в зависимости от того, с каким элементом было совпадение</li>
</ul>
</div>
<div class="section" id="id1">
<h5>Пример использования pexpect<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Пример использования pexpect для подключения к оборудованию и передачи
команды show (файл 1_pexpect.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pexpect</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>


<span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">commands</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ssh </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;[Pp]assword&quot;</span><span class="p">)</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">enable_status</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">enable_status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&quot;enable&quot;</span><span class="p">)</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;[Pp]assword&quot;</span><span class="p">)</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

        <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&quot;terminal length 0&quot;</span><span class="p">)</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="n">prompt</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">EOF</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Символ </span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s2"> не найден в выводе. Полученный вывод записан в словарь&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Соединение разорвано со стороны сервера&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">before</span>
                <span class="n">result</span><span class="p">[</span><span class="n">command</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.2&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.3&quot;</span><span class="p">]</span>
    <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sh clock&quot;</span><span class="p">,</span> <span class="s2">&quot;sh int desc&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">send_show_command</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="n">commands</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
</pre></div>
</div>
<p>Эта часть функции отвечает за переход в режим enable:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">enable_status</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">])</span>
<span class="k">if</span> <span class="n">enable_status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&quot;enable&quot;</span><span class="p">)</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;[Pp]assword&quot;</span><span class="p">)</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
</pre></div>
</div>
<p>Если <code class="docutils literal notranslate"><span class="pre">ssh.expect([&quot;&gt;&quot;,</span> <span class="pre">&quot;#&quot;])</span></code> возвращает индекс 0, значит при подключении не было
автоматического перехода в режим enable и его надо выполнить.
Если возвращается индекс 1 - значит мы уже находимся в режиме enable, например, потому что
на оборудовании настроено privilege 15.</p>
<p>Еще один интересный момент в функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="n">prompt</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">EOF</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Символ </span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s2"> не найден в выводе. Полученный вывод записан в словарь&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Соединение разорвано со стороны сервера&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">before</span>
        <span class="n">result</span><span class="p">[</span><span class="n">command</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>Тут по очереди отправляются команды и expect ждет три варианта: приглашение, таймаут или EOF.
Если метод expect не дождался <code class="docutils literal notranslate"><span class="pre">#</span></code>, будет возвращено значение 1 и в этом случае выводится сообщение,
что символ не найден. При этом, и когда совпадение найдено и когда был таймаут, полученный вывод
записывается в словарь. Таким образом можно увидеть, что было получено с устройства, даже
если приглашение не найдено.</p>
<p>Вывод при запуске скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;sh clock&#39;</span><span class="p">:</span> <span class="s1">&#39;sh clock</span><span class="se">\n</span><span class="s1">*13:13:47.525 UTC Sun Jul 19 2020</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sh int desc&#39;</span><span class="p">:</span> <span class="s1">&#39;sh int desc</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Interface                      Status         Protocol Description</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/0                          up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/1                          up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/2                          up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/3                          up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Lo22                           up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Lo33                           up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Lo45                           up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Lo55                           up             up       </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;sh clock&#39;</span><span class="p">:</span> <span class="s1">&#39;sh clock</span><span class="se">\n</span><span class="s1">*13:13:50.450 UTC Sun Jul 19 2020</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sh int desc&#39;</span><span class="p">:</span> <span class="s1">&#39;sh int desc</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Interface                      Status         Protocol Description</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/0                          up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/1                          up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/2                          admin down     down     </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/3                          admin down     down     </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Lo0                            up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Lo9                            up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Lo19                           up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Lo33                           up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Lo100                          up             up       </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;sh clock&#39;</span><span class="p">:</span> <span class="s1">&#39;sh clock</span><span class="se">\n</span><span class="s1">*13:13:53.360 UTC Sun Jul 19 2020</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sh int desc&#39;</span><span class="p">:</span> <span class="s1">&#39;sh int desc</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Interface                      Status         Protocol Description</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/0                          up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/1                          up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/2                          admin down     down     </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/3                          admin down     down     </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Lo33                           up             up       </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Работа с pexpect без отключения постраничного вывода команд<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Иногда вывод команды сильно большой и его не получается полностью считать или оборудование не
дает возможность отключить постраничный вывод. В этом случае необходим немного другой подход.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Эта же задача будет повторяться и для других модулей этого раздела.</p>
</div>
<p>Пример использования pexpect для работы с постраничным выводом команд
show (файл 1_pexpect_more.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pexpect</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>


<span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ssh </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;[Pp]assword&quot;</span><span class="p">)</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">enable_status</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">enable_status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&quot;enable&quot;</span><span class="p">)</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;[Pp]assword&quot;</span><span class="p">)</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

        <span class="n">ssh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="n">prompt</span><span class="p">,</span> <span class="s2">&quot;--More--&quot;</span><span class="p">,</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">])</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">before</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; +</span><span class="se">\x08</span><span class="s2">+ +</span><span class="se">\x08</span><span class="s2">+&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="n">page</span>
            <span class="k">if</span> <span class="n">match</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">match</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ошибка: timeout&quot;</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> +</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.2&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.3&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">send_show_command</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;sh run&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">_result.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь после отправки команды, метод expect ждет еще один вариант <code class="docutils literal notranslate"><span class="pre">--More--</span></code> - признак,
что дальше идет еще одна страница. Так как заранее не известно сколько именно страниц будет в выводе,
чтение выполняется в цикле <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True</span></code>. Цикл прерывается если встретилось приглашение <code class="docutils literal notranslate"><span class="pre">#</span></code>
или в течение 10 секунд не появилось приглашение или <code class="docutils literal notranslate"><span class="pre">--More--</span></code>.</p>
<p>Если встретилось <code class="docutils literal notranslate"><span class="pre">--More--</span></code>, страницы еще не закончились и надо пролистнуть следующую.
В Cisco для этого надо нажать пробел (без перевода строки). Поэтому тут используется метод send,
а не sendline - sendline автоматически добавляет перевод строки.</p>
<p>Эта строка <code class="docutils literal notranslate"><span class="pre">page</span> <span class="pre">=</span> <span class="pre">re.sub(&quot;</span> <span class="pre">+\x08+</span> <span class="pre">+\x08+&quot;,</span> <span class="pre">&quot;\n&quot;,</span> <span class="pre">page)</span></code> удаляет backspace символы, которые находятся вокруг <code class="docutils literal notranslate"><span class="pre">--More--</span></code> чтобы они не попали в итоговый вывод.</p>
</div>
</div>
<span id="document-book/18_ssh_telnet/telnetlib"></span><div class="section" id="telnetlib">
<h4>Модуль telnetlib<a class="headerlink" href="#telnetlib" title="Ссылка на этот заголовок">¶</a></h4>
<p>Модуль telnetlib входит в стандартную библиотеку Python. Это реализация
клиента telnet.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Подключиться по telnet можно и используя pexpect. Плюс telnetlib в
том, что этот модуль входит в стандартную библиотеку Python.</p>
</div>
<p>Принцип работы telnetlib напоминает pexpect, но есть несколько отличий.
Самое заметное отличие в том, что telnetlib требует передачи байтовой
строки, а не обычной.</p>
<p>Подключение выполняется таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">telnet</span> <span class="o">=</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">(</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="read-until">
<h5>Метод read_until<a class="headerlink" href="#read-until" title="Ссылка на этот заголовок">¶</a></h5>
<p>С помощью метода read_until указывается до какой строки считать вывод.
При этом, как аргумент надо передавать не обычную строку, а байты:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Username&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n\r\n</span><span class="s1">User Access Verification</span><span class="se">\r\n\r\n</span><span class="s1">Username&#39;</span>
</pre></div>
</div>
<p>Метод read_until возвращает все, что он считал до указанной строки.</p>
</div>
<div class="section" id="write">
<h5>Метод write<a class="headerlink" href="#write" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для передачи данных используется метод write. Ему нужно передавать
байтовую строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;cisco</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Читаем вывод до слова Password и передаем пароль:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Password&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;: cisco</span><span class="se">\r\n</span><span class="s1">Password&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;cisco</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь можно указать, что надо считать вывод до приглашения, а затем
отправить команду:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;: </span><span class="se">\r\n</span><span class="s1">R1&gt;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;sh ip int br</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>После отправки команды можно продолжать использовать метод read_until:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;sh ip int br</span><span class="se">\r\n</span><span class="s1">Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\r\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/2                19.1.1.1        YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3                192.168.230.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">R1&gt;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="read-very-eager">
<h5>Метод read_very_eager<a class="headerlink" href="#read-very-eager" title="Ссылка на этот заголовок">¶</a></h5>
<p>Или использовать еще один метод для чтения read_very_eager.
При использовании метода read_very_eager, можно отправить несколько
команд, а затем считать весь доступный вывод:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [9]: telnet.write(b&#39;sh arp\n&#39;)

In [10]: telnet.write(b&#39;sh clock\n&#39;)

In [11]: telnet.write(b&#39;sh ip int br\n&#39;)

In [12]: all_result = telnet.read_very_eager().decode(&#39;utf-8&#39;)

In [13]: print(all_result)
sh arp
Protocol  Address          Age (min)  Hardware Addr   Type   Interface
Internet  10.30.0.1               -   aabb.cc00.6530  ARPA   Ethernet0/3.300
Internet  10.100.0.1              -   aabb.cc00.6530  ARPA   Ethernet0/3.100
Internet  10.200.0.1              -   aabb.cc00.6530  ARPA   Ethernet0/3.200
Internet  19.1.1.1                -   aabb.cc00.6520  ARPA   Ethernet0/2
Internet  192.168.100.1           -   aabb.cc00.6500  ARPA   Ethernet0/0
Internet  192.168.100.2         124   aabb.cc00.6600  ARPA   Ethernet0/0
Internet  192.168.100.3         143   aabb.cc00.6700  ARPA   Ethernet0/0
Internet  192.168.100.100       160   aabb.cc80.c900  ARPA   Ethernet0/0
Internet  192.168.200.1           -   0203.e800.6510  ARPA   Ethernet0/1
Internet  192.168.200.100        13   0800.27ac.16db  ARPA   Ethernet0/1
Internet  192.168.230.1           -   aabb.cc00.6530  ARPA   Ethernet0/3
R1&gt;sh clock
*19:18:57.980 UTC Fri Nov 3 2017
R1&gt;sh ip int br
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.1   YES NVRAM  up                    up
Ethernet0/1                192.168.200.1   YES NVRAM  up                    up
Ethernet0/2                19.1.1.1        YES NVRAM  up                    up
Ethernet0/3                192.168.230.1   YES NVRAM  up                    up
Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up
Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up
Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up
R1&gt;
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Перед методом read_very_eager всегда надо ставить time.sleep(n).</p>
</div>
<p>С read_until будет немного другой подход. Можно выполнить те же три
команды, но затем получать вывод по одной за счет чтения до строки с
приглашением:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;sh arp</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;sh clock</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;sh ip int br</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;sh arp</span><span class="se">\r\n</span><span class="s1">Protocol  Address          Age (min)  Hardware Addr   Type   Interface</span><span class="se">\r\n</span><span class="s1">Internet  10.30.0.1               -   aabb.cc00.6530  ARPA   Ethernet0/3.300</span><span class="se">\r\n</span><span class="s1">Internet  10.100.0.1              -   aabb.cc00.6530  ARPA   Ethernet0/3.100</span><span class="se">\r\n</span><span class="s1">Internet  10.200.0.1              -   aabb.cc00.6530  ARPA   Ethernet0/3.200</span><span class="se">\r\n</span><span class="s1">Internet  19.1.1.1                -   aabb.cc00.6520  ARPA   Ethernet0/2</span><span class="se">\r\n</span><span class="s1">Internet  192.168.100.1           -   aabb.cc00.6500  ARPA   Ethernet0/0</span><span class="se">\r\n</span><span class="s1">Internet  192.168.100.2         126   aabb.cc00.6600  ARPA   Ethernet0/0</span><span class="se">\r\n</span><span class="s1">Internet  192.168.100.3         145   aabb.cc00.6700  ARPA   Ethernet0/0</span><span class="se">\r\n</span><span class="s1">Internet  192.168.100.100       162   aabb.cc80.c900  ARPA   Ethernet0/0</span><span class="se">\r\n</span><span class="s1">Internet  192.168.200.1           -   0203.e800.6510  ARPA   Ethernet0/1</span><span class="se">\r\n</span><span class="s1">Internet  192.168.200.100        15   0800.27ac.16db  ARPA   Ethernet0/1</span><span class="se">\r\n</span><span class="s1">Internet  192.168.230.1           -   aabb.cc00.6530  ARPA   Ethernet0/3</span><span class="se">\r\n</span><span class="s1">R1&gt;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;sh clock</span><span class="se">\r\n</span><span class="s1">*19:20:39.388 UTC Fri Nov 3 2017</span><span class="se">\r\n</span><span class="s1">R1&gt;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;sh ip int br</span><span class="se">\r\n</span><span class="s1">Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\r\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/2                19.1.1.1        YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3                192.168.230.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">R1&gt;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="read-until-vs-read-very-eager">
<h5>read_until vs read_very_eager<a class="headerlink" href="#read-until-vs-read-very-eager" title="Ссылка на этот заголовок">¶</a></h5>
<p>Важное отличие между read_until и read_very_eager заключается в том,
как они реагируют на отсутствие вывода.</p>
<p>Метод read_until ждет определенную строку. По умолчанию, если ее нет,
метод «зависнет». Опциональный параметр timeout позволяет указать
сколько ждать нужную строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>Если за указанное время строка не появилась, возвращается пустая строка.</p>
<p>Метод read_very_eager просто вернет пустую строку, если вывода нет:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">read_very_eager</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="expect">
<h5>Метод expect<a class="headerlink" href="#expect" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод expect позволяет указывать список с регулярными выражениями. Он
работает похоже на pexpect, но в модуле telnetlib всегда надо передавать
список регулярных выражений.</p>
<p>При этом, можно передавать байтовые строки или компилированные
регулярные выражения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;sh clock</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="sa">b</span><span class="s1">&#39;[&gt;#]&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span>
<span class="p">(</span><span class="mi">0</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">_sre</span><span class="o">.</span><span class="n">SRE_Match</span> <span class="nb">object</span><span class="p">;</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">46</span><span class="p">,</span> <span class="mi">47</span><span class="p">),</span> <span class="n">match</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="sa">b</span><span class="s1">&#39;sh clock</span><span class="se">\r\n</span><span class="s1">*19:35:10.984 UTC Fri Nov 3 2017</span><span class="se">\r\n</span><span class="s1">R1&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Метод expect возвращает кортеж их трех элементов:</p>
<ul class="simple">
<li>индекс выражения, которое совпало</li>
<li>объект Match</li>
<li>байтовая строка, которая содержит все
считанное до регулярного выражения и включая его</li>
</ul>
<p>Соответственно, при необходимости, с этими элементами можно дальше
работать:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;sh clock</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">regex_idx</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="sa">b</span><span class="s1">&#39;[&gt;#]&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">regex_idx</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">match</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">_sre</span><span class="o">.</span><span class="n">SRE_Match</span> <span class="nb">object</span><span class="p">;</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">46</span><span class="p">,</span> <span class="mi">47</span><span class="p">),</span> <span class="n">match</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">output</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;sh clock</span><span class="se">\r\n</span><span class="s1">*19:37:21.577 UTC Fri Nov 3 2017</span><span class="se">\r\n</span><span class="s1">R1&gt;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="s1">&#39;sh clock</span><span class="se">\r\n</span><span class="s1">*19:37:21.577 UTC Fri Nov 3 2017</span><span class="se">\r\n</span><span class="s1">R1&gt;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="close">
<h5>Метод close<a class="headerlink" href="#close" title="Ссылка на этот заголовок">¶</a></h5>
<p>Закрывается соединение методом close, но лучше открывать и закрывать сессию с помощью
менеджера контекста:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">telnet</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Использование объекта Telnet как менеджера контекса добавлено в
версии 3.6</p>
</div>
</div>
<div class="section" id="id1">
<h5>Пример использования telnetlib<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Файл 2_telnetlib.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">telnetlib</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>


<span class="k">def</span> <span class="nf">to_bytes</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">commands</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="k">as</span> <span class="n">telnet</span><span class="p">:</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Username&quot;</span><span class="p">)</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Password&quot;</span><span class="p">)</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">password</span><span class="p">))</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="sa">b</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;#&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;enable</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Password&quot;</span><span class="p">)</span>
            <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">enable</span><span class="p">))</span>
            <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;terminal length 0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">read_very_eager</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
            <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">command</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.2&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.3&quot;</span><span class="p">]</span>
    <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sh ip int br&quot;</span><span class="p">,</span> <span class="s2">&quot;sh arp&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">send_show_command</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="n">commands</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
</pre></div>
</div>
<p>Так как методу write надо передавать байты и добавлять каждый раз перевод строки,
создана небольшая функция to_bytes, которая выполняет преобразование в байты и
добавление перевода строки.</p>
<p>Выполнение скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;sh int desc&#39;</span><span class="p">:</span> <span class="s1">&#39;sh int desc</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Interface             Status         Protocol Description</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/0                 up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/1                 up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/2                 up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/3                 up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;R1#&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sh ip int br&#39;</span><span class="p">:</span> <span class="s1">&#39;sh ip int br</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Interface         IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/0       192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/1       192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/2       unassigned      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/3       192.168.130.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;R1#&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;sh int desc&#39;</span><span class="p">:</span> <span class="s1">&#39;sh int desc</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Interface             Status         Protocol Description</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/0                 up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/1                 up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/2                 admin down     down     </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/3                 admin down     down     </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;R2#&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sh ip int br&#39;</span><span class="p">:</span> <span class="s1">&#39;sh ip int br</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Interface         IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/0       192.168.100.2   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/1       unassigned      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/2       unassigned      YES NVRAM  administratively down down    </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/3       unassigned      YES NVRAM  administratively down down    </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;R2#&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;sh int desc&#39;</span><span class="p">:</span> <span class="s1">&#39;sh int desc</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Interface             Status         Protocol Description</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/0                 up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/1                 up             up       </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/2                 admin down     down     </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;Et0/3                 admin down     down     </span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;R3#&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sh ip int br&#39;</span><span class="p">:</span> <span class="s1">&#39;sh ip int br</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Interface         IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/0       192.168.100.3   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/1       unassigned      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/2       unassigned      YES NVRAM  administratively down down    </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/3       unassigned      YES NVRAM  administratively down down    </span><span class="se">\n</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Постраничный вывод команд<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Пример использования telnetlib для работы с постраничным выводом команд
show (файл 2_telnetlib_more.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">telnetlib</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">re</span>


<span class="k">def</span> <span class="nf">to_bytes</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="k">as</span> <span class="n">telnet</span><span class="p">:</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Username&quot;</span><span class="p">)</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Password&quot;</span><span class="p">)</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">password</span><span class="p">))</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="sa">b</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;#&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;enable</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Password&quot;</span><span class="p">)</span>
            <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">enable</span><span class="p">))</span>
            <span class="n">telnet</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">telnet</span><span class="o">.</span><span class="n">read_very_eager</span><span class="p">()</span>

        <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">index</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="sa">b</span><span class="s2">&quot;--More--&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;#&quot;</span><span class="p">],</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; +--More--| +</span><span class="se">\x08</span><span class="s2">+ +</span><span class="se">\x08</span><span class="s2">+&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">output</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">telnet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.2&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.3&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">send_show_command</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;sh run&quot;</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/18_ssh_telnet/paramiko"></span><div class="section" id="paramiko">
<h4>Модуль paramiko<a class="headerlink" href="#paramiko" title="Ссылка на этот заголовок">¶</a></h4>
<p>Paramiko - это реализация протокола SSHv2 на Python. Paramiko
предоставляет функциональность клиента и сервера. В книге рассматривается
только функциональность клиента.</p>
<p>Так как Paramiko не входит в стандартную библиотеку модулей Python, его
нужно установить:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">paramiko</span>
</pre></div>
</div>
<p>Подключение выполняется таким образом: сначала создается клиент и выполняются настройки клиента,
затем выполняется подключение и получение интерактивной сессии:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">client</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">client</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">look_for_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_agent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">ssh</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">invoke_shell</span><span class="p">()</span>
</pre></div>
</div>
<p>SSHClient это класс, который представляет соединение к SSH-серверу. Он выполняет аутентификацию клиента.
Следующая настройка <code class="docutils literal notranslate"><span class="pre">set_missing_host_key_policy</span></code> не является обязательной, она указывает
какую политику использовать, когда выполнятся подключение к серверу, ключ которого неизвестен.
Политика <code class="docutils literal notranslate"><span class="pre">paramiko.AutoAddPolicy()</span></code> автоматически добавляет новое имя хоста и ключ в локальный
объект HostKeys.</p>
<p>Метод <code class="docutils literal notranslate"><span class="pre">connect</span></code> выполняет подключение к SSH-серверу и аутентифицирует подключение. Параметры:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">look_for_keys</span></code> - по умолчанию paramiko выполняет аутентификацию по
ключам. Чтобы отключить это, надо поставить флаг в False</li>
<li><code class="docutils literal notranslate"><span class="pre">allow_agent</span></code> - paramiko может подключаться к локальному SSH агенту
ОС. Это нужно при работе с ключами, а так как в данном случае
аутентификация выполняется по логину/паролю, это нужно отключить.</li>
</ul>
<p>После выполнения предыдущей команды уже есть подключение к серверу. Метод <code class="docutils literal notranslate"><span class="pre">invoke_shell</span></code> позволяет
установить интерактивную сессию SSH с сервером.</p>
<div class="section" id="send">
<h5>Метод send<a class="headerlink" href="#send" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">send</span></code> - отправляет указанную строку в сессию и возвращает количество отправленных байт
или ноль если сессия закрыта и не удалось отправить команду:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;enable</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">7</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;cisco</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="mi">6</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;sh ip int br</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="mi">13</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">В коде после send надо будет ставить time.sleep, особенно между send и recv.
Так как это интерактивная сессия и команды набираются медленно, все работает и без пауз.</p>
</div>
</div>
<div class="section" id="recv">
<h5>Метод recv<a class="headerlink" href="#recv" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">recv</span></code> получает данные из сессии. В скобках  указывается максимальное значение в байтах,
которое нужно получить. Этот метод возвращает считанную строку.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">R1&gt;enable</span><span class="se">\r\n</span><span class="s1">Password: </span><span class="se">\r\n</span><span class="s1">R1#sh ip int br</span><span class="se">\r\n</span><span class="s1">Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\r\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/2                unassigned      YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3                192.168.130.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Loopback22                 10.2.2.2        YES manual up                    up      </span><span class="se">\r\n</span><span class="s1">Loopback33                 unassigned      YES unset  up                    up      </span><span class="se">\r\n</span><span class="s1">Loopback45                 unassigned      YES unset  up                    up      </span><span class="se">\r\n</span><span class="s1">Loopback55                 5.5.5.5         YES manual up                    up      </span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="close">
<h5>Метод close<a class="headerlink" href="#close" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод close закрывает сессию:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h5>Пример использования paramiko<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Пример использования paramiko (файл 3_paramiko.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">paramiko</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>


<span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span>
    <span class="n">ip</span><span class="p">,</span>
    <span class="n">username</span><span class="p">,</span>
    <span class="n">password</span><span class="p">,</span>
    <span class="n">enable</span><span class="p">,</span>
    <span class="n">command</span><span class="p">,</span>
    <span class="n">max_bytes</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span>
    <span class="n">short_pause</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">long_pause</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">hostname</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
        <span class="n">look_for_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">allow_agent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">cl</span><span class="o">.</span><span class="n">invoke_shell</span><span class="p">()</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;enable</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">enable</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">short_pause</span><span class="p">)</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;terminal length 0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">short_pause</span><span class="p">)</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">max_bytes</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

            <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">max_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                    <span class="n">output</span> <span class="o">+=</span> <span class="n">part</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">result</span><span class="p">[</span><span class="n">command</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>

        <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.2&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.3&quot;</span><span class="p">]</span>
    <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sh clock&quot;</span><span class="p">,</span> <span class="s2">&quot;sh arp&quot;</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">send_show_command</span><span class="p">(</span><span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="n">commands</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
</pre></div>
</div>
<p>Результат выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;sh arp&#39;</span><span class="p">:</span> <span class="s1">&#39;sh arp</span><span class="se">\r\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;Protocol  Address          Age (min)  Hardware Addr   Type   Interface</span><span class="se">\r\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;Internet  192.168.100.1           -   aabb.cc00.6500  ARPA   Ethernet0/0</span><span class="se">\r\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;Internet  192.168.100.2         124   aabb.cc00.6600  ARPA   Ethernet0/0</span><span class="se">\r\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;Internet  192.168.100.3         183   aabb.cc00.6700  ARPA   Ethernet0/0</span><span class="se">\r\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;Internet  192.168.100.100       208   aabb.cc80.c900  ARPA   Ethernet0/0</span><span class="se">\r\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;Internet  192.168.101.1           -   aabb.cc00.6500  ARPA   Ethernet0/0</span><span class="se">\r\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;Internet  192.168.102.1           -   aabb.cc00.6500  ARPA   Ethernet0/0</span><span class="se">\r\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;Internet  192.168.130.1           -   aabb.cc00.6530  ARPA   Ethernet0/3</span><span class="se">\r\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;Internet  192.168.200.1           -   0203.e800.6510  ARPA   Ethernet0/1</span><span class="se">\r\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;Internet  192.168.200.100        18   6ee2.6d8c.e75d  ARPA   Ethernet0/1</span><span class="se">\r\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;R1#&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sh clock&#39;</span><span class="p">:</span> <span class="s1">&#39;sh clock</span><span class="se">\r\n</span><span class="s1">*08:25:22.435 UTC Mon Jul 20 2020</span><span class="se">\r\n</span><span class="s1">R1#&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Постраничный вывод команд<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Пример использования paramiko для работы с постраничным выводом команд
show (файл 3_paramiko_more.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">paramiko</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">re</span>


<span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span>
    <span class="n">ip</span><span class="p">,</span>
    <span class="n">username</span><span class="p">,</span>
    <span class="n">password</span><span class="p">,</span>
    <span class="n">enable</span><span class="p">,</span>
    <span class="n">command</span><span class="p">,</span>
    <span class="n">max_bytes</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span>
    <span class="n">short_pause</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">long_pause</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">hostname</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
        <span class="n">look_for_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">allow_agent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">cl</span><span class="o">.</span><span class="n">invoke_shell</span><span class="p">()</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;enable</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">enable</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">short_pause</span><span class="p">)</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">max_bytes</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

            <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">page</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">max_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                    <span class="n">output</span> <span class="o">+=</span> <span class="n">page</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="s2">&quot;More&quot;</span> <span class="ow">in</span> <span class="n">page</span><span class="p">:</span>
                    <span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; +--More--| +</span><span class="se">\x08</span><span class="s2">+ +</span><span class="se">\x08</span><span class="s2">+&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">command</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>

        <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.2&quot;</span><span class="p">,</span> <span class="s2">&quot;192.168.100.3&quot;</span><span class="p">]</span>
    <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sh run&quot;</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">send_show_command</span><span class="p">(</span><span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span> <span class="n">commands</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/18_ssh_telnet/netmiko"></span><div class="section" id="netmiko">
<h4>Модуль netmiko<a class="headerlink" href="#netmiko" title="Ссылка на этот заголовок">¶</a></h4>
<p>Netmiko - это модуль, который позволяет упростить использование paramiko
для сетевых устройств. Netmiko использует paramiko, но при этом создает
интерфейс и методы, которые нужны для работы с сетевым оборудованием.</p>
<p>Сначала netmiko нужно установить:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">netmiko</span>
</pre></div>
</div>
<div class="section" id="id1">
<h5>Поддерживаемые типы устройств<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Netmiko поддерживает несколько типов устройств:</p>
<ul class="simple">
<li>Arista vEOS</li>
<li>Cisco ASA</li>
<li>Cisco IOS</li>
<li>Cisco IOS-XR</li>
<li>Cisco SG300</li>
<li>HP Comware7</li>
<li>HP ProCurve</li>
<li>Juniper Junos</li>
<li>Linux</li>
<li>и другие</li>
</ul>
<p>Актуальный список можно посмотреть в
<a class="reference external" href="https://github.com/ktbyers/netmiko">репозитории</a> модуля.</p>
</div>
<div class="section" id="id2">
<h5>Словарь, определяющий параметры устройств<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>В словаре могут указываться такие параметры:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cisco_router</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;device_type&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco_ios&#39;</span><span class="p">,</span>
    <span class="s1">&#39;host&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.1.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;userpass&#39;</span><span class="p">,</span>
    <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="s1">&#39;enablepass&#39;</span><span class="p">,</span>
    <span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="mi">20022</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ssh">
<h5>Подключение по SSH<a class="headerlink" href="#ssh" title="Ссылка на этот заголовок">¶</a></h5>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">=</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">cisco_router</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="enable">
<h5>Режим enable<a class="headerlink" href="#enable" title="Ссылка на этот заголовок">¶</a></h5>
<p>Перейти в режим enable:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
</pre></div>
</div>
<p>Выйти из режима enable:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">.</span><span class="n">exit_enable_mode</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Отправка команд<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>В netmiko есть несколько способов отправки команд:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">send_command</span></code> - отправить одну команду</li>
<li><code class="docutils literal notranslate"><span class="pre">send_config_set</span></code> - отправить список команд или команду в конфигурационном режиме</li>
<li><code class="docutils literal notranslate"><span class="pre">send_config_from_file</span></code> - отправить команды из файла (использует внутри метод <code class="docutils literal notranslate"><span class="pre">send_config_set</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">send_command_timing</span></code> - отправить команду и подождать вывод на основании таймера</li>
</ul>
<div class="section" id="send-command">
<h6><code class="docutils literal notranslate"><span class="pre">send_command</span></code><a class="headerlink" href="#send-command" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод send_command позволяет отправить одну команду на устройство.</p>
<p>Например:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s1">&#39;show ip int br&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Метод работает таким образом:</p>
<ul class="simple">
<li>отправляет команду на устройство и получает вывод до строки
с приглашением или до указанной строки<ul>
<li>приглашение определяется автоматически</li>
<li>если на вашем устройстве оно не определилось, можно просто указать строку, до которой считывать вывод</li>
<li>ранее так работал метод <code class="docutils literal notranslate"><span class="pre">send_command_expect</span></code>, но с версии 1.0.0
так работает <code class="docutils literal notranslate"><span class="pre">send_command</span></code>, а метод <code class="docutils literal notranslate"><span class="pre">send_command_expect</span></code> оставлен для совместимости</li>
</ul>
</li>
<li>метод возвращает вывод команды</li>
<li>методу можно передавать такие параметры:<ul>
<li><code class="docutils literal notranslate"><span class="pre">command_string</span></code> - команда</li>
<li><code class="docutils literal notranslate"><span class="pre">expect_string</span></code> - до какой строки считывать вывод</li>
<li><code class="docutils literal notranslate"><span class="pre">delay_factor</span></code> - параметр позволяет увеличить задержку до начала поиска строки</li>
<li><code class="docutils literal notranslate"><span class="pre">max_loops</span></code> - количество итераций, до того как метод выдаст ошибку
(исключение). По умолчанию 500</li>
<li><code class="docutils literal notranslate"><span class="pre">strip_prompt</span></code> - удалить приглашение из вывода. По умолчанию удаляется</li>
<li><code class="docutils literal notranslate"><span class="pre">strip_command</span></code> - удалить саму команду из вывода</li>
</ul>
</li>
</ul>
<p>В большинстве случаев достаточно будет указать только команду.</p>
<div class="section" id="send-config-set">
<h7><code class="docutils literal notranslate"><span class="pre">send_config_set</span></code><a class="headerlink" href="#send-config-set" title="Ссылка на этот заголовок">¶</a></h7>
<p>Метод <code class="docutils literal notranslate"><span class="pre">send_config_set</span></code> позволяет отправить команду или несколько
команд конфигурационного режима.</p>
<p>Пример использования:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;router ospf 1&#39;</span><span class="p">,</span>
            <span class="s1">&#39;network 10.0.0.0 0.255.255.255 area 0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;network 192.168.100.0 0.0.0.255 area 1&#39;</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_config_set</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span>
</pre></div>
</div>
<p>Метод работает таким образом:</p>
<ul class="simple">
<li>заходит в конфигурационный режим,</li>
<li>затем передает все команды</li>
<li>и выходит из конфигурационного режима</li>
<li>в зависимости от типа устройства, выхода из конфигурационного режима может
и не быть. Например, для IOS-XR выхода не будет, так как сначала надо
закоммитить изменения</li>
</ul>
</div>
</div>
<div class="section" id="send-config-from-file">
<h6><code class="docutils literal notranslate"><span class="pre">send_config_from_file</span></code><a class="headerlink" href="#send-config-from-file" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод <code class="docutils literal notranslate"><span class="pre">send_config_from_file</span></code> отправляет команды из указанного файла в
конфигурационный режим.</p>
<p>Пример использования:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_config_from_file</span><span class="p">(</span><span class="s1">&#39;config_ospf.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Метод открывает файл, считывает команды и передает их методу
<code class="docutils literal notranslate"><span class="pre">send_config_set</span></code>.</p>
</div>
</div>
<div class="section" id="id4">
<h5>Дополнительные методы<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Кроме перечисленных методов для отправки команд, netmiko поддерживает
такие методы:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">config_mode</span></code> - перейти в режим конфигурации: <code class="docutils literal notranslate"><span class="pre">ssh.config_mode()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">exit_config_mode</span></code> - выйти из режима конфигурации: <code class="docutils literal notranslate"><span class="pre">ssh.exit_config_mode()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">check_config_mode</span></code> - проверить, находится ли netmiko в режиме конфигурации (возвращает True,
если в режиме конфигурации, и False - если нет): <code class="docutils literal notranslate"><span class="pre">ssh.check_config_mode()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">find_prompt</span></code> - возвращает текущее приглашение устройства: <code class="docutils literal notranslate"><span class="pre">ssh.find_prompt()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">commit</span></code> - выполнить commit на IOS-XR и Juniper: <code class="docutils literal notranslate"><span class="pre">ssh.commit()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">disconnect</span></code> - завершить соединение SSH</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Выше ssh - это созданное предварительно соединение SSH:
<code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">=</span> <span class="pre">ConnectHandler(**cisco_router)</span></code></p>
</div>
</div>
<div class="section" id="telnet">
<h5>Поддержка Telnet<a class="headerlink" href="#telnet" title="Ссылка на этот заголовок">¶</a></h5>
<p>С версии 1.0.0 netmiko поддерживает подключения по Telnet, пока что
только для Cisco IOS устройств.</p>
<p>Внутри netmiko использует telnetlib для подключения по Telnet. Но, при
этом, предоставляет тот же интерфейс для работы, что и подключение по
SSH.</p>
<p>Для того, чтобы подключиться по Telnet, достаточно в словаре, который
определяет параметры подключения, указать тип устройства
„cisco_ios_telnet“:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;device_type&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco_ios_telnet&quot;</span><span class="p">,</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;secret&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>В остальном, методы, которые применимы к SSH, применимы и к Telnet.
Пример, аналогичный примеру с SSH (файл 4_netmiko_telnet.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">netmiko</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ConnectHandler</span><span class="p">,</span>
    <span class="n">NetmikoTimeoutException</span><span class="p">,</span>
    <span class="n">NetmikoAuthenticationException</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">commands</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">command</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">NetmikoTimeoutException</span><span class="p">,</span> <span class="n">NetmikoAuthenticationException</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">device</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;device_type&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco_ios_telnet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;secret&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">send_show_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sh clock&quot;</span><span class="p">,</span> <span class="s2">&quot;sh ip int br&quot;</span><span class="p">])</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
</pre></div>
</div>
<p>Аналогично работают и методы:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">send_command_timing()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">find_prompt()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">send_config_set()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">send_config_from_file()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">check_enable_mode()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">disconnect()</span></code></li>
</ul>
</div>
<div class="section" id="id5">
<h5>Пример использования netmiko<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Пример использования netmiko (файл 4_netmiko.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">netmiko</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ConnectHandler</span><span class="p">,</span>
    <span class="n">NetmikoTimeoutException</span><span class="p">,</span>
    <span class="n">NetmikoAuthenticationException</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">commands</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">command</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">NetmikoTimeoutException</span><span class="p">,</span> <span class="n">NetmikoAuthenticationException</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;devices.yaml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">send_show_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sh clock&quot;</span><span class="p">,</span> <span class="s2">&quot;sh ip int br&quot;</span><span class="p">])</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
</pre></div>
</div>
<p>В этом примере не передается команда terminal length, так как netmiko по
умолчанию выполняет эту команду.</p>
<p>Результат выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;sh clock&#39;</span><span class="p">:</span> <span class="s1">&#39;*09:12:15.210 UTC Mon Jul 20 2020&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sh ip int br&#39;</span><span class="p">:</span> <span class="s1">&#39;Interface     IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/0   192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/1   192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/2   unassigned      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/3   192.168.130.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;sh clock&#39;</span><span class="p">:</span> <span class="s1">&#39;*09:12:24.507 UTC Mon Jul 20 2020&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sh ip int br&#39;</span><span class="p">:</span> <span class="s1">&#39;Interface     IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/0   192.168.100.2   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/1   unassigned      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/2   unassigned      YES NVRAM  administratively down down    </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/3   unassigned      YES NVRAM  administratively down down    </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;sh clock&#39;</span><span class="p">:</span> <span class="s1">&#39;*09:12:33.573 UTC Mon Jul 20 2020&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sh ip int br&#39;</span><span class="p">:</span> <span class="s1">&#39;Interface     IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/0   192.168.100.3   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/1   unassigned      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/2   unassigned      YES NVRAM  administratively down down    </span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="s1">&#39;Ethernet0/3   unassigned      YES NVRAM  administratively down down    </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>Постраничный вывод команд<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Пример использования paramiko для работы с постраничным выводом команд
show (файл 4_netmiko_more.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">netmiko</span> <span class="kn">import</span> <span class="n">ConnectHandler</span><span class="p">,</span> <span class="n">NetmikoTimeoutException</span>
<span class="kn">import</span> <span class="nn">yaml</span>


<span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="n">device_params</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">find_prompt</span><span class="p">()</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;terminal length 100&quot;</span><span class="p">)</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">write_channel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">read_until_pattern</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;More|</span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="n">page</span>
                <span class="k">if</span> <span class="s2">&quot;More&quot;</span> <span class="ow">in</span> <span class="n">page</span><span class="p">:</span>
                    <span class="n">ssh</span><span class="o">.</span><span class="n">write_channel</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">except</span> <span class="n">NetmikoTimeoutException</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">output</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;devices.yaml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">send_show_command</span><span class="p">(</span><span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;sh run&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/18_ssh_telnet/scrapli"></span><div class="section" id="scrapli">
<h4>Модуль scrapli<a class="headerlink" href="#scrapli" title="Ссылка на этот заголовок">¶</a></h4>
<p><a class="reference external" href="https://github.com/carlmontanari/scrapli">scrapli</a> это модуль, который
позволяет подключаться к сетевому оборудованию используя Telnet, SSH или NETCONF.</p>
<p>Также как и netmiko, scrapli может использовать paramiko или telnetlib
(и другие модули) для самого подключения, но при этом предоставляет одинаковый
интерфейс работы для разных типов подключения и разного оборудования.</p>
<p>Установка scrapli:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">scrapli</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Рассматривается scrapli версии 2021.1.30.</p>
</div>
<p>Три основные составляющие части scrapli:</p>
<ul class="simple">
<li>transport - это конкретный способ подключения к оборудованию</li>
<li>channel - следующий уровень над транспортом, который отвечает за отправку команд,
получение вывода и другими взаимодействиями с оборудованием</li>
<li>driver - это интерфейс, который предоставляется пользователю для работы со scrapli.
Тут есть как специфические драйверы типа <code class="docutils literal notranslate"><span class="pre">IOSXEDriver</span></code>, который понимает
как взаимодействовать с оборудованием конкретного типа, так и базовый
драйвер Driver, который предоставляет минимальный интерфейс для работы через SSH/Telnet.</li>
</ul>
<p>Доступные варианты транспорта:</p>
<ul class="simple">
<li>system - используется встроенный SSH клиент, подразумевается использование клиента на Linux/MacOS</li>
<li>paramiko - модуль paramiko</li>
<li>ssh2 - используется модуль ssh2-python (обертка вокруг C библиотеки libssh2)</li>
<li>telnet - будет использоваться telnetlib</li>
<li>asyncssh - модуль asyncssh</li>
<li>asynctelnet - telnet клиент написанный с использованием asyncio</li>
</ul>
<p>Основные примеры будут с использованием транспорта system. Так как интерфейс
модуля одинаковый для всех синхронных вариантов транспорта, для использовании
другого вида транспорта, надо только указать его (для транспорта telnet
также обязательно указать порт).</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Асинхронные варианты транспорта (asyncssh, asynctelnet) рассматриваются в книге
<a class="reference external" href="https://advpyneng.readthedocs.io/ru/latest/book/17_async_libraries/scrapli.html">Advanced Python для сетевых инженеров</a></p>
</div>
<p>Поддерживаемые платформы:</p>
<ul class="simple">
<li>Cisco IOS-XE</li>
<li>Cisco NX-OS</li>
<li>Juniper JunOS</li>
<li>Cisco IOS-XR</li>
<li>Arista EOS</li>
</ul>
<p>Кроме этих платформ, есть также платформы
<a class="reference external" href="https://github.com/scrapli/scrapli_community">scrapli community</a>.
И одно из преимуществ scrapli то, что добавлять платформы относительно легко.</p>
<p>В scrapli глобально есть два варианта подключения: используя общий класс Scrapli,
который выбирает нужный driver по параметру platform или конкретный driver,
например, IOSXEDriver. При этом параметры передаются те же самые и конкретному
драйверу и Scrapli.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Кроме этих вариантов, есть также общие (базовые) драйверы.</p>
</div>
<p>Если в scrapli (или scrapli community) нет поддержки необходимой платформы, можно
<a class="reference external" href="https://github.com/scrapli/scrapli_community#adding-a-platform">добавить платформу в scrapli community</a>
или использовать (не рассматривается в книге):</p>
<ul class="simple">
<li><a class="reference external" href="https://carlmontanari.github.io/scrapli/user_guide/advanced_usage/#using-driver-directly">Driver</a></li>
<li><a class="reference external" href="https://carlmontanari.github.io/scrapli/user_guide/advanced_usage/#using-the-genericdriver">GenericDriver</a></li>
<li><a class="reference external" href="https://carlmontanari.github.io/scrapli/user_guide/advanced_usage/">NetworkDriver</a></li>
</ul>
<div class="section" id="id1">
<h5>Параметры подключения<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Основные параметры подключения:</p>
<ul class="simple">
<li>host - IP-адрес или имя хоста</li>
<li>auth_username - имя пользователя</li>
<li>auth_password - пароль</li>
<li>auth_secondary - пароль на enable</li>
<li>auth_strict_key - контролирует проверку SSH ключей сервера, а именно разрешать
ли подключаться к серверам ключ которых не сохранен в ssh/known_hosts.
False - разрешить подключение (по умолчанию значение True)</li>
<li>platform - нужно указывать при использовании Scrapli</li>
<li>transport - какой транспорт использовать</li>
<li>transport_options - опции для конкретного транспорта</li>
</ul>
<p>Процесс подключения немного отличается в зависимости от того используется
менеджер контекста или нет. При подключении без менеджера контекста, сначала надо
передать параметры драйверу или Scrapli, а затем вызвать метод open:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scrapli</span> <span class="kn">import</span> <span class="n">Scrapli</span>

<span class="n">r1</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;auth_username&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
   <span class="s2">&quot;auth_password&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
   <span class="s2">&quot;auth_secondary&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
   <span class="s2">&quot;auth_strict_key&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
   <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco_iosxe&quot;</span>
<span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">ssh</span> <span class="o">=</span> <span class="n">Scrapli</span><span class="p">(</span><span class="o">**</span><span class="n">r1</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
</pre></div>
</div>
<p>После этого можно отправлять команды:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">get_prompt</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;R1#&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>При использовании менеджера контекста, open вызывать не надо:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="k">with</span> <span class="n">Scrapli</span><span class="p">(</span><span class="o">**</span><span class="n">r1_driver</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">ssh</span><span class="o">.</span><span class="n">get_prompt</span><span class="p">())</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">R1</span><span class="c1">#</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Использование драйвера<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Доступные драйверы</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="30%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Оборудование</th>
<th class="head">Драйвер</th>
<th class="head">Параметр platform</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Cisco IOS-XE</td>
<td>IOSXEDriver</td>
<td>cisco_iosxe</td>
</tr>
<tr class="row-odd"><td>Cisco NX-OS</td>
<td>NXOSDriver</td>
<td>cisco_nxos</td>
</tr>
<tr class="row-even"><td>Cisco IOS-XR</td>
<td>IOSXRDriver</td>
<td>cisco_iosxr</td>
</tr>
<tr class="row-odd"><td>Arista EOS</td>
<td>EOSDriver</td>
<td>arista_eos</td>
</tr>
<tr class="row-even"><td>Juniper JunOS</td>
<td>JunosDriver</td>
<td>juniper_junos</td>
</tr>
</tbody>
</table>
<p>Пример подключения с использованием драйвера IOSXEDriver (технически
подключение выполняется к Cisco IOS):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">scrapli.driver.core</span> <span class="kn">import</span> <span class="n">IOSXEDriver</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">r1_driver</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>    <span class="s2">&quot;auth_username&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>    <span class="s2">&quot;auth_password&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>    <span class="s2">&quot;auth_secondary&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>    <span class="s2">&quot;auth_strict_key&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span> <span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="k">with</span> <span class="n">IOSXEDriver</span><span class="p">(</span><span class="o">**</span><span class="n">r1_driver</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">ssh</span><span class="o">.</span><span class="n">get_prompt</span><span class="p">())</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">R1</span><span class="c1">#</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Отправка команд<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>В scrapli есть несколько методов для отправки команд:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">send_command</span></code> - отправить одну show команду</li>
<li><code class="docutils literal notranslate"><span class="pre">send_commands</span></code> - отправить список show команд</li>
<li><code class="docutils literal notranslate"><span class="pre">send_commands_from_file</span></code> - отправить show команды из файла</li>
<li><code class="docutils literal notranslate"><span class="pre">send_config</span></code> - отправить одну команду в конфигурационном режиме</li>
<li><code class="docutils literal notranslate"><span class="pre">send_configs</span></code> - отправить список команд в конфигурационном режиме</li>
<li><code class="docutils literal notranslate"><span class="pre">send_configs_from_file</span></code> - отправить команды из файла в конфигурационном режиме</li>
<li><code class="docutils literal notranslate"><span class="pre">send_interactive</span></code></li>
</ul>
<p>Все эти методы возвращают объект Response, а не вывод команды в виде строки.</p>
</div>
<div class="section" id="response">
<h5>Объект Response<a class="headerlink" href="#response" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод send_command и другие методы для отправки команд на оборудование
возвращают объект Response (не вывод команды).
Response позволяет получить не только вывод команды, но и такие вещи как
время работы команды, выполнилась команда с ошибками или без, структурированный
вывод с помощью textfsm и так далее.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">reply</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;sh clock&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">reply</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">Response</span> <span class="o">&lt;</span><span class="n">Success</span><span class="p">:</span> <span class="kc">True</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Получить вывод команды можно обратившись к атрибуту result:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">reply</span><span class="o">.</span><span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;*17:31:54.232 UTC Wed Mar 31 2021&#39;</span>
</pre></div>
</div>
<p>Атрибут raw_result содержит байтовую строку с полным выводом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">reply</span><span class="o">.</span><span class="n">raw_result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">*17:31:54.232 UTC Wed Mar 31 2021</span><span class="se">\n</span><span class="s1">R1#&#39;</span>
</pre></div>
</div>
<p>Для команд, которые выполняются дольше обычных show, может быть необходимо
знать время выполнения команды:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">r</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;ping 10.1.1.1&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="s1">&#39;Type escape sequence to abort.</span><span class="se">\n</span><span class="s1">Sending 5, 100-byte ICMP Echos to 10.1.1.1, timeout is 2 seconds:</span><span class="se">\n</span><span class="s1">.....</span><span class="se">\n</span><span class="s1">Success rate is 0 percent (0/5)&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">elapsed_time</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="mf">10.047594</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">start_time</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">63697</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">finish_time</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">111291</span><span class="p">)</span>
</pre></div>
</div>
<p>Атрибут channel_input возвращает команду, которая была отправлена на оборудование:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">channel_input</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="s1">&#39;ping 10.1.1.1&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="send-command">
<h5>Метод send_command<a class="headerlink" href="#send-command" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">send_command</span></code> позволяет отправить одну команду на устройство.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">reply</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;sh clock&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Параметры метода (все эти параметры надо передавать как ключевые):</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">strip_prompt</span></code> - удалить приглашение из вывода. По умолчанию удаляется</li>
<li><code class="docutils literal notranslate"><span class="pre">failed_when_contains</span></code> - если вывод содержит указанную строку или одну из
строк в списке, будет считаться, что команда выполнилась с ошибкой</li>
<li><code class="docutils literal notranslate"><span class="pre">timeout_ops</span></code> - максимальное время на выполнение команды, по умолчанию
равно 30 секунд для IOSXEDriver</li>
</ul>
<p>Пример вызова метода <code class="docutils literal notranslate"><span class="pre">send_command</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">reply</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;sh clock&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">reply</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">Response</span> <span class="o">&lt;</span><span class="n">Success</span><span class="p">:</span> <span class="kc">True</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Параметр timeout_ops указывает сколько ждать выполнения команды:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;ping 8.8.8.8&quot;</span><span class="p">,</span> <span class="n">timeout_ops</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">Response</span> <span class="o">&lt;</span><span class="n">Success</span><span class="p">:</span> <span class="kc">True</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Если команда не выполнилась за указанное время, сгенерируется исключение
ScrapliTimeout (вывод сокращен):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;ping 8.8.8.8&quot;</span><span class="p">,</span> <span class="n">timeout_ops</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="n">ScrapliTimeout</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">e062fb19f0e6</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;ping 8.8.8.8&quot;</span><span class="p">,</span> <span class="n">timeout_ops</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Кроме получения обычного вывода команды, scrapli также позволяет получить
структурированный вывод, например, с помощью метода textfsm_parse_output:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">reply</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;sh ip int br&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">reply</span><span class="o">.</span><span class="n">textfsm_parse_output</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span>
<span class="p">[{</span><span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;Ethernet0/0&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ipaddr&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;proto&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;Ethernet0/1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ipaddr&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.200.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;proto&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;Ethernet0/2&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ipaddr&#39;</span><span class="p">:</span> <span class="s1">&#39;unassigned&#39;</span><span class="p">,</span>
  <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;proto&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;Ethernet0/3&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ipaddr&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.130.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;proto&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">}]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Что такое TextFSM и как с ним работать рассматривается в 21 разделе.
Scrapli использует готовые шаблоны для того чтобы получать структурированный
вывод и в базовых случаях не требует знания TextFSM.</p>
</div>
</div>
<div class="section" id="id4">
<h5>Обнаружение ошибок<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Методы для отправки команд автоматически проверяют вывод на наличие ошибок.
Для каждого вендора/типа оборудования это свои ошибки, плюс можно самостоятельно
указать наличие каких строк в выводе будет считаться ошибкой.
По умолчанию для IOSXEDriver ошибками будут считаться такие строки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">failed_when_contains</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;% Ambiguous command&#39;</span><span class="p">,</span>
 <span class="s1">&#39;% Incomplete command&#39;</span><span class="p">,</span>
 <span class="s1">&#39;% Invalid input detected&#39;</span><span class="p">,</span>
 <span class="s1">&#39;% Unknown command&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Атрибут failed у объекта Response возвращает True, если команда отработала с
ошибкой и False, если без ошибки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">reply</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;sh clck&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">reply</span><span class="o">.</span><span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="s2">&quot;        ^</span><span class="se">\n</span><span class="s2">% Invalid input detected at &#39;^&#39; marker.&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">reply</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">Response</span> <span class="o">&lt;</span><span class="n">Success</span><span class="p">:</span> <span class="kc">False</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">reply</span><span class="o">.</span><span class="n">failed</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="send-config">
<h5>Метод send_config<a class="headerlink" href="#send-config" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод <code class="docutils literal notranslate"><span class="pre">send_config</span></code> позволяет отправить одну команду конфигурационного режима.</p>
<p>Пример использования:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">r</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_config</span><span class="p">(</span><span class="s2">&quot;username user1 password password1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Так как scrapli удаляет команду из вывода, по умолчанию, при использовании
send_config, в атрибуте result будет пустая строка (если не было ошибки при
выполнении команды):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>Можно добавлять параметр <code class="docutils literal notranslate"><span class="pre">strip_prompt=False</span></code> и тогда в выводе появится
приглашение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">r</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_config</span><span class="p">(</span><span class="s2">&quot;username user1 password password1&quot;</span><span class="p">,</span> <span class="n">strip_prompt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="s1">&#39;R1(config)#&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="send-commands-send-configs">
<h5>Методы send_commands, send_configs<a class="headerlink" href="#send-commands-send-configs" title="Ссылка на этот заголовок">¶</a></h5>
<p>Методы send_commands, send_configs отличаются от send_command, send_config тем,
что могут отправлять несколько команд.
Кроме того, эти методы возвращают не Response, а MultiResponse, который можно
в целом воспринимать как список Response, по одному для каждой команды.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [44]: reply = ssh.send_commands([&quot;sh clock&quot;, &quot;sh ip int br&quot;])

In [45]: reply
Out[45]: MultiResponse &lt;Success: True; Response Elements: 2&gt;

In [46]: for r in reply:
    ...:     print(r)
    ...:     print(r.result)
    ...:
Response &lt;Success: True&gt;
*08:38:20.115 UTC Thu Apr 1 2021
Response &lt;Success: True&gt;
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.1   YES NVRAM  up                    up
Ethernet0/1                192.168.200.1   YES NVRAM  up                    up
Ethernet0/2                unassigned      YES NVRAM  up                    up
Ethernet0/3                192.168.130.1   YES NVRAM  up                    up

In [47]: reply.result
Out[47]: &#39;sh clock\n*08:38:20.115 UTC Thu Apr 1 2021sh ip int br\nInterface                  IP-Address      OK? Method Status                Protocol\nEthernet0/0                192.168.100.1   YES NVRAM  up                    up\nEthernet0/1                192.168.200.1   YES NVRAM  up                    up\nEthernet0/2                unassigned      YES NVRAM  up                    up\nEthernet0/3                192.168.130.1   YES NVRAM  up                    up&#39;

In [48]: reply[0]
Out[48]: Response &lt;Success: True&gt;

In [49]: reply[1]
Out[49]: Response &lt;Success: True&gt;

In [50]: reply[0].result
Out[50]: &#39;*08:38:20.115 UTC Thu Apr 1 2021&#39;
</pre></div>
</div>
<p>При отправке нескольких команд также очень удобно использовать параметр
<code class="docutils literal notranslate"><span class="pre">stop_on_failed</span></code>. По умолчанию он равен False, поэтому выполняются все
команды, но если указать <code class="docutils literal notranslate"><span class="pre">stop_on_failed=True</span></code>, после возникновения
ошибки в какой-то команде, следующие команды не будут выполняться:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [59]: reply = ssh.send_commands([&quot;ping 192.168.100.2&quot;, &quot;sh clck&quot;, &quot;sh ip int br&quot;], stop_on_failed=True)

In [60]: reply
Out[60]: MultiResponse &lt;Success: False; Response Elements: 2&gt;

In [61]: reply.result
Out[61]: &quot;ping 192.168.100.2\nType escape sequence to abort.\nSending 5, 100-byte ICMP Echos to 192.168.100.2, timeout is 2 seconds:\n!!!!!\nSuccess rate is 100 percent (5/5), round-trip min/avg/max = 1/2/6 mssh clck\n        ^\n% Invalid input detected at &#39;^&#39; marker.&quot;

In [62]: for r in reply:
    ...:     print(r)
    ...:     print(r.result)
    ...:
Response &lt;Success: True&gt;
Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 192.168.100.2, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/2/6 ms
Response &lt;Success: False&gt;
        ^
% Invalid input detected at &#39;^&#39; marker.
</pre></div>
</div>
</div>
<div class="section" id="telnet">
<h5>Подключение telnet<a class="headerlink" href="#telnet" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для подключения к оборудовани по Telnet надо указать transport равным
telnet и обязательно указать параметр port равным 23 (или тому порту который
используется у вас для подключения по Telnet):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scrapli.driver.core</span> <span class="kn">import</span> <span class="n">IOSXEDriver</span>
<span class="kn">from</span> <span class="nn">scrapli.exceptions</span> <span class="kn">import</span> <span class="n">ScrapliException</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">r1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_username&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_password&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_secondary&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_strict_key&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;telnet&quot;</span><span class="p">,</span>
    <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span>  <span class="c1"># обязательно указывать при подключении telnet</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">show_command</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">IOSXEDriver</span><span class="p">(</span><span class="o">**</span><span class="n">r1</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">show_command</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">reply</span><span class="o">.</span><span class="n">result</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ScrapliException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">])</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">send_show</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="s2">&quot;sh ip int br&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Примеры использования scrapli<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scrapli.driver.core</span> <span class="kn">import</span> <span class="n">IOSXEDriver</span>
<span class="kn">from</span> <span class="nn">scrapli.exceptions</span> <span class="kn">import</span> <span class="n">ScrapliException</span>


<span class="n">r1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_username&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_password&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_secondary&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_strict_key&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;timeout_socket&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># timeout for establishing socket/initial connection</span>
    <span class="s2">&quot;timeout_transport&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>  <span class="c1"># timeout for ssh|telnet transport</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">show_command</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">IOSXEDriver</span><span class="p">(</span><span class="o">**</span><span class="n">r1</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">show_command</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">reply</span><span class="o">.</span><span class="n">result</span>
    <span class="k">except</span> <span class="n">ScrapliException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">])</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">send_show</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="s2">&quot;sh ip int br&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">scrapli</span> <span class="kn">import</span> <span class="n">Scrapli</span>

<span class="n">r1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_username&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_password&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_secondary&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_strict_key&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco_iosxe&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">show_commands</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">show_commands</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">show_commands</span> <span class="o">=</span> <span class="p">[</span><span class="n">show_commands</span><span class="p">]</span>
    <span class="n">cmd_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">Scrapli</span><span class="p">(</span><span class="o">**</span><span class="n">r1</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">show_commands</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="n">cmd_dict</span><span class="p">[</span><span class="n">cmd</span><span class="p">]</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">result</span>
    <span class="k">return</span> <span class="n">cmd_dict</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">))</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">send_show</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sh ip int br&quot;</span><span class="p">,</span> <span class="s2">&quot;sh ver | i uptime&quot;</span><span class="p">])</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">scrapli</span> <span class="kn">import</span> <span class="n">Scrapli</span>

<span class="n">r1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_username&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_password&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_secondary&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auth_strict_key&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco_iosxe&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">send_cfg</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">cfg_commands</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cfg_commands</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">cfg_commands</span> <span class="o">=</span> <span class="p">[</span><span class="n">cfg_commands</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">Scrapli</span><span class="p">(</span><span class="o">**</span><span class="n">r1</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_configs</span><span class="p">(</span><span class="n">cfg_commands</span><span class="p">,</span> <span class="n">stop_on_failed</span><span class="o">=</span><span class="n">strict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cmd_reply</span> <span class="ow">in</span> <span class="n">reply</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cmd_reply</span><span class="o">.</span><span class="n">failed</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;При выполнении команды возникла ошибка:</span><span class="se">\n</span><span class="si">{</span><span class="n">reply</span><span class="o">.</span><span class="n">result</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">result</span>
    <span class="k">return</span> <span class="n">output</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">output_cfg</span> <span class="o">=</span> <span class="n">send_cfg</span><span class="p">(</span>
        <span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;interfacelo11&quot;</span><span class="p">,</span> <span class="s2">&quot;ip address 11.1.1.1 255.255.255.255&quot;</span><span class="p">],</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">output_cfg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/18_ssh_telnet/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="https://pexpect.readthedocs.io/en/stable/index.html">pexpect</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/telnetlib.html">telnetlib</a></li>
<li><a class="reference external" href="http://docs.paramiko.org/en/2.0/api/client.html">paramiko Client</a></li>
<li><a class="reference external" href="http://docs.paramiko.org/en/2.0/api/channel.html">paramiko Channel</a></li>
<li><a class="reference external" href="https://github.com/ktbyers/netmiko">netmiko</a></li>
<li><a class="reference external" href="https://carlmontanari.github.io/scrapli/user_guide/basic_usage/">scrapli</a></li>
<li><a class="reference external" href="https://scrapli.github.io/scrapli_cfg/user_guide/quickstart/">scrapli-cfg</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/time.html">time</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/datetime.html">datetime</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/getpass.html">getpass</a></li>
</ul>
<p>Статьи:</p>
<ul class="simple">
<li><a class="reference external" href="https://pynet.twb-tech.com/blog/automation/netmiko.html">Netmiko Library</a></li>
<li><a class="reference external" href="https://codingnetworker.com/2016/03/automate-ssh-connections-with-netmiko/">Automate SSH connections with netmiko</a></li>
<li><a class="reference external" href="http://www.networkcomputing.com/networking/network-automation-using-python-bgp-configuration/1423704194">Network Automation Using Python: BGP Configuration</a></li>
<li><a class="reference external" href="https://www.montanari.io/posts/2020/a_tale_of_five_python_ssh_libraries_commentary/">A Tale of Five Python SSH Libraries Commentary</a></li>
</ul>
<p>Примеры кода:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ktbyers/netmiko/tree/develop/examples">netmiko</a></li>
<li><a class="reference external" href="https://github.com/carlmontanari/scrapli/tree/master/examples">scrapli</a></li>
<li><a class="reference external" href="https://github.com/natenka/pyneng-examples/tree/main/ssh_telnet">netmiko, paramiko, telnetlib, scrapli, pexpect</a></li>
</ul>
</div>
<span id="document-exercises/18_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 18.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию send_show_command.</p>
<p>Функция подключается по SSH (с помощью netmiko) к ОДНОМУ устройству и выполняет указанную команду.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>device - словарь с параметрами подключения к устройству</li>
<li>command - команда, которую надо выполнить</li>
</ul>
<p>Функция возвращает строку с выводом команды.</p>
<p>Скрипт должен отправлять команду command на все устройства из файла devices.yaml с помощью функции send_show_command (эта часть кода написана).</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yaml</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;sh ip int br&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;devices.yaml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">send_show_command</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">command</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 18.1a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать функцию send_show_command из задания 18.1 и переделать ее таким образом,
чтобы обрабатывалось исключение, которое генерируется при ошибке аутентификации на устройстве.</p>
<p>При возникновении ошибки, на стандартный поток вывода должно выводиться сообщение исключения.</p>
<p>Для проверки измените пароль на устройстве или в файле devices.yaml.</p>
</div>
<div class="section" id="b">
<h5>Задание 18.1b<a class="headerlink" href="#b" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать функцию send_show_command из задания 18.1a и переделать ее таким образом,
чтобы обрабатывалось не только исключение, которое генерируется
при ошибке аутентификации на устройстве, но и исключение,
которое генерируется, когда IP-адрес устройства недоступен.</p>
<p>При возникновении ошибки, на стандартный поток вывода должно выводиться сообщение исключения.</p>
<p>Для проверки измените IP-адрес на устройстве или в файле devices.yaml.</p>
</div>
<div class="section" id="id3">
<h5>Задание 18.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию send_config_commands</p>
<p>Функция подключается по SSH (с помощью netmiko) к одному устройству и выполняет перечень команд в конфигурационном режиме на основании переданных аргументов.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>device - словарь с параметрами подключения к устройству</li>
<li>config_commands - список команд, которые надо выполнить</li>
</ul>
<p>Функция возвращает строку с результатами выполнения команды:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">r1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
<span class="p">{</span><span class="s1">&#39;device_type&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco_ios&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
 <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
 <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">commands</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;logging 10.255.255.1&#39;</span><span class="p">,</span> <span class="s1">&#39;logging buffered 20010&#39;</span><span class="p">,</span> <span class="s1">&#39;no logging console&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">send_config_commands</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">commands</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;config term</span><span class="se">\n</span><span class="s1">Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\n</span><span class="s1">R1(config)#logging 10.255.255.1</span><span class="se">\n</span><span class="s1">R1(config)#logging buffered 20010</span><span class="se">\n</span><span class="s1">R1(config)#no logging console</span><span class="se">\n</span><span class="s1">R1(config)#end</span><span class="se">\n</span><span class="s1">R1#&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">config</span> <span class="n">term</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#logging 10.255.255.1</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#logging buffered 20010</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#no logging console</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#end</span>
<span class="n">R1</span><span class="c1">#</span>
</pre></div>
</div>
<p>Скрипт должен отправлять команду command на все устройства из файла devices.yaml с помощью функции send_config_commands.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">commands</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;logging 10.255.255.1&#39;</span><span class="p">,</span> <span class="s1">&#39;logging buffered 20010&#39;</span><span class="p">,</span> <span class="s1">&#39;no logging console&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Задание 18.2a<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать функцию send_config_commands из задания 18.2 и добавить параметр log,
который контролирует будет ли выводится на стандартный поток вывода
информация о том к какому устройству выполняется подключение.</p>
<p>По умолчанию, результат должен выводиться.</p>
<p>Пример работы функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">send_config_commands</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">commands</span><span class="p">)</span>
<span class="n">Подключаюсь</span> <span class="n">к</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span><span class="o">...</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">send_config_commands</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">commands</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span>
</pre></div>
</div>
<p>Скрипт должен отправлять список команд commands на все устройства из файла devices.yaml с помощью функции send_config_commands.</p>
</div>
<div class="section" id="id5">
<h5>Задание 18.2b<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать функцию send_config_commands из задания 18.2a и добавить проверку на ошибки.</p>
<p>При выполнении каждой команды, скрипт должен проверять результат на такие ошибки:</p>
<ul class="simple">
<li>Invalid input detected</li>
<li>Incomplete command</li>
<li>Ambiguous command</li>
</ul>
<p>Если при выполнении какой-то из команд возникла ошибка,
функция должна выводить сообщение на стандартный поток вывода с информацией
о том, какая ошибка возникла, при выполнении какой команды и на каком устройстве, например:
Команда «logging» выполнилась с ошибкой «Incomplete command.» на устройстве 192.168.100.1</p>
<p>Ошибки должны выводиться всегда, независимо от значения параметра log.
При этом, log по-прежнему должен контролировать будет ли выводиться сообщение:
Подключаюсь к 192.168.100.1…</p>
<p>Функция send_config_commands теперь должна возвращать кортеж из двух словарей:</p>
<ul class="simple">
<li>первый словарь с выводом команд, которые выполнились без ошибки</li>
<li>второй словарь с выводом команд, которые выполнились с ошибками</li>
</ul>
<p>Оба словаря в формате (примеры словарей ниже):</p>
<ul class="simple">
<li>ключ - команда</li>
<li>значение - вывод с выполнением команд</li>
</ul>
<p>Проверить работу функции можно на одном устройстве.</p>
<p>Пример работы функции send_config_commands:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">commands</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;logging 0255.255.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;logging&#39;</span><span class="p">,</span>
 <span class="s1">&#39;a&#39;</span><span class="p">,</span>
 <span class="s1">&#39;logging buffered 20010&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ip http server&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">send_config_commands</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">commands</span><span class="p">)</span>
<span class="n">Подключаюсь</span> <span class="n">к</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span><span class="o">...</span>
<span class="n">Команда</span> <span class="s2">&quot;logging 0255.255.1&quot;</span> <span class="n">выполнилась</span> <span class="n">с</span> <span class="n">ошибкой</span> <span class="s2">&quot;Invalid input detected at &#39;^&#39; marker.&quot;</span> <span class="n">на</span> <span class="n">устройстве</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>
<span class="n">Команда</span> <span class="s2">&quot;logging&quot;</span> <span class="n">выполнилась</span> <span class="n">с</span> <span class="n">ошибкой</span> <span class="s2">&quot;Incomplete command.&quot;</span> <span class="n">на</span> <span class="n">устройстве</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>
<span class="n">Команда</span> <span class="s2">&quot;a&quot;</span> <span class="n">выполнилась</span> <span class="n">с</span> <span class="n">ошибкой</span> <span class="s2">&quot;Ambiguous command:  &quot;</span><span class="n">a</span><span class="s2">&quot;&quot;</span> <span class="n">на</span> <span class="n">устройстве</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
<span class="p">({</span><span class="s1">&#39;ip http server&#39;</span><span class="p">:</span> <span class="s1">&#39;config term</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;R1(config)#ip http server</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;R1(config)#&#39;</span><span class="p">,</span>
  <span class="s1">&#39;logging buffered 20010&#39;</span><span class="p">:</span> <span class="s1">&#39;config term</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="s1">&#39;Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="s1">&#39;R1(config)#logging buffered 20010</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="s1">&#39;R1(config)#&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;config term</span><span class="se">\n</span><span class="s1">&#39;</span>
       <span class="s1">&#39;Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\n</span><span class="s1">&#39;</span>
       <span class="s1">&#39;R1(config)#a</span><span class="se">\n</span><span class="s1">&#39;</span>
       <span class="s1">&#39;% Ambiguous command:  &quot;a&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
       <span class="s1">&#39;R1(config)#&#39;</span><span class="p">,</span>
  <span class="s1">&#39;logging&#39;</span><span class="p">:</span> <span class="s1">&#39;config term</span><span class="se">\n</span><span class="s1">&#39;</span>
             <span class="s1">&#39;Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\n</span><span class="s1">&#39;</span>
             <span class="s1">&#39;R1(config)#logging</span><span class="se">\n</span><span class="s1">&#39;</span>
             <span class="s1">&#39;% Incomplete command.</span><span class="se">\n</span><span class="s1">&#39;</span>
             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
             <span class="s1">&#39;R1(config)#&#39;</span><span class="p">,</span>
  <span class="s1">&#39;logging 0255.255.1&#39;</span><span class="p">:</span> <span class="s1">&#39;config term</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;R1(config)#logging 0255.255.1</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;                   ^</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s2">&quot;% Invalid input detected at &#39;^&#39; marker.</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;R1(config)#&#39;</span><span class="p">})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">good</span><span class="p">,</span> <span class="n">bad</span> <span class="o">=</span> <span class="n">result</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">good</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;logging buffered 20010&#39;</span><span class="p">,</span> <span class="s1">&#39;ip http server&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">bad</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;logging 0255.255.1&#39;</span><span class="p">,</span> <span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Примеры команд с ошибками:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#logging 0255.255.1</span>
                   <span class="o">^</span>
<span class="o">%</span> <span class="n">Invalid</span> <span class="nb">input</span> <span class="n">detected</span> <span class="n">at</span> <span class="s1">&#39;^&#39;</span> <span class="n">marker</span><span class="o">.</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#logging</span>
<span class="o">%</span> <span class="n">Incomplete</span> <span class="n">command</span><span class="o">.</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#a</span>
<span class="o">%</span> <span class="n">Ambiguous</span> <span class="n">command</span><span class="p">:</span>  <span class="s2">&quot;a&quot;</span>
</pre></div>
</div>
<p>Списки команд с ошибками и без:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">commands_with_errors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;logging 0255.255.1&#39;</span><span class="p">,</span> <span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="n">correct_commands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;logging buffered 20010&#39;</span><span class="p">,</span> <span class="s1">&#39;ip http server&#39;</span><span class="p">]</span>

<span class="n">commands</span> <span class="o">=</span> <span class="n">commands_with_errors</span> <span class="o">+</span> <span class="n">correct_commands</span>
</pre></div>
</div>
</div>
<div class="section" id="c">
<h5>Задание 18.2c<a class="headerlink" href="#c" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать функцию send_config_commands из задания 18.2b и переделать ее таким образом:
Если при выполнении команды возникла ошибка,
спросить пользователя надо ли выполнять остальные команды.</p>
<p>Варианты ответа [y]/n:</p>
<ul class="simple">
<li>y - выполнять остальные команды. Это значение по умолчанию, поэтому нажатие любой комбинации воспринимается как y</li>
<li>n или no - не выполнять остальные команды</li>
</ul>
<p>Функция send_config_commands по-прежнему должна возвращать кортеж из двух словарей:</p>
<ul class="simple">
<li>первый словарь с выводом команд, которые выполнились без ошибки</li>
<li>второй словарь с выводом команд, которые выполнились с ошибками</li>
</ul>
<p>Оба словаря в формате</p>
<ul class="simple">
<li>ключ - команда</li>
<li>значение - вывод с выполнением команд</li>
</ul>
<p>Проверить работу функции можно на одном устройстве.</p>
<p>Пример работы функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>In [11]: result = send_config_commands(r1, commands)
Подключаюсь к 192.168.100.1...
Команда &quot;logging 0255.255.1&quot; выполнилась с ошибкой &quot;Invalid input detected at &#39;^&#39; marker.&quot; на устройстве 192.168.100.1
Продолжать выполнять команды? [y]/n: y
Команда &quot;logging&quot; выполнилась с ошибкой &quot;Incomplete command.&quot; на устройстве 192.168.100.1
Продолжать выполнять команды? [y]/n: n

In [12]: pprint(result)
({},
 {&#39;logging&#39;: &#39;config term\n&#39;
             &#39;Enter configuration commands, one per line.  End with CNTL/Z.\n&#39;
             &#39;R1(config)#logging\n&#39;
             &#39;% Incomplete command.\n&#39;
             &#39;\n&#39;
             &#39;R1(config)#&#39;,
  &#39;logging 0255.255.1&#39;: &#39;config term\n&#39;
                        &#39;Enter configuration commands, one per line.  End with &#39;
                        &#39;CNTL/Z.\n&#39;
                        &#39;R1(config)#logging 0255.255.1\n&#39;
                        &#39;                   ^\n&#39;
                        &quot;% Invalid input detected at &#39;^&#39; marker.\n&quot;
                        &#39;\n&#39;
                        &#39;R1(config)#&#39;})
</pre></div>
</div>
<p>Списки команд с ошибками и без:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">commands_with_errors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;logging 0255.255.1&#39;</span><span class="p">,</span> <span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="n">correct_commands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;logging buffered 20010&#39;</span><span class="p">,</span> <span class="s1">&#39;ip http server&#39;</span><span class="p">]</span>

<span class="n">commands</span> <span class="o">=</span> <span class="n">commands_with_errors</span> <span class="o">+</span> <span class="n">correct_commands</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>Задание 18.3<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию send_commands (для подключения по SSH используется netmiko).</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>device - словарь с параметрами подключения к одному устройству</li>
<li>show - одна команда show (строка)</li>
<li>config - список с командами, которые надо выполнить в конфигурационном режиме</li>
</ul>
<p>Аргументы show и config должны передаваться только как ключевые. При передачи
этих аргументов как позиционных, должно генерироваться исключение TypeError.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">send_commands</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">75</span><span class="n">adcfb4a005</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">send_commands</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">send_commands</span><span class="p">()</span> <span class="n">takes</span> <span class="mi">1</span> <span class="n">positional</span> <span class="n">argument</span> <span class="n">but</span> <span class="mi">2</span> <span class="n">were</span> <span class="n">given</span>
</pre></div>
</div>
<p>В зависимости от того, какой аргумент был передан, функция вызывает разные функции
внутри. При вызове функции send_commands, всегда должен передаваться
только один из аргументов show, config. Если передаются оба аргумента, должно
генерироваться исключение ValueError.</p>
<p>Далее комбинация из аргумента и соответствующей функции:</p>
<ul class="simple">
<li>show - функция send_show_command из задания 18.1</li>
<li>config - функция send_config_commands из задания 18.2</li>
</ul>
<p>Функция возвращает строку с результатами выполнения команд или команды.</p>
<p>Проверить работу функции:</p>
<ul class="simple">
<li>со списком команд commands</li>
<li>командой command</li>
</ul>
<p>Пример работы функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">send_commands</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="s1">&#39;*17:06:12.278 UTC Wed Mar 13 2019&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username user5 password pass5&#39;</span><span class="p">,</span> <span class="s1">&#39;username user6 password pass6&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">send_commands</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">commands</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;config term</span><span class="se">\n</span><span class="s1">Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\n</span><span class="s1">R1(config)#username user5 password pass5</span><span class="se">\n</span><span class="s1">R1(config)#username user6 password pass6</span><span class="se">\n</span><span class="s1">R1(config)#end</span><span class="se">\n</span><span class="s1">R1#&#39;</span>
</pre></div>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;logging 10.255.255.1&quot;</span><span class="p">,</span> <span class="s2">&quot;logging buffered 20010&quot;</span><span class="p">,</span> <span class="s2">&quot;no logging console&quot;</span><span class="p">]</span>
<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;sh ip int br&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/19_concurrent_connections/index"></span><div class="section" id="concurrent-connections-index">
<span id="id1"></span><h3>19. Одновременное подключение к нескольким устройствам<a class="headerlink" href="#concurrent-connections-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>Когда нужно опросить много устройств, выполнение подключений поочередно
будет достаточно долгим. Конечно, это будет быстрее, чем подключение
вручную, но хотелось бы получать отклик как можно быстрее.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Все эти «долго» и «быстрее» относительные понятия, но в этом разделе
мы научимся и конкретно измерять, сколько отрабатывал скрипт, чтобы
сравнить, насколько быстрее будет выполняться подключение.</p>
</div>
<p>Для параллельного подключения к устройствам в этом разделе используется
модуль concurrent.futures.</p>
<div class="toctree-wrapper compound">
<span id="document-book/19_concurrent_connections/measure_script_execution_time"></span><div class="section" id="id1">
<h4>Измерение времени выполнения скрипта<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для оценки времени выполнения скрипта есть несколько вариантов. Тут
используются самые простые варианты:</p>
<ul class="simple">
<li>утилита Linux time</li>
<li>и модуль Python datetime</li>
</ul>
<p>При оценке времени выполнения скрипта в данном случае не важна высокая
точность. Главное - сравнить время выполнения скрипта в разных
вариантах.</p>
<div class="section" id="time">
<h5><code class="docutils literal notranslate"><span class="pre">time</span></code><a class="headerlink" href="#time" title="Ссылка на этот заголовок">¶</a></h5>
<p>Утилита time в Linux позволяет замерить время выполнения скрипта.
Для использования утилиты time достаточно написать time перед строкой
запуска скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ time python thread_paramiko.py
...
real    0m4.712s
user    0m0.336s
sys     0m0.064s
</pre></div>
</div>
<p>Нас интересует real время. В данном случае это 4.7 секунд.</p>
</div>
<div class="section" id="datetime">
<h5><code class="docutils literal notranslate"><span class="pre">datetime</span></code><a class="headerlink" href="#datetime" title="Ссылка на этот заголовок">¶</a></h5>
<p>Второй вариант - модуль datetime. Этот модуль позволяет работать со
временем и датами в Python.</p>
<p>Пример использования:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="c1">#Тут выполняются действия</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</pre></div>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python test.py
0:00:05.004949
</pre></div>
</div>
</div>
</div>
<span id="document-book/19_concurrent_connections/cpython_gil"></span><div class="section" id="python-cpython">
<h4>Процессы и потоки в Python (CPython)<a class="headerlink" href="#python-cpython" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для начала нам нужно разобраться с терминами:</p>
<ul class="simple">
<li>процесс (process) - это, грубо говоря, запущенная программа. Процессу
выделяются отдельные ресурсы: память, процессорное время</li>
<li>поток (thread) - это единица исполнения в процессе. Потоки разделяют
ресурсы процесса, к которому они относятся.</li>
</ul>
<p>Python (а точнее, CPython - реализация, которая используется в книге)
оптимизирован для работы в однопоточном режиме. Это хорошо, если в
программе используется только один поток.
И, в то же время, у Python есть определенные нюансы работы в
многопоточном режиме. Связаны они с тем, что CPython использует GIL
(global interpreter lock).</p>
<p>GIL не дает нескольким потокам исполнять одновременно код Python. Если
не вдаваться в подробности, то GIL можно представить как некий
переходящий флаг, который разрешает потокам выполняться. У кого флаг,
тот может выполнять работу.
Флаг передается либо каждые сколько-то инструкций Python, либо,
например, когда выполняются какие-то операции ввода-вывода.</p>
<p>Поэтому получается, что разные потоки не будут выполняться параллельно,
а программа просто будет между ними переключаться, выполняя их в разное
время.
Однако, если в программе есть некое «ожидание»: пакетов из
сети, запроса пользователя, пауза типа time.sleep, то в такой программе
потоки будут выполняться как будто параллельно. А всё потому, что во
время таких пауз флаг (GIL) можно передать другому потоку.</p>
<p>То есть, потоки отлично подходят для задач, которые связаны с операциями
ввода-вывода:</p>
<ul class="simple">
<li>Подключение к оборудованию и подключение по сети в целом</li>
<li>Работа с файловой системой</li>
<li>Скачивание файлов по сети</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В интернете часто можно встретить выражения «В Python лучше вообще не использовать потоки».
К сожалению, такие фразы не всегда пишут с контекстом, а именно,
что речь о конкретных задачах, которые завязаны на CPU.</p>
</div>
<p>В следующих разделах рассматривается, как использовать потоки для
подключения по Telnet/SSH. И проверяется, какое суммарное время будет
занимать исполнение скрипта, по сравнению с последовательным исполнением
и с использованием процессов.</p>
<div class="section" id="id1">
<h5>Процессы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Процессы позволяют выполнять задачи на разных ядрах компьютера. Это
важно для задач, которые завязаны на CPU.
Для каждого процесса создается своя копия ресурсов, выделяется память, у
каждого процесса свой GIL. Это же делает процессы более тяжеловесными,
по сравнению с потоками.</p>
<p>Кроме того, количество процессов, которые запускаются параллельно,
зависит от количества ядер и CPU и обычно исчисляется в десятках, тогда
как количество потоков для операций ввода-вывода может исчисляться в
сотнях.</p>
<p>Процессы и потоки можно совмещать, но это усложняет программу и на
базовом уровне для операций ввода-вывода лучше остановиться на потоках.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Совмещение потоков и процессов, то есть запуск процесса в программе и внутри него уже
запуск потоков - сильно усложняет траблшутинг программы. И лучше такой вариант
не использовать.</p>
</div>
<p>Несмотря на то, что, как правило, для задач ввода-вывода лучше использовать потоки
с некоторыми модулями надо использовать процессы, так как они могут некорректно работать
с потоками.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Помимо процессов и потоков есть еще один вариант одновременного подключения к оборудованию:
асинхронное программирование. Этот вариант не рассматривается в книге.</p>
</div>
</div>
</div>
<span id="document-book/19_concurrent_connections/thread_count"></span><div class="section" id="id1">
<h4>Количество потоков<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Сколько потоков нужно использовать при подключении к оборудованию?
На этот вопрос нет однозначного ответа. Количество потоков, как минимум,
зависит от того на каком компьютере выполняется
скрипт (ОС, память, процессор), от самой сети (задержек).</p>
<p>Поэтому, вместо поиска идеального количества потоков, надо замерить количество на своем
компьютере, сети, скрипте. Например, в примерах к этому разделу есть скрипт
netmiko_count_threads.py, который запускает одну и ту же функцию с разным
количеством потоков и выводит информацию о времени выполнения.
В функции по умолчанию используется небольшое количество устройств из файла devices_all.yaml
и небольшое количество потоков, однако его можно адаптировать к любому количеству для своей сети.</p>
<p>Пример подключения к 5000 устройств с разным количеством потоков:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Количество</span> <span class="n">устройств</span><span class="p">:</span> <span class="mi">5460</span>

<span class="c1">#30 потоков</span>
<span class="o">----------------------------------------</span>
<span class="n">Время</span> <span class="n">выполнения</span><span class="p">:</span> <span class="mi">0</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">17.187867</span>

<span class="c1">#50 потоков</span>
<span class="o">----------------------------------------</span>
<span class="n">Время</span> <span class="n">выполнения</span><span class="p">:</span> <span class="mi">0</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">17.604252</span>

<span class="c1">#70 потоков</span>
<span class="o">----------------------------------------</span>
<span class="n">Время</span> <span class="n">выполнения</span><span class="p">:</span> <span class="mi">0</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">17.117332</span>

<span class="c1">#90 потоков</span>
<span class="o">----------------------------------------</span>
<span class="n">Время</span> <span class="n">выполнения</span><span class="p">:</span> <span class="mi">0</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">16.693774</span>

<span class="c1">#100 потоков</span>
<span class="o">----------------------------------------</span>
<span class="n">Время</span> <span class="n">выполнения</span><span class="p">:</span> <span class="mi">0</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">17.083294</span>

<span class="c1">#120 потоков</span>
<span class="o">----------------------------------------</span>
<span class="n">Время</span> <span class="n">выполнения</span><span class="p">:</span> <span class="mi">0</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">17.945270</span>

<span class="c1">#140 потоков</span>
<span class="o">----------------------------------------</span>
<span class="n">Время</span> <span class="n">выполнения</span><span class="p">:</span> <span class="mi">0</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">18.114993</span>

<span class="c1">#200 потоков</span>
<span class="o">----------------------------------------</span>
<span class="n">Время</span> <span class="n">выполнения</span><span class="p">:</span> <span class="mi">0</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mf">12.951247</span>

<span class="c1">#300 потоков</span>
<span class="o">----------------------------------------</span>
<span class="n">Время</span> <span class="n">выполнения</span><span class="p">:</span> <span class="mi">0</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">03.790432</span>
</pre></div>
</div>
<p>В этом случае время выполнения с 30 потоками и 120 потоков одинаковое, а после время только
увеличивается.
Так происходит потому что на переключение между потоками также тратится много времени,
чем больше потоков, тем больше переключений.
И с какого-то момента нет смысла увеличивать количество потоков. Тут оптимальным количеством можно считать, например, 50 потоков. Тут мы берем не 30 чтобы сделать запас.</p>
</div>
<span id="document-book/19_concurrent_connections/thread_safety"></span><div class="section" id="id1">
<h4>Потоковая безопасность<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>При работе с потоками есть несколько рекомендаций, а также правил.
Если их соблюдать, работать с потоками будет проще и, скорее всего,
не будет проблем именно из-за потоков.
Конечно, время от времени, будут появляться задачи, которые потребуют нарушения рекомендаций.
Однако, прежде чем делать это, лучше попытаться решить задачу соблюдая
рекомендации. Если это невозможно, тогда надо искать как обезопасить
решение, чтобы не были повреждены данные.</p>
<p>Очень важная особенность работы с потоками: на небольшом количестве потоков
и небольших тестовых задачах «все работает».
Например, вывод информации с помощью print, при подключении к 20 устройствам
в 5 потоков, будет работать нормально.
А при подключении к большому количеству устройств с большим количеством потоков
окажется, что иногда сообщения «налазят» друг на друга.
Такая особенность проявляется очень часто, поэтому не доверяйте варианту
когда «все работает» на базовых примерах, соблюдайте правила работы с потоками.</p>
<p>Прежде чем разбираться с правилами, надо разобраться с термином «потоковая безопасность».
Потоковая безопасность - это концепция, которая описывает работу с многопоточными программами.
Код считается потокобезопасным (thread-safe), если он может работать
нормально при использовании нескольких потоков.</p>
<p>Например, функция print не является потокобезопасной. Это проявляется в том, что
когда код выполняет print из разных потоков, сообщения на стандартном потоке вывода
могут смешиваться. Может выводиться сначала часть сообщения из одного потока,
потом часть из второго, потом часть из первого и так далее.
То есть, функция print не работает нормально (как положено) в потоках.
В этом случае говорят, что функция print не является потокобезопасной (not thread-safe).</p>
<p>В общем случае, проблем не будет, если каждый поток работает со своими ресурсами.
Например, каждый поток пишет данные в свой файл. Однако, это не всегда возможно
или может усложнять решение.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">С print проблемы потому что из разных потоков пишем в один
стандартный поток вывода, а print не потокобезопасен.</p>
</div>
<p>В том случае, если надо все же из разных потоков писать в один и тот же ресурс,
есть два варианта:</p>
<ol class="arabic simple">
<li>Писать в один и тот же ресурс после того как работа в потоке закончилась.
Например, в потоках 1, 2 и 3 выполнилась функция, ее результат по очереди
(последовательно) получен из каждого потока, а затем записан в файл.</li>
<li>Использовать потокобезопасную альтернативу (не всегда доступна и/или не всегда простая).
Например, вместо функции print использовать модуль logging.</li>
</ol>
<p>Рекомендации при работе с потоками:</p>
<ol class="arabic simple">
<li>Не пишите в один и тот же ресурс из разных потоков, если ресурс
или то, чем пишете не предназначено для многопоточной работы.
Выяснить это, проще всего, погуглив что-то вроде «python write to file from threads».</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>В этой рекомендации есть нюансы. Например, можно писать из разных потоков
в один и тот же файл, если использовать Lock или использовать потокобезопасную очередь.
Эти варианты, чаще всего, непросты в использовании и не рассматриваются в книге.
Скорее всего, 95% задач, с которыми вы будете сталкиваться, можно решить без них.</li>
<li>К этой категории относится запись/изменение списков/словарей/множеств из разных потоков.
Сами по себе эти объекты потокобезопасны, но нет гарантии, что при изменении с одного
и того же списка из разных потоков, данные в списке будут правильные.
В случае, если надо использовать общий контейнер для данных для разных потоков,
надо использовать очередь queue из модуля Queue. Она потокобезопасна и с ней
можно работать из разных потоков.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Если есть воможность, избегайте коммуникаций между потоками в процессе их работы.
Это непростая задача и лучше постараться обойтись без нее.</li>
<li>Соблюдайте принцип KISS (Keep it simple, stupid) - постарайтесь, чтобы решение
было максимально простым.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Эти рекомендации, в целом, написаны для тех, кто только начинает
программировать на Python. Однако, как правило, они актуальны для большиства
программистов, которые пишут приложения для пользователей, а не фреймворки.</p>
</div>
<p>Модуль concurrent.futures, который будет рассматриваться дальше, упрощает
соблюдение первого принципа «Не пишите в один и тот же ресурс из разных потоков…».
Сам интерфейс работы с модулем к этому подталкивает, но конечно не запрещает его нарушать.</p>
<p>Однако, перед знакомством с concurrent.futures, надо рассмотреть основы работы
с модулем logging. Он будет использоваться вместо функции print,
которая не является потокобезопасной.</p>
</div>
<span id="document-book/19_concurrent_connections/logging"></span><div class="section" id="logging">
<h4>Модуль logging<a class="headerlink" href="#logging" title="Ссылка на этот заголовок">¶</a></h4>
<p>Модуль logging - это модуль из стандартной библиотеки Python, который позволяет
настраивать логирование из скрипта.
У модуля logging очень много возможностей и огромное количество вариантов настройки.
В этом разделе рассматривается только базовый вариант настройки.</p>
<p>Самый простой вариант настройки логирования в скрипте, использовать logging.basicConfig:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>


<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(threadName)s</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</pre></div>
</div>
<p>В таком варианте настройки:</p>
<ul class="simple">
<li>все сообщения будут выводиться на стандартный поток вывода,</li>
<li>будут выводиться сообщения уровня INFO и выше,</li>
<li>в каждом сообщении будет информация о потоке, имя логера, уровень сообщения и само сообщение.</li>
</ul>
<p>Теперь, чтобы вывести log-сообщение в этом скрипте, надо написать так <code class="docutils literal notranslate"><span class="pre">logging.info(&quot;тест&quot;)</span></code>.</p>
<p>Пример скрипта с настройкой логирования: (файл logging_basics.py)</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">netmiko</span>
<span class="kn">import</span> <span class="nn">yaml</span>


<span class="c1"># эта строка указывает, что лог-сообщения paramiko будут выводиться</span>
<span class="c1"># только если они уровня WARNING и выше</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;paramiko&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(threadName)s</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
    <span class="n">start_msg</span> <span class="o">=</span> <span class="s1">&#39;===&gt; </span><span class="si">{}</span><span class="s1"> Connection: </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">received_msg</span> <span class="o">=</span> <span class="s1">&#39;&lt;=== </span><span class="si">{}</span><span class="s1"> Received:   </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;ip&quot;</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">start_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>

    <span class="k">with</span> <span class="n">netmiko</span><span class="o">.</span><span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span>  <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">show</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">received_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;devices.yaml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">send_show</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>При выполнении скрипта, вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python logging_basics.py
MainThread root INFO: ===&gt; 12:26:12.767168 Connection: 192.168.100.1
MainThread root INFO: &lt;=== 12:26:18.307017 Received:   192.168.100.1
*12:26:18.137 UTC Wed Jun 5 2019
MainThread root INFO: ===&gt; 12:26:18.413913 Connection: 192.168.100.2
MainThread root INFO: &lt;=== 12:26:23.991715 Received:   192.168.100.2
*12:26:23.819 UTC Wed Jun 5 2019
MainThread root INFO: ===&gt; 12:26:24.095452 Connection: 192.168.100.3
MainThread root INFO: &lt;=== 12:26:29.478553 Received:   192.168.100.3
*12:26:29.308 UTC Wed Jun 5 2019
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В модуле logging еще очень много возможностей. В этом разделе используется только
базовый вариант настройки.
Узнать больше о возможностях модуля можно в <a class="reference external" href="https://docs.python.org/3/howto/logging.html#logging-basic-tutorial">Logging HOWTO</a></p>
</div>
</div>
<span id="document-book/19_concurrent_connections/concurrent_futures"></span><div class="section" id="concurrent-futures">
<h4>Модуль concurrent.futures<a class="headerlink" href="#concurrent-futures" title="Ссылка на этот заголовок">¶</a></h4>
<p>Модуль concurrent.futures предоставляет высокоуровневый интерфейс для
работы с процессами и потоками. При этом и для потоков, и для процессов
используется одинаковый интерфейс, что позволяет легко переключаться
между ними.</p>
<p>Если сравнивать этот модуль с threading или multiprocessing, то у него
меньше возможностей, но с concurrent.futures работать проще и
интерфейс более понятный.</p>
<p>Модуль concurrent.futures позволяет решить задачу запуска
нескольких потоков/процессов и получения из них данных.
Для этого в модуле используются два класса:</p>
<ul class="simple">
<li><strong>ThreadPoolExecutor</strong> - для работы с потоками</li>
<li><strong>ProcessPoolExecutor</strong> - для работы с процессами</li>
</ul>
<p>Оба класса используют одинаковый интерфейс, поэтому достаточно
разобраться с одним и затем просто переключиться на другой при
необходимости.</p>
<p>Создание объекта Executor на примере ThreadPoolExecutor:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">executor</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>После создания объекта Executor, у него есть три метода: shutdown, map и submit.
Метод shutdown отвечает за завершение потоков/процессов, а методы map и submit за
запуск функций в разных потоках/процессах.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">На самом деле, map и submit могут запускать не только функции,
а и любой вызываемый объект. Однако далее будут рассматриваться только функции.</p>
</div>
<p>Метод shutdown указывает, что объекту Executor надо завершить работу.
При этом, если методу shutdown передать значение <code class="docutils literal notranslate"><span class="pre">wait=True</span></code> (значение по умолчанию),
он не вернет результат пока не завершатся все функции, которые запущены в потоках.
Если же <code class="docutils literal notranslate"><span class="pre">wait=False</span></code>, метод shutdown завершает работу мгновенно, но при этом
сам скрипт не завершит работу пока все функции не отработают.</p>
<p>Как правило, метод shutdown не используется явно, так как при создании объекта Executor
в менеджере контекста, метод shutdown автоматически вызывается в конце блока with c wait равным True.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Так как методы map и submit запускают какую-то функцию в потоках или процессах,
в коде должна присутствовать, как минимум, функция которая выполняет одно действие и
которую надо запустить в разных потоках с разными аргументами функции.</p>
<p>Например, если необходимо пинговать несколько IP-адресов в разных потоках,
надо создать функцию, которая будет пинговать один IP-адрес, а затем запустить
эту функцию в разных потоках для разных IP-адресов с помощью concurrent.futures.</p>
<div class="toctree-wrapper compound">
<span id="document-book/19_concurrent_connections/concurrent_futures_map"></span><div class="section" id="map">
<h5>Метод map<a class="headerlink" href="#map" title="Ссылка на этот заголовок">¶</a></h5>
<p>Синтаксис метода:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">iterables</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Метод map - работает похоже на встроенную функцию map: применяет функцию
func к одному или более итерируемых объектов. При этом, каждый вызов
функции запускается в отдельном потоке/процессе. Метод map возвращает
итератор с результатами выполнения функции для каждого элемента итерируемого
объекта. Результаты расположены в том же порядке, что и элементы
в итерируемом объекте.</p>
<p>При работе с пулами потоков/процессов, создается определенное
количество потоков/процессов и затем код выполняется в этих потоках.
Например, если при создании пула указано, что надо создать 5 потоков,
а функцию надо запустить для 10 разных устройств, подключение будет выполняться
сначала к первым пяти устройствам, а затем, по мере освобождения,
к остальным.</p>
<p>Пример использования функции map с ThreadPoolExecutor (файл
netmiko_threads_map_basics.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">repeat</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">netmiko</span>
<span class="kn">import</span> <span class="nn">yaml</span>


<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;paramiko&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(threadName)s</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
    <span class="n">start_msg</span> <span class="o">=</span> <span class="s1">&#39;===&gt; </span><span class="si">{}</span><span class="s1"> Connection: </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">received_msg</span> <span class="o">=</span> <span class="s1">&#39;&lt;=== </span><span class="si">{}</span><span class="s1"> Received:   </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">start_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">netmiko</span><span class="o">.</span><span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">show</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">received_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;devices.yaml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">devices</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;sh clock&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">device</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">],</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>Так как методу map надо передавать функцию, создана функция send_show,
которая подключается к оборудованию, передает указанную команду show и
возвращает результат с выводом команды.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
    <span class="n">start_msg</span> <span class="o">=</span> <span class="s1">&#39;===&gt; </span><span class="si">{}</span><span class="s1"> Connection: </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">received_msg</span> <span class="o">=</span> <span class="s1">&#39;&lt;=== </span><span class="si">{}</span><span class="s1"> Received:   </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">start_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">netmiko</span><span class="o">.</span><span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">show</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">received_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>Функция send_show выводит лог сообщения в начале и в конце работы.
Это позволит определить когда функция отработала для конкретного устройства.
Также внутри функции указано, что при подключении к устройству с адресом 192.168.100.1,
надо сделать паузу на 5 секунд - таким образом маршрутизатор с этим адресом будет отрабатывать дольше.</p>
<p>Последние 4 строки кода отвечают за подключение к устройствам в отдельных потоках:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">devices</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;sh clock&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">device</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">],</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">ThreadPoolExecutor(max_workers=3)</span> <span class="pre">as</span> <span class="pre">executor:</span></code> - класс
ThreadPoolExecutor инициируется в блоке with с указанием количества
потоков.</p>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">result</span> <span class="pre">=</span> <span class="pre">executor.map(send_show,</span> <span class="pre">devices,</span> <span class="pre">repeat('sh</span> <span class="pre">clock'))</span></code> - метод map похож на</dt>
<dd><p class="first last">функцию map, но тут функция send_show вызывается в разных потоках. При
этом в разных потоках функция будет вызываться с разными аргументами:</p>
</dd>
</dl>
<ul class="simple">
<li>элементами итерируемого объекта devices и одной и той же командой sh clock.</li>
<li>так как вместо списка команд, тут используется только одна команда,
ее надо каким-то образом повторять, чтобы метод map подставлял эту команду
разным устройствам. Для этого используется функция repeat - она повторяет команду ровно столько
раз, сколько запрашивает map</li>
</ul>
</li>
<li><p class="first">метод map возвращает генератор. В этом генераторе содержатся
результаты выполнения функций. Результаты находятся в том же порядке,
что и устройства в списке devices, поэтому для совмещения IP-адресов устройств
и вывода команды используется функция zip.</p>
</li>
</ul>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python netmiko_threads_map_basics.py
ThreadPoolExecutor-0_0 root INFO: ===&gt; 08:28:55.950254 Connection: 192.168.100.1
ThreadPoolExecutor-0_1 root INFO: ===&gt; 08:28:55.963198 Connection: 192.168.100.2
ThreadPoolExecutor-0_2 root INFO: ===&gt; 08:28:55.970269 Connection: 192.168.100.3
ThreadPoolExecutor-0_1 root INFO: &lt;=== 08:29:11.968796 Received:   192.168.100.2
ThreadPoolExecutor-0_2 root INFO: &lt;=== 08:29:15.497324 Received:   192.168.100.3
ThreadPoolExecutor-0_0 root INFO: &lt;=== 08:29:16.854344 Received:   192.168.100.1
192.168.100.1 *08:29:16.663 UTC Thu Jul 4 2019
192.168.100.2 *08:29:11.744 UTC Thu Jul 4 2019
192.168.100.3 *08:29:15.374 UTC Thu Jul 4 2019
</pre></div>
</div>
<p>Первые три сообщения указывают когда было выполнено подключение и к какому устройству:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_0</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">08</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">55.950254</span> <span class="n">Connection</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_1</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">08</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">55.963198</span> <span class="n">Connection</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.2</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_2</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">08</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">55.970269</span> <span class="n">Connection</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.3</span>
</pre></div>
</div>
<p>Следующие три сообщения показывают время получения информации и завершения функции:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_1</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">&lt;===</span> <span class="mi">08</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mf">11.968796</span> <span class="n">Received</span><span class="p">:</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.2</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_2</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">&lt;===</span> <span class="mi">08</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mf">15.497324</span> <span class="n">Received</span><span class="p">:</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.3</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_0</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">&lt;===</span> <span class="mi">08</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mf">16.854344</span> <span class="n">Received</span><span class="p">:</span>   <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>
</pre></div>
</div>
<p>Так как для первого устройства был добавлен sleep на 5 секунд, информация
с первого маршрутизатора фактически была получена позже всего.
Однако, так как метод map возвращает значения в том же порядке, что и устройства в списке device,
итоговый результат выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="o">*</span><span class="mi">08</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mf">16.663</span> <span class="n">UTC</span> <span class="n">Thu</span> <span class="n">Jul</span> <span class="mi">4</span> <span class="mi">2019</span>
<span class="mf">192.168</span><span class="o">.</span><span class="mf">100.2</span> <span class="o">*</span><span class="mi">08</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mf">11.744</span> <span class="n">UTC</span> <span class="n">Thu</span> <span class="n">Jul</span> <span class="mi">4</span> <span class="mi">2019</span>
<span class="mf">192.168</span><span class="o">.</span><span class="mf">100.3</span> <span class="o">*</span><span class="mi">08</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mf">15.374</span> <span class="n">UTC</span> <span class="n">Thu</span> <span class="n">Jul</span> <span class="mi">4</span> <span class="mi">2019</span>
</pre></div>
</div>
<div class="section" id="id1">
<h6>Обработка исключений с map<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h6>
<p>Пример использования map с обработкой исключений:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">repeat</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">netmiko</span> <span class="kn">import</span> <span class="n">ConnectHandler</span><span class="p">,</span> <span class="n">NetMikoAuthenticationException</span>


<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;paramiko&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(threadName)s</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device_dict</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">start_msg</span> <span class="o">=</span> <span class="s1">&#39;===&gt; </span><span class="si">{}</span><span class="s1"> Connection: </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">received_msg</span> <span class="o">=</span> <span class="s1">&#39;&lt;=== </span><span class="si">{}</span><span class="s1"> Received:   </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">device_dict</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">start_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device_dict</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">received_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="n">NetMikoAuthenticationException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send_command_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">devices</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">device</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">output</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;devices.yaml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">send_command_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="s1">&#39;sh ip int br&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Пример в целом аналогичен предыдущему, но в функции send_show появилась обработка
ошибки NetMikoAuthenticationException, а код, который запускал функцию send_show
в потоках, теперь находится в функции send_command_to_devices.</p>
<p>При использовании метода map, обработку исключений лучше делать внутри функции,
которая запускается в потоках, в данном случае это функция send_show.</p>
</div>
</div>
<span id="document-book/19_concurrent_connections/concurrent_futures_submit"></span><div class="section" id="submit-futures">
<h5>Метод submit и работа с futures<a class="headerlink" href="#submit-futures" title="Ссылка на этот заголовок">¶</a></h5>
<p>Метод submit отличается от метода map:</p>
<ul class="simple">
<li>submit запускает в потоке только одну функцию</li>
<li>с помощью submit можно запускать разные функции с разными несвязанными аргументами,
а map надо обязательно запускать с итерируемым объектами в роли аргументов</li>
<li>submit сразу возвращает результат, не дожидаясь выполнения функции</li>
<li>submit возвращает специальный объект Future, который представляет
выполнение функции.<ul>
<li>submit возвращает Future для того чтобы вызов submit не блокировал
код. Как только submit вернул Future, код может выполняться дальше.
И как только запущены все функции в потоках, можно начинать запрашивать
Future о том готовы ли результаты. Или воспользоваться специальной функцией
as_completed, которая сама запрашивает результат, а код получает его
по мере готовности</li>
</ul>
</li>
<li>submit можно передавать ключевые аргументы, а map только позиционные</li>
</ul>
<p>Метод submit использует объект <a class="reference external" href="https://en.wikipedia.org/wiki/Futures_and_promises">Future</a> - это
объект, который представляет отложенное вычисление. Этот объект можно
запрашивать о состоянии (завершена работа или нет), можно получать
результаты или исключения, которые возникли в процессе работы.
Future не нужно создавать вручную, эти объекты создаются методом submit.</p>
<p>Пример запуска функции в потоках с помощью submit (файл
netmiko_threads_submit_basics.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">netmiko</span> <span class="kn">import</span> <span class="n">ConnectHandler</span><span class="p">,</span> <span class="n">NetMikoAuthenticationException</span>


<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;paramiko&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(threadName)s</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device_dict</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">start_msg</span> <span class="o">=</span> <span class="s1">&#39;===&gt; </span><span class="si">{}</span><span class="s1"> Connection: </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">received_msg</span> <span class="o">=</span> <span class="s1">&#39;&lt;=== </span><span class="si">{}</span><span class="s1"> Received: </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">device_dict</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">start_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device_dict</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">received_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">ip</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;devices.yaml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">future_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
        <span class="n">future_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">future_list</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</pre></div>
</div>
<p>Остальной код не изменился, поэтому разобраться надо только с блоком,
который запускает функцию send_show в потоках:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">future_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
        <span class="n">future_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">future_list</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</pre></div>
</div>
<p>Теперь в блоке with два цикла:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">future_list</span></code> - это список объектов future:<ul>
<li>для создания future используется функция submit</li>
<li>ей как аргументы передаются: имя функции, которую надо выполнить, и ее аргументы</li>
</ul>
</li>
<li>следующий цикл проходится по списку future и получает результат с помощью метода result</li>
</ul>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_0</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">12</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mf">39.194657</span> <span class="n">Connection</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_1</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">12</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mf">39.195841</span> <span class="n">Connection</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.2</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_1</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">&lt;===</span> <span class="mi">12</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mf">40.024725</span> <span class="n">Received</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.2</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_1</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">12</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mf">40.257218</span> <span class="n">Connection</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.3</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_1</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">&lt;===</span> <span class="mi">12</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mf">41.085220</span> <span class="n">Received</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.3</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_0</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">&lt;===</span> <span class="mi">12</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mf">45.025395</span> <span class="n">Received</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>
<span class="p">{</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">:</span> <span class="s1">&#39;*12:13:45.017 UTC Tue Mar 16 2021&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;192.168.100.2&#39;</span><span class="p">:</span> <span class="s1">&#39;*12:13:40.019 UTC Tue Mar 16 2021&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;192.168.100.3&#39;</span><span class="p">:</span> <span class="s1">&#39;*12:13:41.077 UTC Tue Mar 16 2021&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>В этом случае результаты возвращаются в порядке создания Future, но при использовании
submit можно также использовать функцию as_completed, которая позволяет получать результаты
по мере того как функции завершают работу.</p>
<p>Пример запуска функции в потоках с помощью submit и as_completed
(полный код в файле netmiko_threads_submit_basics_as_completed.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>


<span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">future_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
        <span class="n">future_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">future_list</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
</pre></div>
</div>
<p>Теперь цикл проходится по списку future с помощью функции as_completed. Эта функция
возвращает future только когда они завершили работу или были отменены.
При этом future возвращаются по мере завершения работы, не в порядке добавления в
список future_list.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Создание списка с future можно сделать с помощью list comprehensions:
<code class="docutils literal notranslate"><span class="pre">future_list</span> <span class="pre">=</span> <span class="pre">[executor.submit(send_show,</span> <span class="pre">device,</span> <span class="pre">'sh</span> <span class="pre">clock')</span> <span class="pre">for</span> <span class="pre">device</span> <span class="pre">in</span> <span class="pre">devices]</span></code></p>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python netmiko_threads_submit_basics.py
ThreadPoolExecutor-0_0 root INFO: ===&gt; 17:32:59.088025 Connection: 192.168.100.1
ThreadPoolExecutor-0_1 root INFO: ===&gt; 17:32:59.094103 Connection: 192.168.100.2
ThreadPoolExecutor-0_1 root INFO: &lt;=== 17:33:11.639672 Received: 192.168.100.2
{&#39;192.168.100.2&#39;: &#39;*17:33:11.429 UTC Thu Jul 4 2019&#39;}
ThreadPoolExecutor-0_1 root INFO: ===&gt; 17:33:11.849132 Connection: 192.168.100.3
ThreadPoolExecutor-0_0 root INFO: &lt;=== 17:33:17.735761 Received: 192.168.100.1
{&#39;192.168.100.1&#39;: &#39;*17:33:17.694 UTC Thu Jul 4 2019&#39;}
ThreadPoolExecutor-0_1 root INFO: &lt;=== 17:33:23.230123 Received: 192.168.100.3
{&#39;192.168.100.3&#39;: &#39;*17:33:23.188 UTC Thu Jul 4 2019&#39;}
</pre></div>
</div>
<p>Обратите внимание, что порядок не сохраняется и зависит от того, какие
функции раньше завершили работу.</p>
<div class="section" id="future">
<h6>Future<a class="headerlink" href="#future" title="Ссылка на этот заголовок">¶</a></h6>
<p>Пример запуска функции send_show с помощью submit и вывод информации о Future (обратите внимание на статус future в разные моменты времени):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">netmiko_threads_submit_futures</span> <span class="kn">import</span> <span class="n">send_show</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">f1</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">f3</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">r3</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_0</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">17</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">19.656867</span> <span class="n">Connection</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_1</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">17</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">19.657252</span> <span class="n">Connection</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.2</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Future</span> <span class="n">at</span> <span class="mh">0xb488e2ac</span> <span class="n">state</span><span class="o">=</span><span class="n">running</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Future</span> <span class="n">at</span> <span class="mh">0xb488ef2c</span> <span class="n">state</span><span class="o">=</span><span class="n">running</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Future</span> <span class="n">at</span> <span class="mh">0xb488e72c</span> <span class="n">state</span><span class="o">=</span><span class="n">pending</span><span class="o">&gt;</span>

<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_1</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">&lt;===</span> <span class="mi">17</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">25.757704</span> <span class="n">Received</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.2</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_1</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">===&gt;</span> <span class="mi">17</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">25.869368</span> <span class="n">Connection</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Future</span> <span class="n">at</span> <span class="mh">0xb488e2ac</span> <span class="n">state</span><span class="o">=</span><span class="n">running</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Future</span> <span class="n">at</span> <span class="mh">0xb488ef2c</span> <span class="n">state</span><span class="o">=</span><span class="n">finished</span> <span class="n">returned</span> <span class="nb">dict</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Future</span> <span class="n">at</span> <span class="mh">0xb488e72c</span> <span class="n">state</span><span class="o">=</span><span class="n">running</span><span class="o">&gt;</span>

<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_0</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">&lt;===</span> <span class="mi">17</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">30.431207</span> <span class="n">Received</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>
<span class="n">ThreadPoolExecutor</span><span class="o">-</span><span class="mi">0_1</span> <span class="n">root</span> <span class="n">INFO</span><span class="p">:</span> <span class="o">&lt;===</span> <span class="mi">17</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mf">31.636523</span> <span class="n">Received</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Future</span> <span class="n">at</span> <span class="mh">0xb488e2ac</span> <span class="n">state</span><span class="o">=</span><span class="n">finished</span> <span class="n">returned</span> <span class="nb">dict</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Future</span> <span class="n">at</span> <span class="mh">0xb488ef2c</span> <span class="n">state</span><span class="o">=</span><span class="n">finished</span> <span class="n">returned</span> <span class="nb">dict</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Future</span> <span class="n">at</span> <span class="mh">0xb488e72c</span> <span class="n">state</span><span class="o">=</span><span class="n">finished</span> <span class="n">returned</span> <span class="nb">dict</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Чтобы посмотреть на future, в скрипт добавлены несколько строк с выводом
информации (netmiko_threads_submit_futures.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">netmiko</span> <span class="kn">import</span> <span class="n">ConnectHandler</span><span class="p">,</span> <span class="n">NetMikoAuthenticationException</span>


<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;paramiko&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(threadName)s</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device_dict</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">start_msg</span> <span class="o">=</span> <span class="s1">&#39;===&gt; </span><span class="si">{}</span><span class="s1"> Connection: </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">received_msg</span> <span class="o">=</span> <span class="s1">&#39;&lt;=== </span><span class="si">{}</span><span class="s1"> Received: </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">device_dict</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">start_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device_dict</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">received_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">ip</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">send_command_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">future_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
            <span class="n">future_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Future: </span><span class="si">{}</span><span class="s1"> for device </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">future</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">future_list</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Future done </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;devices.yaml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">send_command_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python netmiko_threads_submit_futures.py
Future: &lt;Future at 0xb5ed938c state=running&gt; for device 192.168.100.1
ThreadPoolExecutor-0_0 root INFO: ===&gt; 07:14:26.298007 Connection: 192.168.100.1
Future: &lt;Future at 0xb5ed96cc state=running&gt; for device 192.168.100.2
Future: &lt;Future at 0xb5ed986c state=pending&gt; for device 192.168.100.3
ThreadPoolExecutor-0_1 root INFO: ===&gt; 07:14:26.299095 Connection: 192.168.100.2
ThreadPoolExecutor-0_1 root INFO: &lt;=== 07:14:32.056003 Received: 192.168.100.2
ThreadPoolExecutor-0_1 root INFO: ===&gt; 07:14:32.164774 Connection: 192.168.100.3
Future done &lt;Future at 0xb5ed96cc state=finished returned dict&gt;
ThreadPoolExecutor-0_0 root INFO: &lt;=== 07:14:36.714923 Received: 192.168.100.1
Future done &lt;Future at 0xb5ed938c state=finished returned dict&gt;
ThreadPoolExecutor-0_1 root INFO: &lt;=== 07:14:37.577327 Received: 192.168.100.3
Future done &lt;Future at 0xb5ed986c state=finished returned dict&gt;
{&#39;192.168.100.1&#39;: &#39;*07:14:36.546 UTC Fri Jul 26 2019&#39;,
 &#39;192.168.100.2&#39;: &#39;*07:14:31.865 UTC Fri Jul 26 2019&#39;,
 &#39;192.168.100.3&#39;: &#39;*07:14:37.413 UTC Fri Jul 26 2019&#39;}
</pre></div>
</div>
<p>Так как по умолчанию используется ограничение в два потока, только два
из трех future показывают статус running. Третий находится в состоянии
pending и ждет, пока до него дойдет очередь.</p>
</div>
<div class="section" id="id1">
<h6>Обработка исключений<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h6>
<p>Если при выполнении функции возникло исключение, оно будет сгенерировано
при получении результата</p>
<p>Например, в файле devices.yaml пароль для устройства 192.168.100.2
изменен на неправильный:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python netmiko_threads_submit.py
===&gt; 06:29:40.871851 Connection to device: 192.168.100.1
===&gt; 06:29:40.872888 Connection to device: 192.168.100.2
===&gt; 06:29:43.571296 Connection to device: 192.168.100.3
&lt;=== 06:29:48.921702 Received result from device: 192.168.100.3
&lt;=== 06:29:56.269284 Received result from device: 192.168.100.1
Traceback (most recent call last):
...
  File &quot;/home/vagrant/venv/py3_convert/lib/python3.6/site-packages/netmiko/base_connection.py&quot;, line 500, in establish_connection
    raise NetMikoAuthenticationException(msg)
netmiko.ssh_exception.NetMikoAuthenticationException: Authentication failure: unable to connect cisco_ios 192.168.100.2:22
Authentication failed.
</pre></div>
</div>
<p>Так как исключение возникает при получении результата, легко добавить
обработку исключений (файл netmiko_threads_submit_exception.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">repeat</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">netmiko</span> <span class="kn">import</span> <span class="n">ConnectHandler</span>
<span class="kn">from</span> <span class="nn">netmiko.ssh_exception</span> <span class="kn">import</span> <span class="n">NetMikoAuthenticationException</span>

<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;paramiko&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(threadName)s</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="n">start_msg</span> <span class="o">=</span> <span class="s1">&#39;===&gt; </span><span class="si">{}</span><span class="s1"> Connection: </span><span class="si">{}</span><span class="s1">&#39;</span>
<span class="n">received_msg</span> <span class="o">=</span> <span class="s1">&#39;&lt;=== </span><span class="si">{}</span><span class="s1"> Received: </span><span class="si">{}</span><span class="s1">&#39;</span>


<span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device_dict</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">device_dict</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">start_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device_dict</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">received_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">ip</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">send_command_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">future_ssh</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">future_ssh</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">NetMikoAuthenticationException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;devices.yaml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">send_command_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python netmiko_threads_submit_exception.py
ThreadPoolExecutor-0_0 root INFO: ===&gt; 07:21:21.190544 Connection: 192.168.100.1
ThreadPoolExecutor-0_1 root INFO: ===&gt; 07:21:21.191429 Connection: 192.168.100.2
ThreadPoolExecutor-0_1 root INFO: ===&gt; 07:21:23.672425 Connection: 192.168.100.3
Authentication failure: unable to connect cisco_ios 192.168.100.2:22
Authentication failed.
ThreadPoolExecutor-0_1 root INFO: &lt;=== 07:21:29.095289 Received: 192.168.100.3
ThreadPoolExecutor-0_0 root INFO: &lt;=== 07:21:31.607635 Received: 192.168.100.1
{&#39;192.168.100.1&#39;: &#39;*07:21:31.436 UTC Fri Jul 26 2019&#39;,
 &#39;192.168.100.3&#39;: &#39;*07:21:28.930 UTC Fri Jul 26 2019&#39;}
</pre></div>
</div>
<p>Конечно, обработка исключения может выполняться и внутри функции
send_show, но это просто пример того, как можно работать с
исключениями при использовании future.</p>
</div>
</div>
<span id="document-book/19_concurrent_connections/concurrent_futures_processes"></span><div class="section" id="processpoolexecutor">
<h5>Использование ProcessPoolExecutor<a class="headerlink" href="#processpoolexecutor" title="Ссылка на этот заголовок">¶</a></h5>
<p>Интерфейс модуля concurrent.futures очень удобен тем, что переход с потоков
на процессы делается заменой ThreadPoolExecutor на ProcessPoolExecutor,
поэтому все примеры ниже полностью аналогичны примерам с потоками.</p>
<div class="section" id="map">
<h6>Метод map<a class="headerlink" href="#map" title="Ссылка на этот заголовок">¶</a></h6>
<p>Для того чтобы использовать процессы вместо потоков,
достаточно сменить ThreadPoolExecutor на ProcessPoolExecutor:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">repeat</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">netmiko</span> <span class="kn">import</span> <span class="n">ConnectHandler</span><span class="p">,</span> <span class="n">NetMikoAuthenticationException</span>


<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;paramiko&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(threadName)s</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device_dict</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">start_msg</span> <span class="o">=</span> <span class="s1">&#39;===&gt; </span><span class="si">{}</span><span class="s1"> Connection: </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">received_msg</span> <span class="o">=</span> <span class="s1">&#39;&lt;=== </span><span class="si">{}</span><span class="s1"> Received:   </span><span class="si">{}</span><span class="s1">&#39;</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">device_dict</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">start_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device_dict</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
            <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">received_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="n">NetMikoAuthenticationException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">send_command_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">devices</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">device</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">output</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;devices.yaml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">send_command_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python netmiko_processes_map.py
MainThread root INFO: ===&gt; 08:35:50.931629 Connection: 192.168.100.2
MainThread root INFO: ===&gt; 08:35:50.931295 Connection: 192.168.100.1
MainThread root INFO: &lt;=== 08:35:56.353774 Received:   192.168.100.2
MainThread root INFO: ===&gt; 08:35:56.469854 Connection: 192.168.100.3
MainThread root INFO: &lt;=== 08:36:01.410230 Received:   192.168.100.1
MainThread root INFO: &lt;=== 08:36:02.067678 Received:   192.168.100.3
{&#39;192.168.100.1&#39;: &#39;*08:36:01.242 UTC Fri Jul 26 2019&#39;,
 &#39;192.168.100.2&#39;: &#39;*08:35:56.185 UTC Fri Jul 26 2019&#39;,
 &#39;192.168.100.3&#39;: &#39;*08:36:01.900 UTC Fri Jul 26 2019&#39;}
</pre></div>
</div>
</div>
<div class="section" id="submit">
<h6>Метод submit<a class="headerlink" href="#submit" title="Ссылка на этот заголовок">¶</a></h6>
<p>Файл netmiko_processes_submit_exception.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">repeat</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">netmiko</span> <span class="kn">import</span> <span class="n">ConnectHandler</span>
<span class="kn">from</span> <span class="nn">netmiko.ssh_exception</span> <span class="kn">import</span> <span class="n">NetMikoAuthenticationException</span>

<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;paramiko&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(threadName)s</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="n">start_msg</span> <span class="o">=</span> <span class="s1">&#39;===&gt; </span><span class="si">{}</span><span class="s1"> Connection: </span><span class="si">{}</span><span class="s1">&#39;</span>
<span class="n">received_msg</span> <span class="o">=</span> <span class="s1">&#39;&lt;=== </span><span class="si">{}</span><span class="s1"> Received: </span><span class="si">{}</span><span class="s1">&#39;</span>


<span class="k">def</span> <span class="nf">send_show</span><span class="p">(</span><span class="n">device_dict</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">device_dict</span><span class="p">[</span><span class="s1">&#39;ip&#39;</span><span class="p">]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">start_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device_dict</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh</span><span class="p">:</span>
        <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">received_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">ip</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">ip</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">send_command_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">future_ssh</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">send_show</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">future_ssh</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">NetMikoAuthenticationException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;devices.yaml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">send_command_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python netmiko_processes_submit_exception.py
MainThread root INFO: ===&gt; 08:38:08.780267 Connection: 192.168.100.1
MainThread root INFO: ===&gt; 08:38:08.781355 Connection: 192.168.100.2
MainThread root INFO: &lt;=== 08:38:14.420339 Received: 192.168.100.2
MainThread root INFO: ===&gt; 08:38:14.529405 Connection: 192.168.100.3
MainThread root INFO: &lt;=== 08:38:19.224554 Received: 192.168.100.1
MainThread root INFO: &lt;=== 08:38:20.162920 Received: 192.168.100.3
{&#39;192.168.100.1&#39;: &#39;*08:38:19.058 UTC Fri Jul 26 2019&#39;,
 &#39;192.168.100.2&#39;: &#39;*08:38:14.250 UTC Fri Jul 26 2019&#39;,
 &#39;192.168.100.3&#39;: &#39;*08:38:19.995 UTC Fri Jul 26 2019&#39;}
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/19_concurrent_connections/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<div class="section" id="gil">
<h5>GIL<a class="headerlink" href="#gil" title="Ссылка на этот заголовок">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/faq/library.html#can-t-we-get-rid-of-the-global-interpreter-lock">Can’t we get rid of the Global Interpreter
Lock?</a></li>
<li><a class="reference external" href="http://asvetlov.blogspot.com/2011/07/gil.html">GIL</a> (на русском)</li>
<li><a class="reference external" href="http://www.dabeaz.com/GIL/">Understanding the Python GIL</a></li>
<li><a class="reference external" href="http://jessenoller.com/blog/2009/02/01/python-threads-and-the-global-interpreter-lock">Python threads and the
GIL</a></li>
</ul>
</div>
<div class="section" id="concurrent-futures">
<h5>concurrent.futures<a class="headerlink" href="#concurrent-futures" title="Ссылка на этот заголовок">¶</a></h5>
<p>Документация Python:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html">concurrent.futures — Launching parallel
tasks</a></li>
<li><a class="reference external" href="https://www.python.org/dev/peps/pep-3148/">PEP 3148</a></li>
<li><a class="reference external" href="https://pymotw.com/3/concurrent.futures/index.html">PyMOTW. concurrent.futures — Manage Pools of Concurrent
Tasks</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/threading.html">threading</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html">multiprocessing</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/queue.html">queue</a></li>
</ul>
<p>Статьи:</p>
<ul class="simple">
<li><a class="reference external" href="http://masnun.com/2016/03/29/python-a-quick-introduction-to-the-concurrent-futures-module.html">A quick introduction to the concurrent.futures
module</a></li>
<li><a class="reference external" href="http://eli.thegreenplace.net/2013/01/16/python-paralellizing-cpu-bound-tasks-with-concurrent-futures">Python - paralellizing CPU-bound tasks with
concurrent.futures</a></li>
<li><a class="reference external" href="https://www.ploggingdev.com/2017/01/concurrent.futures-in-python-3/">concurrent.futures in Python
3</a></li>
</ul>
</div>
<div class="section" id="stackoverflow">
<h5>Полезные вопросы и ответы на stackoverflow<a class="headerlink" href="#stackoverflow" title="Ссылка на этот заголовок">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://stackoverflow.com/a/23816818">How many processes should I run in
parallel?</a></li>
<li><a class="reference external" href="https://stackoverflow.com/questions/481970/how-many-threads-is-too-many">How many threads is too
many?</a></li>
</ul>
</div>
</div>
<span id="document-exercises/19_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 19.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию ping_ip_addresses, которая проверяет пингуются ли IP-адреса.
Проверка IP-адресов должна выполняться параллельно в разных потоках.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>ip_list - список IP-адресов</li>
<li>limit - максимальное количество параллельных потоков (по умолчанию 3)</li>
</ul>
<p>Функция должна возвращать кортеж с двумя списками:</p>
<ul class="simple">
<li>список доступных IP-адресов</li>
<li>список недоступных IP-адресов</li>
</ul>
<p>Для выполнения задания можно создавать любые дополнительные функции.</p>
<p>Для проверки доступности IP-адреса, используйте ping.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Подсказка о работе с concurrent.futures:
Если необходимо пинговать несколько IP-адресов в разных потоках,
надо создать функцию, которая будет пинговать один IP-адрес,
а затем запустить эту функцию в разных потоках для разных
IP-адресов с помощью concurrent.futures (это надо сделать в функции ping_ip_addresses).</p>
</div>
</div>
<div class="section" id="id3">
<h5>Задание 19.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию send_show_command_to_devices, которая отправляет
одну и ту же команду show на разные устройства в параллельных потоках,
а затем записывает вывод команд в файл. Вывод с устройств в файле может быть в любом порядке.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>devices - список словарей с параметрами подключения к устройствам</li>
<li>command - команда</li>
<li>filename - имя текстового файла, в который будут записаны выводы всех команд</li>
<li>limit - максимальное количество параллельных потоков (по умолчанию 3)</li>
</ul>
<p>Функция ничего не возвращает.</p>
<p>Вывод команд должен быть записан в обычный текстовый файл в таком формате (перед выводом команды надо написать имя хоста и саму команду):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>R1#sh ip int br
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.1   YES NVRAM  up                    up
Ethernet0/1                192.168.200.1   YES NVRAM  up                    up
R2#sh ip int br
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.2   YES NVRAM  up                    up
Ethernet0/1                10.1.1.1        YES NVRAM  administratively down down
R3#sh ip int br
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.3   YES NVRAM  up                    up
Ethernet0/1                unassigned      YES NVRAM  administratively down down
</pre></div>
</div>
<p>Для выполнения задания можно создавать любые дополнительные функции.</p>
<p>Проверить работу функции на устройствах из файла devices.yaml</p>
</div>
<div class="section" id="id4">
<h5>Задание 19.3<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию send_command_to_devices, которая отправляет
разные команды show на разные устройства в параллельных потоках,
а затем записывает вывод команд в файл. Вывод с устройств в файле может быть в любом порядке.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>devices - список словарей с параметрами подключения к устройствам</li>
<li>commands_dict - словарь в котором указано на какое устройство отправлять какую команду. Пример словаря - commands</li>
<li>filename - имя файла, в который будут записаны выводы всех команд</li>
<li>limit - максимальное количество параллельных потоков (по умолчанию 3)</li>
</ul>
<p>Функция ничего не возвращает.</p>
<p>Вывод команд должен быть записан в файл в таком формате (перед выводом команды надо написать имя хоста и саму команду):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>R1#sh ip int br
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.1   YES NVRAM  up                    up
Ethernet0/1                192.168.200.1   YES NVRAM  up                    up
R2#sh arp
Protocol  Address          Age (min)  Hardware Addr   Type   Interface
Internet  192.168.100.1          76   aabb.cc00.6500  ARPA   Ethernet0/0
Internet  192.168.100.2           -   aabb.cc00.6600  ARPA   Ethernet0/0
Internet  192.168.100.3         173   aabb.cc00.6700  ARPA   Ethernet0/0
R3#sh ip int br
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.3   YES NVRAM  up                    up
Ethernet0/1                unassigned      YES NVRAM  administratively down down
</pre></div>
</div>
<p>Для выполнения задания можно создавать любые дополнительные функции.</p>
<p>Проверить работу функции на устройствах из файла devices.yaml и словаре commands</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Этот словарь нужен только для проверки работа кода, в нем можно менять IP-адреса</span>
<span class="c1"># тест берет адреса из файла devices.yaml</span>
<span class="n">commands</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;192.168.100.3&quot;</span><span class="p">:</span> <span class="s2">&quot;sh run | s ^router ospf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">:</span> <span class="s2">&quot;sh ip int br&quot;</span><span class="p">,</span>
    <span class="s2">&quot;192.168.100.2&quot;</span><span class="p">:</span> <span class="s2">&quot;sh int desc&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 19.3a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию send_command_to_devices, которая отправляет
список указанных команды show на разные устройства в параллельных потоках,
а затем записывает вывод команд в файл. Вывод с устройств в файле может быть в любом порядке.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>devices - список словарей с параметрами подключения к устройствам</li>
<li>commands_dict - словарь в котором указано на какое устройство отправлять какие команды. Пример словаря - commands</li>
<li>filename - имя файла, в который будут записаны выводы всех команд</li>
<li>limit - максимальное количество параллельных потоков (по умолчанию 3)</li>
</ul>
<p>Функция ничего не возвращает.</p>
<p>Вывод команд должен быть записан в файл в таком формате (перед выводом каждой команды надо написать имя хоста и саму команду):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>R2#sh arp
Protocol  Address          Age (min)  Hardware Addr   Type   Interface
Internet  192.168.100.1          87   aabb.cc00.6500  ARPA   Ethernet0/0
Internet  192.168.100.2           -   aabb.cc00.6600  ARPA   Ethernet0/0
R1#sh ip int br
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.1   YES NVRAM  up                    up
Ethernet0/1                192.168.200.1   YES NVRAM  up                    up
R1#sh arp
Protocol  Address          Age (min)  Hardware Addr   Type   Interface
Internet  10.30.0.1               -   aabb.cc00.6530  ARPA   Ethernet0/3.300
Internet  10.100.0.1              -   aabb.cc00.6530  ARPA   Ethernet0/3.100
R3#sh ip int br
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.3   YES NVRAM  up                    up
Ethernet0/1                unassigned      YES NVRAM  administratively down down
R3#sh ip route | ex -

Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 4 subnets, 2 masks
O        10.1.1.1/32 [110/11] via 192.168.100.1, 07:12:03, Ethernet0/0
O        10.30.0.0/24 [110/20] via 192.168.100.1, 07:12:03, Ethernet0/0
</pre></div>
</div>
<p>Порядок команд в файле может быть любым.</p>
<p>Для выполнения задания можно создавать любые дополнительные функции, а также использовать функции созданные в предыдущих заданиях.</p>
<p>Проверить работу функции на устройствах из файла devices.yaml и словаре commands</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Этот словарь нужен только для проверки работа кода, в нем можно менять IP-адреса</span>
<span class="c1"># тест берет адреса из файла devices.yaml</span>
<span class="n">commands</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;192.168.100.3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sh ip int br&quot;</span><span class="p">,</span> <span class="s2">&quot;sh ip route | ex -&quot;</span><span class="p">],</span>
    <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sh ip int br&quot;</span><span class="p">,</span> <span class="s2">&quot;sh int desc&quot;</span><span class="p">],</span>
    <span class="s2">&quot;192.168.100.2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sh int desc&quot;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Задание 19.4<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию send_commands_to_devices, которая отправляет команду show или config
на разные устройства в параллельных потоках, а затем записывает вывод команд в файл.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>devices - список словарей с параметрами подключения к устройствам</li>
<li>filename - имя файла, в который будут записаны выводы всех команд</li>
<li>show - команда show, которую нужно отправить (по умолчанию, значение None)</li>
<li>config - команды конфигурационного режима, которые нужно отправить (по умолчанию None)</li>
<li>limit - максимальное количество параллельных потоков (по умолчанию 3)</li>
</ul>
<p>Функция ничего не возвращает.</p>
<p>Аргументы show, config и limit должны передаваться только как ключевые. При передачи
этих аргументов как позиционных, должно генерироваться исключение TypeError.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">send_commands_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="s1">&#39;result.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">75</span><span class="n">adcfb4a005</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">send_commands_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="s1">&#39;result.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">send_commands_to_devices</span><span class="p">()</span> <span class="n">takes</span> <span class="mi">2</span> <span class="n">positional</span> <span class="n">argument</span> <span class="n">but</span> <span class="mi">3</span> <span class="n">were</span> <span class="n">given</span>
</pre></div>
</div>
<p>При вызове функции send_commands_to_devices, всегда должен передаваться
только один из аргументов show, config. Если передаются оба аргумента, должно
генерироваться исключение ValueError.</p>
<p>Вывод команд должен быть записан в файл в таком формате
(перед выводом команды надо написать имя хоста и саму команду):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>R1#sh ip int br
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.1   YES NVRAM  up                    up
Ethernet0/1                192.168.200.1   YES NVRAM  up                    up
R2#sh arp
Protocol  Address          Age (min)  Hardware Addr   Type   Interface
Internet  192.168.100.1          76   aabb.cc00.6500  ARPA   Ethernet0/0
Internet  192.168.100.2           -   aabb.cc00.6600  ARPA   Ethernet0/0
Internet  192.168.100.3         173   aabb.cc00.6700  ARPA   Ethernet0/0
R3#sh ip int br
Interface                  IP-Address      OK? Method Status                Protocol
Ethernet0/0                192.168.100.3   YES NVRAM  up                    up
Ethernet0/1                unassigned      YES NVRAM  administratively down down
</pre></div>
</div>
<p>Пример вызова функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">send_commands_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="s1">&#39;result.txt&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">cat</span> <span class="n">result</span><span class="o">.</span><span class="n">txt</span>
<span class="n">R1</span><span class="c1">#sh clock</span>
<span class="o">*</span><span class="mi">04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">34.668</span> <span class="n">UTC</span> <span class="n">Sat</span> <span class="n">Mar</span> <span class="mi">23</span> <span class="mi">2019</span>
<span class="n">R2</span><span class="c1">#sh clock</span>
<span class="o">*</span><span class="mi">04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">34.687</span> <span class="n">UTC</span> <span class="n">Sat</span> <span class="n">Mar</span> <span class="mi">23</span> <span class="mi">2019</span>
<span class="n">R3</span><span class="c1">#sh clock</span>
<span class="o">*</span><span class="mi">04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">40.354</span> <span class="n">UTC</span> <span class="n">Sat</span> <span class="n">Mar</span> <span class="mi">23</span> <span class="mi">2019</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">send_commands_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="s1">&#39;result.txt&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;logging 10.5.5.5&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">cat</span> <span class="n">result</span><span class="o">.</span><span class="n">txt</span>
<span class="n">config</span> <span class="n">term</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#logging 10.5.5.5</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#end</span>
<span class="n">R1</span><span class="c1">#</span>
<span class="n">config</span> <span class="n">term</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#logging 10.5.5.5</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#end</span>
<span class="n">R2</span><span class="c1">#</span>
<span class="n">config</span> <span class="n">term</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#logging 10.5.5.5</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#end</span>
<span class="n">R3</span><span class="c1">#</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;router ospf 55&#39;</span><span class="p">,</span> <span class="s1">&#39;network 0.0.0.0 255.255.255.255 area 0&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">send_commands_to_devices</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="s1">&#39;result.txt&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">commands</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">cat</span> <span class="n">result</span><span class="o">.</span><span class="n">txt</span>
<span class="n">config</span> <span class="n">term</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#router ospf 55</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#network 0.0.0.0 255.255.255.255 area 0</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#end</span>
<span class="n">R1</span><span class="c1">#</span>
<span class="n">config</span> <span class="n">term</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#router ospf 55</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#network 0.0.0.0 255.255.255.255 area 0</span>
<span class="n">R2</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#end</span>
<span class="n">R2</span><span class="c1">#</span>
<span class="n">config</span> <span class="n">term</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#router ospf 55</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#network 0.0.0.0 255.255.255.255 area 0</span>
<span class="n">R3</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1">#end</span>
<span class="n">R3</span><span class="c1">#</span>
</pre></div>
</div>
<p>Для выполнения задания можно создавать любые дополнительные функции.</p>
</div>
</div>
</div>
</div>
<span id="document-book/20_jinja2/index"></span><div class="section" id="jinja2">
<span id="jinja2-index"></span><h3>20. Шаблоны конфигураций с Jinja2<a class="headerlink" href="#jinja2" title="Ссылка на этот заголовок">¶</a></h3>
<p>Jinja2 - это язык шаблонов, который
используется в Python. Jinja - это не единственный язык шаблонов
(шаблонизатор) для Python и не единственный язык шаблонов в
целом.</p>
<p>Jinja2 используется для генерации документов на основе одного или
нескольких шаблонов.</p>
<p>Примеры использования:</p>
<ul class="simple">
<li>шаблоны для генерации HTML-страниц</li>
<li>шаблоны для генерации конфигурационных файлов в Unix/Linux</li>
<li>шаблоны для генерации конфигурационных файлов сетевых устройств</li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-book/20_jinja2/README"></span><div class="section" id="jinja2">
<h4>Начало работы с Jinja2<a class="headerlink" href="#jinja2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Установить Jinja2 можно с помощью pip:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">jinja2</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Далее термины Jinja и Jinja2 используются взаимозаменяемо.</p>
</div>
<p>Главная идея Jinja: разделение данных и шаблона. Это позволяет
использовать один и тот же шаблон, но подставлять в него разные данные.</p>
<p>В самом простом случае шаблон - это просто текстовый файл, в котором
указаны места подстановки значений с помощью переменных Jinja.</p>
<p>Пример шаблона Jinja (cfg_template.txt):</p>
<div class="code jinja highlight-default notranslate"><div class="highlight"><pre><span></span>hostname {{name}}
!
interface Loopback255
 description Management loopback
 ip address 10.255.{{id}}.1 255.255.255.255
!
interface GigabitEthernet0/0
 description LAN to {{name}} sw1 {{int}}
 ip address {{ip}} 255.255.255.0
!
router ospf 10
 router-id 10.255.{{id}}.1
 auto-cost reference-bandwidth 10000
 network 10.0.0.0 0.255.255.255 area 0
</pre></div>
</div>
<p>Комментарии к шаблону:</p>
<ul class="simple">
<li>В Jinja переменные записываются в двойных фигурных скобках.</li>
<li>При выполнении скрипта эти переменные заменяются нужными значениями.</li>
</ul>
<p>Этот шаблон может использоваться для генерации конфигурации разных
устройств с помощью подстановки других наборов переменных.</p>
<p>Пример скрипта с генерацией файла на основе шаблона Jinja (файл
basic_generator.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FileSystemLoader</span>
<span class="kn">import</span> <span class="nn">yaml</span>


<span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
<span class="n">templ</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;cfg_template.txt&quot;</span><span class="p">)</span>

<span class="n">liverpool</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;11&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Liverpool&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="s2">&quot;Gi1/0/17&quot;</span><span class="p">,</span> <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.1.1.10&quot;</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">templ</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">liverpool</span><span class="p">))</span>
</pre></div>
</div>
<p>Скрипт импортирует из модуля jinja2:</p>
<ul class="simple">
<li>FileSystemLoader - загрузчик, который позволяет работать с файловой системой.
Тут указывается путь к каталогу, где находятся шаблоны
в данном случае шаблон находится в текущем каталоге</li>
<li>Environment - класс для описания параметров окружения. В данном случае указан
только загрузчик, но в нём можно указывать методы обработки шаблона</li>
</ul>
<p>Комментарии к файлу basic_generator.py:</p>
<ul class="simple">
<li>в шаблоне используются переменные в синтаксисе Jinja</li>
<li>в словаре liverpool ключи должны быть такими же, как имена переменных в шаблоне</li>
<li>значения, которые соответствуют ключам - это те данные, которые будут подставлены на место переменных</li>
<li>последняя строка рендерит шаблон, используя словарь liverpool, то есть, подставляет значения в переменные.</li>
</ul>
<p>Если запустить скрипт basic_generator.py, то вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python basic_generator.py

hostname Liverpool
!
interface Loopback255
 description Management loopback
 ip address 10.255.11.1 255.255.255.255
!
interface GigabitEthernet0/0
 description LAN to Liverpool sw1 Gi1/0/17
 ip address 10.1.1.10 255.255.255.0
!
router ospf 10
 router-id 10.255.11.1
 auto-cost reference-bandwidth 10000
 network 10.0.0.0 0.255.255.255 area 0
</pre></div>
</div>
</div>
<span id="document-book/20_jinja2/example"></span><div class="section" id="jinja">
<h4>Пример использования Jinja<a class="headerlink" href="#jinja" title="Ссылка на этот заголовок">¶</a></h4>
<p>Шаблон templates/router_template.txt - это обычный текстовый файл:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>hostname {{name}}
!
interface Loopback10
 description MPLS loopback
 ip address 10.10.{{id}}.1 255.255.255.255
 !
interface GigabitEthernet0/0
 description WAN to {{name}} sw1 G0/1
!
interface GigabitEthernet0/0.1{{id}}1
 description MPLS to {{to_name}}
 encapsulation dot1Q 1{{id}}1
 ip address 10.{{id}}.1.2 255.255.255.252
 ip ospf network point-to-point
 ip ospf hello-interval 1
 ip ospf cost 10
!
interface GigabitEthernet0/1
 description LAN {{name}} to sw1 G0/2 !
interface GigabitEthernet0/1.{{IT}}
 description PW IT {{name}} - {{to_name}}
 encapsulation dot1Q {{IT}}
 xconnect 10.10.{{to_id}}.1 {{id}}11 encapsulation mpls
 backup peer 10.10.{{to_id}}.2 {{id}}21
  backup delay 1 1
!
interface GigabitEthernet0/1.{{BS}}
 description PW BS {{name}} - {{to_name}}
 encapsulation dot1Q {{BS}}
 xconnect 10.10.{{to_id}}.1 {{to_id}}{{id}}11 encapsulation mpls
  backup peer 10.10.{{to_id}}.2 {{to_id}}{{id}}21
  backup delay 1 1
!
router ospf 10
 router-id 10.10.{{id}}.1
 auto-cost reference-bandwidth 10000
 network 10.0.0.0 0.255.255.255 area 0
 !
</pre></div>
</div>
<p>Файл с данными routers_info.yml</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">11</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">Liverpool</span>
  <span class="n">to_name</span><span class="p">:</span> <span class="n">LONDON</span>
  <span class="n">IT</span><span class="p">:</span> <span class="mi">791</span>
  <span class="n">BS</span><span class="p">:</span> <span class="mi">1550</span>
  <span class="n">to_id</span><span class="p">:</span> <span class="mi">1</span>

<span class="o">-</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">12</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">Bristol</span>
  <span class="n">to_name</span><span class="p">:</span> <span class="n">LONDON</span>
  <span class="n">IT</span><span class="p">:</span> <span class="mi">793</span>
  <span class="n">BS</span><span class="p">:</span> <span class="mi">1510</span>
  <span class="n">to_id</span><span class="p">:</span> <span class="mi">1</span>

<span class="o">-</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">14</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">Coventry</span>
  <span class="n">to_name</span><span class="p">:</span> <span class="n">Manchester</span>
  <span class="n">IT</span><span class="p">:</span> <span class="mi">892</span>
  <span class="n">BS</span><span class="p">:</span> <span class="mi">1650</span>
  <span class="n">to_id</span><span class="p">:</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Скрипт для генерации конфигураций router_config_generator_ver2.py</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FileSystemLoader</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="s1">&#39;templates&#39;</span><span class="p">))</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s1">&#39;router_template.txt&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;routers_info.yml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">routers</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">for</span> <span class="n">router</span> <span class="ow">in</span> <span class="n">routers</span><span class="p">:</span>
    <span class="n">r1_conf</span> <span class="o">=</span> <span class="n">router</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_r1.txt&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">r1_conf</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">router</span><span class="p">))</span>
</pre></div>
</div>
<p>Файл router_config_generator.py импортирует из модуля jinja2:</p>
<ul class="simple">
<li><strong>FileSystemLoader</strong> - загрузчик, который позволяет работать с файловой системой<ul>
<li>тут указывается путь к каталогу, где находятся шаблоны</li>
<li>в данном случае шаблон находится в каталоге templates</li>
</ul>
</li>
<li><strong>Environment</strong> - класс для описания параметров окружения.
В данном случае указан только загрузчик, но в нём можно указывать методы обработки шаблона</li>
</ul>
<p>Обратите внимание, что шаблон теперь находится в каталоге <strong>templates</strong>.</p>
</div>
<span id="document-book/20_jinja2/template_syntax"></span><div class="section" id="jinja2">
<h4>Синтаксис шаблонов Jinja2<a class="headerlink" href="#jinja2" title="Ссылка на этот заголовок">¶</a></h4>
<p>До сих пор в примерах шаблонов Jinja2 использовалась только подстановка
переменных. Это самый простой и понятный пример использования шаблонов.
Но синтаксис шаблонов Jinja на этом не ограничивается.</p>
<p>В шаблонах Jinja2 можно использовать:</p>
<ul class="simple">
<li>переменные</li>
<li>условия (if/else)</li>
<li>циклы (for)</li>
<li>фильтры - специальные встроенные методы, которые
позволяют делать преобразования переменных</li>
<li>тесты - используются для проверки,
соответствует ли переменная какому-то условию</li>
</ul>
<p>Кроме того, Jinja поддерживает наследование между шаблонами, а также
позволяет добавлять содержимое одного шаблона в другой.</p>
<p>В этом разделе рассматриваются только основы этих возможностей. Подробнее о шаблонах Jinja2
можно почитать в <a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/">документации</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Все файлы, которые используются как примеры в этом подразделе,
находятся в каталоге 3_template_syntax/</p>
</div>
<p>Для генерации шаблонов будет использоваться скрипт cfg_gen.py</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FileSystemLoader</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1">#$ python cfg_gen.py templates/for.txt data_files/for.yml</span>
<span class="n">template_dir</span><span class="p">,</span> <span class="n">template_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">vars_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
    <span class="n">loader</span><span class="o">=</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">template_dir</span><span class="p">),</span>
    <span class="n">trim_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">lstrip_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">vars_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">vars_dict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">vars_dict</span><span class="p">))</span>
</pre></div>
</div>
<p>Для того, чтобы посмотреть на результат, нужно вызвать скрипт и передать
ему два аргумента:</p>
<ul class="simple">
<li>шаблон</li>
<li>файл с переменными в формате YAML</li>
</ul>
<p>Результат будет выведен на стандартный поток вывода.</p>
<p>Пример запуска скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/variables.txt data_files/vars.yml
</pre></div>
</div>
<p>Параметры trim_blocks и lstrip_blocks описаны в следующем
подразделе.</p>
<div class="toctree-wrapper compound">
<span id="document-book/20_jinja2/whitespace_control"></span><div class="section" id="whitespace">
<h5>Контроль символов whitespace<a class="headerlink" href="#whitespace" title="Ссылка на этот заголовок">¶</a></h5>
<div class="section" id="trim-blocks-lstrip-blocks">
<h6>trim_blocks, lstrip_blocks<a class="headerlink" href="#trim-blocks-lstrip-blocks" title="Ссылка на этот заголовок">¶</a></h6>
<p>Параметр <code class="docutils literal notranslate"><span class="pre">trim_blocks</span></code> удаляет первую пустую строку после блока
конструкции, если его значение равно True (по умолчанию False).</p>
<p>Эффект применения флага рассматривается на примере шаблона
templates/env_flags.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Если скрипт cfg_gen.py запускается без флагов trim_blocks,
lstrip_blocks:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">TEMPLATE_DIR</span><span class="p">))</span>
</pre></div>
</div>
<p>Вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/env_flags.txt data_files/router.yml
router bgp 100

 neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100

 neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100
</pre></div>
</div>
<p>Переводы строк появляются из-за блока for.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>По умолчанию такое же поведение будет с любыми другими блоками Jinja.</p>
<p>При добавлении флага trim_blocks таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">TEMPLATE_DIR</span><span class="p">),</span>
                  <span class="n">trim_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Результат выполнения будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/env_flags.txt data_files/router.yml
router bgp 100
  neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100
  neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100
</pre></div>
</div>
<p>Были удалены пустые строки после блока.</p>
<p>Перед строками <code class="docutils literal notranslate"><span class="pre">neighbor</span> <span class="pre">...</span> <span class="pre">remote-as</span></code> появились два пробела. Так
получилось из-за того, что перед блоком for стоит пробел. После того,
как был отключен лишний перевод строки, пробелы и табы перед блоком
добавляются к первой строке блока.</p>
<p>Это не влияет на следующие строки. Поэтому строки с
<code class="docutils literal notranslate"><span class="pre">neighbor</span> <span class="pre">...</span> <span class="pre">update-source</span></code> отображаются с одним пробелом.</p>
<p>Параметр <code class="docutils literal notranslate"><span class="pre">lstrip_blocks</span></code> контролирует то, будут ли удаляться пробелы и
табы от начала строки до начала блока (до открывающейся фигурной
скобки).</p>
<p>Если добавить аргумент <code class="docutils literal notranslate"><span class="pre">lstrip_blocks=True</span></code> таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">TEMPLATE_DIR</span><span class="p">),</span>
                  <span class="n">trim_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lstrip_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Результат выполнения будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/env_flags.txt data_files/router.yml
router bgp 100
 neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100
 neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100
</pre></div>
</div>
</div>
<div class="section" id="lstrip-blocks">
<h6>Отключение lstrip_blocks для блока<a class="headerlink" href="#lstrip-blocks" title="Ссылка на этот заголовок">¶</a></h6>
<p>Иногда нужно отключить функциональность lstrip_blocks для блока.</p>
<p>Например, если параметр <code class="docutils literal notranslate"><span class="pre">lstrip_blocks</span></code> установлен равным True в
окружении, но нужно отключить его для второго блока в шаблоне (файл
templates/env_flags2.txt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>

<span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%+</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Результат будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/env_flags2.txt data_files/router.yml
router bgp 100
 neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100
 neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100

router bgp 100
  neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100
 neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100
</pre></div>
</div>
<p>Плюс после знака процента отключает lstrip_blocks для блока, в данном
случае, только для начала блока.</p>
<p>Если сделать таким образом (плюс добавлен в выражении для завершения
блока):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>

<span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%+</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%+</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Он будет отключен и для конца блока:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/env_flags2.txt data_files/router.yml
router bgp 100
 neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100
 neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100

router bgp 100
  neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100
  neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h6>Удаление whitespace в блоке<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h6>
<p>Аналогичным образом можно контролировать удаление whitespace для блока.</p>
<p>Для этого примера в окружении не выставлены флаги:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">TEMPLATE_DIR</span><span class="p">))</span>
</pre></div>
</div>
<p>Шаблон templates/env_flags3.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>

<span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%-</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Обратите внимание на минус в начале второго блока. Минус удаляет все
whitespace символы, в данном случае, в начале блока.</p>
<p>Результат будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/env_flags3.txt data_files/router.yml
router bgp 100

 neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100

 neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100


router bgp 100
 neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100

 neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100
</pre></div>
</div>
<p>Если добавить минус в конец блока:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>

<span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%-</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%-</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Удалится пустая строка и в конце блока:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/env_flags3.txt data_files/router.yml
router bgp 100

 neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100

 neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100


router bgp 100
 neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100
 neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100
</pre></div>
</div>
<p>Попробуйте добавить минус в конце выражений, описывающих блок, и
посмотреть на результат:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>

<span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%-</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">-%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%-</span> <span class="n">endfor</span> <span class="o">-%</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/20_jinja2/syntax_variables"></span><div class="section" id="id1">
<h5>Переменные<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Переменные в шаблоне указываются в двойных фигурных скобках:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostname</span> <span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span>

<span class="n">interface</span> <span class="n">Loopback0</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.</span><span class="p">{{</span> <span class="nb">id</span> <span class="p">}}</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>
</pre></div>
</div>
<p>Значения переменных подставляются на основе словаря, который передается
шаблону.</p>
<p>Переменная, которая передается в словаре, может быть не только числом
или строкой, но и, например, списком или словарем. Внутри шаблона можно,
соответственно, обращаться к элементу по номеру или по ключу.</p>
<p>Пример шаблона templates/variables.txt с использованием разных вариантов
переменных:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostname</span> <span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span>

<span class="n">interface</span> <span class="n">Loopback0</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.</span><span class="p">{{</span> <span class="nb">id</span> <span class="p">}}</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>

<span class="n">vlan</span> <span class="p">{{</span> <span class="n">vlans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">}}</span>

<span class="n">router</span> <span class="n">ospf</span> <span class="mi">1</span>
 <span class="n">router</span><span class="o">-</span><span class="nb">id</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.</span><span class="p">{{</span> <span class="nb">id</span> <span class="p">}}</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="mi">10000</span>
 <span class="n">network</span> <span class="p">{{</span> <span class="n">ospf</span><span class="o">.</span><span class="n">network</span> <span class="p">}}</span> <span class="n">area</span> <span class="p">{{</span> <span class="n">ospf</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="p">}}</span>
</pre></div>
</div>
<p>И соответствующий файл data_files/vars.yml с переменными:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">name</span><span class="p">:</span> <span class="n">R3</span>
<span class="n">vlans</span><span class="p">:</span>
  <span class="o">-</span> <span class="mi">10</span>
  <span class="o">-</span> <span class="mi">20</span>
  <span class="o">-</span> <span class="mi">30</span>
<span class="n">ospf</span><span class="p">:</span>
  <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
  <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Обратите внимание на использование переменной vlans в шаблоне:  так
как переменная vlans это список, можно указывать, какой именно элемент
из списка нам нужен</p>
<p>Если передается словарь (как в случае с переменной ospf), то внутри
шаблона можно обращаться к объектам словаря, используя один из
вариантов: <code class="docutils literal notranslate"><span class="pre">ospf.network</span> <span class="pre">или</span> <span class="pre">ospf['network']</span></code></p>
<p>Результат запуска скрипта будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/variables.txt data_files/vars.yml
hostname R3

interface Loopback0
 ip address 10.0.0.3 255.255.255.255

vlan 10

router ospf 1
 router-id 10.0.0.3
 auto-cost reference-bandwidth 10000
 network 10.0.1.0 0.0.0.255 area 0
</pre></div>
</div>
</div>
<span id="document-book/20_jinja2/syntax_for"></span><div class="section" id="for">
<h5>Цикл for<a class="headerlink" href="#for" title="Ссылка на этот заголовок">¶</a></h5>
<p>Цикл for позволяет проходиться по элементам последовательности.</p>
<p>Цикл for должен находиться внутри символов <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">%}</span></code>.
Кроме того, нужно явно указывать завершение цикла:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">vlan</span> <span class="ow">in</span> <span class="n">vlans</span> <span class="o">%</span><span class="p">}</span>
  <span class="n">vlan</span> <span class="p">{{</span> <span class="n">vlan</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Пример шаблона templates/for.txt с использованием цикла:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostname</span> <span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span>

<span class="n">interface</span> <span class="n">Loopback0</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.</span><span class="p">{{</span> <span class="nb">id</span> <span class="p">}}</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>

<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">vlans</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>
<span class="n">vlan</span> <span class="p">{{</span> <span class="n">vlan</span> <span class="p">}}</span>
 <span class="n">name</span> <span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>

<span class="n">router</span> <span class="n">ospf</span> <span class="mi">1</span>
 <span class="n">router</span><span class="o">-</span><span class="nb">id</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.</span><span class="p">{{</span> <span class="nb">id</span> <span class="p">}}</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="mi">10000</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">networks</span> <span class="ow">in</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">network</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">network</span> <span class="p">}}</span> <span class="n">area</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">area</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Файл data_files/for.yml с переменными:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">name</span><span class="p">:</span> <span class="n">R3</span>
<span class="n">vlans</span><span class="p">:</span>
  <span class="mi">10</span><span class="p">:</span> <span class="n">Marketing</span>
  <span class="mi">20</span><span class="p">:</span> <span class="n">Voice</span>
  <span class="mi">30</span><span class="p">:</span> <span class="n">Management</span>
<span class="n">ospf</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">2</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>В цикле for можно проходиться как по элементам списка (например, список
ospf), так и по словарю (словарь vlans). И, аналогичным образом, по
любой последовательности.</p>
<p>Результат выполнения будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/for.txt data_files/for.yml
hostname R3

interface Loopback0
 ip address 10.0.0.3 255.255.255.255

vlan 10
 name Marketing
vlan 20
 name Voice
vlan 30
 name Management

router ospf 1
 router-id 10.0.0.3
 auto-cost reference-bandwidth 10000
 network 10.0.1.0 0.0.0.255 area 0
 network 10.0.2.0 0.0.0.255 area 2
 network 10.1.1.0 0.0.0.255 area 0
</pre></div>
</div>
</div>
<span id="document-book/20_jinja2/syntax_if"></span><div class="section" id="if-elif-else">
<h5>if/elif/else<a class="headerlink" href="#if-elif-else" title="Ссылка на этот заголовок">¶</a></h5>
<p>if позволяет добавлять условие в шаблон. Например, можно использовать
if, чтобы добавлять какие-то части шаблона в зависимости от наличия
переменных в словаре с данными.</p>
<p>Конструкция if также должна находиться внутри <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">%}</span></code>.
Нужно явно указывать окончание условия:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
<span class="n">router</span> <span class="n">ospf</span> <span class="mi">1</span>
 <span class="n">router</span><span class="o">-</span><span class="nb">id</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.</span><span class="p">{{</span> <span class="nb">id</span> <span class="p">}}</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="mi">10000</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Пример шаблона templates/if.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostname</span> <span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span>

<span class="n">interface</span> <span class="n">Loopback0</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.</span><span class="p">{{</span> <span class="nb">id</span> <span class="p">}}</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>

<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">vlans</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>
<span class="n">vlan</span> <span class="p">{{</span> <span class="n">vlan</span> <span class="p">}}</span>
 <span class="n">name</span> <span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
<span class="n">router</span> <span class="n">ospf</span> <span class="mi">1</span>
 <span class="n">router</span><span class="o">-</span><span class="nb">id</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.</span><span class="p">{{</span> <span class="nb">id</span> <span class="p">}}</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="mi">10000</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">networks</span> <span class="ow">in</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">network</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">network</span> <span class="p">}}</span> <span class="n">area</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">area</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Выражение <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">ospf</span></code> работает так же, как в Python: если переменная
существует и не пустая, результат будет True. Если переменной нет или
она пустая, результат будет False.</p>
<p>То есть, в этом шаблоне конфигурация OSPF генерируется только в том
случае, если переменная ospf существует и не пустая.</p>
<p>Конфигурация будет генерироваться с двумя вариантами данных.</p>
<p>Сначала с файлом data_files/if.yml, в котором нет переменной ospf:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">name</span><span class="p">:</span> <span class="n">R3</span>
<span class="n">vlans</span><span class="p">:</span>
  <span class="mi">10</span><span class="p">:</span> <span class="n">Marketing</span>
  <span class="mi">20</span><span class="p">:</span> <span class="n">Voice</span>
  <span class="mi">30</span><span class="p">:</span> <span class="n">Management</span>
</pre></div>
</div>
<p>Результат будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/if.txt data_files/if.yml

hostname R3

interface Loopback0
 ip address 10.0.0.3 255.255.255.255

vlan 10
 name Marketing
vlan 20
 name Voice
vlan 30
 name Management
</pre></div>
</div>
<p>Теперь аналогичный шаблон, но с файлом data_files/if_ospf.yml:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">id</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">name</span><span class="p">:</span> <span class="n">R3</span>
<span class="n">vlans</span><span class="p">:</span>
  <span class="mi">10</span><span class="p">:</span> <span class="n">Marketing</span>
  <span class="mi">20</span><span class="p">:</span> <span class="n">Voice</span>
  <span class="mi">30</span><span class="p">:</span> <span class="n">Management</span>
<span class="n">ospf</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">2</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Теперь результат выполнения будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostname</span> <span class="n">R3</span>

<span class="n">interface</span> <span class="n">Loopback0</span>
 <span class="n">ip</span> <span class="n">address</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span>

<span class="n">vlan</span> <span class="mi">10</span>
 <span class="n">name</span> <span class="n">Marketing</span>
<span class="n">vlan</span> <span class="mi">20</span>
 <span class="n">name</span> <span class="n">Voice</span>
<span class="n">vlan</span> <span class="mi">30</span>
 <span class="n">name</span> <span class="n">Management</span>

<span class="n">router</span> <span class="n">ospf</span> <span class="mi">1</span>
 <span class="n">router</span><span class="o">-</span><span class="nb">id</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="mi">10000</span>
 <span class="n">network</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span> <span class="n">area</span> <span class="mi">0</span>
 <span class="n">network</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span> <span class="n">area</span> <span class="mi">2</span>
 <span class="n">network</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span> <span class="n">area</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Как и в Python, в Jinja можно делать ответвления в условии.</p>
<p>Пример шаблона templates/if_vlans.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">intf</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">trunks</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>
<span class="n">interface</span> <span class="p">{{</span> <span class="n">intf</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">add</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">remove</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Файл data_files/if_vlans.yml с данными:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trunks</span><span class="p">:</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">add</span>
    <span class="n">vlans</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span><span class="mi">20</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">only</span>
    <span class="n">vlans</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span><span class="mi">30</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">delete</span>
    <span class="n">vlans</span><span class="p">:</span> <span class="mi">10</span>
</pre></div>
</div>
<p>В данном примере в зависимости от значения параметра action генерируются
разные команды.</p>
<p>В шаблоне можно было использовать и такой вариант обращения к вложенным
словарям:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">intf</span> <span class="ow">in</span> <span class="n">trunks</span> <span class="o">%</span><span class="p">}</span>
<span class="n">interface</span> <span class="p">{{</span> <span class="n">intf</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">trunks</span><span class="p">[</span><span class="n">intf</span><span class="p">][</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">add</span> <span class="p">{{</span> <span class="n">trunks</span><span class="p">[</span><span class="n">intf</span><span class="p">][</span><span class="s1">&#39;vlans&#39;</span><span class="p">]</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">elif</span> <span class="n">trunks</span><span class="p">[</span><span class="n">intf</span><span class="p">][</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">remove</span> <span class="p">{{</span> <span class="n">trunks</span><span class="p">[</span><span class="n">intf</span><span class="p">][</span><span class="s1">&#39;vlans&#39;</span><span class="p">]</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="p">{{</span> <span class="n">trunks</span><span class="p">[</span><span class="n">intf</span><span class="p">][</span><span class="s1">&#39;vlans&#39;</span><span class="p">]</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>В итоге будет сгенерирована такая конфигурация:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/if_vlans.txt data_files/if_vlans.yml
interface Fa0/1
 switchport trunk allowed vlan add 10,20
interface Fa0/3
 switchport trunk allowed vlan remove 10
interface Fa0/2
 switchport trunk allowed vlan 10,30
</pre></div>
</div>
<p>Также с помощью if можно фильтровать, по каким элементам
последовательности пройдется цикл for.</p>
<p>Пример шаблона templates/if_for.txt с фильтром в цикле for:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">vlans</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">vlan</span> <span class="o">&gt;</span> <span class="mi">15</span> <span class="o">%</span><span class="p">}</span>
<span class="n">vlan</span> <span class="p">{{</span> <span class="n">vlan</span> <span class="p">}}</span>
 <span class="n">name</span> <span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Файл с данными (data_files/if_for.yml):</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vlans</span><span class="p">:</span>
  <span class="mi">10</span><span class="p">:</span> <span class="n">Marketing</span>
  <span class="mi">20</span><span class="p">:</span> <span class="n">Voice</span>
  <span class="mi">30</span><span class="p">:</span> <span class="n">Management</span>
</pre></div>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/if_for.txt data_files/if_for.yml
vlan 20
 name Voice
vlan 30
 name Management
</pre></div>
</div>
</div>
<span id="document-book/20_jinja2/syntax_filter"></span><div class="section" id="id1">
<h5>Фильтры<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>В Jinja переменные можно изменять с помощью фильтров. Фильтры отделяются
от переменной вертикальной чертой (pipe <code class="docutils literal notranslate"><span class="pre">|</span></code>) и могут содержать
дополнительные аргументы.</p>
<p>Кроме того, к переменной могут быть применены несколько фильтров. В
таком случае фильтры просто пишутся последовательно, и каждый из них
отделен вертикальной чертой.</p>
<p>Jinja поддерживает большое количество встроенных фильтров. Мы рассмотрим
лишь несколько из них. Остальные фильтры можно найти в
<a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/#builtin-filters">документации</a>.</p>
<p>Также достаточно легко можно создавать и свои собственные фильтры. Мы не
будем рассматривать эту возможность, но это хорошо описано в
<a class="reference external" href="http://jinja.pocoo.org/docs/2.9/api/#custom-filters">документации</a>.</p>
<div class="section" id="default">
<h6>default<a class="headerlink" href="#default" title="Ссылка на этот заголовок">¶</a></h6>
<p>Фильтр default позволяет указать для переменной значение по умолчанию.
Если переменная определена, будет выводиться переменная, если переменная
не определена, будет выводиться значение, которое указано в фильтре
default.</p>
<p>Пример шаблона templates/filter_default.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">ospf</span> <span class="mi">1</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="p">{{</span> <span class="n">ref_bw</span> <span class="o">|</span> <span class="n">default</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">networks</span> <span class="ow">in</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">network</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">network</span> <span class="p">}}</span> <span class="n">area</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">area</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Если переменная ref_bw определена в словаре, будет подставлено её
значение. Если же переменной нет, будет подставлено значение 10000.</p>
<p>Файл с данными (data_files/filter_default.yml):</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ospf</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">2</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/filter_default.txt data_files/filter_default.yml
router ospf 1
 auto-cost reference-bandwidth 10000
 network 10.0.1.0 0.0.0.255 area 0
 network 10.0.2.0 0.0.0.255 area 2
 network 10.1.1.0 0.0.0.255 area 0
</pre></div>
</div>
<p>По умолчанию, если переменная определена и её значение пустой объект,
будет считаться, что переменная и её значение есть.</p>
<p>Если нужно сделать так, чтобы значение по умолчанию подставлялось и в
том случае, когда переменная пустая (то есть, обрабатывается как False в
Python), надо указать дополнительный параметр <code class="docutils literal notranslate"><span class="pre">boolean=true</span></code>.</p>
<p>Например, если файл данных был бы таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ref_bw</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
<span class="n">ospf</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">2</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>То в итоге сгенерировался такой результат:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/filter_default.txt data_files/filter_default.yml
router ospf 1
 auto-cost reference-bandwidth
 network 10.0.1.0 0.0.0.255 area 0
 network 10.0.2.0 0.0.0.255 area 2
 network 10.1.1.0 0.0.0.255 area 0
</pre></div>
</div>
<p>Если же при таком же файле данных изменить шаблон таким образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">ospf</span> <span class="mi">1</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="p">{{</span> <span class="n">ref_bw</span> <span class="o">|</span> <span class="n">default</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">boolean</span><span class="o">=</span><span class="n">true</span><span class="p">)</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">networks</span> <span class="ow">in</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">network</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">network</span> <span class="p">}}</span> <span class="n">area</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">area</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Вместо <code class="docutils literal notranslate"><span class="pre">default(10000,</span> <span class="pre">boolean=true)</span></code> можно написать
default(10000, true)</p>
</div>
<p>Результат уже будет таким (значение по умолчанию подставится):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/filter_default.txt data_files/filter_default.yml
router ospf 1
 auto-cost reference-bandwidth 10000
 network 10.0.1.0 0.0.0.255 area 0
 network 10.0.2.0 0.0.0.255 area 2
 network 10.1.1.0 0.0.0.255 area 0
</pre></div>
</div>
</div>
<div class="section" id="dictsort">
<h6>dictsort<a class="headerlink" href="#dictsort" title="Ссылка на этот заголовок">¶</a></h6>
<p>Фильтр dictsort позволяет сортировать словарь. По умолчанию сортировка
выполняется по ключам, но, изменив параметры фильтра, можно выполнять
сортировку по значениям.</p>
<p>Синтаксис фильтра:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dictsort</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>После того, как dictsort отсортировал словарь, он возвращает список
кортежей, а не словарь.</p>
<p>Пример шаблона templates/filter_dictsort.txt с использованием фильтра
dictsort:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">intf</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">trunks</span> <span class="o">|</span> <span class="n">dictsort</span> <span class="o">%</span><span class="p">}</span>
<span class="n">interface</span> <span class="p">{{</span> <span class="n">intf</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">add</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">remove</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Обратите внимание, что фильтр ожидает словарь, а не список кортежей
или итератор.</p>
<p>Файл с данными (data_files/filter_dictsort.yml):</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trunks</span><span class="p">:</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">only</span>
    <span class="n">vlans</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span><span class="mi">30</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">delete</span>
    <span class="n">vlans</span><span class="p">:</span> <span class="mi">10</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">add</span>
    <span class="n">vlans</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span><span class="mi">20</span>
</pre></div>
</div>
<p>Результат выполнения будет таким (интерфейсы упорядочены):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/filter_dictsort.txt data_files/filter_dictsort.yml
interface Fa0/1
 switchport trunk allowed vlan add 10,20
interface Fa0/2
 switchport trunk allowed vlan 10,30
interface Fa0/3
 switchport trunk allowed vlan remove 10
</pre></div>
</div>
</div>
<div class="section" id="join">
<h6>join<a class="headerlink" href="#join" title="Ссылка на этот заголовок">¶</a></h6>
<p>Фильтр join работает так же, как и метод join в Python.</p>
<p>С помощью фильтра join можно объединять элементы последовательности в
строку с опциональным разделителем между элементами.</p>
<p>Пример шаблона templates/filter_join.txt с использованием фильтра join:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">intf</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">trunks</span> <span class="o">|</span> <span class="n">dictsort</span> <span class="o">%</span><span class="p">}</span>
<span class="n">interface</span> <span class="p">{{</span> <span class="n">intf</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">add</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="o">|</span> <span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">remove</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="o">|</span> <span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="o">|</span> <span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Файл с данными (data_files/filter_join.yml):</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trunks</span><span class="p">:</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">add</span>
    <span class="n">vlans</span><span class="p">:</span>
      <span class="o">-</span> <span class="mi">10</span>
      <span class="o">-</span> <span class="mi">20</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">only</span>
    <span class="n">vlans</span><span class="p">:</span>
      <span class="o">-</span> <span class="mi">10</span>
      <span class="o">-</span> <span class="mi">30</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">delete</span>
    <span class="n">vlans</span><span class="p">:</span>
      <span class="o">-</span> <span class="mi">10</span>
</pre></div>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/filter_join.txt data_files/filter_join.yml
interface Fa0/1
 switchport trunk allowed vlan add 10,20
interface Fa0/2
 switchport trunk allowed vlan 10,30
interface Fa0/3
 switchport trunk allowed vlan remove 10
</pre></div>
</div>
</div>
</div>
<span id="document-book/20_jinja2/syntax_test"></span><div class="section" id="id1">
<h5>Тесты<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Кроме фильтров, Jinja также поддерживает тесты. Тесты позволяют
проверять переменные на какое-то условие.</p>
<p>Jinja поддерживает большое количество встроенных тестов. Мы рассмотрим
лишь несколько из них. Остальные тесты вы можете найти в
<a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/#builtin-tests">документации</a>.</p>
<p>Тесты, как и фильтры, можно создавать самостоятельно.</p>
<div class="section" id="defined">
<h6>defined<a class="headerlink" href="#defined" title="Ссылка на этот заголовок">¶</a></h6>
<p>Тест defined позволяет проверить, есть ли переменная в словаре данных.</p>
<p>Пример шаблона templates/test_defined.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">ospf</span> <span class="mi">1</span>
<span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">ref_bw</span> <span class="ow">is</span> <span class="n">defined</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="p">{{</span> <span class="n">ref_bw</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="mi">10000</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">networks</span> <span class="ow">in</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">network</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">network</span> <span class="p">}}</span> <span class="n">area</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">area</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Этот пример более громоздкий, чем вариант с использованием фильтра
default, но этот тест может быть полезен в том случае, если, в
зависимости от того, определена переменная или нет, нужно выполнять
разные команды.</p>
<p>Файл с данными (data_files/test_defined.yml):</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ospf</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">2</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/test_defined.txt data_files/test_defined.yml
router ospf 1
 auto-cost reference-bandwidth 10000
 network 10.0.1.0 0.0.0.255 area 0
 network 10.0.2.0 0.0.0.255 area 2
 network 10.1.1.0 0.0.0.255 area 0
</pre></div>
</div>
</div>
<div class="section" id="iterable">
<h6>iterable<a class="headerlink" href="#iterable" title="Ссылка на этот заголовок">¶</a></h6>
<p>Тест iterable проверяет, является ли объект итератором.</p>
<p>Благодаря таким проверкам, можно делать ответвления в шаблоне, которые
будут учитывать тип переменной.</p>
<p>Шаблон templates/test_iterable.txt (сделаны отступы, чтобы были
понятней ответвления):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">intf</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">trunks</span> <span class="o">|</span> <span class="n">dictsort</span> <span class="o">%</span><span class="p">}</span>
<span class="n">interface</span> <span class="p">{{</span> <span class="n">intf</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="ow">is</span> <span class="n">iterable</span> <span class="o">%</span><span class="p">}</span>
   <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">add</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="o">|</span> <span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">}}</span>
   <span class="p">{</span><span class="o">%</span> <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">remove</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="o">|</span> <span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">}}</span>
   <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="o">|</span> <span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">}}</span>
   <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
   <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">add</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="p">}}</span>
   <span class="p">{</span><span class="o">%</span> <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">remove</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="p">}}</span>
   <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="p">{{</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="p">}}</span>
   <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Файл с данными (data_files/test_iterable.yml):</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trunks</span><span class="p">:</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">add</span>
    <span class="n">vlans</span><span class="p">:</span>
      <span class="o">-</span> <span class="mi">10</span>
      <span class="o">-</span> <span class="mi">20</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">only</span>
    <span class="n">vlans</span><span class="p">:</span>
      <span class="o">-</span> <span class="mi">10</span>
      <span class="o">-</span> <span class="mi">30</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">delete</span>
    <span class="n">vlans</span><span class="p">:</span> <span class="mi">10</span>
</pre></div>
</div>
<p>Обратите внимание на последнюю строку: <code class="docutils literal notranslate"><span class="pre">vlans:</span> <span class="pre">10</span></code>. В данном случае 10
уже не находится в списке, и фильтр join в таком случае не работает. Но,
за счет теста <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">iterable</span></code> (в этом случае результат будет false), в
этом случае шаблон уходит в ветку else.</p>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/test_iterable.txt data_files/test_iterable.yml
interface Fa0/1
 switchport trunk allowed vlan add 10,20
interface Fa0/2
 switchport trunk allowed vlan 10,30
interface Fa0/3
 switchport trunk allowed vlan remove 10
</pre></div>
</div>
<p>Такие отступы получились из-за того, что в шаблоне используются
отступы, но не установлено lstrip_blocks=True (он удаляет пробелы и
табы в начале строки).</p>
</div>
</div>
<span id="document-book/20_jinja2/assignments"></span><div class="section" id="set">
<h5>set<a class="headerlink" href="#set" title="Ссылка на этот заголовок">¶</a></h5>
<p>Внутри шаблона можно присваивать значения переменным. Это могут быть
новые переменные, а могут быть измененные значения переменных, которые
были переданы шаблону.</p>
<p>Таким образом можно запомнить значение, которое, например, было получено
в результате применения нескольких фильтров. И в дальнейшем использовать
имя переменной, а не повторять снова все фильтры.</p>
<p>Пример шаблона templates/set.txt, в котором выражение set используется,
чтобы задать более короткие имена параметрам:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">intf</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">trunks</span> <span class="o">|</span> <span class="n">dictsort</span> <span class="o">%</span><span class="p">}</span>
 <span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">vlans</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="o">%</span><span class="p">}</span>
 <span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">action</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">%</span><span class="p">}</span>

<span class="n">interface</span> <span class="p">{{</span> <span class="n">intf</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">vlans</span> <span class="ow">is</span> <span class="n">iterable</span> <span class="o">%</span><span class="p">}</span>
  <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">add</span> <span class="p">{{</span> <span class="n">vlans</span> <span class="o">|</span> <span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">}}</span>
  <span class="p">{</span><span class="o">%</span> <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">remove</span> <span class="p">{{</span> <span class="n">vlans</span> <span class="o">|</span> <span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">}}</span>
  <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="p">{{</span> <span class="n">vlans</span> <span class="o">|</span> <span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">}}</span>
  <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
  <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">add</span> <span class="p">{{</span> <span class="n">vlans</span> <span class="p">}}</span>
  <span class="p">{</span><span class="o">%</span> <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">remove</span> <span class="p">{{</span> <span class="n">vlans</span> <span class="p">}}</span>
  <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="p">{{</span> <span class="n">vlans</span> <span class="p">}}</span>
  <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Обратите внимание на вторую и третью строки:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">vlans</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">vlans</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="n">action</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">action</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Таким образом создаются новые переменные, и дальше используются уже эти
новые значения. Так шаблон выглядит понятней.</p>
<p>Файл с данными (data_files/set.yml):</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trunks</span><span class="p">:</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">add</span>
    <span class="n">vlans</span><span class="p">:</span>
      <span class="o">-</span> <span class="mi">10</span>
      <span class="o">-</span> <span class="mi">20</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">only</span>
    <span class="n">vlans</span><span class="p">:</span>
      <span class="o">-</span> <span class="mi">10</span>
      <span class="o">-</span> <span class="mi">30</span>
  <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">delete</span>
    <span class="n">vlans</span><span class="p">:</span> <span class="mi">10</span>
</pre></div>
</div>
<p>Результат выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/set.txt data_files/set.yml

interface Fa0/1
 switchport trunk allowed vlan add 10,20

interface Fa0/2
 switchport trunk allowed vlan 10,30

interface Fa0/3
 switchport trunk allowed vlan remove 10
</pre></div>
</div>
</div>
<span id="document-book/20_jinja2/include"></span><div class="section" id="include">
<h5>include<a class="headerlink" href="#include" title="Ссылка на этот заголовок">¶</a></h5>
<p>Выражение include позволяет добавить один шаблон в другой.</p>
<p>Переменные, которые передаются как данные, должны содержать все данные и
для основного шаблона, и для того, который добавлен через include.</p>
<p>Шаблон templates/vlans.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">vlans</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">%</span><span class="p">}</span>
<span class="n">vlan</span> <span class="p">{{</span> <span class="n">vlan</span> <span class="p">}}</span>
 <span class="n">name</span> <span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Шаблон templates/ospf.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">ospf</span> <span class="mi">1</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="mi">10000</span>
<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">networks</span> <span class="ow">in</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">network</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">network</span> <span class="p">}}</span> <span class="n">area</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">area</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Шаблон templates/bgp.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">bgp</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">ibgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ibgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">local_as</span> <span class="p">}}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ibgp</span> <span class="p">}}</span> <span class="n">update</span><span class="o">-</span><span class="n">source</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">loopback</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">ebgp</span> <span class="ow">in</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ebgp_neighbors</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">neighbor</span> <span class="p">{{</span> <span class="n">ebgp</span> <span class="p">}}</span> <span class="n">remote</span><span class="o">-</span><span class="k">as</span> <span class="p">{{</span> <span class="n">bgp</span><span class="o">.</span><span class="n">ebgp_neighbors</span><span class="p">[</span><span class="n">ebgp</span><span class="p">]</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Шаблон templates/switch.txt использует созданные шаблоны ospf и vlans:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s1">&#39;vlans.txt&#39;</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s1">&#39;ospf.txt&#39;</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Файл с данными для генерации конфигурации (data_files/switch.yml):</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vlans</span><span class="p">:</span>
  <span class="mi">10</span><span class="p">:</span> <span class="n">Marketing</span>
  <span class="mi">20</span><span class="p">:</span> <span class="n">Voice</span>
  <span class="mi">30</span><span class="p">:</span> <span class="n">Management</span>
<span class="n">ospf</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">2</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Результат выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/switch.txt data_files/switch.yml
vlan 10
 name Marketing
vlan 20
 name Voice
vlan 30
 name Management

router ospf 1
 auto-cost reference-bandwidth 10000
 network 10.0.1.0 0.0.0.255 area 0
 network 10.0.2.0 0.0.0.255 area 2
 network 10.1.1.0 0.0.0.255 area 0
</pre></div>
</div>
<p>Итоговая конфигурация получилась такой, как будто строки из шаблонов
ospf.txt и vlans.txt находились в шаблоне switch.txt.</p>
<p>Шаблон templates/router.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s1">&#39;ospf.txt&#39;</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s1">&#39;bgp.txt&#39;</span> <span class="o">%</span><span class="p">}</span>

<span class="n">logging</span> <span class="p">{{</span> <span class="n">log_server</span> <span class="p">}}</span>
</pre></div>
</div>
<p>В данном случае кроме include добавлена ещё одна строка в шаблон, чтобы
показать, что выражения include могут идти вперемешку с обычным
шаблоном.</p>
<p>Файл с данными (data_files/router.yml):</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ospf</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">2</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">bgp</span><span class="p">:</span>
  <span class="n">local_as</span><span class="p">:</span> <span class="mi">100</span>
  <span class="n">loopback</span><span class="p">:</span> <span class="n">lo100</span>
  <span class="n">ibgp_neighbors</span><span class="p">:</span>
    <span class="o">-</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span>
    <span class="o">-</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span>
  <span class="n">ebgp_neighbors</span><span class="p">:</span>
    <span class="mf">90.1</span><span class="o">.</span><span class="mf">1.1</span><span class="p">:</span> <span class="mi">500</span>
    <span class="mf">80.1</span><span class="o">.</span><span class="mf">1.1</span><span class="p">:</span> <span class="mi">600</span>
<span class="n">log_server</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>
</pre></div>
</div>
<p>Результат выполнения скрипта будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/router.txt data_files/router.yml
router ospf 1
 auto-cost reference-bandwidth 10000
 network 10.0.1.0 0.0.0.255 area 0
 network 10.0.2.0 0.0.0.255 area 2
 network 10.1.1.0 0.0.0.255 area 0

router bgp 100
 neighbor 10.0.0.2 remote-as 100
 neighbor 10.0.0.2 update-source lo100
 neighbor 10.0.0.3 remote-as 100
 neighbor 10.0.0.3 update-source lo100
 neighbor 90.1.1.1 remote-as 500
 neighbor 80.1.1.1 remote-as 600

logging 10.1.1.1
</pre></div>
</div>
<p>Благодаря include, шаблон templates/ospf.txt используется и в шаблоне
templates/switch.txt, и в шаблоне templates/router.txt, вместо того,
чтобы повторять одно и то же дважды.</p>
</div>
</div>
</div>
<span id="document-book/20_jinja2/template_inheritance"></span><div class="section" id="id1">
<h4>Наследование шаблонов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Наследование шаблонов - это очень мощный функционал, который позволяет
избежать повторения одного и того же в разных шаблонах.</p>
<p>При использовании наследования различают:</p>
<ul class="simple">
<li><strong>базовый шаблон</strong> - это шаблон, в котором описывается каркас шаблона.</li>
<li>в этом шаблоне могут находиться любые обычные выражения или текст.
Кроме того, в этом шаблоне определяются специальные <strong>блоки (block)</strong>.</li>
<li><strong>дочерний шаблон</strong> - шаблон, который расширяет базовый шаблон, заполняя
обозначенные блоки.</li>
<li>дочерние шаблоны могут переписывать или дополнять
блоки, определенные в базовом шаблоне.</li>
</ul>
<p>Пример базового шаблона templates/base_router.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!
{% block services %}
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
{% endblock %}
!
no ip domain lookup
!
ip ssh version 2
!
{% block ospf %}
router ospf 1
 auto-cost reference-bandwidth 10000
{% endblock %}
!
{% block bgp %}
{% endblock %}
!
{% block alias %}
{% endblock %}
!
line con 0
 logging synchronous
 history size 100
line vty 0 4
 logging synchronous
 history size 100
 transport input ssh
!
</pre></div>
</div>
<p>Обратите внимание на четыре блока, которые созданы в шаблоне:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{% block services %}
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
{% endblock %}
!
{% block ospf %}
router ospf 1
 auto-cost reference-bandwidth 10000
{% endblock %}
!
{% block bgp %}
{% endblock %}
!
{% block alias %}
{% endblock %}
</pre></div>
</div>
<p>Это заготовки для соответствующих разделов конфигурации. Дочерний
шаблон, который будет использовать этот базовый шаблон как основу, может
заполнять все блоки или только какие-то из них.</p>
<p>Дочерний шаблон templates/hq_router.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">extends</span> <span class="s2">&quot;base_router.txt&quot;</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{{</span> <span class="nb">super</span><span class="p">()</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">networks</span> <span class="ow">in</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">network</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">network</span> <span class="p">}}</span> <span class="n">area</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">area</span> <span class="p">}}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">alias</span> <span class="o">%</span><span class="p">}</span>
<span class="n">alias</span> <span class="n">configure</span> <span class="n">sh</span> <span class="n">do</span> <span class="n">sh</span>
<span class="n">alias</span> <span class="n">exec</span> <span class="n">ospf</span> <span class="n">sh</span> <span class="n">run</span> <span class="o">|</span> <span class="n">s</span> <span class="o">^</span><span class="n">router</span> <span class="n">ospf</span>
<span class="n">alias</span> <span class="n">exec</span> <span class="n">bri</span> <span class="n">show</span> <span class="n">ip</span> <span class="nb">int</span> <span class="n">bri</span> <span class="o">|</span> <span class="n">exc</span> <span class="n">unass</span>
<span class="n">alias</span> <span class="n">exec</span> <span class="nb">id</span> <span class="n">show</span> <span class="nb">int</span> <span class="n">desc</span>
<span class="n">alias</span> <span class="n">exec</span> <span class="n">top</span> <span class="n">sh</span> <span class="n">proc</span> <span class="n">cpu</span> <span class="nb">sorted</span> <span class="o">|</span> <span class="n">excl</span> <span class="mf">0.00</span><span class="o">%</span><span class="n">__0</span><span class="o">.</span><span class="mi">00</span><span class="o">%</span><span class="n">__0</span><span class="o">.</span><span class="mi">00</span><span class="o">%</span>
<span class="n">alias</span> <span class="n">exec</span> <span class="n">c</span> <span class="n">conf</span> <span class="n">t</span>
<span class="n">alias</span> <span class="n">exec</span> <span class="n">diff</span> <span class="n">sh</span> <span class="n">archive</span> <span class="n">config</span> <span class="n">differences</span> <span class="n">nvram</span><span class="p">:</span><span class="n">startup</span><span class="o">-</span><span class="n">config</span> <span class="n">system</span><span class="p">:</span><span class="n">running</span><span class="o">-</span><span class="n">config</span>
<span class="n">alias</span> <span class="n">exec</span> <span class="n">desc</span> <span class="n">sh</span> <span class="nb">int</span> <span class="n">desc</span> <span class="o">|</span> <span class="n">ex</span> <span class="n">down</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Первая строка в шаблоне templates/hq_router.txt очень важна:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">extends</span> <span class="s2">&quot;base_router.txt&quot;</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Именно она говорит о том, что шаблон hq_router.txt будет построен на
основе шаблона base_router.txt.</p>
<p>Внутри дочернего шаблона всё происходит внутри блоков. За счет блоков,
которые были определены в базовом шаблоне, дочерний шаблон может
расширять родительский шаблон.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Обратите внимание, что те строки, которые описаны в дочернем шаблоне
за пределами блоков, игнорируются.</p>
</div>
<p>В базовом шаблоне четыре блока: services, ospf, bgp, alias. В дочернем
шаблоне заполнены только два из них: ospf и alias.
В этом удобство наследования. Не обязательно заполнять все блоки в
каждом дочернем шаблоне.</p>
<p>При этом блоки ospf и alias используются по-разному. В базовом шаблоне в
блоке ospf уже была часть конфигурации:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
<span class="n">router</span> <span class="n">ospf</span> <span class="mi">1</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="mi">10000</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Поэтому, в дочернем шаблоне есть выбор: использовать эту конфигурацию и
дополнить её, или полностью переписать всё в дочернем шаблоне.</p>
<p>В данном случае конфигурация дополняется. Именно поэтому в дочернем
шаблоне templates/hq_router.txt блок ospf начинается с выражения
<code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{{</span> <span class="nb">super</span><span class="p">()</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">networks</span> <span class="ow">in</span> <span class="n">ospf</span> <span class="o">%</span><span class="p">}</span>
 <span class="n">network</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">network</span> <span class="p">}}</span> <span class="n">area</span> <span class="p">{{</span> <span class="n">networks</span><span class="o">.</span><span class="n">area</span> <span class="p">}}</span>
 <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></code> переносит в дочерний шаблон содержимое этого блока из
родительского шаблона. За счет этого в дочерний шаблон перенесутся
строки из родительского.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Выражение super не обязательно должно находиться в самом начале
блока. Оно может быть в любом месте блока. Содержимое базового
шаблона перенесется в то место, где находится выражение super.</p>
</div>
<p>В блоке alias просто описаны нужные alias. И, даже если бы в
родительском шаблоне были какие-то настройки, они были бы затерты
содержимым дочернего шаблона.</p>
<p>Подытожим правила работы с блоками. Если в родительском шаблоне создан
блок:</p>
<ul class="simple">
<li>без содержимого - в дочернем шаблоне можно заполнить этот блок
или игнорировать. Если блок заполнен, в нём будет только то, что было
написано в дочернем шаблоне (пример - блок alias)</li>
<li>с содержимым - то в дочернем шаблоне можно выполнить такие действия:<ul>
<li>игнорировать блок - в таком случае в дочерний шаблон попадет содержимое,
которое находилось в этом блоке в родительском шаблоне (пример - блок services)</li>
<li>переписать блок - тогда в дочернем шаблоне будет только то, что указано в нём</li>
<li>перенести содержимое блока из родительского шаблона и дополнить
его - тогда в дочернем шаблоне будет и содержимое блока из родительского
шаблона, и содержимое из дочернего шаблона. Для переноса содержимого из
родительского шаблона используется выражение <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></code> (пример - блок ospf)</li>
</ul>
</li>
</ul>
<p>Файл с данными для генерации конфигурации по шаблону
(data_files/hq_router.yml):</p>
<div class="code json highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ospf</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">2.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">2</span>
  <span class="o">-</span> <span class="n">network</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.255</span>
    <span class="n">area</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Результат выполнения будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python cfg_gen.py templates/hq_router.txt data_files/hq_router.yml
!
service timestamps debug datetime msec localtime show-timezone year
service timestamps log datetime msec localtime show-timezone year
service password-encryption
service sequence-numbers
!
no ip domain lookup
!
ip ssh version 2
!
router ospf 1
 auto-cost reference-bandwidth 10000

 network 10.0.1.0 0.0.0.255 area 0
 network 10.0.2.0 0.0.0.255 area 2
 network 10.1.1.0 0.0.0.255 area 0
!
!
alias configure sh do sh
alias exec ospf sh run | s ^router ospf
alias exec bri show ip int bri | exc unass
alias exec id show int desc
alias exec top sh proc cpu sorted | excl 0.00%__0.00%__0.00%
alias exec c conf t
alias exec diff sh archive config differences nvram:startup-config system:running-config
alias exec desc sh int desc | ex down
!
line con 0
 logging synchronous
 history size 100
line vty 0 4
 logging synchronous
 history size 100
 transport input ssh
!
</pre></div>
</div>
<p>Обратите внимание, что в блоке ospf есть и команды из базового шаблона,
и команды из дочернего шаблона.</p>
</div>
<span id="document-book/20_jinja2/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="http://jinja.pocoo.org/docs/2.9/">Общая документация Jinja2</a></li>
<li><a class="reference external" href="http://jinja.pocoo.org/docs/2.9/templates/">Синтаксис шаблонов</a></li>
</ul>
<p>Статьи:</p>
<ul class="simple">
<li><a class="reference external" href="https://oswalt.dev/2014/03/network-configuration-templates-using-jinja2/">Network Configuration Templates Using Jinja2. Matt Oswalt</a></li>
<li><a class="reference external" href="http://packetpushers.net/python-jinja2-tutorial/">Python And Jinja2 Tutorial. Jeremy Schulman</a></li>
<li><a class="reference external" href="https://codingnetworker.com/2015/09/configuration-generator-with-python-and-jinja2/">Configuration Generator with Python and Jinja2</a></li>
<li><a class="reference external" href="https://codingnetworker.com/2015/10/custom-filters-jinja2-config-generator/">Custom filters for a Jinja2 based Config Generator</a></li>
</ul>
</div>
<span id="document-exercises/20_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 20.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию generate_config.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>template - путь к файлу с шаблоном (например, «templates/for.txt»)</li>
<li>data_dict - словарь со значениями, которые надо подставить в шаблон</li>
</ul>
<p>Функция должна возвращать строку с конфигурацией, которая была сгенерирована.</p>
<p>Проверить работу функции на шаблоне templates/for.txt и данных из файла data_files/for.yml.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yaml</span>


<span class="c1"># так должен выглядеть вызов функции</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">data_file</span> <span class="o">=</span> <span class="s2">&quot;data_files/for.yml&quot;</span>
    <span class="n">template_file</span> <span class="o">=</span> <span class="s2">&quot;templates/for.txt&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">generate_config</span><span class="p">(</span><span class="n">template_file</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Задание 20.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать шаблон templates/cisco_router_base.txt.
В шаблон templates/cisco_router_base.txt должно быть включено содержимое шаблонов:</p>
<ul class="simple">
<li>templates/cisco_base.txt</li>
<li>templates/alias.txt</li>
<li>templates/eem_int_desc.txt</li>
</ul>
<p>При этом, нельзя копировать текст шаблонов.</p>
<p>Проверьте шаблон templates/cisco_router_base.txt, с помощью
функции generate_config из задания 20.1. Не копируйте код функции generate_config.</p>
<p>В качестве данных, используйте информацию из файла data_files/router_info.yml</p>
</div>
<div class="section" id="id4">
<h5>Задание 20.3<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создайте шаблон templates/ospf.txt на основе конфигурации OSPF в файле cisco_ospf.txt.
Пример конфигурации дан, чтобы показать синтаксис.</p>
<p>Шаблон надо создавать вручную, скопировав части конфига в соответствующий шаблон.</p>
<p>Какие значения должны быть переменными:</p>
<ul class="simple">
<li>номер процесса. Имя переменной - process</li>
<li>router-id. Имя переменной - router_id</li>
<li>reference-bandwidth. Имя переменной - ref_bw</li>
<li>интерфейсы, на которых нужно включить OSPF. Имя переменной - ospf_intf.
На месте этой переменной ожидается список словарей с такими ключами:<ul>
<li>name - имя интерфейса, вида Fa0/1, Vlan10, Gi0/0</li>
<li>ip - IP-адрес интерфейса, вида 10.0.1.1</li>
<li>area - номер зоны</li>
<li>passive - является ли интерфейс пассивным. Допустимые значения: True или False</li>
</ul>
</li>
</ul>
<p>Для всех интерфейсов в списке ospf_intf, надо сгенерировать строки:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">network</span> <span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">x</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="n">area</span> <span class="n">x</span>
</pre></div>
</div>
<p>Если интерфейс пассивный, для него должна быть добавлена строка:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">passive</span><span class="o">-</span><span class="n">interface</span> <span class="n">x</span>
</pre></div>
</div>
<p>Для интерфейсов, которые не являются пассивными, в режиме конфигурации интерфейса,
надо добавить строку:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">ospf</span> <span class="n">hello</span><span class="o">-</span><span class="n">interval</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Все команды должны быть в соответствующих режимах.</p>
<p>Проверьте получившийся шаблон templates/ospf.txt, на данных в файле data_files/ospf.yml,
с помощью функции generate_config из задания 20.1.
Не копируйте код функции generate_config.</p>
<p>В результате должна получиться конфигурация такого вида
(команды в режиме router ospf не обязательно должны быть в таком порядке, главное чтобы они были в нужном режиме):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span> <span class="n">ospf</span> <span class="mi">10</span>
 <span class="n">router</span><span class="o">-</span><span class="nb">id</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span>
 <span class="n">auto</span><span class="o">-</span><span class="n">cost</span> <span class="n">reference</span><span class="o">-</span><span class="n">bandwidth</span> <span class="mi">20000</span>
 <span class="n">network</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">0.1</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="n">area</span> <span class="mi">0</span>
 <span class="n">network</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="n">area</span> <span class="mi">0</span>
 <span class="n">network</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">2.1</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="n">area</span> <span class="mi">0</span>
 <span class="n">network</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">10.1</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="n">area</span> <span class="mi">2</span>
 <span class="n">network</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">20.1</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span> <span class="n">area</span> <span class="mi">2</span>
 <span class="n">passive</span><span class="o">-</span><span class="n">interface</span> <span class="n">Fa0</span><span class="o">/</span><span class="mf">0.10</span>
 <span class="n">passive</span><span class="o">-</span><span class="n">interface</span> <span class="n">Fa0</span><span class="o">/</span><span class="mf">0.20</span>
<span class="n">interface</span> <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span>
 <span class="n">ip</span> <span class="n">ospf</span> <span class="n">hello</span><span class="o">-</span><span class="n">interval</span> <span class="mi">1</span>
<span class="n">interface</span> <span class="n">Fa0</span><span class="o">/</span><span class="mf">1.100</span>
 <span class="n">ip</span> <span class="n">ospf</span> <span class="n">hello</span><span class="o">-</span><span class="n">interval</span> <span class="mi">1</span>
<span class="n">interface</span> <span class="n">Fa0</span><span class="o">/</span><span class="mf">1.200</span>
 <span class="n">ip</span> <span class="n">ospf</span> <span class="n">hello</span><span class="o">-</span><span class="n">interval</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Задание 20.4<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создайте шаблон templates/add_vlan_to_switch.txt, который будет использоваться
при необходимости добавить VLAN на коммутатор.</p>
<p>В шаблоне должны поддерживаться возможности:</p>
<ul class="simple">
<li>добавления VLAN и имени VLAN</li>
<li>добавления VLAN как access, на указанном интерфейсе</li>
<li>добавления VLAN в список разрешенных, на указанные транки</li>
</ul>
<p>Если VLAN необходимо добавить как access, надо настроить и режим интерфейса и добавить его в VLAN:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
 <span class="n">switchport</span> <span class="n">mode</span> <span class="n">access</span>
 <span class="n">switchport</span> <span class="n">access</span> <span class="n">vlan</span> <span class="mi">5</span>
</pre></div>
</div>
<p>Для транков, необходимо только добавить VLAN в список разрешенных:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span> <span class="n">Gi0</span><span class="o">/</span><span class="mi">10</span>
 <span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="n">add</span> <span class="mi">5</span>
</pre></div>
</div>
<p>Имена переменных надо выбрать на основании примера данных,
в файле data_files/add_vlan_to_switch.yaml.</p>
<p>Проверьте шаблон templates/add_vlan_to_switch.txt на данных в файле data_files/add_vlan_to_switch.yaml, с помощью функции generate_config из задания 20.1.
Не копируйте код функции generate_config.</p>
</div>
<div class="section" id="id6">
<h5>Задание 20.5<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать шаблоны templates/gre_ipsec_vpn_1.txt и templates/gre_ipsec_vpn_2.txt,
которые генерируют конфигурацию IPsec over GRE между двумя маршрутизаторами.</p>
<p>Шаблон templates/gre_ipsec_vpn_1.txt создает конфигурацию для одной стороны туннеля,
а templates/gre_ipsec_vpn_2.txt - для второй.</p>
<p>Примеры итоговой конфигурации, которая должна создаваться на основе шаблонов в файлах:
cisco_vpn_1.txt и cisco_vpn_2.txt.</p>
<p>Создать функцию create_vpn_config, которая использует эти шаблоны для генерации конфигурации VPN на основе данных в словаре data.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>template1 - имя файла с шаблоном, который создает конфигурацию для одной строны туннеля</li>
<li>template2 - имя файла с шаблоном, который создает конфигурацию для второй строны туннеля</li>
<li>data_dict - словарь со значениями, которые надо подставить в шаблоны</li>
</ul>
<p>Функция должна возвращать кортеж с двумя конфигурациямя (строки), которые получены на основе шаблонов.</p>
<p>Примеры конфигураций VPN, которые должна возвращать функция create_vpn_config в файлах
cisco_vpn_1.txt и cisco_vpn_2.txt.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tun_num&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;wan_ip_1&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wan_ip_2&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tun_ip_1&#39;</span><span class="p">:</span> <span class="s1">&#39;10.0.1.1 255.255.255.252&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tun_ip_2&#39;</span><span class="p">:</span> <span class="s1">&#39;10.0.1.2 255.255.255.252&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 20.5a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию configure_vpn, которая использует шаблоны из задания 20.5 для настройки VPN на маршрутизаторах на основе данных в словаре data.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>src_device_params - словарь с параметрами подключения к устройству</li>
<li>dst_device_params - словарь с параметрами подключения к устройству</li>
<li>src_template - имя файла с шаблоном, который создает конфигурацию для одной строны туннеля</li>
<li>dst_template - имя файла с шаблоном, который создает конфигурацию для второй строны туннеля</li>
<li>vpn_data_dict - словарь со значениями, которые надо подставить в шаблоны</li>
</ul>
<p>Функция должна настроить VPN на основе шаблонов и данных на каждом устройстве с помощью netmiko.
Функция возвращает вывод с набором команд с двух марушртизаторов (вывод, которые возвращает метод netmiko send_config_set).</p>
<p>При этом, в словаре data не указан номер интерфейса Tunnel, который надо использовать.
Номер надо определить самостоятельно на основе информации с оборудования.
Если на маршрутизаторе нет интерфейсов Tunnel, взять номер 0, если есть взять ближайший свободный номер, но одинаковый для двух маршрутизаторов.</p>
<p>Например, если на маршрутизаторе src такие интерфейсы: Tunnel1, Tunnel4.
А на маршрутизаторе dest такие: Tunnel2, Tunnel3, Tunnel8.
Первый свободный номер одинаковый для двух маршрутизаторов будет 5.
И надо будет настроить интерфейс Tunnel 5.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Для этого задания тест проверяет работу функции на первых двух устройствах
из файла devices.yaml. И проверяет, что в выводе есть команды настройки
интерфейсов, но при этом не проверяет настроенные номера тунелей и другие команды.
Они должны быть, но тест упрощен, чтобы было больше свободы выполнения.</p>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tun_num&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;wan_ip_1&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wan_ip_2&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tun_ip_1&#39;</span><span class="p">:</span> <span class="s1">&#39;10.0.1.1 255.255.255.252&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tun_ip_2&#39;</span><span class="p">:</span> <span class="s1">&#39;10.0.1.2 255.255.255.252&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/21_textfsm/index"></span><div class="section" id="textfsm">
<span id="textfsm-index"></span><h3>21. Обработка вывода команд TextFSM<a class="headerlink" href="#textfsm" title="Ссылка на этот заголовок">¶</a></h3>
<p>На оборудовании, которое не поддерживает какого-то программного
интерфейса, вывод команд show возвращается в виде строки. И, хотя
отчасти она структурирована, но всё же это просто строка. И её надо
как-то обработать, чтобы получить объекты Python, например, словарь или
список.</p>
<p>Например, можно построчно обрабатывать вывод команды и, используя,
например, регулярные выражения, получить объекты Python. Но есть более
удобный вариант, чем просто обрабатывать каждый вывод построчно:
TextFSM.</p>
<p>TextFSM - это библиотека, созданная Google для обработки вывода с
сетевых устройств. Она позволяет создавать шаблоны, по которым будет
обрабатываться вывод команды.</p>
<p>Использование TextFSM лучше, чем простая построчная обработка, так как
шаблоны дают лучшее представление о том, как вывод будет обрабатываться,
и шаблонами проще поделиться. А значит, проще найти уже созданные
шаблоны и использовать их, или поделиться своими.</p>
<div class="toctree-wrapper compound">
<span id="document-book/21_textfsm/README"></span><div class="section" id="textfsm">
<h4>Начало работы с TextFSM<a class="headerlink" href="#textfsm" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для начала библиотеку надо установить:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">textfsm</span>
</pre></div>
</div>
<p>Для использования TextFSM надо создать шаблон, по которому будет
обрабатываться вывод команды.</p>
<p>Пример вывода команды traceroute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r2</span><span class="c1">#traceroute 90.0.0.9 source 33.0.0.2</span>
<span class="n">traceroute</span> <span class="mf">90.0</span><span class="o">.</span><span class="mf">0.9</span> <span class="n">source</span> <span class="mf">33.0</span><span class="o">.</span><span class="mf">0.2</span>
<span class="n">Type</span> <span class="n">escape</span> <span class="n">sequence</span> <span class="n">to</span> <span class="n">abort</span><span class="o">.</span>
<span class="n">Tracing</span> <span class="n">the</span> <span class="n">route</span> <span class="n">to</span> <span class="mf">90.0</span><span class="o">.</span><span class="mf">0.9</span>
<span class="n">VRF</span> <span class="n">info</span><span class="p">:</span> <span class="p">(</span><span class="n">vrf</span> <span class="ow">in</span> <span class="n">name</span><span class="o">/</span><span class="nb">id</span><span class="p">,</span> <span class="n">vrf</span> <span class="n">out</span> <span class="n">name</span><span class="o">/</span><span class="nb">id</span><span class="p">)</span>
  <span class="mi">1</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.1</span> <span class="mi">1</span> <span class="n">msec</span> <span class="mi">0</span> <span class="n">msec</span> <span class="mi">0</span> <span class="n">msec</span>
  <span class="mi">2</span> <span class="mf">15.0</span><span class="o">.</span><span class="mf">0.5</span>  <span class="mi">0</span> <span class="n">msec</span> <span class="mi">5</span> <span class="n">msec</span> <span class="mi">4</span> <span class="n">msec</span>
  <span class="mi">3</span> <span class="mf">57.0</span><span class="o">.</span><span class="mf">0.7</span>  <span class="mi">4</span> <span class="n">msec</span> <span class="mi">1</span> <span class="n">msec</span> <span class="mi">4</span> <span class="n">msec</span>
  <span class="mi">4</span> <span class="mf">79.0</span><span class="o">.</span><span class="mf">0.9</span>  <span class="mi">4</span> <span class="n">msec</span> <span class="o">*</span>  <span class="mi">1</span> <span class="n">msec</span>
</pre></div>
</div>
<p>Например, из вывода надо получить хопы, через которые прошел пакет.</p>
<p>В таком случае шаблон TextFSM будет выглядеть так (файл
traceroute.template):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value ID (\d+)
Value Hop (\d+(\.\d+){3})

Start
  ^  ${ID} ${Hop} -&gt; Record
</pre></div>
</div>
<p>Первые две строки определяют переменные:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Value</span> <span class="pre">ID</span> <span class="pre">(\d+)</span></code> - эта строка определяет переменную ID,
которая описывает регулярное выражение: <code class="docutils literal notranslate"><span class="pre">(\d+)</span></code> - одна или более цифр,
сюда попадут номера хопов</li>
<li><code class="docutils literal notranslate"><span class="pre">Value</span> <span class="pre">Hop</span> <span class="pre">(\d+(\.\d+){3})</span></code> - эта строка определяет переменную Hop,
которая описывает IP-адрес таким регулярным выражением: <code class="docutils literal notranslate"><span class="pre">(\d+(\.\d+){3})</span></code></li>
</ul>
<p>После строки Start начинается сам шаблон. В данном случае он очень
простой:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">^</span>&#160; <span class="pre">${ID}</span> <span class="pre">${Hop}</span> <span class="pre">-&gt;</span> <span class="pre">Record</span></code></li>
<li>сначала идет символ начала строки, затем два пробела и переменные ID и Hop</li>
<li>в TextFSM переменные описываются таким образом: <code class="docutils literal notranslate"><span class="pre">${имя</span> <span class="pre">переменной}</span></code></li>
<li>слово <code class="docutils literal notranslate"><span class="pre">Record</span></code> в конце означает, что строки, которые попадут под описанный шаблон, будут
обработаны и выведены в результаты TextFSM (с этим подробнее мы
разберемся в следующем разделе</li>
</ul>
<p>Скрипт для обработки вывода команды traceroute с помощью TextFSM
(parse_traceroute.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">textfsm</span>

<span class="n">traceroute</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">r2#traceroute 90.0.0.9 source 33.0.0.2</span>
<span class="s1">traceroute 90.0.0.9 source 33.0.0.2</span>
<span class="s1">Type escape sequence to abort.</span>
<span class="s1">Tracing the route to 90.0.0.9</span>
<span class="s1">VRF info: (vrf in name/id, vrf out name/id)</span>
<span class="s1">  1 10.0.12.1 1 msec 0 msec 0 msec</span>
<span class="s1">  2 15.0.0.5  0 msec 5 msec 4 msec</span>
<span class="s1">  3 57.0.0.7  4 msec 1 msec 4 msec</span>
<span class="s1">  4 79.0.0.9  4 msec *  1 msec</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;traceroute.template&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">template</span><span class="p">:</span>
    <span class="n">fsm</span> <span class="o">=</span> <span class="n">textfsm</span><span class="o">.</span><span class="n">TextFSM</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">fsm</span><span class="o">.</span><span class="n">ParseText</span><span class="p">(</span><span class="n">traceroute</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">fsm</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Результат выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_traceroute.py
[&#39;ID&#39;, &#39;Hop&#39;]
[[&#39;1&#39;, &#39;10.0.12.1&#39;], [&#39;2&#39;, &#39;15.0.0.5&#39;], [&#39;3&#39;, &#39;57.0.0.7&#39;], [&#39;4&#39;, &#39;79.0.0.9&#39;]]
</pre></div>
</div>
<p>Строки, которые совпали с описанным шаблоном, возвращаются в виде списка
списков. Каждый элемент - это список, который состоит из двух элементов:
номера хопа и IP-адреса.</p>
<p>Разберемся с содержимым скрипта:</p>
<ul class="simple">
<li>traceroute - это переменная, которая содержит вывод команды traceroute</li>
<li><code class="docutils literal notranslate"><span class="pre">template</span> <span class="pre">=</span> <span class="pre">open('traceroute.template')</span></code> - содержимое файла с шаблоном
TextFSM считывается в переменную template</li>
<li><code class="docutils literal notranslate"><span class="pre">fsm</span> <span class="pre">=</span> <span class="pre">textfsm.TextFSM(template)</span></code> - класс, который обрабатывает шаблон
и создает из него объект в TextFSM</li>
<li><code class="docutils literal notranslate"><span class="pre">result</span> <span class="pre">=</span> <span class="pre">fsm.ParseText(traceroute)</span></code> - метод, который обрабатывает
переданный вывод согласно шаблону и возвращает список списков, в котором
каждый элемент - это обработанная строка</li>
<li>В конце выводится заголовок: <code class="docutils literal notranslate"><span class="pre">print(fsm.header)</span></code>,
который содержит имена переменных и результат обработки</li>
</ul>
<p>С этим выводом можно работать дальше. Например, периодически выполнять
команду traceroute и сравнивать, изменилось ли количество хопов и их
порядок.</p>
<p>Для работы с TextFSM нужны вывод команды и шаблон:</p>
<ul class="simple">
<li>для разных команд нужны разные шаблоны</li>
<li>TextFSM возвращает результат обработки в табличном виде (в виде списка списков)</li>
<li>этот вывод легко преобразовать в csv формат или в список словарей</li>
</ul>
</div>
<span id="document-book/21_textfsm/textfsm_syntax"></span><div class="section" id="textfsm">
<h4>Синтаксис шаблонов TextFSM<a class="headerlink" href="#textfsm" title="Ссылка на этот заголовок">¶</a></h4>
<p>В этом разделе описан синтаксис шаблонов на основе документации TextFSM.
В следующем разделе показаны примеры использования синтаксиса. Поэтому,
в принципе, можно перейти сразу к следующему разделу, а к этому
возвращаться по необходимости, для тех ситуаций, для которых нет
примера, и когда нужно перечитать, что означает какой-то параметр.</p>
<p>Шаблон TextFSM описывает, каким образом данные должны обрабатываться.</p>
<p>Любой шаблон состоит из двух частей:</p>
<ul class="simple">
<li>определения переменных</li>
<li>эти переменные описывают, какие столбцы будут в табличном представлении</li>
<li>определения состояний</li>
</ul>
<p>Пример разбора команды traceroute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Определение переменных:
Value ID (\d+)
Value Hop (\d+(\.\d+){3})

# Секция с определением состояний всегда должна начинаться с состояния Start
Start
#     Переменные      действие
   ^  ${ID} ${Hop} -&gt; Record
</pre></div>
</div>
<div class="section" id="id1">
<h5>Определение переменных<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>В секции с переменными должны идти только определения переменных.
Единственное исключение - в этом разделе могут быть комментарии.</p>
<p>В этом разделе не должно быть пустых строк. Для TextFSM пустая строка
означает завершение секции определения переменных.</p>
<p>Формат описания переменных:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Value</span> <span class="p">[</span><span class="n">option</span><span class="p">[,</span><span class="n">option</span><span class="o">...</span><span class="p">]]</span> <span class="n">name</span> <span class="n">regex</span>
</pre></div>
</div>
<p>Синтаксис описания переменных (для каждой опции ниже мы рассмотрим
примеры):</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Value</span></code> - это ключевое слово, которое указывает, что
создается переменная. Его обязательно нужно указывать</li>
<li>option - опции, которые определяют, как работать с переменной.
Если нужно указать несколько опций, они должны быть отделены запятой,
без пробелов. Поддерживаются такие опции:<ul>
<li><strong>Filldown</strong> - значение, которое ранее
совпало с регулярным выражением, запоминается до следующей обработки
строки (если не было явно очищено или снова совпало регулярное выражение).
Это значит, что последнее значение столбца, которое
совпало с регулярным выражением, запоминается и используется в следующих
строках, если в них не присутствовал этот столбец.</li>
<li><strong>Key</strong> - определяет, что это поле содержит уникальный идентификатор строки</li>
<li><strong>Required</strong> - строка, которая обрабатывается, будет записана только в
том случае, если эта переменная присутствует.</li>
<li><strong>List</strong> - значение это список, и каждое совпадение с регулярным выражением будет добавлять
в список элемент. По умолчанию каждое следующее совпадение перезаписывает предыдущее.</li>
<li><strong>Fillup</strong> - работает как Filldown, но заполняет пустые значение выше до тех пор,
пока не найдет совпадение. Не совместимо с Required.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> - имя переменной, которое будет использоваться как имя колонки.
Зарезервированные имена не должны использоваться как имя переменной.</li>
<li><code class="docutils literal notranslate"><span class="pre">regex</span></code> - регулярное выражение, которое описывает переменную.
Регулярное выражение должно быть в скобках.</li>
</ul>
</div>
<div class="section" id="id2">
<h5>Определение состояний<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>После определения переменных нужно описать состояния:</p>
<ul class="simple">
<li>каждое определение состояния должно быть отделено пустой строкой (как минимум, одной)</li>
<li>первая строка - имя состояния</li>
<li>затем идут строки, которые описывают правила. Правила должны начинаться с двух пробелов и символа <code class="docutils literal notranslate"><span class="pre">^</span></code></li>
</ul>
<p>Начальное состояние всегда <strong>Start</strong>. Входные данные сравниваются с
текущим состоянием, но в строке правила может быть указано, что нужно
перейти к другому состоянию.</p>
<p>Проверка выполняется построчно, пока не будет достигнут <strong>EOF</strong> (конец
файла), или текущее состояние перейдет в состояние <strong>End</strong>.</p>
<div class="section" id="id3">
<h6>Зарезервированные состояния<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h6>
<p>Зарезервированы такие состояния:</p>
<ul class="simple">
<li><strong>Start</strong> - это состояние обязательно должно быть указано.
Без него шаблон не будет работать.</li>
<li><strong>End</strong> - это состояние завершает обработку входящих строк
и не выполняет состояние <strong>EOF</strong>.</li>
<li><strong>EOF</strong> - это неявное состояние, которое выполняется всегда,
когда обработка дошла до конца файла. Выглядит оно таким образом:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EOF</span>
  <span class="o">^.*</span> <span class="o">-&gt;</span> <span class="n">Record</span>
</pre></div>
</div>
<p><strong>EOF</strong> записывает текущую строку, прежде чем обработка завершается.
Если это поведение нужно изменить, надо явно в конце шаблона написать
EOF:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EOF</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id4">
<h4>Правила состояний<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Каждое состояние состоит из одного или более правил:</p>
<ul class="simple">
<li>TextFSM обрабатывает входящие строки и сравнивает их с правилами</li>
<li>если правило (регулярное выражение) совпадает со строкой, выполняются действия,
которые описаны в правиле, и для следующей строки процесс повторяется
заново, с начала состояния.</li>
</ul>
<p>Правила должны быть описаны в таком формате:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">^</span><span class="n">regex</span> <span class="p">[</span><span class="o">-&gt;</span> <span class="n">action</span><span class="p">]</span>
</pre></div>
</div>
<p>В правиле:</p>
<ul class="simple">
<li>каждое правило должно начинаться с двух пробелов и символа <code class="docutils literal notranslate"><span class="pre">^</span></code>. Символ <code class="docutils literal notranslate"><span class="pre">^</span></code>
означает начало строки и всегда должен указываться явно</li>
<li>regex - это регулярное выражение, в котором могут использоваться переменные<ul>
<li>для указания переменной,&nbsp;может использоваться синтаксис
<code class="docutils literal notranslate"><span class="pre">$ValueName</span></code> или <code class="docutils literal notranslate"><span class="pre">${ValueName}</span></code>(этот формат предпочтителен)</li>
<li>в правиле на место переменных подставляются регулярные выражения, которые
они описывают</li>
<li>если нужно явно указать символ конца строки, используется значение <code class="docutils literal notranslate"><span class="pre">$$</span></code></li>
</ul>
</li>
</ul>
<div class="section" id="id5">
<h5>Действия в правилах<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>После регулярного выражения в правиле могут указываться действия:</p>
<ul class="simple">
<li>между регулярным выражением и действием должен быть символ <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code></li>
<li>действия могут состоять из трех частей в таком формате: <strong>L.R S</strong><ul>
<li><strong>L - Line Action</strong> - действия, которые применяются к входящей строке</li>
<li><strong>R - Record Action</strong> - действия, которые применяются к собранным значениям</li>
<li><strong>S - State Transition</strong> - переход в другое состояние</li>
</ul>
</li>
<li>по умолчанию используется <strong>Next.NoRecord</strong></li>
</ul>
<div class="section" id="line-actions">
<h6>Line Actions<a class="headerlink" href="#line-actions" title="Ссылка на этот заголовок">¶</a></h6>
<p>Line Actions:</p>
<ul class="simple">
<li><strong>Next</strong> - обработать строку, прочитать следующую и
начать проверять её с начала состояния. Это действие используется по
умолчанию, если не указано другое</li>
<li><strong>Continue</strong> - продолжить обработку правил,
как будто совпадения не было, при этом значения присваиваются</li>
</ul>
</div>
<div class="section" id="record-action">
<h6>Record Action<a class="headerlink" href="#record-action" title="Ссылка на этот заголовок">¶</a></h6>
<p><strong>Record Action</strong> - опциональное действие, которое может быть указано
после Line Action. Они должны быть разделены точкой. Типы действий:</p>
<ul class="simple">
<li><strong>NoRecord</strong> - не выполнять ничего. Это действие по умолчанию,
когда другое не указано</li>
<li><strong>Record</strong> - запомнить значения, которые совпали с правилом.
Все переменные, кроме тех, где указана опция Filldown, обнуляются.</li>
<li><strong>Clear</strong> - обнулить все переменные, кроме тех, где указана опция Filldown.</li>
<li><strong>Clearall</strong> - обнулить все переменные.</li>
</ul>
<p>Разделять действия точкой нужно только в том случае, если нужно
указать и Line, и Record действия. Если нужно указать только одно из
них, точку ставить не нужно.</p>
</div>
<div class="section" id="state-transition">
<h6>State Transition<a class="headerlink" href="#state-transition" title="Ссылка на этот заголовок">¶</a></h6>
<p>После действия может быть указано новое состояние:</p>
<ul class="simple">
<li>состояние должно быть одним из зарезервированных или определенных в шаблоне</li>
<li>если входная строка совпала:<ul>
<li>все действия выполняются,</li>
<li>считывается следующая строка,</li>
<li>затем текущее состояние меняется на новое, и обработка продолжается в новом состоянии.</li>
</ul>
</li>
</ul>
<p>Если в правиле используется действие <strong>Continue</strong>, то в нём нельзя
использовать переход в другое состояние. Это правило нужно для того,
чтобы в последовательности состояний не было петель.</p>
</div>
<div class="section" id="error-action">
<h6>Error Action<a class="headerlink" href="#error-action" title="Ссылка на этот заголовок">¶</a></h6>
<p>Специальное действие <strong>Error</strong> останавливает всю обработку строк,
отбрасывает все строки, которые были собраны до сих пор, и возвращает
исключение.</p>
<p>Синтаксис этого действия такой:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">^</span><span class="n">regex</span> <span class="o">-&gt;</span> <span class="n">Error</span> <span class="p">[</span><span class="n">word</span><span class="o">|</span><span class="s2">&quot;string&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-book/21_textfsm/textfsm_examples"></span><div class="section" id="textfsm">
<h4>Примеры использования TextFSM<a class="headerlink" href="#textfsm" title="Ссылка на этот заголовок">¶</a></h4>
<p>В этом разделе рассматриваются примеры шаблонов и использования TextFSM.</p>
<p>Для обработки вывода команд по шаблону в разделе используется скрипт
parse_output.py. Он не привязан к конкретному шаблону и выводу: шаблон
и вывод команды будут передаваться как аргументы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textfsm</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="n">template</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">template</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
    <span class="n">re_table</span> <span class="o">=</span> <span class="n">textfsm</span><span class="o">.</span><span class="n">TextFSM</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">re_table</span><span class="o">.</span><span class="n">header</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">re_table</span><span class="o">.</span><span class="n">ParseText</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">))</span>
</pre></div>
</div>
<p>Пример запуска скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_output.py template command_output
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Модуль tabulate используется для отображения данных в табличном виде
(его нужно установить, если хотите использовать этот скрипт).
Аналогичный вывод можно было сделать и с помощью форматирования
строк, но с tabulate это сделать проще.</p>
</div>
<p>Обработка данных по шаблону всегда выполняется одинаково. Поэтому скрипт
будет одинаковый, только шаблон и данные будут отличаться.</p>
<p>Начиная с простого примера, разберемся с тем, как использовать TextFSM.</p>
<div class="section" id="show-clock">
<h5>show clock<a class="headerlink" href="#show-clock" title="Ссылка на этот заголовок">¶</a></h5>
<p>Первый пример - разбор вывода команды sh clock (файл
output/sh_clock.txt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">15</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">44.867</span> <span class="n">UTC</span> <span class="n">Sun</span> <span class="n">Nov</span> <span class="mi">13</span> <span class="mi">2016</span>
</pre></div>
</div>
<p>Для начала в шаблоне надо определить переменные:</p>
<ul class="simple">
<li>в начале каждой строки должно быть ключевое слово Value</li>
<li>каждая переменная определяет столбец в таблице</li>
<li>следующее слово - название переменной</li>
<li>после названия, в скобках - регулярное выражение, которое описывает значение переменной</li>
</ul>
<p>Определение переменных выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Value</span> <span class="n">Time</span> <span class="p">(</span><span class="o">..</span><span class="p">:</span><span class="o">..</span><span class="p">:</span><span class="o">..</span><span class="p">)</span>
<span class="n">Value</span> <span class="n">Timezone</span> <span class="p">(</span>\<span class="n">S</span><span class="o">+</span><span class="p">)</span>
<span class="n">Value</span> <span class="n">WeekDay</span> <span class="p">(</span>\<span class="n">w</span><span class="o">+</span><span class="p">)</span>
<span class="n">Value</span> <span class="n">Month</span> <span class="p">(</span>\<span class="n">w</span><span class="o">+</span><span class="p">)</span>
<span class="n">Value</span> <span class="n">MonthDay</span> <span class="p">(</span>\<span class="n">d</span><span class="o">+</span><span class="p">)</span>
<span class="n">Value</span> <span class="n">Year</span> <span class="p">(</span>\<span class="n">d</span><span class="o">+</span><span class="p">)</span>
</pre></div>
</div>
<p>Подсказка по спецсимволам:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">.</span></code> - любой символ</li>
<li><code class="docutils literal notranslate"><span class="pre">+</span></code> - одно или более повторений предыдущего символа</li>
<li><code class="docutils literal notranslate"><span class="pre">\S</span></code> - все символы, кроме whitespace</li>
<li><code class="docutils literal notranslate"><span class="pre">\w</span></code> - любая буква или цифра</li>
<li><code class="docutils literal notranslate"><span class="pre">\d</span></code> - любая цифра</li>
</ul>
<p>После определения переменных должна идти пустая строка и состояние
<strong>Start</strong>, а после, начиная с пробела и символа <code class="docutils literal notranslate"><span class="pre">^</span></code>, идет правило
(файл templates/sh_clock.template):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value Time (..:..:..)
Value Timezone (\S+)
Value WeekDay (\w+)
Value Month (\w+)
Value MonthDay (\d+)
Value Year (\d+)

Start
  ^${Time}.* ${Timezone} ${WeekDay} ${Month} ${MonthDay} ${Year} -&gt; Record
</pre></div>
</div>
<p>Так как в данном случае в выводе всего одна строка, можно не писать
в шаблоне действие Record. Но лучше его использовать в ситуациях,
когда надо записать значения, чтобы привыкать к этому синтаксису и
не ошибиться, когда нужна обработка нескольких строк.</p>
<p>Когда TextFSM обрабатывает строки вывода, он подставляет вместо
переменных их значения. В итоге правило будет выглядеть так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">^</span><span class="p">(</span><span class="o">..</span><span class="p">:</span><span class="o">..</span><span class="p">:</span><span class="o">..</span><span class="p">)</span><span class="o">.*</span> <span class="p">(</span>\<span class="n">S</span><span class="o">+</span><span class="p">)</span> <span class="p">(</span>\<span class="n">w</span><span class="o">+</span><span class="p">)</span> <span class="p">(</span>\<span class="n">w</span><span class="o">+</span><span class="p">)</span> <span class="p">(</span>\<span class="n">d</span><span class="o">+</span><span class="p">)</span> <span class="p">(</span>\<span class="n">d</span><span class="o">+</span><span class="p">)</span>
</pre></div>
</div>
<p>Когда это регулярное выражение применяется к выводу show clock, в каждой
группе регулярного выражения будет находиться соответствующее значение:</p>
<ul class="simple">
<li>1 группа: 15:10:44</li>
<li>2 группа: UTC</li>
<li>3 группа: Sun</li>
<li>4 группа: Nov</li>
<li>5 группа: 13</li>
<li>6 группа: 2016</li>
</ul>
<p>В правиле, кроме явного действия Record, которое указывает, что запись
надо поместить в финальную таблицу, по умолчанию также используется
правило Next. Оно указывает, что надо перейти к следующей строке текста.
Так как в выводе команды sh clock только одна строка, обработка
завершается.</p>
<p>Результат отработки скрипта будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_output.py templates/sh_clock.template output/sh_clock.txt
Time      Timezone    WeekDay    Month      MonthDay    Year
--------  ----------  ---------  -------  ----------  ------
15:10:44  UTC         Sun        Nov              13    2016
</pre></div>
</div>
</div>
<div class="section" id="show-ip-interface-brief">
<h5>show ip interface brief<a class="headerlink" href="#show-ip-interface-brief" title="Ссылка на этот заголовок">¶</a></h5>
<p>В случае, когда нужно обработать данные, которые выведены столбцами,
шаблон TextFSM наиболее удобен.</p>
<p>Шаблон для вывода команды show ip interface brief (файл
templates/sh_ip_int_br.template):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value INTF (\S+)
Value ADDR (\S+)
Value STATUS (up|down|administratively down)
Value PROTO (up|down)

Start
  ^${INTF}\s+${ADDR}\s+\w+\s+\w+\s+${STATUS}\s+${PROTO} -&gt; Record
</pre></div>
</div>
<p>В этом случае правило можно описать одной строкой.</p>
<p>Вывод команды (файл output/sh_ip_int_br.txt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>R1#show ip interface brief
Interface                  IP-Address      OK? Method Status                Protocol
FastEthernet0/0            15.0.15.1       YES manual up                    up
FastEthernet0/1            10.0.12.1       YES manual up                    up
FastEthernet0/2            10.0.13.1       YES manual up                    up
FastEthernet0/3            unassigned      YES unset  up                    up
Loopback0                  10.1.1.1        YES manual up                    up
Loopback100                100.0.0.1       YES manual up                    up
</pre></div>
</div>
<p>Результат выполнения будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_output.py templates/sh_ip_int_br.template output/sh_ip_int_br.txt
INT              ADDR        STATUS    PROTO
---------------  ----------  --------  -------
FastEthernet0/0  15.0.15.1   up        up
FastEthernet0/1  10.0.12.1   up        up
FastEthernet0/2  10.0.13.1   up        up
FastEthernet0/3  unassigned  up        up
Loopback0        10.1.1.1    up        up
Loopback100      100.0.0.1   up        up
</pre></div>
</div>
</div>
<div class="section" id="show-cdp-neighbors-detail">
<h5>show cdp neighbors detail<a class="headerlink" href="#show-cdp-neighbors-detail" title="Ссылка на этот заголовок">¶</a></h5>
<p>Теперь попробуем обработать вывод команды show cdp neighbors detail.</p>
<p>Особенность этой команды в том, что данные находятся не в одной строке,
а в разных.</p>
<p>В файле output/sh_cdp_n_det.txt находится вывод команды show cdp
neighbors detail:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SW1</span><span class="c1">#show cdp neighbors detail</span>
<span class="o">-------------------------</span>
<span class="n">Device</span> <span class="n">ID</span><span class="p">:</span> <span class="n">SW2</span>
<span class="n">Entry</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.2</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">cisco</span> <span class="n">WS</span><span class="o">-</span><span class="n">C2960</span><span class="o">-</span><span class="mi">8</span><span class="n">TC</span><span class="o">-</span><span class="n">L</span><span class="p">,</span>  <span class="n">Capabilities</span><span class="p">:</span> <span class="n">Switch</span> <span class="n">IGMP</span>
<span class="n">Interface</span><span class="p">:</span> <span class="n">GigabitEthernet1</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span>  <span class="n">Port</span> <span class="n">ID</span> <span class="p">(</span><span class="n">outgoing</span> <span class="n">port</span><span class="p">):</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Holdtime</span> <span class="p">:</span> <span class="mi">164</span> <span class="n">sec</span>

<span class="n">Version</span> <span class="p">:</span>
<span class="n">Cisco</span> <span class="n">IOS</span> <span class="n">Software</span><span class="p">,</span> <span class="n">C2960</span> <span class="n">Software</span> <span class="p">(</span><span class="n">C2960</span><span class="o">-</span><span class="n">LANBASEK9</span><span class="o">-</span><span class="n">M</span><span class="p">),</span> <span class="n">Version</span> <span class="mf">12.2</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span><span class="n">SE9</span><span class="p">,</span> <span class="n">RELEASE</span> <span class="n">SOFTWARE</span> <span class="p">(</span><span class="n">fc1</span><span class="p">)</span>
<span class="n">Technical</span> <span class="n">Support</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">cisco</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">techsupport</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">1986</span><span class="o">-</span><span class="mi">2014</span> <span class="n">by</span> <span class="n">Cisco</span> <span class="n">Systems</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span>
<span class="n">Compiled</span> <span class="n">Mon</span> <span class="mi">03</span><span class="o">-</span><span class="n">Mar</span><span class="o">-</span><span class="mi">14</span> <span class="mi">22</span><span class="p">:</span><span class="mi">53</span> <span class="n">by</span> <span class="n">prod_rel_team</span>

<span class="n">advertisement</span> <span class="n">version</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">VTP</span> <span class="n">Management</span> <span class="n">Domain</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
<span class="n">Native</span> <span class="n">VLAN</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Duplex</span><span class="p">:</span> <span class="n">full</span>
<span class="n">Management</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.2</span>

<span class="o">-------------------------</span>
<span class="n">Device</span> <span class="n">ID</span><span class="p">:</span> <span class="n">R1</span>
<span class="n">Entry</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span><span class="p">:</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">Cisco</span> <span class="mi">3825</span><span class="p">,</span>  <span class="n">Capabilities</span><span class="p">:</span> <span class="n">Router</span> <span class="n">Switch</span> <span class="n">IGMP</span>
<span class="n">Interface</span><span class="p">:</span> <span class="n">GigabitEthernet1</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">22</span><span class="p">,</span>  <span class="n">Port</span> <span class="n">ID</span> <span class="p">(</span><span class="n">outgoing</span> <span class="n">port</span><span class="p">):</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Holdtime</span> <span class="p">:</span> <span class="mi">156</span> <span class="n">sec</span>

<span class="n">Version</span> <span class="p">:</span>
<span class="n">Cisco</span> <span class="n">IOS</span> <span class="n">Software</span><span class="p">,</span> <span class="mi">3800</span> <span class="n">Software</span> <span class="p">(</span><span class="n">C3825</span><span class="o">-</span><span class="n">ADVENTERPRISEK9</span><span class="o">-</span><span class="n">M</span><span class="p">),</span> <span class="n">Version</span> <span class="mf">12.4</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="n">T1</span><span class="p">,</span> <span class="n">RELEASE</span> <span class="n">SOFTWARE</span> <span class="p">(</span><span class="n">fc3</span><span class="p">)</span>
<span class="n">Technical</span> <span class="n">Support</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">cisco</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">techsupport</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">1986</span><span class="o">-</span><span class="mi">2009</span> <span class="n">by</span> <span class="n">Cisco</span> <span class="n">Systems</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span>
<span class="n">Compiled</span> <span class="n">Fri</span> <span class="mi">19</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">09</span> <span class="mi">18</span><span class="p">:</span><span class="mi">40</span> <span class="n">by</span> <span class="n">prod_rel_team</span>

<span class="n">advertisement</span> <span class="n">version</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">VTP</span> <span class="n">Management</span> <span class="n">Domain</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
<span class="n">Duplex</span><span class="p">:</span> <span class="n">full</span>
<span class="n">Management</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>

<span class="o">-------------------------</span>
<span class="n">Device</span> <span class="n">ID</span><span class="p">:</span> <span class="n">R2</span>
<span class="n">Entry</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
  <span class="n">IP</span> <span class="n">address</span><span class="p">:</span> <span class="mf">10.2</span><span class="o">.</span><span class="mf">2.2</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">Cisco</span> <span class="mi">2911</span><span class="p">,</span>  <span class="n">Capabilities</span><span class="p">:</span> <span class="n">Router</span> <span class="n">Switch</span> <span class="n">IGMP</span>
<span class="n">Interface</span><span class="p">:</span> <span class="n">GigabitEthernet1</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">21</span><span class="p">,</span>  <span class="n">Port</span> <span class="n">ID</span> <span class="p">(</span><span class="n">outgoing</span> <span class="n">port</span><span class="p">):</span> <span class="n">GigabitEthernet0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Holdtime</span> <span class="p">:</span> <span class="mi">156</span> <span class="n">sec</span>

<span class="n">Version</span> <span class="p">:</span>
<span class="n">Cisco</span> <span class="n">IOS</span> <span class="n">Software</span><span class="p">,</span> <span class="mi">2900</span> <span class="n">Software</span> <span class="p">(</span><span class="n">C3825</span><span class="o">-</span><span class="n">ADVENTERPRISEK9</span><span class="o">-</span><span class="n">M</span><span class="p">),</span> <span class="n">Version</span> <span class="mf">15.2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="n">T1</span><span class="p">,</span> <span class="n">RELEASE</span> <span class="n">SOFTWARE</span> <span class="p">(</span><span class="n">fc3</span><span class="p">)</span>
<span class="n">Technical</span> <span class="n">Support</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">cisco</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">techsupport</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">1986</span><span class="o">-</span><span class="mi">2009</span> <span class="n">by</span> <span class="n">Cisco</span> <span class="n">Systems</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span>
<span class="n">Compiled</span> <span class="n">Fri</span> <span class="mi">19</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">09</span> <span class="mi">18</span><span class="p">:</span><span class="mi">40</span> <span class="n">by</span> <span class="n">prod_rel_team</span>

<span class="n">advertisement</span> <span class="n">version</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">VTP</span> <span class="n">Management</span> <span class="n">Domain</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
<span class="n">Duplex</span><span class="p">:</span> <span class="n">full</span>
<span class="n">Management</span> <span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">):</span>
</pre></div>
</div>
<p>Из вывода команды надо получить такие поля:</p>
<ul class="simple">
<li>LOCAL_HOST - имя устройства из приглашения</li>
<li>DEST_HOST - имя соседа</li>
<li>MGMNT_IP - IP-адрес соседа</li>
<li>PLATFORM - модель соседнего устройства</li>
<li>LOCAL_PORT - локальный интерфейс, который соединен с соседом</li>
<li>REMOTE_PORT - порт соседнего устройства</li>
<li>IOS_VERSION - версия IOS соседа</li>
</ul>
<p>Шаблон выглядит таким образом (файл templates/sh_cdp_n_det.template):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value LOCAL_HOST (\S+)
Value DEST_HOST (\S+)
Value MGMNT_IP (.*)
Value PLATFORM (.*)
Value LOCAL_PORT (.*)
Value REMOTE_PORT (.*)
Value IOS_VERSION (\S+)

Start
  ^${LOCAL_HOST}[&gt;#].
  ^Device ID: ${DEST_HOST}
  ^.*IP address: ${MGMNT_IP}
  ^Platform: ${PLATFORM},
  ^Interface: ${LOCAL_PORT},  Port ID \(outgoing port\): ${REMOTE_PORT}
  ^.*Version ${IOS_VERSION},
</pre></div>
</div>
<p>Результат выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_output.py templates/sh_cdp_n_det.template output/sh_cdp_n_det.txt
LOCAL_HOST    DEST_HOST    MGMNT_IP    PLATFORM    LOCAL_PORT             REMOTE_PORT         IOS_VERSION
------------  -----------  ----------  ----------  ---------------------  ------------------  -------------
SW1           R2           10.2.2.2    Cisco 2911  GigabitEthernet1/0/21  GigabitEthernet0/0  15.2(2)T1
</pre></div>
</div>
<p>Несмотря на то, что правила с переменными описаны в разных строках, и,
соответственно, работают с разными строками, TextFSM собирает их в одну
строку таблицы. То есть, переменные, которые определены в начале
шаблона, задают строку итоговой таблицы.</p>
<p>Обратите внимание, что в файле sh_cdp_n_det.txt находится вывод с
тремя соседями, а в таблице только один сосед, последний.</p>
<div class="section" id="record">
<h6>Record<a class="headerlink" href="#record" title="Ссылка на этот заголовок">¶</a></h6>
<p>Так получилось из-за того, что в шаблоне не указано действие <strong>Record</strong>.
И в итоге в финальной таблице осталась только последняя строка.</p>
<p>Исправленный шаблон:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value LOCAL_HOST (\S+)
Value DEST_HOST (\S+)
Value MGMNT_IP (.*)
Value PLATFORM (.*)
Value LOCAL_PORT (.*)
Value REMOTE_PORT (.*)
Value IOS_VERSION (\S+)

Start
  ^${LOCAL_HOST}[&gt;#].
  ^Device ID: ${DEST_HOST}
  ^.*IP address: ${MGMNT_IP}
  ^Platform: ${PLATFORM},
  ^Interface: ${LOCAL_PORT},  Port ID \(outgoing port\): ${REMOTE_PORT}
  ^.*Version ${IOS_VERSION}, -&gt; Record
</pre></div>
</div>
<p>Теперь результат запуска скрипта выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_output.py templates/sh_cdp_n_det.template output/sh_cdp_n_det.txt
LOCAL_HOST    DEST_HOST    MGMNT_IP    PLATFORM              LOCAL_PORT             REMOTE_PORT         IOS_VERSION
------------  -----------  ----------  --------------------  ---------------------  ------------------  -------------
SW1           SW2          10.1.1.2    cisco WS-C2960-8TC-L  GigabitEthernet1/0/16  GigabitEthernet0/1  12.2(55)SE9
              R1           10.1.1.1    Cisco 3825            GigabitEthernet1/0/22  GigabitEthernet0/0  12.4(24)T1
              R2           10.2.2.2    Cisco 2911            GigabitEthernet1/0/21  GigabitEthernet0/0  15.2(2)T1
</pre></div>
</div>
<p>Вывод получен со всех трёх устройств. Но переменная LOCAL_HOST
отображается не в каждой строке, а только в первой.</p>
</div>
<div class="section" id="filldown">
<h6>Filldown<a class="headerlink" href="#filldown" title="Ссылка на этот заголовок">¶</a></h6>
<p>Это связано с тем, что приглашение, из которого взято значение
переменной, появляется только один раз. И для того, чтобы оно появлялось
и в последующих строках, надо использовать действие <strong>Filldown</strong> для
переменной LOCAL_HOST:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value Filldown LOCAL_HOST (\S+)
Value DEST_HOST (\S+)
Value MGMNT_IP (.*)
Value PLATFORM (.*)
Value LOCAL_PORT (.*)
Value REMOTE_PORT (.*)
Value IOS_VERSION (\S+)

Start
  ^${LOCAL_HOST}[&gt;#].
  ^Device ID: ${DEST_HOST}
  ^.*IP address: ${MGMNT_IP}
  ^Platform: ${PLATFORM},
  ^Interface: ${LOCAL_PORT},  Port ID \(outgoing port\): ${REMOTE_PORT}
  ^.*Version ${IOS_VERSION}, -&gt; Record
</pre></div>
</div>
<p>Теперь мы получили такой вывод:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_output.py templates/sh_cdp_n_det.template output/sh_cdp_n_det.txt
LOCAL_HOST    DEST_HOST    MGMNT_IP    PLATFORM              LOCAL_PORT             REMOTE_PORT         IOS_VERSION
------------  -----------  ----------  --------------------  ---------------------  ------------------  -------------
SW1           SW2          10.1.1.2    cisco WS-C2960-8TC-L  GigabitEthernet1/0/16  GigabitEthernet0/1  12.2(55)SE9
SW1           R1           10.1.1.1    Cisco 3825            GigabitEthernet1/0/22  GigabitEthernet0/0  12.4(24)T1
SW1           R2           10.2.2.2    Cisco 2911            GigabitEthernet1/0/21  GigabitEthernet0/0  15.2(2)T1
SW1
</pre></div>
</div>
<p>Теперь значение переменной LOCAL_HOST появилось во всех трёх строках.
Но появился ещё один странный эффект - последняя строка, в которой
заполнена только колонка LOCAL_HOST.</p>
</div>
<div class="section" id="required">
<h6>Required<a class="headerlink" href="#required" title="Ссылка на этот заголовок">¶</a></h6>
<p>Дело в том, что все переменные, которые мы определили, опциональны. К
тому же, одна переменная с параметром Filldown. И, чтобы избавиться от
последней строки, нужно сделать хотя бы одну переменную обязательной с
помощью параметра <strong>Required</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value Filldown LOCAL_HOST (\S+)
Value Required DEST_HOST (\S+)
Value MGMNT_IP (.*)
Value PLATFORM (.*)
Value LOCAL_PORT (.*)
Value REMOTE_PORT (.*)
Value IOS_VERSION (\S+)

Start
  ^${LOCAL_HOST}[&gt;#].
  ^Device ID: ${DEST_HOST}
  ^.*IP address: ${MGMNT_IP}
  ^Platform: ${PLATFORM},
  ^Interface: ${LOCAL_PORT},  Port ID \(outgoing port\): ${REMOTE_PORT}
  ^.*Version ${IOS_VERSION}, -&gt; Record
</pre></div>
</div>
<p>Теперь мы получим корректный вывод:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_output.py templates/sh_cdp_n_det.template output/sh_cdp_n_det.txt
LOCAL_HOST    DEST_HOST    MGMNT_IP    PLATFORM              LOCAL_PORT             REMOTE_PORT         IOS_VERSION
------------  -----------  ----------  --------------------  ---------------------  ------------------  -------------
SW1           SW2          10.1.1.2    cisco WS-C2960-8TC-L  GigabitEthernet1/0/16  GigabitEthernet0/1  12.2(55)SE9
SW1           R1           10.1.1.1    Cisco 3825            GigabitEthernet1/0/22  GigabitEthernet0/0  12.4(24)T1
SW1           R2           10.2.2.2    Cisco 2911            GigabitEthernet1/0/21  GigabitEthernet0/0  15.2(2)T1
</pre></div>
</div>
</div>
</div>
<div class="section" id="show-ip-route-ospf">
<h5>show ip route ospf<a class="headerlink" href="#show-ip-route-ospf" title="Ссылка на этот заголовок">¶</a></h5>
<p>Рассмотрим случай, когда нам нужно обработать вывод команды show ip
route ospf, и в таблице маршрутизации есть несколько маршрутов к одной
сети.</p>
<p>Для маршрутов к одной и той же сети вместо нескольких строк, где будет
повторяться сеть, будет создана одна запись, в которой все доступные
next-hop адреса собраны в список.</p>
<p>Пример вывода команды show ip route ospf (файл
output/sh_ip_route_ospf.txt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R1</span><span class="c1">#sh ip route ospf</span>
<span class="n">Codes</span><span class="p">:</span> <span class="n">L</span> <span class="o">-</span> <span class="n">local</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">connected</span><span class="p">,</span> <span class="n">S</span> <span class="o">-</span> <span class="n">static</span><span class="p">,</span> <span class="n">R</span> <span class="o">-</span> <span class="n">RIP</span><span class="p">,</span> <span class="n">M</span> <span class="o">-</span> <span class="n">mobile</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">BGP</span>
       <span class="n">D</span> <span class="o">-</span> <span class="n">EIGRP</span><span class="p">,</span> <span class="n">EX</span> <span class="o">-</span> <span class="n">EIGRP</span> <span class="n">external</span><span class="p">,</span> <span class="n">O</span> <span class="o">-</span> <span class="n">OSPF</span><span class="p">,</span> <span class="n">IA</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">inter</span> <span class="n">area</span>
       <span class="n">N1</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">NSSA</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N2</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">NSSA</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">2</span>
       <span class="n">E1</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">1</span><span class="p">,</span> <span class="n">E2</span> <span class="o">-</span> <span class="n">OSPF</span> <span class="n">external</span> <span class="nb">type</span> <span class="mi">2</span>
       <span class="n">i</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span><span class="p">,</span> <span class="n">su</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span> <span class="n">summary</span><span class="p">,</span> <span class="n">L1</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span> <span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">L2</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span> <span class="n">level</span><span class="o">-</span><span class="mi">2</span>
       <span class="n">ia</span> <span class="o">-</span> <span class="n">IS</span><span class="o">-</span><span class="n">IS</span> <span class="n">inter</span> <span class="n">area</span><span class="p">,</span> <span class="o">*</span> <span class="o">-</span> <span class="n">candidate</span> <span class="n">default</span><span class="p">,</span> <span class="n">U</span> <span class="o">-</span> <span class="n">per</span><span class="o">-</span><span class="n">user</span> <span class="n">static</span> <span class="n">route</span>
       <span class="n">o</span> <span class="o">-</span> <span class="n">ODR</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">periodic</span> <span class="n">downloaded</span> <span class="n">static</span> <span class="n">route</span><span class="p">,</span> <span class="n">H</span> <span class="o">-</span> <span class="n">NHRP</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="n">LISP</span>
       <span class="o">+</span> <span class="o">-</span> <span class="n">replicated</span> <span class="n">route</span><span class="p">,</span> <span class="o">%</span> <span class="o">-</span> <span class="nb">next</span> <span class="n">hop</span> <span class="n">override</span>

<span class="n">Gateway</span> <span class="n">of</span> <span class="n">last</span> <span class="n">resort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span>

      <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">8</span> <span class="ow">is</span> <span class="n">variably</span> <span class="n">subnetted</span><span class="p">,</span> <span class="mi">10</span> <span class="n">subnets</span><span class="p">,</span> <span class="mi">2</span> <span class="n">masks</span>
<span class="n">O</span>        <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">24</span> <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">20</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">O</span>        <span class="mf">10.2</span><span class="o">.</span><span class="mf">2.0</span><span class="o">/</span><span class="mi">24</span> <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">20</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span>
<span class="n">O</span>        <span class="mf">10.3</span><span class="o">.</span><span class="mf">3.3</span><span class="o">/</span><span class="mi">32</span> <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">11</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="n">O</span>        <span class="mf">10.4</span><span class="o">.</span><span class="mf">4.4</span><span class="o">/</span><span class="mi">32</span> <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">11</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span>
                     <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">11</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">14.4</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">3</span>
<span class="n">O</span>        <span class="mf">10.5</span><span class="o">.</span><span class="mf">5.5</span><span class="o">/</span><span class="mi">32</span> <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">21</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span>
                     <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">21</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">1</span>
                     <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">21</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">14.4</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">3</span>
<span class="n">O</span>        <span class="mf">10.6</span><span class="o">.</span><span class="mf">6.0</span><span class="o">/</span><span class="mi">24</span> <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">20</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span>
</pre></div>
</div>
<p>Для этого примера упрощаем задачу и считаем, что маршруты могут быть
только OSPF и с обозначением только O (то есть, только
внутризональные маршруты).</p>
<p>Первая версия шаблона выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value network (\S+)
Value mask (\d+)
Value distance (\d+)
Value metric (\d+)
Value nexthop (\S+)

Start
  ^O +${network}/${mask}\s\[${distance}/${metric}\]\svia\s${nexthop}, -&gt; Record
</pre></div>
</div>
<p>Результат получился такой:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">network</span>      <span class="n">mask</span>    <span class="n">distance</span>    <span class="n">metric</span>  <span class="n">nexthop</span>
<span class="o">---------</span>  <span class="o">------</span>  <span class="o">----------</span>  <span class="o">--------</span>  <span class="o">---------</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span>       <span class="mi">24</span>         <span class="mi">110</span>        <span class="mi">20</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span>
<span class="mf">10.2</span><span class="o">.</span><span class="mf">2.0</span>       <span class="mi">24</span>         <span class="mi">110</span>        <span class="mi">20</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
<span class="mf">10.3</span><span class="o">.</span><span class="mf">3.3</span>       <span class="mi">32</span>         <span class="mi">110</span>        <span class="mi">11</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span>
<span class="mf">10.4</span><span class="o">.</span><span class="mf">4.4</span>       <span class="mi">32</span>         <span class="mi">110</span>        <span class="mi">11</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
<span class="mf">10.5</span><span class="o">.</span><span class="mf">5.5</span>       <span class="mi">32</span>         <span class="mi">110</span>        <span class="mi">21</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
<span class="mf">10.6</span><span class="o">.</span><span class="mf">6.0</span>       <span class="mi">24</span>         <span class="mi">110</span>        <span class="mi">20</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
</pre></div>
</div>
<p>Всё нормально, но потерялись варианты путей для маршрутов 10.4.4.4/32 и 10.5.5.5/32.
Это логично, ведь нет правила, которое подошло бы для такой строки.</p>
<p>Добавляем в шаблон правило для строк с частичными записями:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value network (\S+)
Value mask (\d+)
Value distance (\d+)
Value metric (\d+)
Value nexthop (\S+)

Start
  ^O +${network}/${mask}\s\[${distance}/${metric}\]\svia\s${nexthop}, -&gt; Record
  ^\s+\[${distance}/${metric}\]\svia\s${nexthop}, -&gt; Record
</pre></div>
</div>
<p>Теперь вывод выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">network</span>    <span class="n">mask</span>      <span class="n">distance</span>    <span class="n">metric</span>  <span class="n">nexthop</span>
<span class="o">---------</span>  <span class="o">------</span>  <span class="o">----------</span>  <span class="o">--------</span>  <span class="o">---------</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span>   <span class="mi">24</span>             <span class="mi">110</span>        <span class="mi">20</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span>
<span class="mf">10.2</span><span class="o">.</span><span class="mf">2.0</span>   <span class="mi">24</span>             <span class="mi">110</span>        <span class="mi">20</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
<span class="mf">10.3</span><span class="o">.</span><span class="mf">3.3</span>   <span class="mi">32</span>             <span class="mi">110</span>        <span class="mi">11</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span>
<span class="mf">10.4</span><span class="o">.</span><span class="mf">4.4</span>   <span class="mi">32</span>             <span class="mi">110</span>        <span class="mi">11</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
                          <span class="mi">110</span>        <span class="mi">11</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">14.4</span>
<span class="mf">10.5</span><span class="o">.</span><span class="mf">5.5</span>   <span class="mi">32</span>             <span class="mi">110</span>        <span class="mi">21</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
                          <span class="mi">110</span>        <span class="mi">21</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span>
                          <span class="mi">110</span>        <span class="mi">21</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">14.4</span>
<span class="mf">10.6</span><span class="o">.</span><span class="mf">6.0</span>   <span class="mi">24</span>             <span class="mi">110</span>        <span class="mi">20</span>  <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
</pre></div>
</div>
<p>В частичных записях нехватает сети и маски, но в предыдущих примерах мы уже рассматривали Filldown и, при желании, его можно применить тут, но для этого примера будет использоваться другая опция - List.</p>
<div class="section" id="list">
<h6>List<a class="headerlink" href="#list" title="Ссылка на этот заголовок">¶</a></h6>
<p>Воспользуемся опцией <strong>List</strong> для переменной nexthop:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value network (\S+)
Value mask (\d+)
Value distance (\d+)
Value metric (\d+)
Value List nexthop (\S+)

Start
  ^O +${network}/${mask}\s\[${distance}/${metric}\]\svia\s${nexthop}, -&gt; Record
  ^\s+\[${distance}/${metric}\]\svia\s${nexthop}, -&gt; Record
</pre></div>
</div>
<p>Теперь вывод получился таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">network</span>    <span class="n">mask</span>      <span class="n">distance</span>    <span class="n">metric</span>  <span class="n">nexthop</span>
<span class="o">---------</span>  <span class="o">------</span>  <span class="o">----------</span>  <span class="o">--------</span>  <span class="o">-------------</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span>   <span class="mi">24</span>             <span class="mi">110</span>        <span class="mi">20</span>  <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">]</span>
<span class="mf">10.2</span><span class="o">.</span><span class="mf">2.0</span>   <span class="mi">24</span>             <span class="mi">110</span>        <span class="mi">20</span>  <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
<span class="mf">10.3</span><span class="o">.</span><span class="mf">3.3</span>   <span class="mi">32</span>             <span class="mi">110</span>        <span class="mi">11</span>  <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">]</span>
<span class="mf">10.4</span><span class="o">.</span><span class="mf">4.4</span>   <span class="mi">32</span>             <span class="mi">110</span>        <span class="mi">11</span>  <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
                          <span class="mi">110</span>        <span class="mi">11</span>  <span class="p">[</span><span class="s1">&#39;10.0.14.4&#39;</span><span class="p">]</span>
<span class="mf">10.5</span><span class="o">.</span><span class="mf">5.5</span>   <span class="mi">32</span>             <span class="mi">110</span>        <span class="mi">21</span>  <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
                          <span class="mi">110</span>        <span class="mi">21</span>  <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">]</span>
                          <span class="mi">110</span>        <span class="mi">21</span>  <span class="p">[</span><span class="s1">&#39;10.0.14.4&#39;</span><span class="p">]</span>
<span class="mf">10.6</span><span class="o">.</span><span class="mf">6.0</span>   <span class="mi">24</span>             <span class="mi">110</span>        <span class="mi">20</span>  <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Изменилось то, что в столбце nexthop отображается список, но пока с
одним элементом. При использовании List - значение это список, и каждое совпадение с регулярным выражением будет добавлять в список элемент. По умолчанию каждое следующее совпадение перезаписывает предыдущее.
Если, например, оставить действие Record только для полных строк:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value network (\S+)
Value mask (\d+)
Value distance (\d+)
Value metric (\d+)
Value List nexthop (\S+)

Start
  ^O +${network}/${mask}\s\[${distance}/${metric}\]\svia\s${nexthop}, -&gt; Record
  ^\s+\[${distance}/${metric}\]\svia\s${nexthop},
</pre></div>
</div>
<p>Результат будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">network</span>      <span class="n">mask</span>    <span class="n">distance</span>    <span class="n">metric</span>  <span class="n">nexthop</span>
<span class="o">---------</span>  <span class="o">------</span>  <span class="o">----------</span>  <span class="o">--------</span>  <span class="o">---------------------------------------</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span>       <span class="mi">24</span>         <span class="mi">110</span>        <span class="mi">20</span>  <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">]</span>
<span class="mf">10.2</span><span class="o">.</span><span class="mf">2.0</span>       <span class="mi">24</span>         <span class="mi">110</span>        <span class="mi">20</span>  <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
<span class="mf">10.3</span><span class="o">.</span><span class="mf">3.3</span>       <span class="mi">32</span>         <span class="mi">110</span>        <span class="mi">11</span>  <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">]</span>
<span class="mf">10.4</span><span class="o">.</span><span class="mf">4.4</span>       <span class="mi">32</span>         <span class="mi">110</span>        <span class="mi">11</span>  <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
<span class="mf">10.5</span><span class="o">.</span><span class="mf">5.5</span>       <span class="mi">32</span>         <span class="mi">110</span>        <span class="mi">21</span>  <span class="p">[</span><span class="s1">&#39;10.0.14.4&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
<span class="mf">10.6</span><span class="o">.</span><span class="mf">6.0</span>       <span class="mi">24</span>         <span class="mi">110</span>        <span class="mi">20</span>  <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.14.4&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Сейчас результат не совсем правильный, адреса хопов записались не к тем маршрутам.
Так получилось потому что запись выполняется на полном маршруте, затем хопы
неполных маршрутов собираются в список (другие переменные перезаписываются)
и когда встречается следующий полный маршрут, список записывается к нему.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">O</span>        <span class="mf">10.4</span><span class="o">.</span><span class="mf">4.4</span><span class="o">/</span><span class="mi">32</span> <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">11</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span>
                     <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">11</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">14.4</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">3</span>
<span class="n">O</span>        <span class="mf">10.5</span><span class="o">.</span><span class="mf">5.5</span><span class="o">/</span><span class="mi">32</span> <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">21</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span>
                     <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">21</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">1</span>
                     <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">21</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">14.4</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">3</span>
<span class="n">O</span>        <span class="mf">10.6</span><span class="o">.</span><span class="mf">6.0</span><span class="o">/</span><span class="mi">24</span> <span class="p">[</span><span class="mi">110</span><span class="o">/</span><span class="mi">20</span><span class="p">]</span> <span class="n">via</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span><span class="p">,</span> <span class="mi">1</span><span class="n">w2d</span><span class="p">,</span> <span class="n">Ethernet0</span><span class="o">/</span><span class="mi">2</span>
</pre></div>
</div>
<p>Фактически неполные маршруты действительно надо записывать, когда встретился следующий полный,
но при этом, надо записать их к соответствующему маршруту.
Надо сделать следующее: как только встретился полный маршрут, надо записать
предыдущие значения, а затем продолжить обрабатывать тот же полный маршрут
для получения его информации. В TextFSM это можно сделать с помощью действий Continue.Record:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">^</span><span class="n">O</span> <span class="o">-&gt;</span> <span class="n">Continue</span><span class="o">.</span><span class="n">Record</span>
</pre></div>
</div>
<p>В ней действие <strong>Record</strong> говорит, что надо записать текущее значение
переменных. Так как в этом правиле нет переменных, записывается то,
что было в предыдущих значениях.</p>
<p>Действие <strong>Continue</strong> говорит, что надо продолжить работать с текущей
строкой так, как будто совпадения не было. За счет этого сработает
следующая строка шаблона. Итоговый шаблон выглядит так (файл
templates/sh_ip_route_ospf.template):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value network (\S+)
Value mask (\d+)
Value distance (\d+)
Value metric (\d+)
Value List nexthop (\S+)

Start
  ^O -&gt; Continue.Record
  ^O +${network}/${mask}\s\[${distance}/${metric}\]\svia\s${nexthop},
  ^\s+\[${distance}/${metric}\]\svia\s${nexthop},
</pre></div>
</div>
<p>В результате мы получим такой вывод:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">network</span>      <span class="n">mask</span>    <span class="n">distance</span>    <span class="n">metric</span>  <span class="n">nexthop</span>
<span class="o">---------</span>  <span class="o">------</span>  <span class="o">----------</span>  <span class="o">--------</span>  <span class="o">---------------------------------------</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span>       <span class="mi">24</span>         <span class="mi">110</span>        <span class="mi">20</span>  <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">]</span>
<span class="mf">10.2</span><span class="o">.</span><span class="mf">2.0</span>       <span class="mi">24</span>         <span class="mi">110</span>        <span class="mi">20</span>  <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
<span class="mf">10.3</span><span class="o">.</span><span class="mf">3.3</span>       <span class="mi">32</span>         <span class="mi">110</span>        <span class="mi">11</span>  <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">]</span>
<span class="mf">10.4</span><span class="o">.</span><span class="mf">4.4</span>       <span class="mi">32</span>         <span class="mi">110</span>        <span class="mi">11</span>  <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.14.4&#39;</span><span class="p">]</span>
<span class="mf">10.5</span><span class="o">.</span><span class="mf">5.5</span>       <span class="mi">32</span>         <span class="mi">110</span>        <span class="mi">21</span>  <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.12.2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.14.4&#39;</span><span class="p">]</span>
<span class="mf">10.6</span><span class="o">.</span><span class="mf">6.0</span>       <span class="mi">24</span>         <span class="mi">110</span>        <span class="mi">20</span>  <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="show-etherchannel-summary">
<h5>show etherchannel summary<a class="headerlink" href="#show-etherchannel-summary" title="Ссылка на этот заголовок">¶</a></h5>
<p>TextFSM удобно использовать для разбора вывода, который отображается
столбцами, или для обработки вывода, который находится в разных строках.
Менее удобными получаются шаблоны, когда надо получить несколько
однотипных элементов из одной строки.</p>
<p>Пример вывода команды show etherchannel summary (файл
output/sh_etherchannel_summary.txt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sw1</span><span class="c1"># sh etherchannel summary</span>
<span class="n">Flags</span><span class="p">:</span>  <span class="n">D</span> <span class="o">-</span> <span class="n">down</span>        <span class="n">P</span> <span class="o">-</span> <span class="n">bundled</span> <span class="ow">in</span> <span class="n">port</span><span class="o">-</span><span class="n">channel</span>
        <span class="n">I</span> <span class="o">-</span> <span class="n">stand</span><span class="o">-</span><span class="n">alone</span> <span class="n">s</span> <span class="o">-</span> <span class="n">suspended</span>
        <span class="n">H</span> <span class="o">-</span> <span class="n">Hot</span><span class="o">-</span><span class="n">standby</span> <span class="p">(</span><span class="n">LACP</span> <span class="n">only</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">-</span> <span class="n">Layer3</span>      <span class="n">S</span> <span class="o">-</span> <span class="n">Layer2</span>
        <span class="n">U</span> <span class="o">-</span> <span class="ow">in</span> <span class="n">use</span>      <span class="n">f</span> <span class="o">-</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">allocate</span> <span class="n">aggregator</span>

        <span class="n">M</span> <span class="o">-</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">use</span><span class="p">,</span> <span class="n">minimum</span> <span class="n">links</span> <span class="ow">not</span> <span class="n">met</span>
        <span class="n">u</span> <span class="o">-</span> <span class="n">unsuitable</span> <span class="k">for</span> <span class="n">bundling</span>
        <span class="n">w</span> <span class="o">-</span> <span class="n">waiting</span> <span class="n">to</span> <span class="n">be</span> <span class="n">aggregated</span>
        <span class="n">d</span> <span class="o">-</span> <span class="n">default</span> <span class="n">port</span>


<span class="n">Number</span> <span class="n">of</span> <span class="n">channel</span><span class="o">-</span><span class="n">groups</span> <span class="ow">in</span> <span class="n">use</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">aggregators</span><span class="p">:</span>           <span class="mi">2</span>

<span class="n">Group</span>  <span class="n">Port</span><span class="o">-</span><span class="n">channel</span>  <span class="n">Protocol</span>    <span class="n">Ports</span>
<span class="o">------+-------------+-----------+-----------------------------------------------</span>
<span class="mi">1</span>      <span class="n">Po1</span><span class="p">(</span><span class="n">SU</span><span class="p">)</span>         <span class="n">LACP</span>      <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>   <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>   <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="mi">3</span>      <span class="n">Po3</span><span class="p">(</span><span class="n">SU</span><span class="p">)</span>          <span class="o">-</span>        <span class="n">Fa0</span><span class="o">/</span><span class="mi">11</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>   <span class="n">Fa0</span><span class="o">/</span><span class="mi">12</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>   <span class="n">Fa0</span><span class="o">/</span><span class="mi">13</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>   <span class="n">Fa0</span><span class="o">/</span><span class="mi">14</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
<p>В данном случае нужно получить:</p>
<ul class="simple">
<li>имя и номер port-channel. Например, Po1</li>
<li>список всех портов в нём. Например, [„Fa0/1“, „Fa0/2“, „Fa0/3“]</li>
</ul>
<p>Сложность тут в том, что порты находятся в одной строке, а в TextFSM
нельзя указывать одну и ту же переменную несколько раз в строке. Но есть
возможность несколько раз искать совпадение в строке.</p>
<p>Первая версия шаблона выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value CHANNEL (\S+)
Value List MEMBERS (\w+\d+\/\d+)

Start
  ^\d+ +${CHANNEL}\(\S+ +[\w-]+ +[\w ]+ +${MEMBERS}\( -&gt; Record
</pre></div>
</div>
<p>В шаблоне две переменные:</p>
<ul class="simple">
<li>CHANNEL - имя и номер агрегированного порта</li>
<li>MEMBERS - список портов, которые входят в агрегированный порт.
Для этой переменной указан тип - List</li>
</ul>
<p>Результат:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CHANNEL</span>    <span class="n">MEMBERS</span>
<span class="o">---------</span>  <span class="o">----------</span>
<span class="n">Po1</span>        <span class="p">[</span><span class="s1">&#39;Fa0/1&#39;</span><span class="p">]</span>
<span class="n">Po3</span>        <span class="p">[</span><span class="s1">&#39;Fa0/11&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Пока что в выводе только первый порт, а нужно, чтобы попали все порты. В
данном случае надо продолжить обработку строки с портами после
найденного совпадения. То есть, использовать действие Continue и описать
следующее выражение.</p>
<p>Единственная строка, которая есть в шаблоне, описывает первый порт. Надо
добавить строку, которая описывает следующий порт.</p>
<p>Следующая версия шаблона:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value CHANNEL (\S+)
Value List MEMBERS (\w+\d+\/\d+)

Start
  ^\d+ +${CHANNEL}\(\S+ +[\w-]+ +[\w ]+ +${MEMBERS}\( -&gt; Continue
  ^\d+ +${CHANNEL}\(\S+ +[\w-]+ +[\w ]+ +\S+ +${MEMBERS}\( -&gt; Record
</pre></div>
</div>
<p>Вторая строка описывает такое же выражение, но переменная MEMBERS
смещается на следующий порт.</p>
<p>Результат:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CHANNEL</span>    <span class="n">MEMBERS</span>
<span class="o">---------</span>  <span class="o">--------------------</span>
<span class="n">Po1</span>        <span class="p">[</span><span class="s1">&#39;Fa0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/2&#39;</span><span class="p">]</span>
<span class="n">Po3</span>        <span class="p">[</span><span class="s1">&#39;Fa0/11&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/12&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Аналогично надо дописать в шаблон строки, которые описывают третий и
четвертый порт. Но, так как в выводе может быть переменное количество
портов, надо перенести правило Record на отдельную строку, чтобы оно не
было привязано к конкретному количеству портов в строке.</p>
<p>Если Record будет находиться, например, после строки, в которой
описаны четыре порта, для ситуации, когда портов в строке меньше,
запись не будет выполняться.</p>
<p>Итоговый шаблон (файл templates/sh_etherchannel_summary.txt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value CHANNEL (\S+)
Value List MEMBERS (\w+\d+\/\d+)

Start
  ^\d+.* -&gt; Continue.Record
  ^\d+ +${CHANNEL}\(\S+ +[\w-]+ +[\w ]+ +\S+ +${MEMBERS}\( -&gt; Continue
  ^\d+ +${CHANNEL}\(\S+ +[\w-]+ +[\w ]+ +(\S+ +){2} +${MEMBERS}\( -&gt; Continue
  ^\d+ +${CHANNEL}\(\S+ +[\w-]+ +[\w ]+ +(\S+ +){3} +${MEMBERS}\( -&gt; Continue
</pre></div>
</div>
<p>Результат обработки:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CHANNEL</span>    <span class="n">MEMBERS</span>
<span class="o">---------</span>  <span class="o">----------------------------------------</span>
<span class="n">Po1</span>        <span class="p">[</span><span class="s1">&#39;Fa0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/3&#39;</span><span class="p">]</span>
<span class="n">Po3</span>        <span class="p">[</span><span class="s1">&#39;Fa0/11&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/12&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/13&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/14&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Теперь все порты попали в вывод.</p>
<blockquote>
<div>Шаблон предполагает, что в одной строке будет максимум четыре порта.
Если портов может быть больше, надо добавить соответствующие строки
в шаблон.</div></blockquote>
<p>Возможен ещё один вариант вывода команды sh etherchannel summary (файл
output/sh_etherchannel_summary2.txt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sw1</span><span class="c1"># sh etherchannel summary</span>
<span class="n">Flags</span><span class="p">:</span>  <span class="n">D</span> <span class="o">-</span> <span class="n">down</span>        <span class="n">P</span> <span class="o">-</span> <span class="n">bundled</span> <span class="ow">in</span> <span class="n">port</span><span class="o">-</span><span class="n">channel</span>
        <span class="n">I</span> <span class="o">-</span> <span class="n">stand</span><span class="o">-</span><span class="n">alone</span> <span class="n">s</span> <span class="o">-</span> <span class="n">suspended</span>
        <span class="n">H</span> <span class="o">-</span> <span class="n">Hot</span><span class="o">-</span><span class="n">standby</span> <span class="p">(</span><span class="n">LACP</span> <span class="n">only</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">-</span> <span class="n">Layer3</span>      <span class="n">S</span> <span class="o">-</span> <span class="n">Layer2</span>
        <span class="n">U</span> <span class="o">-</span> <span class="ow">in</span> <span class="n">use</span>      <span class="n">f</span> <span class="o">-</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">allocate</span> <span class="n">aggregator</span>

        <span class="n">M</span> <span class="o">-</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">use</span><span class="p">,</span> <span class="n">minimum</span> <span class="n">links</span> <span class="ow">not</span> <span class="n">met</span>
        <span class="n">u</span> <span class="o">-</span> <span class="n">unsuitable</span> <span class="k">for</span> <span class="n">bundling</span>
        <span class="n">w</span> <span class="o">-</span> <span class="n">waiting</span> <span class="n">to</span> <span class="n">be</span> <span class="n">aggregated</span>
        <span class="n">d</span> <span class="o">-</span> <span class="n">default</span> <span class="n">port</span>


<span class="n">Number</span> <span class="n">of</span> <span class="n">channel</span><span class="o">-</span><span class="n">groups</span> <span class="ow">in</span> <span class="n">use</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">aggregators</span><span class="p">:</span>           <span class="mi">2</span>

<span class="n">Group</span>  <span class="n">Port</span><span class="o">-</span><span class="n">channel</span>  <span class="n">Protocol</span>    <span class="n">Ports</span>
<span class="o">------+-------------+-----------+-----------------------------------------------</span>
<span class="mi">1</span>      <span class="n">Po1</span><span class="p">(</span><span class="n">SU</span><span class="p">)</span>         <span class="n">LACP</span>      <span class="n">Fa0</span><span class="o">/</span><span class="mi">1</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>   <span class="n">Fa0</span><span class="o">/</span><span class="mi">2</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>   <span class="n">Fa0</span><span class="o">/</span><span class="mi">3</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="mi">3</span>      <span class="n">Po3</span><span class="p">(</span><span class="n">SU</span><span class="p">)</span>          <span class="o">-</span>        <span class="n">Fa0</span><span class="o">/</span><span class="mi">11</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>   <span class="n">Fa0</span><span class="o">/</span><span class="mi">12</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>   <span class="n">Fa0</span><span class="o">/</span><span class="mi">13</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>   <span class="n">Fa0</span><span class="o">/</span><span class="mi">14</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
                                 <span class="n">Fa0</span><span class="o">/</span><span class="mi">15</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>   <span class="n">Fa0</span><span class="o">/</span><span class="mi">16</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
<p>В таком выводе появляется новый вариант - строки, в которых находятся
только порты.</p>
<p>Для того, чтобы шаблон обрабатывал и этот вариант, надо его
модифицировать (файл templates/sh_etherchannel_summary2.txt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Value CHANNEL (\S+)
Value List MEMBERS (\w+\d+\/\d+)

Start
  ^\d+.* -&gt; Continue.Record
  ^\d+ +${CHANNEL}\(\S+ +[\w-]+ +[\w ]+ +${MEMBERS}\( -&gt; Continue
  ^\d+ +${CHANNEL}\(\S+ +[\w-]+ +[\w ]+ +\S+ +${MEMBERS}\( -&gt; Continue
  ^\d+ +${CHANNEL}\(\S+ +[\w-]+ +[\w ]+ +(\S+ +){2} +${MEMBERS}\( -&gt; Continue
  ^\d+ +${CHANNEL}\(\S+ +[\w-]+ +[\w ]+ +(\S+ +){3} +${MEMBERS}\( -&gt; Continue
  ^ +${MEMBERS} -&gt; Continue
  ^ +\S+ +${MEMBERS} -&gt; Continue
  ^ +(\S+ +){2} +${MEMBERS} -&gt; Continue
  ^ +(\S+ +){3} +${MEMBERS} -&gt; Continue
</pre></div>
</div>
<p>Результат будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CHANNEL</span>    <span class="n">MEMBERS</span>
<span class="o">---------</span>  <span class="o">------------------------------------------------------------</span>
<span class="n">Po1</span>        <span class="p">[</span><span class="s1">&#39;Fa0/1&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/2&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/3&#39;</span><span class="p">]</span>
<span class="n">Po3</span>        <span class="p">[</span><span class="s1">&#39;Fa0/11&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/12&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/13&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/14&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/15&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa0/16&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>На этом мы заканчиваем разбираться с шаблонами TextFSM.</p>
<p>Примеры шаблонов для Cisco и другого оборудования можно посмотреть в
проекте
<a class="reference external" href="https://github.com/networktocode/ntc-templates/tree/89c57342b47c9990f0708226fb3f268c6b8c1549/templates">ntc-ansible</a>.</p>
</div>
</div>
<span id="document-book/21_textfsm/textfsm_clitable"></span><div class="section" id="textfsm-cli-table">
<h4>TextFSM CLI Table<a class="headerlink" href="#textfsm-cli-table" title="Ссылка на этот заголовок">¶</a></h4>
<p>Благодаря TextFSM можно обрабатывать вывод команд и получать
структурированный результат. Однако, всё ещё надо вручную прописывать,
каким шаблоном обрабатывать команды show, каждый раз, когда используется
TextFSM.</p>
<p>Было бы намного удобней иметь какое-то соответствие между командой и
шаблоном, чтобы можно было написать общий скрипт, который выполняет
подключения к устройствам, отправляет команды, сам выбирает шаблон и
парсит вывод в соответствии с шаблоном.</p>
<p>В TextFSM есть такая возможность.
Для того, чтобы ею можно было воспользоваться, надо создать файл, в
котором описаны соответствия между командами и шаблонами. В TextFSM он
называется index.</p>
<p>Этот файл должен находиться в каталоге с шаблонами и должен иметь такой
формат:</p>
<ul class="simple">
<li>первая строка - названия колонок</li>
<li>каждая следующая строка - это соответствие шаблона команде</li>
<li>обязательные колонки, местоположение которых фиксировано
(должны быть обязательно первой и последней, соответственно):<ul>
<li>первая колонка - имена шаблонов</li>
<li>последняя колонка - соответствующая команда. В этой колонке используется специальный
формат, чтобы описать то, что команда может быть написана не полностью</li>
</ul>
</li>
<li>остальные колонки могут быть любыми<ul>
<li>например, в примере ниже будут колонки Hostname, Vendor.
Они позволяют уточнить информацию об устройстве,
чтобы определить, какой шаблон использовать. Например,
команда show version может быть у оборудования Cisco и HP.
Соответственно, только команды недостаточно, чтобы определить, какой
шаблон использовать. В таком случае можно передать информацию о том,
какой тип оборудования используется, вместе с командой, и тогда
получится определить правильный шаблон.</li>
</ul>
</li>
<li>во всех столбцах, кроме первого, поддерживаются регулярные выражения.
В командах внутри <code class="docutils literal notranslate"><span class="pre">[[]]</span></code> регулярные выражения не поддерживаются</li>
</ul>
<p>Пример файла index:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Template</span><span class="p">,</span> <span class="n">Hostname</span><span class="p">,</span> <span class="n">Vendor</span><span class="p">,</span> <span class="n">Command</span>
<span class="n">sh_cdp_n_det</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="o">.*</span><span class="p">,</span> <span class="n">Cisco</span><span class="p">,</span> <span class="n">sh</span><span class="p">[[</span><span class="n">ow</span><span class="p">]]</span> <span class="n">cdp</span> <span class="n">ne</span><span class="p">[[</span><span class="n">ighbors</span><span class="p">]]</span> <span class="n">de</span><span class="p">[[</span><span class="n">tail</span><span class="p">]]</span>
<span class="n">sh_clock</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="o">.*</span><span class="p">,</span> <span class="n">Cisco</span><span class="p">,</span> <span class="n">sh</span><span class="p">[[</span><span class="n">ow</span><span class="p">]]</span> <span class="n">clo</span><span class="p">[[</span><span class="n">ck</span><span class="p">]]</span>
<span class="n">sh_ip_int_br</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="o">.*</span><span class="p">,</span> <span class="n">Cisco</span><span class="p">,</span> <span class="n">sh</span><span class="p">[[</span><span class="n">ow</span><span class="p">]]</span> <span class="n">ip</span> <span class="nb">int</span><span class="p">[[</span><span class="n">erface</span><span class="p">]]</span> <span class="n">br</span><span class="p">[[</span><span class="n">ief</span><span class="p">]]</span>
<span class="n">sh_ip_route_ospf</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="o">.*</span><span class="p">,</span> <span class="n">Cisco</span><span class="p">,</span> <span class="n">sh</span><span class="p">[[</span><span class="n">ow</span><span class="p">]]</span> <span class="n">ip</span> <span class="n">rou</span><span class="p">[[</span><span class="n">te</span><span class="p">]]</span> <span class="n">o</span><span class="p">[[</span><span class="n">spf</span><span class="p">]]</span>
</pre></div>
</div>
<p>Обратите внимание на то, как записаны команды:  <code class="docutils literal notranslate"><span class="pre">sh[[ow]]</span> <span class="pre">ip</span> <span class="pre">int[[erface]]</span> <span class="pre">br[[ief]]</span></code>.
Запись будет преобразована в выражение <code class="docutils literal notranslate"><span class="pre">sh((ow)?)?</span> <span class="pre">ip</span> <span class="pre">int((erface)?)?</span> <span class="pre">br((ief)?)?</span></code>.
Это значит, что TextFSM сможет определить, какой шаблон использовать,
даже если команда набрана не полностью. Например, такие варианты
команды сработают:</p>
<ul class="simple">
<li>sh ip int br</li>
<li>show ip inter bri</li>
</ul>
<div class="section" id="cli-table">
<h5>Как использовать CLI table<a class="headerlink" href="#cli-table" title="Ссылка на этот заголовок">¶</a></h5>
<p>Посмотрим, как пользоваться классом clitable и файлом index.</p>
<p>В каталоге templates такие шаблоны и файл index:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sh_cdp_n_det</span><span class="o">.</span><span class="n">template</span>
<span class="n">sh_clock</span><span class="o">.</span><span class="n">template</span>
<span class="n">sh_ip_int_br</span><span class="o">.</span><span class="n">template</span>
<span class="n">sh_ip_route_ospf</span><span class="o">.</span><span class="n">template</span>
<span class="n">index</span>
</pre></div>
</div>
<p>Сначала попробуем поработать с CLI Table в ipython, чтобы посмотреть,
какие возможности есть у этого класса, а затем посмотрим на финальный
скрипт.</p>
<p>Для начала импортируем класс clitable:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">textfsm</span> <span class="kn">import</span> <span class="n">clitable</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p>В зависимости от версии textfsm, надо по-разному импортировать clitable:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">clitable</span></code> для версии &lt;= 0.4.1</li>
<li><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">textfsm</span> <span class="pre">import</span> <span class="pre">clitable</span></code> для версии &gt;= 1.1.0</li>
</ul>
<p class="last">Посмотреть версию textfsm: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">show</span> <span class="pre">textfsm</span></code>.</p>
</div>
<p>Проверять работу clitable будем на последнем примере из прошлого раздела
- выводе команды show ip route ospf. Считываем вывод, который хранится в
файле output/sh_ip_route_ospf.txt, в строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;output/sh_ip_route_ospf.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">output_sh_ip_route_ospf</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Сначала надо инициализировать класс, передав ему имя файла, в котором
хранится соответствие между шаблонами и командами, и указать имя
каталога, в котором хранятся шаблоны:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">cli_table</span> <span class="o">=</span> <span class="n">clitable</span><span class="o">.</span><span class="n">CliTable</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Надо указать, какая команда передается, и указать дополнительные
атрибуты, которые помогут идентифицировать шаблон. Для этого нужно
создать словарь, в котором ключи - имена столбцов, которые определены в
файле index. В данном случае не обязательно указывать название вендора,
так как команде sh ip route ospf соответствует только один шаблон.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Command&#39;</span><span class="p">:</span> <span class="s1">&#39;show ip route ospf&#39;</span><span class="p">,</span> <span class="s1">&#39;Vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Методу ParseCmd надо передать вывод команды и словарь с параметрами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">cli_table</span><span class="o">.</span><span class="n">ParseCmd</span><span class="p">(</span><span class="n">output_sh_ip_route_ospf</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
</pre></div>
</div>
<p>В результате в объекте cli_table получаем обработанный вывод команды sh
ip route ospf.</p>
<p>Методы cli_table (чтобы посмотреть все методы, надо вызвать
dir(cli_table)):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">cli_table</span><span class="o">.</span>
<span class="n">cli_table</span><span class="o">.</span><span class="n">AddColumn</span>        <span class="n">cli_table</span><span class="o">.</span><span class="n">NewRow</span>           <span class="n">cli_table</span><span class="o">.</span><span class="n">index</span>            <span class="n">cli_table</span><span class="o">.</span><span class="n">size</span>
<span class="n">cli_table</span><span class="o">.</span><span class="n">AddKeys</span>          <span class="n">cli_table</span><span class="o">.</span><span class="n">ParseCmd</span>         <span class="n">cli_table</span><span class="o">.</span><span class="n">index_file</span>       <span class="n">cli_table</span><span class="o">.</span><span class="n">sort</span>
<span class="n">cli_table</span><span class="o">.</span><span class="n">Append</span>           <span class="n">cli_table</span><span class="o">.</span><span class="n">ReadIndex</span>        <span class="n">cli_table</span><span class="o">.</span><span class="n">next</span>             <span class="n">cli_table</span><span class="o">.</span><span class="n">superkey</span>
<span class="n">cli_table</span><span class="o">.</span><span class="n">CsvToTable</span>       <span class="n">cli_table</span><span class="o">.</span><span class="n">Remove</span>           <span class="n">cli_table</span><span class="o">.</span><span class="n">raw</span>              <span class="n">cli_table</span><span class="o">.</span><span class="n">synchronised</span>
<span class="n">cli_table</span><span class="o">.</span><span class="n">FormattedTable</span>   <span class="n">cli_table</span><span class="o">.</span><span class="n">Reset</span>            <span class="n">cli_table</span><span class="o">.</span><span class="n">row</span>              <span class="n">cli_table</span><span class="o">.</span><span class="n">table</span>
<span class="n">cli_table</span><span class="o">.</span><span class="n">INDEX</span>            <span class="n">cli_table</span><span class="o">.</span><span class="n">RowWith</span>          <span class="n">cli_table</span><span class="o">.</span><span class="n">row_class</span>        <span class="n">cli_table</span><span class="o">.</span><span class="n">template_dir</span>
<span class="n">cli_table</span><span class="o">.</span><span class="n">KeyValue</span>         <span class="n">cli_table</span><span class="o">.</span><span class="n">extend</span>           <span class="n">cli_table</span><span class="o">.</span><span class="n">row_index</span>
<span class="n">cli_table</span><span class="o">.</span><span class="n">LabelValueTable</span>  <span class="n">cli_table</span><span class="o">.</span><span class="n">header</span>           <span class="n">cli_table</span><span class="o">.</span><span class="n">separator</span>
</pre></div>
</div>
<p>Например, если вызвать <code class="docutils literal notranslate"><span class="pre">print</span> <span class="pre">cli_table</span></code>, получим такой вывод:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">cli_table</span><span class="p">)</span>
<span class="n">Network</span><span class="p">,</span> <span class="n">Mask</span><span class="p">,</span> <span class="n">Distance</span><span class="p">,</span> <span class="n">Metric</span><span class="p">,</span> <span class="n">NextHop</span>
<span class="mf">10.0</span><span class="o">.</span><span class="mf">24.0</span><span class="p">,</span> <span class="o">/</span><span class="mi">24</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">]</span>
<span class="mf">10.0</span><span class="o">.</span><span class="mf">34.0</span><span class="p">,</span> <span class="o">/</span><span class="mi">24</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
<span class="mf">10.2</span><span class="o">.</span><span class="mf">2.2</span><span class="p">,</span> <span class="o">/</span><span class="mi">32</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">]</span>
<span class="mf">10.3</span><span class="o">.</span><span class="mf">3.3</span><span class="p">,</span> <span class="o">/</span><span class="mi">32</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
<span class="mf">10.4</span><span class="o">.</span><span class="mf">4.4</span><span class="p">,</span> <span class="o">/</span><span class="mi">32</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.12.2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.14.4&#39;</span><span class="p">]</span>
<span class="mf">10.5</span><span class="o">.</span><span class="mf">35.0</span><span class="p">,</span> <span class="o">/</span><span class="mi">24</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Метод FormattedTable позволяет получить вывод в виде таблицы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">cli_table</span><span class="o">.</span><span class="n">FormattedTable</span><span class="p">())</span>
 <span class="n">Network</span>    <span class="n">Mask</span>  <span class="n">Distance</span>  <span class="n">Metric</span>  <span class="n">NextHop</span>
<span class="o">====================================================================</span>
 <span class="mf">10.0</span><span class="o">.</span><span class="mf">24.0</span>  <span class="o">/</span><span class="mi">24</span>   <span class="mi">110</span>       <span class="mi">20</span>      <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span>
 <span class="mf">10.0</span><span class="o">.</span><span class="mf">34.0</span>  <span class="o">/</span><span class="mi">24</span>   <span class="mi">110</span>       <span class="mi">20</span>      <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
 <span class="mf">10.2</span><span class="o">.</span><span class="mf">2.2</span>   <span class="o">/</span><span class="mi">32</span>   <span class="mi">110</span>       <span class="mi">11</span>      <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span>
 <span class="mf">10.3</span><span class="o">.</span><span class="mf">3.3</span>   <span class="o">/</span><span class="mi">32</span>   <span class="mi">110</span>       <span class="mi">11</span>      <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
 <span class="mf">10.4</span><span class="o">.</span><span class="mf">4.4</span>   <span class="o">/</span><span class="mi">32</span>   <span class="mi">110</span>       <span class="mi">21</span>      <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span><span class="p">,</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">12.2</span><span class="p">,</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">14.4</span>
 <span class="mf">10.5</span><span class="o">.</span><span class="mf">35.0</span>  <span class="o">/</span><span class="mi">24</span>   <span class="mi">110</span>       <span class="mi">20</span>      <span class="mf">10.0</span><span class="o">.</span><span class="mf">13.3</span>
</pre></div>
</div>
<p>Такой вывод может пригодиться для отображения информации.</p>
<p>Чтобы получить из объекта cli_table структурированный вывод, например,
список списков, надо обратиться к объекту таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">data_rows</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cli_table</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">data_rows</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span>
<span class="p">[[</span><span class="s1">&#39;10.0.24.0&#39;</span><span class="p">,</span> <span class="s1">&#39;/24&#39;</span><span class="p">,</span> <span class="s1">&#39;110&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">]],</span>
 <span class="p">[</span><span class="s1">&#39;10.0.34.0&#39;</span><span class="p">,</span> <span class="s1">&#39;/24&#39;</span><span class="p">,</span> <span class="s1">&#39;110&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]],</span>
 <span class="p">[</span><span class="s1">&#39;10.2.2.2&#39;</span><span class="p">,</span> <span class="s1">&#39;/32&#39;</span><span class="p">,</span> <span class="s1">&#39;110&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.12.2&#39;</span><span class="p">]],</span>
 <span class="p">[</span><span class="s1">&#39;10.3.3.3&#39;</span><span class="p">,</span> <span class="s1">&#39;/32&#39;</span><span class="p">,</span> <span class="s1">&#39;110&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]],</span>
 <span class="p">[</span><span class="s1">&#39;10.4.4.4&#39;</span><span class="p">,</span> <span class="s1">&#39;/32&#39;</span><span class="p">,</span> <span class="s1">&#39;110&#39;</span><span class="p">,</span> <span class="s1">&#39;21&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.12.2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.0.14.4&#39;</span><span class="p">]],</span>
 <span class="p">[</span><span class="s1">&#39;10.5.35.0&#39;</span><span class="p">,</span> <span class="s1">&#39;/24&#39;</span><span class="p">,</span> <span class="s1">&#39;110&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;10.0.13.3&#39;</span><span class="p">]]]</span>
</pre></div>
</div>
<p>Отдельно можно получить названия столбцов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">header</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cli_table</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">header</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;Network&#39;</span><span class="p">,</span> <span class="s1">&#39;Mask&#39;</span><span class="p">,</span> <span class="s1">&#39;Distance&#39;</span><span class="p">,</span> <span class="s1">&#39;Metric&#39;</span><span class="p">,</span> <span class="s1">&#39;NextHop&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Теперь вывод аналогичен тому, который был получен в прошлом разделе.</p>
<p>Соберем всё в один скрипт (файл textfsm_clitable.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">textfsm</span> <span class="kn">import</span> <span class="n">clitable</span>

<span class="n">output_sh_ip_route_ospf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;output/sh_ip_route_ospf.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">cli_table</span> <span class="o">=</span> <span class="n">clitable</span><span class="o">.</span><span class="n">CliTable</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>

<span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Command&#39;</span><span class="p">:</span> <span class="s1">&#39;show ip route ospf&#39;</span><span class="p">,</span> <span class="s1">&#39;Vendor&#39;</span><span class="p">:</span> <span class="s1">&#39;Cisco&#39;</span><span class="p">}</span>

<span class="n">cli_table</span><span class="o">.</span><span class="n">ParseCmd</span><span class="p">(</span><span class="n">output_sh_ip_route_ospf</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CLI Table output:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">cli_table</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Formatted Table:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">cli_table</span><span class="o">.</span><span class="n">FormattedTable</span><span class="p">())</span>

<span class="n">data_rows</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cli_table</span><span class="p">]</span>
<span class="n">header</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cli_table</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data_rows</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>В упражнениях к этому разделу будет задание, в котором надо
объединить описанную процедуру в функцию, а также вариант с
получением списка словарей.</p>
<p>Вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python textfsm_clitable.py
CLI Table output:
Network, Mask, Distance, Metric, NextHop
10.0.24.0, /24, 110, 20, [&#39;10.0.12.2&#39;]
10.0.34.0, /24, 110, 20, [&#39;10.0.13.3&#39;]
10.2.2.2, /32, 110, 11, [&#39;10.0.12.2&#39;]
10.3.3.3, /32, 110, 11, [&#39;10.0.13.3&#39;]
10.4.4.4, /32, 110, 21, [&#39;10.0.13.3&#39;, &#39;10.0.12.2&#39;, &#39;10.0.14.4&#39;]
10.5.35.0, /24, 110, 20, [&#39;10.0.13.3&#39;]

Formatted Table:
 Network    Mask  Distance  Metric  NextHop
====================================================================
 10.0.24.0  /24   110       20      10.0.12.2
 10.0.34.0  /24   110       20      10.0.13.3
 10.2.2.2   /32   110       11      10.0.12.2
 10.3.3.3   /32   110       11      10.0.13.3
 10.4.4.4   /32   110       21      10.0.13.3, 10.0.12.2, 10.0.14.4
 10.5.35.0  /24   110       20      10.0.13.3

[&#39;Network&#39;, &#39;Mask&#39;, &#39;Distance&#39;, &#39;Metric&#39;, &#39;NextHop&#39;]
[&#39;10.0.24.0&#39;, &#39;/24&#39;, &#39;110&#39;, &#39;20&#39;, [&#39;10.0.12.2&#39;]]
[&#39;10.0.34.0&#39;, &#39;/24&#39;, &#39;110&#39;, &#39;20&#39;, [&#39;10.0.13.3&#39;]]
[&#39;10.2.2.2&#39;, &#39;/32&#39;, &#39;110&#39;, &#39;11&#39;, [&#39;10.0.12.2&#39;]]
[&#39;10.3.3.3&#39;, &#39;/32&#39;, &#39;110&#39;, &#39;11&#39;, [&#39;10.0.13.3&#39;]]
[&#39;10.4.4.4&#39;, &#39;/32&#39;, &#39;110&#39;, &#39;21&#39;, [&#39;10.0.13.3&#39;, &#39;10.0.12.2&#39;, &#39;10.0.14.4&#39;]]
[&#39;10.5.35.0&#39;, &#39;/24&#39;, &#39;110&#39;, &#39;20&#39;, [&#39;10.0.13.3&#39;]]
</pre></div>
</div>
<p>Теперь с помощью TextFSM можно не только получать структурированный
вывод, но и автоматически определять, какой шаблон использовать, по
команде и опциональным аргументам.</p>
</div>
</div>
<span id="document-book/21_textfsm/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/google/textfsm/wiki">TextFSM</a></li>
</ul>
<p>Статьи:</p>
<ul>
<li><p class="first"><a class="reference external" href="http://jedelman.com/home/programmatic-access-to-cli-devices-with-textfsm/">Programmatic Access to CLI Devices with TextFSM. Jason Edelman (26.02.2015)</a> -
основы TextFSM и идеи о развитии, которые легли в основу модуля ntc-ansible</p>
</li>
<li><p class="first"><a class="reference external" href="https://codingnetworker.com/2015/08/parse-cli-outputs-textfsm/">Parse CLI outputs with TextFSM. Henry Ölsner (24.08.2015)</a>
- пример использования TextFSM для разбора большого файла с выводом sh inventory. Подробнее объясняется синтаксис TextFSM</p>
</li>
<li><p class="first"><a class="reference external" href="http://jedelman.com/home/creating-templates-for-textfsm-and-ntc_show_command/">Creating Templates for TextFSM and ntc_show_command. Jason Edelman (27.08.2015)</a>
- подробнее рассматривается синтаксис TextFSM, и показаны примеры использования модуля ntc-ansible</p>
<blockquote>
<div><p>(обратите внимание, что синтаксис модуля уже немного изменился)</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference external" href="https://pynet.twb-tech.com/blog/python/textfsm.html">TextFSM and Structured Data. Kirk Byers (22.10.2015)</a> -
вводная статья о TextFSM. Тут не описывается синтаксис, но дается общее
представление о том, что такое TextFSM, и пример его использования</p>
</li>
</ul>
<p>Проекты, которые используют TextFSM:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/networktocode/ntc-ansible">Модуль ntc-ansible</a></li>
</ul>
<p>Шаблоны TextFSM (из модуля ntc-ansible):</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/networktocode/ntc-templates/tree/master/templates">ntc-templates</a></li>
</ul>
</div>
<span id="document-exercises/21_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 21.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию parse_command_output. Параметры функции:</p>
<ul class="simple">
<li>template - имя файла, в котором находится шаблон TextFSM (templates/sh_ip_int_br.template)</li>
<li>command_output - вывод соответствующей команды show (строка)</li>
</ul>
<p>Функция должна возвращать список:</p>
<ul class="simple">
<li>первый элемент - это список с названиями столбцов</li>
<li>остальные элементы это списки, в котором находятся результаты обработки вывода</li>
</ul>
<p>Проверить работу функции на выводе команды output/sh_ip_int_br.txt и шаблоне templates/sh_ip_int_br.template.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">netmiko</span> <span class="kn">import</span> <span class="n">ConnectHandler</span>


<span class="c1"># вызов функции должен выглядеть так</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">r1_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;device_type&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco_ios&quot;</span><span class="p">,</span>
        <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
        <span class="s2">&quot;secret&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">with</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">r1_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">r1</span><span class="p">:</span>
        <span class="n">r1</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;sh ip int br&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">parse_command_output</span><span class="p">(</span><span class="s2">&quot;templates/sh_ip_int_br.template&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 21.1a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию parse_output_to_dict.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>template - имя файла, в котором находится шаблон TextFSM (templates/sh_ip_int_br.template)</li>
<li>command_output - вывод соответствующей команды show (строка)</li>
</ul>
<p>Функция должна возвращать список словарей:</p>
<ul class="simple">
<li>ключи - имена переменных в шаблоне TextFSM</li>
<li>значения - части вывода, которые соответствуют переменным</li>
</ul>
<p>Проверить работу функции на выводе команды output/sh_ip_int_br.txt и шаблоне templates/sh_ip_int_br.template.</p>
</div>
<div class="section" id="id3">
<h5>Задание 21.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Сделать шаблон TextFSM для обработки вывода sh ip dhcp snooping binding и записать его в файл templates/sh_ip_dhcp_snooping.template</p>
<p>Вывод команды находится в файле output/sh_ip_dhcp_snooping.txt.</p>
<p>Шаблон должен обрабатывать и возвращать значения таких столбцов:</p>
<ul class="simple">
<li>mac - такого вида 00:04:A3:3E:5B:69</li>
<li>ip - такого вида 10.1.10.6</li>
<li>vlan - 10</li>
<li>intf - FastEthernet0/10</li>
</ul>
<p>Проверить работу шаблона с помощью функции parse_command_output из задания 21.1.</p>
</div>
<div class="section" id="id4">
<h5>Задание 21.3<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию parse_command_dynamic.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>command_output - вывод команды (строка)</li>
<li>attributes_dict - словарь атрибутов, в котором находятся такие пары ключ-значение:<ul>
<li>„Command“: команда</li>
<li>„Vendor“: вендор</li>
</ul>
</li>
<li>index_file - имя файла, где хранится соответствие между командами и шаблонами. Значение по умолчанию - «index»</li>
<li>templ_path - каталог, где хранятся шаблоны. Значение по умолчанию - «templates»</li>
</ul>
<p>Функция должна возвращать список словарей с результатами обработки вывода команды (как в задании 21.1a):</p>
<ul class="simple">
<li>ключи - имена переменных в шаблоне TextFSM</li>
<li>значения - части вывода, которые соответствуют переменным</li>
</ul>
<p>Проверить работу функции на примере вывода команды sh ip int br.</p>
</div>
<div class="section" id="id5">
<h5>Задание 21.4<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию send_and_parse_show_command.</p>
<p>Параметры функции:</p>
<ul class="simple">
<li>device_dict - словарь с параметрами подключения к одному устройству</li>
<li>command - команда, которую надо выполнить</li>
<li>templates_path - путь к каталогу с шаблонами TextFSM</li>
<li>index - имя индекс файла, значение по умолчанию «index»</li>
</ul>
<p>Функция должна подключаться к одному устройству, отправлять команду show с помощью netmiko,
а затем парсить вывод команды с помощью TextFSM.</p>
<p>Функция должна возвращать список словарей с результатами обработки вывода команды (как в задании 21.1a):</p>
<ul class="simple">
<li>ключи - имена переменных в шаблоне TextFSM</li>
<li>значения - части вывода, которые соответствуют переменным</li>
</ul>
<p>Проверить работу функции на примере вывода команды sh ip int br и устройствах из devices.yaml.</p>
</div>
<div class="section" id="id6">
<h5>Задание 21.5<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать функцию send_and_parse_command_parallel.</p>
<p>Функция send_and_parse_command_parallel должна запускать в
параллельных потоках функцию send_and_parse_show_command из задания 21.4.</p>
<p>Параметры функции send_and_parse_command_parallel:</p>
<ul class="simple">
<li>devices - список словарей с параметрами подключения к устройствам</li>
<li>command - команда</li>
<li>templates_path - путь к каталогу с шаблонами TextFSM</li>
<li>limit - максимальное количество параллельных потоков (по умолчанию 3)</li>
</ul>
<p>Функция должна возвращать словарь:</p>
<ul class="simple">
<li>ключи - IP-адрес устройства с которого получен вывод</li>
<li>значения - список словарей (вывод который возвращает функция send_and_parse_show_command)</li>
</ul>
<p>Пример словаря:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;Ethernet0/0&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">},</span>
                   <span class="p">{</span><span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.200.1&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;Ethernet0/1&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">}],</span>
 <span class="s1">&#39;192.168.100.2&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.2&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;Ethernet0/0&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">},</span>
                   <span class="p">{</span><span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;10.100.23.2&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;Ethernet0/1&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">}]}</span>
</pre></div>
</div>
<p>Проверить работу функции на примере вывода команды sh ip int br
и устройствах из devices.yaml.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/Part_VI"></span><div class="section" id="vi">
<h2>VI.  Основы объектно-ориентированного программирования<a class="headerlink" href="#vi" title="Ссылка на этот заголовок">¶</a></h2>
<p>Объектно-ориентированное программирование (ООП) - это методология
программирования, в которой программа состоит из объектов, которые
взаимодействуют между собой. Объекты создаются на основании класса,
определенного в коде и, как правило, объединяют данные и действия,
которые можно выполнять с данными, в одно целое.</p>
<p>Без использования ООП вполне можно писать код, но, как минимум, изучение
основ ООП поможет лучше понимать, что такое объект, класс, метод,
переменная объекта, а это те вещи, которые используются в Python
постоянно. Кроме того, знание ООП пригодится в чтении чужого кода.
Например, будет проще разобраться в коде netmiko.</p>
<p>Хотя ООП лежит в основе того как все устроено в Python, при написании
кода не обязательно использовать объектно-ориентированный подход.</p>
<blockquote>
<div>Тут речь о том, что в Python не обязательно нужно создавать классы,
чтобы что-то сделать.</div></blockquote>
<div class="toctree-wrapper compound">
<span id="document-book/22_oop_basics/index"></span><div class="section" id="oop-basics-index">
<span id="id1"></span><h3>22. Основы ООП<a class="headerlink" href="#oop-basics-index" title="Ссылка на этот заголовок">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-book/22_oop_basics/terminology"></span><div class="section" id="id1">
<h4>Основы ООП<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<ul class="simple">
<li>Класс (class) - элемент программы, который описывает какой-то тип
данных. Класс описывает шаблон для создания объектов, как правило,
указывает переменные этого объекта и действия, которые можно
выполнять применимо к объекту.</li>
<li>Экземпляр класса (instance) - объект, который является представителем
класса.</li>
<li>Метод (method) - функция, которая определена внутри класса и
описывает какое-то действие, которое поддерживает класс</li>
<li>Переменная экземпляра (instance variable, а иногда и instance
attribute) - данные, которые относятся к объекту</li>
<li>Переменная класса (class variable) - данные, которые относятся к
классу и разделяются всеми экземплярами класса</li>
<li>Атрибут экземпляра (instance attribute) - переменные и методы,
которые относятся к объектам (экземплярам) созданным на основании
класса. У каждого объекта есть своя копия атрибутов.</li>
</ul>
<p>Пример из реальной жизни в стиле ООП:</p>
<ul class="simple">
<li>Проект дома - это класс</li>
<li>Конкретный дом, который был построен по проекту - экземпляр класса</li>
<li>Такие особенности как цвет дома, количество окон - переменные
экземпляра, то есть конкретного дома</li>
<li>Дом можно продать, перекрасить, отремонтировать - это методы</li>
</ul>
<p>Например, при работе с netmiko первое, что нужно было сделать
создать подключение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">netmiko</span> <span class="kn">import</span> <span class="n">ConnectHandler</span>

<span class="n">device</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;device_type&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco_ios&quot;</span><span class="p">,</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;secret&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">ssh</span> <span class="o">=</span> <span class="n">ConnectHandler</span><span class="p">(</span><span class="o">**</span><span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
<p>Переменная <code class="docutils literal notranslate"><span class="pre">ssh</span></code> - это объект, который представляет реальное
соединение с оборудованием. Благодаря функции type, можно выяснить экземпляром
какого класса является объект ssh:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">ssh</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">netmiko</span><span class="o">.</span><span class="n">cisco</span><span class="o">.</span><span class="n">cisco_ios</span><span class="o">.</span><span class="n">CiscoIosSSH</span>
</pre></div>
</div>
<p>У <code class="docutils literal notranslate"><span class="pre">ssh</span></code> есть свои методы и переменные, которые зависят от состояния
текущего объекта. Например, переменная экземпляра <code class="docutils literal notranslate"><span class="pre">ssh.host</span></code>
доступна у каждого экземпляра класса <code class="docutils literal notranslate"><span class="pre">netmiko.cisco.cisco_ios.CiscoIosSSH</span></code> и возвращает
IP-адрес или имя хоста, в зависимости от того что указывалось в словаре device:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">host</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;192.168.100.1&#39;</span>
</pre></div>
</div>
<p>Метод send_command выполняет команду на оборудовании:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;sh clock&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;*10:08:50.654 UTC Tue Feb 2 2021&#39;</span>
</pre></div>
</div>
<p>Метод enable переходит в режим enable и при этом объект ssh
сохраняет состояние: до и после перехода видно разное приглашение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">find_prompt</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;R1&gt;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;enable</span><span class="se">\r\n</span><span class="s1">Password: </span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">ssh</span><span class="o">.</span><span class="n">find_prompt</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;R1#&#39;</span>
</pre></div>
</div>
<p>В этом примере показаны важные аспекты ООП: объединение данных и
действия над данными, а также сохранение состояния.</p>
<p>До сих пор, при написании кода, данные и действия были
разделены. Чаще всего, действия описаны в виде функций, а данные
передаются как аргументы этим функциям. При создании класса, данные и
действия объединяются. Конечно же, эти данные и действия связаны. То
есть, методами класса становятся те действия, которые характерны именно
для объекта такого типа, а не какие-то произвольные действия.</p>
<p>Например, в экзепляре класса str, все методы относятся к работе с этой
строкой:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;string&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;STRING&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="s1">&#39;=======string=======&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">На примере со строкой понятно, что класс не обязан хранить
состояние - строка неизменяемый тип данных и все методы возвращают
новые строки и не изменяют исходную строку.</p>
</div>
<p>Выше, при обращении к атрибутам экземпляра (переменным и методам)
используется такой синтаксис: <code class="docutils literal notranslate"><span class="pre">objectname.attribute</span></code>. Эта запись
<code class="docutils literal notranslate"><span class="pre">s.lower()</span></code> означает: вызвать метод lower у объекта s. Обращение к
методам и переменным выполняется одинаково, но для вызова метода, надо
добавить скобки и передать все необходимые аргументы.</p>
<p>Всё описанное неоднократно использовалось в книге, но теперь мы
разберемся с формальной терминологией.</p>
</div>
<span id="document-book/22_oop_basics/create_class"></span><div class="section" id="id1">
<h4>Создание класса<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Обратите внимание, что тут основы поясняются с учетом того, что у
читающего нет опыта работы с ООП. Некоторые примеры не очень
правильны с точки зрения идеологии Python, но помогают лучше понять
происходящее. В конце даются пояснения как это правильней делать.</p>
</div>
<p>Для создания классов в питоне используется ключевое слово <code class="docutils literal notranslate"><span class="pre">class</span></code>.
Самый простой класс, который можно создать в Python:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Switch</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">pass</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Имена классов: в Python принято писать имена классов в формате
CamelCase.</p>
</div>
<p>Для создания экземпляра класса, надо вызвать класс:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">sw1</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">sw1</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">Switch</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0xb44963ac</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Используя точечную нотацию, можно получать значения переменных
экземпляра, создавать новые переменные и присваивать новое значение
существующим:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;Cisco 3850&#39;</span>
</pre></div>
</div>
<p>В другом экземпляре класса Switch, переменные могут быть другие:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">sw2</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">sw2</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw2&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">sw2</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;Cisco 3750&#39;</span>
</pre></div>
</div>
<p>Посмотреть значение переменных экземпляра можно используя ту же точечную
нотацию:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">model</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;Cisco 3850&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">sw2</span><span class="o">.</span><span class="n">model</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;Cisco 3750&#39;</span>
</pre></div>
</div>
</div>
<span id="document-book/22_oop_basics/create_methods"></span><div class="section" id="id1">
<h4>Создание метода<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Прежде чем мы начнем разбираться с методами класса, посмотрим пример
функции, которая ожидает как аргумент экземпляр класса Switch и выводит
информацию о нем, используя переменные экземпляра hostname и model:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">sw_obj</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hostname: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sw_obj</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">sw_obj</span><span class="o">.</span><span class="n">model</span><span class="p">))</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">sw1</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;Cisco 3850&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">info</span><span class="p">(</span><span class="n">sw1</span><span class="p">)</span>
<span class="n">Hostname</span><span class="p">:</span> <span class="n">sw1</span>
<span class="n">Model</span><span class="p">:</span> <span class="n">Cisco</span> <span class="mi">3850</span>
</pre></div>
</div>
<p>В функции info параметр <code class="docutils literal notranslate"><span class="pre">sw_obj</span></code> ожидает экземпляр класса <code class="docutils literal notranslate"><span class="pre">Switch</span></code>.
Скорее всего, в этом примере нет ничего нового, ведь аналогичным образом
ранее мы писали функции, которые ожидают строку, как аргумент, а затем
вызывают какие-то методы у этой строки.</p>
<p>Этот пример поможет разобраться с методом info, который мы добавим в
класс Switch.</p>
<p>Для добавления метода, необходимо создать функцию внутри класса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Switch</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hostname: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Если присмотреться, метод info выглядит точно так же, как функция info,
только вместо имени sw_obj, используется self. Почему тут используется
странное имя self, мы разберемся позже, а пока посмотрим как вызвать
метод info:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">sw1</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;Cisco 3850&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">Hostname</span><span class="p">:</span> <span class="n">sw1</span>
<span class="n">Model</span><span class="p">:</span> <span class="n">Cisco</span> <span class="mi">3850</span>
</pre></div>
</div>
<p>В примере выше сначала создается экземпляр класса Switch, затем в
экземпляр добавляются переменные hostname и model, и только после этого
вызывается метод info. Метод info выводит информацию про коммутатор,
используя значения, которые хранятся в переменных экземпляра.</p>
<p>Вызов метода отличается, от вызова функции: мы не передаем ссылку на
экземпляр класса Switch. Нам это не нужно, потому что мы вызываем метод
у самого экземпляра. Еще один непонятный момент - зачем же мы тогда
писали self.</p>
<p>Все дело в том, что Python преобразует такой вызов:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">Hostname</span><span class="p">:</span> <span class="n">sw1</span>
<span class="n">Model</span><span class="p">:</span> <span class="n">Cisco</span> <span class="mi">3850</span>
</pre></div>
</div>
<p>Вот в такой:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">Switch</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">sw1</span><span class="p">)</span>
<span class="n">Hostname</span><span class="p">:</span> <span class="n">sw1</span>
<span class="n">Model</span><span class="p">:</span> <span class="n">Cisco</span> <span class="mi">3850</span>
</pre></div>
</div>
<p>Во втором случае, в параметре self уже больше смысла, он действительно
принимает ссылку на экземпляр и на основании этого выводит информацию.</p>
<p>С точки зрения использования объектов, удобней вызывать методы используя
первый вариант синтаксиса, поэтому, практически всегда именно он и
используется.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">При вызове метода экземпляра класса, ссылка на экземпляр передается
первым аргументом. При этом, экземпляр передается неявно, но
параметр надо указывать явно.</p>
</div>
<p>Такое преобразование не является особенностью пользовательских классов и
работает и для встроенных типов данных аналогично. Например, стандартный
способ вызова метода append в списке, выглядит так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">a</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<p>При этом, то же самое можно сделать и используя второй вариант, вызова
через класс:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">a</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<span id="document-book/22_oop_basics/parameter_self"></span><div class="section" id="self">
<h4>Параметр self<a class="headerlink" href="#self" title="Ссылка на этот заголовок">¶</a></h4>
<p>Параметр self указывался выше в определении методов, а также при
использовании переменных экземпляра в методе. Параметр self это ссылка
на конкретный экземпляр класса. При этом, само имя self не является
особенным, а лишь договоренностью. Вместо self можно использовать другое
имя, но так делать не стоит.</p>
<p>Пример с использованием другого имени, вместо self:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Switch</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">sw_object</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hostname: </span><span class="si">{</span><span class="n">sw_object</span><span class="o">.</span><span class="n">hostname</span><span class="si">}</span><span class="se">\n</span><span class="s1">Model: </span><span class="si">{</span><span class="n">sw_object</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Работать все будет аналогично:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">sw1</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;Cisco 3850&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">Hostname</span><span class="p">:</span> <span class="n">sw1</span>
<span class="n">Model</span><span class="p">:</span> <span class="n">Cisco</span> <span class="mi">3850</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Хотя технически использовать другое имя можно, всегда используйте
self.</p>
</div>
<p>Во всех «обычных» методах класса первым параметром всегда будет self.
Кроме того, создание переменной экземпляра внутри класса также
выполняется через self.</p>
<p>Пример класса Switch с новым методом generate_interfaces: метод
generate_interfaces должен сгенерировать список с интерфейсами на
основании указанного типа и количества и создать переменную в экземпляре
класса. Для начала, вариант создания обычно переменной внутри метода:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Switch</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">generate_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intf_type</span><span class="p">,</span> <span class="n">number_of_intf</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">interfaces</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">intf_type</span><span class="si">}{</span><span class="n">number</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_intf</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>В этом случае, в экземплярах класса не будет переменной interfaces:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">sw1</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">generate_interfaces</span><span class="p">(</span><span class="s1">&#39;Fa&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">interfaces</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="n">e6b457e4e23e</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">sw1</span><span class="o">.</span><span class="n">interfaces</span>

<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;Switch&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;interfaces&#39;</span>
</pre></div>
</div>
<p>Этой переменной нет, потому что она существует только внутри метода, а
область видимости у метода такая же, как и у функции. Даже другие методы
одного и того же класса, не видят переменные в других методах.</p>
<p>Чтобы список с интерфейсами был доступен как переменная в экземплярах,
надо присвоить значение в self.interfaces:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Switch</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hostname: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="si">}</span><span class="se">\n</span><span class="s2">Model: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">generate_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intf_type</span><span class="p">,</span> <span class="n">number_of_intf</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">interfaces</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">intf_type</span><span class="si">}{</span><span class="n">number</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_intf</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span> <span class="o">=</span> <span class="n">interfaces</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Теперь, после вызова метода generate_interfaces, в экземпляре создается
переменная interfaces:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">sw1</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">generate_interfaces</span><span class="p">(</span><span class="s1">&#39;Fa&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">interfaces</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;Fa1&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa2&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa3&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa4&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa5&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa6&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa7&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa8&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa9&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa10&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<span id="document-book/22_oop_basics/init_method"></span><div class="section" id="init">
<h4>Метод <code class="docutils literal notranslate"><span class="pre">__init__</span></code><a class="headerlink" href="#init" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для корректной работы метода info, необходимо чтобы у экземпляра были
переменные hostname и model. Если этих переменных нет, возникнет ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Switch</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hostname: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="n">sw2</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="n">sw2</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">60</span><span class="o">-</span><span class="mi">5</span><span class="n">a006dd8aae1</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">sw2</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">57</span><span class="o">-</span><span class="mi">30</span><span class="n">b05739380d</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
      <span class="mi">1</span> <span class="k">class</span> <span class="nc">Switch</span><span class="p">:</span>
      <span class="mi">2</span>     <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="o">----&gt;</span> <span class="mi">3</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hostname: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">))</span>

<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;Switch&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;hostname&#39;</span>
</pre></div>
</div>
<p>Практически всегда, при создании объекта, у него есть какие-то начальные
данные. Например, чтобы создать подключение к оборудование с помощью
netmiko, надо передать параметры подключения.</p>
<p>В Python эти начальные данные про объект указываются в методе
<code class="docutils literal notranslate"><span class="pre">__init__</span></code>. Метод <code class="docutils literal notranslate"><span class="pre">__init__</span></code> выполняется после того как Python
создал новый экземпляр и, при этом, методу <code class="docutils literal notranslate"><span class="pre">__init__</span></code> передаются
аргументы с которыми был создан экземпляр:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Switch</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">hostname</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hostname: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="si">}</span><span class="se">\n</span><span class="s1">Model: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Обратите внимание на то, что у каждого экземпляра, который создан из этого класса,
будут созданы переменные: <code class="docutils literal notranslate"><span class="pre">self.model</span></code> и <code class="docutils literal notranslate"><span class="pre">self.hostname</span></code>.</p>
<p>Теперь, при создании экземпляра класса Switch, обязательно надо указать
hostname и model:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">sw1</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">(</span><span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3850&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>И, соответственно, метод info отрабатывает без ошибок:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">Hostname</span><span class="p">:</span> <span class="n">sw1</span>
<span class="n">Model</span><span class="p">:</span> <span class="n">Cisco</span> <span class="mi">3850</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Метод <code class="docutils literal notranslate"><span class="pre">__init__</span></code> иногда называют конструктором класса, хотя
технически в Python сначала выполняется метод <code class="docutils literal notranslate"><span class="pre">__new__</span></code>, а затем
<code class="docutils literal notranslate"><span class="pre">__init__</span></code>. В большинстве случаев, метод <code class="docutils literal notranslate"><span class="pre">__new__</span></code> использовать
не нужно.</p>
</div>
<p>Важной особенностью метода <code class="docutils literal notranslate"><span class="pre">__init__</span></code> является то, что он не должен
ничего возвращать. Python сгенерирует исключение, если попытаться это
сделать.</p>
</div>
<span id="document-book/22_oop_basics/class_example"></span><div class="section" id="id1">
<h4>Пример класса<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Пример класса, который описывает сеть:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Network</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span><span class="o">.</span><span class="n">hosts</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocated</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">allocated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IP-адрес </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> уже находится в allocated&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IP-адрес </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> не входит в сеть </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Использование класса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">net1</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s2">&quot;10.1.1.0/29&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">net1</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;10.1.1.1&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">net1</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;10.1.1.2&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">net1</span><span class="o">.</span><span class="n">allocated</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.2&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">net1</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;10.1.1.100&quot;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span>                                <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="mi">9</span><span class="n">a4157e02c78</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">net1</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;10.1.1.100&quot;</span><span class="p">)</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">c5255d37a7fd</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="n">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">)</span>
     <span class="mi">12</span>                 <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IP-адрес </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> уже находится в allocated&quot;</span><span class="p">)</span>
     <span class="mi">13</span>         <span class="k">else</span><span class="p">:</span>
<span class="o">---&gt;</span> <span class="mi">14</span>             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IP-адрес </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> не входит в сеть </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
     <span class="mi">15</span>

<span class="ne">ValueError</span><span class="p">:</span> <span class="n">IP</span><span class="o">-</span><span class="n">адрес</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.100</span> <span class="n">не</span> <span class="n">входит</span> <span class="n">в</span> <span class="n">сеть</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">29</span>
</pre></div>
</div>
</div>
<span id="document-book/22_oop_basics/class_namespace"></span><div class="section" id="id1">
<h4>Область видимости<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>У каждого метода в классе своя локальная область видимости. Это значит,
что один метод класса не видит переменные другого метода класса. Для
того чтобы переменные были доступны, надо присваивать их экземпляру
через <code class="docutils literal notranslate"><span class="pre">self.name</span></code>.
По сути метод - это функция привязанная к объекту. Поэтому все
нюансы, которые касаются функция, относятся и к методам.</p>
<p>Переменные экземпляра доступны в другом методе, потому что каждому
методу первым аргументом передается сам экзепляр. В примере ниже, в
методе <code class="docutils literal notranslate"><span class="pre">__init__</span></code> переменные hostname и model присваиваются
экземпляру, а затем в info используются, за счет того, что экземпляр
передается первым аргументом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Switch</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">hostname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hostname: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">))</span>
</pre></div>
</div>
</div>
<span id="document-book/22_oop_basics/class_variables"></span><div class="section" id="id1">
<h4>Переменные класса<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Помимо переменных экземпляра, существуют также переменные класса. Они
создаются, при указании переменных внутри самого класса, не метода:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Network</span><span class="p">:</span>
    <span class="n">all_allocated_ip</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span><span class="o">.</span><span class="n">hosts</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocated</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">allocated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
                <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">all_allocated_ip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IP-адрес </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> уже находится в allocated&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IP-адрес </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> не входит в сеть </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>К переменным класса можно обращаться по-разному:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">self.all_allocated_ip</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Network.all_allocated_ip</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">type(self).all_allocated_ip</span></code></li>
</ul>
<p>Вариант <code class="docutils literal notranslate"><span class="pre">self.all_allocated_ip</span></code> позволяет обратиться к значению переменной
класса или добавить элемент, если переменная класса изменяемый тип данных.
Минус этого варианта в том, что если в методе написать
<code class="docutils literal notranslate"><span class="pre">self.all_allocated_ip</span> <span class="pre">=</span> <span class="pre">...</span></code>, вместо изменения переменной класса,
будет создана переменная экземпляра.</p>
<p>Вариант <code class="docutils literal notranslate"><span class="pre">Network.all_allocated_ip</span></code> будет работать корректно, но небольшой минус
этого варианта в том, что имя класса прописано вручную.
Вместо него можно использовать третий вариант <code class="docutils literal notranslate"><span class="pre">type(self).all_allocated_ip</span></code>,
так как <code class="docutils literal notranslate"><span class="pre">type(self)</span></code> возвращает класс.</p>
<p>Теперь у класса есть переменная all_allocated_ip в которую записываются
все IP-адреса, которые выделены в сетях:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">net1</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s2">&quot;10.1.1.0/29&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">net1</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;10.1.1.1&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">net1</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;10.1.1.2&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">net1</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;10.1.1.3&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">net1</span><span class="o">.</span><span class="n">allocated</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.3&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">net2</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s2">&quot;10.2.2.0/29&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">net2</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;10.2.2.1&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span> <span class="n">net2</span><span class="o">.</span><span class="n">allocate</span><span class="p">(</span><span class="s2">&quot;10.2.2.2&quot;</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">net2</span><span class="o">.</span><span class="n">allocated</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.2.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2.2.2&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">Network</span><span class="o">.</span><span class="n">all_allocated_ip</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.3&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2.2.2&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Переменная доступна не только через класс, но и через экземпляры:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">Network</span><span class="o">.</span><span class="n">all_allocated_ip</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.3&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2.2.2&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">net1</span><span class="o">.</span><span class="n">all_allocated_ip</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.3&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2.2.2&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">net2</span><span class="o">.</span><span class="n">all_allocated_ip</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.2&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.3&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2.2.1&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2.2.2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<span id="document-exercises/22_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 22.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать класс Topology, который представляет топологию сети.</p>
<p>При создании экземпляра класса, как аргумент передается словарь,
который описывает топологию. Словарь может содержать «дублирующиеся» соединения.
Тут «дублирующиеся» соединения, это ситуация когда в словаре есть два соединения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/1&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="s2">&quot;SW1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/1&quot;</span><span class="p">):</span> <span class="p">(</span><span class="s2">&quot;R1&quot;</span><span class="p">,</span> <span class="s2">&quot;Eth0/0&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Задача оставить только один из этих линков в итоговом словаре, не важно какой.</p>
<p>В каждом экземпляре должна быть создана переменная topology, в которой содержится
словарь топологии, но уже без «дублей». Переменная topology должна содержать словарь
без «дублей» сразу после создания экземпляра.</p>
<p>Пример создания экземпляра класса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">top</span> <span class="o">=</span> <span class="n">Topology</span><span class="p">(</span><span class="n">topology_example</span><span class="p">)</span>
</pre></div>
</div>
<p>После этого, должна быть доступна переменная topology:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">top</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
<span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">topology_example</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 22.1a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать класс Topology из задания 22.1 и изменить его.</p>
<p>Перенести функциональность удаления «дублей» в метод _normalize.
При этом метод __init__ должен выглядеть таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Topology</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topology_dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topology</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize</span><span class="p">(</span><span class="n">topology_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="b">
<h5>Задание 22.1b<a class="headerlink" href="#b" title="Ссылка на этот заголовок">¶</a></h5>
<p>Изменить класс Topology из задания 22.1a или 22.1.</p>
<p>Добавить метод delete_link, который удаляет указанное соединение.
Метод должен удалять и «обратное» соединение, если оно есть (ниже пример).</p>
<p>Если такого соединения нет, выводится сообщение «Такого соединения нет».</p>
<p>Создание топологии</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Topology</span><span class="p">(</span><span class="n">topology_example</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span>
<span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Удаление линка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">delete_link</span><span class="p">((</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
<span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Удаление «обратного» линка:
в словаре есть запись <code class="docutils literal notranslate"><span class="pre">('R3',</span> <span class="pre">'Eth0/2'):</span> <span class="pre">('R5',</span> <span class="pre">'Eth0/0')</span></code>, но вызов delete_link
с указанием ключа и значения в обратном порядке, должно удалять соединение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">delete_link</span><span class="p">((</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span>
<span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Если такого соединения нет, выводится сообщение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">delete_link</span><span class="p">((</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">))</span>
<span class="n">Такого</span> <span class="n">соединения</span> <span class="n">нет</span>
</pre></div>
</div>
</div>
<div class="section" id="c">
<h5>Задание 22.1c<a class="headerlink" href="#c" title="Ссылка на этот заголовок">¶</a></h5>
<p>Изменить класс Topology из задания 22.1b.</p>
<p>Добавить метод delete_node, который удаляет все соединения с указаным устройством.
Если такого устройства нет, выводится сообщение «Такого устройства нет».</p>
<p>Создание топологии</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Topology</span><span class="p">(</span><span class="n">topology_example</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
<span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Удаление устройства:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">delete_node</span><span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
<span class="p">{(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Если такого устройства нет, выводится сообщение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">delete_node</span><span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">)</span>
<span class="n">Такого</span> <span class="n">устройства</span> <span class="n">нет</span>
</pre></div>
</div>
</div>
<div class="section" id="d">
<h5>Задание 22.1d<a class="headerlink" href="#d" title="Ссылка на этот заголовок">¶</a></h5>
<p>Изменить класс Topology из задания 22.1c</p>
<p>Добавить метод add_link, который добавляет указанное соединение, если его еще нет в топологии.
Если соединение существует, вывести сообщение «Такое соединение существует».
Если одна из сторон есть в топологии, вывести сообщение «Cоединение с одним из портов существует».</p>
<p>Пример создания топологии и добавления соединений</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Topology</span><span class="p">(</span><span class="n">topology_example</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span>
<span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">add_link</span><span class="p">((</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;R7&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
<span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/4&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R7&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">add_link</span><span class="p">((</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;R7&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">))</span>
<span class="n">Такое</span> <span class="n">соединение</span> <span class="n">существует</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">add_link</span><span class="p">((</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;R7&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/5&#39;</span><span class="p">))</span>
<span class="n">Cоединение</span> <span class="n">с</span> <span class="n">одним</span> <span class="n">из</span> <span class="n">портов</span> <span class="n">существует</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Задание 22.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать класс CiscoTelnet, который подключается по Telnet к оборудованию Cisco.</p>
<p>При создании экземпляра класса, должно создаваться подключение Telnet, а также переход в режим enable.
Класс должен использовать модуль telnetlib для подключения по Telnet.</p>
<p>У класса CiscoTelnet, кроме __init__, должно быть, как минимум, два метода:</p>
<ul class="simple">
<li>_write_line - принимает как аргумент строку и отправляет на оборудование строку преобразованную в байты и добавляет перевод строки в конце.
Метод _write_line должен использоваться внутри класса.</li>
<li>send_show_command - принимает как аргумент команду show и возвращает вывод полученный с обрудования</li>
</ul>
<p>Параметры метода __init__:</p>
<ul class="simple">
<li>ip - IP-адрес</li>
<li>username - имя пользователя</li>
<li>password - пароль</li>
<li>secret - пароль enable</li>
</ul>
<p>Пример создания экземпляра класса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_22_2</span> <span class="kn">import</span> <span class="n">CiscoTelnet</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1_params</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">}</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">CiscoTelnet</span><span class="p">(</span><span class="o">**</span><span class="n">r1_params</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh ip int br&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;sh ip int br</span><span class="se">\r\n</span><span class="s1">Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\r\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/2                190.16.200.1    YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3                192.168.130.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Loopback0                  10.1.1.1        YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Loopback55                 5.5.5.5         YES manual up                    up      </span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Подсказка:
Метод _write_line нужен для того чтобы можно было сократить строку: <code class="docutils literal notranslate"><span class="pre">self.telnet.write(line.encode(&quot;ascii&quot;)</span> <span class="pre">+</span> <span class="pre">b&quot;\n&quot;)</span></code> до такой: <code class="docutils literal notranslate"><span class="pre">self._write_line(line)</span></code>.
Он не должен делать ничего другого.</p>
</div>
</div>
<div class="section" id="id4">
<h5>Задание 22.2a<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать класс CiscoTelnet из задания 22.2 и изменить метод send_show_command добавив три параметра:</p>
<ul class="simple">
<li>parse - контролирует то, будет возвращаться обычный вывод команды или список словарей, полученные после обработки с помощью TextFSM. При parse=True должен возвращаться список словарей, а parse=False обычный вывод. Значение по умолчанию - True.</li>
<li>templates - путь к каталогу с шаблонами. Значение по умолчанию - «templates»</li>
<li>index - имя файла, где хранится соответствие между командами и шаблонами. Значение по умолчанию - «index»</li>
</ul>
<p>Пример создания экземпляра класса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">r1_params</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_22_2a</span> <span class="kn">import</span> <span class="n">CiscoTelnet</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">CiscoTelnet</span><span class="p">(</span><span class="o">**</span><span class="n">r1_params</span><span class="p">)</span>
</pre></div>
</div>
<p>Использование метода send_show_command:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s2">&quot;sh ip int br&quot;</span><span class="p">,</span> <span class="n">parse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
<span class="p">[{</span><span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;Ethernet0/0&#39;</span><span class="p">,</span>
  <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;Ethernet0/1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.200.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">},</span>
 <span class="p">{</span><span class="s1">&#39;intf&#39;</span><span class="p">:</span> <span class="s1">&#39;Ethernet0/2&#39;</span><span class="p">,</span>
  <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.130.1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
  <span class="s1">&#39;protocol&#39;</span><span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">}]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s2">&quot;sh ip int br&quot;</span><span class="p">,</span> <span class="n">parse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;sh ip int br</span><span class="se">\r\n</span><span class="s1">Interface                  IP-Address      OK? Method Status</span>
<span class="n">Protocol</span>\<span class="n">r</span>\<span class="n">nEthernet0</span><span class="o">/</span><span class="mi">0</span>                <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span>   <span class="n">YES</span> <span class="n">NVRAM</span>  <span class="n">up</span>
<span class="n">up</span>      \<span class="n">r</span>\<span class="n">nEthernet0</span><span class="o">/</span><span class="mi">1</span>                <span class="mf">192.168</span><span class="o">.</span><span class="mf">200.1</span>   <span class="n">YES</span> <span class="n">NVRAM</span>  <span class="n">up</span><span class="o">...</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Задание 22.2b<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать класс CiscoTelnet из задания 22.2a и добавить метод send_config_commands.</p>
<p>Метод send_config_commands должен уметь отправлять одну команду конфигурационного режима или список команд.
Метод дожен возвращать вывод аналогичный методу send_config_set у netmiko (пример вывода ниже).</p>
<p>Пример создания экземпляра класса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_22_2b</span> <span class="kn">import</span> <span class="n">CiscoTelnet</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">r1_params</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">CiscoTelnet</span><span class="p">(</span><span class="o">**</span><span class="n">r1_params</span><span class="p">)</span>
</pre></div>
</div>
<p>Использование метода send_config_commands:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_config_commands</span><span class="p">(</span><span class="s1">&#39;logging 10.1.1.1&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;conf t</span><span class="se">\r\n</span><span class="s1">Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\r\n</span><span class="s1">R1(config)#logging 10.1.1.1</span><span class="se">\r\n</span><span class="s1">R1(config)#end</span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_config_commands</span><span class="p">([</span><span class="s1">&#39;interface loop55&#39;</span><span class="p">,</span> <span class="s1">&#39;ip address 5.5.5.5 255.255.255.255&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;conf t</span><span class="se">\r\n</span><span class="s1">Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\r\n</span><span class="s1">R1(config)#interface loop55</span><span class="se">\r\n</span><span class="s1">R1(config-if)#ip address 5.5.5.5 255.255.255.255</span><span class="se">\r\n</span><span class="s1">R1(config-if)#end</span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>Задание 22.2c<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать класс CiscoTelnet из задания 22.2b и изменить метод send_config_commands добавив проверку команд на ошибки.</p>
<p>У метода send_config_commands должен быть дополнительный параметр strict:</p>
<ul class="simple">
<li>strict=True значит, что при обнаружении ошибки, необходимо сгенерировать исключение ValueError (значение по умолчанию)</li>
<li>strict=False значит, что при обнаружении ошибки, надо только вывести на стандартный поток вывода сообщене об ошибке</li>
</ul>
<p>Метод дожен возвращать вывод аналогичный методу send_config_set у netmiko (пример вывода ниже). Текст исключения и ошибки в примере ниже.</p>
<p>Пример создания экземпляра класса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_22_2c</span> <span class="kn">import</span> <span class="n">CiscoTelnet</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">r1_params</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">CiscoTelnet</span><span class="p">(</span><span class="o">**</span><span class="n">r1_params</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">commands_with_errors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;logging 0255.255.1&#39;</span><span class="p">,</span> <span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">correct_commands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;logging buffered 20010&#39;</span><span class="p">,</span> <span class="s1">&#39;ip http server&#39;</span><span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">commands</span> <span class="o">=</span> <span class="n">commands_with_errors</span><span class="o">+</span><span class="n">correct_commands</span>
</pre></div>
</div>
<p>Использование метода send_config_commands:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">send_config_commands</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">При</span> <span class="n">выполнении</span> <span class="n">команды</span> <span class="s2">&quot;logging 0255.255.1&quot;</span> <span class="n">на</span> <span class="n">устройстве</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="n">возникла</span> <span class="n">ошибка</span> <span class="o">-&gt;</span> <span class="n">Invalid</span> <span class="nb">input</span> <span class="n">detected</span> <span class="n">at</span> <span class="s1">&#39;^&#39;</span> <span class="n">marker</span><span class="o">.</span>
<span class="n">При</span> <span class="n">выполнении</span> <span class="n">команды</span> <span class="s2">&quot;logging&quot;</span> <span class="n">на</span> <span class="n">устройстве</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="n">возникла</span> <span class="n">ошибка</span> <span class="o">-&gt;</span> <span class="n">Incomplete</span> <span class="n">command</span><span class="o">.</span>
<span class="n">При</span> <span class="n">выполнении</span> <span class="n">команды</span> <span class="s2">&quot;a&quot;</span> <span class="n">на</span> <span class="n">устройстве</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="n">возникла</span> <span class="n">ошибка</span> <span class="o">-&gt;</span> <span class="n">Ambiguous</span> <span class="n">command</span><span class="p">:</span>  <span class="s2">&quot;a&quot;</span>
<span class="n">conf</span> <span class="n">t</span>
<span class="n">Enter</span> <span class="n">configuration</span> <span class="n">commands</span><span class="p">,</span> <span class="n">one</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>  <span class="n">End</span> <span class="k">with</span> <span class="n">CNTL</span><span class="o">/</span><span class="n">Z</span><span class="o">.</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#logging 0255.255.1</span>
                   <span class="o">^</span>
<span class="o">%</span> <span class="n">Invalid</span> <span class="nb">input</span> <span class="n">detected</span> <span class="n">at</span> <span class="s1">&#39;^&#39;</span> <span class="n">marker</span><span class="o">.</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#logging</span>
<span class="o">%</span> <span class="n">Incomplete</span> <span class="n">command</span><span class="o">.</span>

<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#a</span>
<span class="o">%</span> <span class="n">Ambiguous</span> <span class="n">command</span><span class="p">:</span>  <span class="s2">&quot;a&quot;</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#logging buffered 20010</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#ip http server</span>
<span class="n">R1</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1">#end</span>
<span class="n">R1</span><span class="c1">#</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">send_config_commands</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span>                                <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="mi">0</span><span class="n">abc1ed8602e</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">send_config_commands</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="o">...</span>

<span class="ne">ValueError</span><span class="p">:</span> <span class="n">При</span> <span class="n">выполнении</span> <span class="n">команды</span> <span class="s2">&quot;logging 0255.255.1&quot;</span> <span class="n">на</span> <span class="n">устройстве</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="n">возникла</span> <span class="n">ошибка</span> <span class="o">-&gt;</span> <span class="n">Invalid</span> <span class="nb">input</span> <span class="n">detected</span> <span class="n">at</span> <span class="s1">&#39;^&#39;</span> <span class="n">marker</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/23_oop_special_methods/index"></span><div class="section" id="oop-special-methods-index">
<span id="id1"></span><h3>23. Специальные методы<a class="headerlink" href="#oop-special-methods-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>Специальные методы в Python - это методы, которые отвечают за «стандартные» возможности
объектов и вызываются автоматически при использовани этих возможностей.
Например, выражение <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></code>, где a и b это числа, преобразуется в такой вызов
<code class="docutils literal notranslate"><span class="pre">a.__add__(b)</span></code>, то есть, специальный метод __add__ отвечает за операцию сложения.
Все специальные методы начинаются и заканчиваются двойным подчеркиванием, поэтому
на английском их часто называют dunder методы, сокращенно от «double underscore».</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Специальные методы часто называют волшебными (magic) методами.</p>
</div>
<p>Специальные методы отвечают за такие возможности как работа в менеджерах контекста,
создание итераторов и итерируемых объектов, операции сложения, умножения и другие.
Добавляя специальные методы в объекты, которые созданы пользователем, мы делаем
их похожими на встроенные объекты.</p>
<div class="toctree-wrapper compound">
<span id="document-book/23_oop_special_methods/underscore_names"></span><div class="section" id="id1">
<h4>Подчеркивание в именах<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python подчеркивание в начале или в конце имени указывает на
специальные имена. Чаще всего это всего лишь договоренность, но иногда
это действительно влияет на поведение объекта.</p>
<div class="section" id="id2">
<h5>Одно подчеркивание перед именем<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Одно подчеркивание перед именем метода указывает, что метод является
внутренней особенностью реализации и его не стоит использовать напрямую.</p>
<p>Например, класс CiscoSSH использует paramiko для подключения к оборудованию:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">paramiko</span>


<span class="k">class</span> <span class="nc">CiscoSSH</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">disable_paging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">hostname</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
            <span class="n">look_for_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">allow_agent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">invoke_shell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;enable</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">enable</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">disable_paging</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;terminal length 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>После создания экземпляра класса, доступен не только метод send_show_command,
но и атрибуты client и ssh (3 строка это подсказки по tab в ipython):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">CiscoSSH</span><span class="p">(</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span>
            <span class="n">client</span>
            <span class="n">send_show_command</span><span class="p">()</span>
            <span class="n">ssh</span>
</pre></div>
</div>
<p>Если же необходимо указать, что client и ssh являются внутренними атрибутами,
которые нужны для работы класса, но не предназначены для пользователя,
надо поставить нижнее подчеркивание перед именем:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CiscoSSH</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">disable_paging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">hostname</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
            <span class="n">look_for_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">allow_agent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">invoke_shell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;enable</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">enable</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">disable_paging</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;terminal length 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Часто такие методы и атрибуты называются приватными, но это не значит,
что методы и переменные недоступны пользователю.</p>
</div>
</div>
<div class="section" id="id3">
<h5>Два подчеркивания перед именем<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Два подчеркивания перед именем метода используются не просто как
договоренность. Такие имена трансформируются в формат «имя класса + имя
метода». Это позволяет создавать уникальные методы и атрибуты классов.</p>
<p>Такое преобразование выполняется только в том случае, если в конце
менее двух подчеркиваний или нет подчеркиваний.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Switch</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">__quantity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">__configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">pass</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;_Switch__configure&#39;</span><span class="p">,</span> <span class="s1">&#39;_Switch__quantity&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>Хотя методы создавались без приставки <code class="docutils literal notranslate"><span class="pre">_Switch</span></code>, она была добавлена.</p>
<p>Если создать подкласс, то метод <code class="docutils literal notranslate"><span class="pre">__configure</span></code> не перепишет метод
родительского класса Switch:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">CiscoSwitch</span><span class="p">(</span><span class="n">Switch</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">__quantity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">__configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">pass</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">(</span><span class="n">CiscoSwitch</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;_CiscoSwitch__configure&#39;</span><span class="p">,</span> <span class="s1">&#39;_CiscoSwitch__quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;_Switch__configure&#39;</span><span class="p">,</span> <span class="s1">&#39;_Switch__quantity&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="id4">
<h6>Два подчеркивания перед и после имени<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h6>
<p>Таким образом обозначаются специальные переменные и методы.</p>
<p>Например, в модуле Python есть такие специальные переменные:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">__name__</span></code> - эта переменная равна строке <code class="docutils literal notranslate"><span class="pre">__main__</span></code>, когда скрипт
запускается напрямую, и равна имени модуля, когда импортируется</li>
<li><code class="docutils literal notranslate"><span class="pre">__file__</span></code> - эта переменная равна имени скрипта, который был запущен
напрямую, и равна полному пути к модулю, когда он импортируется</li>
</ul>
<p>Переменная <code class="docutils literal notranslate"><span class="pre">__name__</span></code> чаще всего используется, чтобы указать, что
определенная часть кода должна выполняться, только когда модуль
выполняется напрямую:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>А переменная <code class="docutils literal notranslate"><span class="pre">__file__</span></code> может быть полезна в определении текущего пути
к файлу скрипта:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;__file__&#39;</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</pre></div>
</div>
<p>Вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="vm">__file__</span> <span class="n">example2</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">example2</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Кроме того, таким образом в Python обозначаются специальные методы. Эти
методы вызываются при использовании функций и операторов Python и
позволяют реализовать определенный функционал.</p>
<p>Как правило, такие методы не нужно вызывать напрямую. Но, например, при
создании своего класса может понадобиться описать такой метод, чтобы
объект поддерживал какие-то операции в Python.</p>
<p>Например, для того, чтобы можно было получить длину объекта, он должен
поддерживать метод <code class="docutils literal notranslate"><span class="pre">__len__</span></code>.</p>
</div>
</div>
</div>
<span id="document-book/23_oop_special_methods/str_repr"></span><div class="section" id="str-repr">
<h4>Методы __str__, __repr__<a class="headerlink" href="#str-repr" title="Ссылка на этот заголовок">¶</a></h4>
<p>Специальные методы __str__ и __repr__ отвечают за строковое представления
объекта. При этом используются они в разных местах.</p>
<p>Рассмотрим пример класса IPAddress, который отвечает за представление
IPv4 адреса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">IPAddress</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>После создания экземпляров класса, у них есть строковое представление по
умолчанию, которое выглядит так (этот же вывод отображается при использовании print):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">ip2</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.2.2.2&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ip1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;&lt;__main__.IPAddress object at 0xb4e4e76c&gt;&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ip2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;&lt;__main__.IPAddress object at 0xb1bd376c&gt;&#39;</span>
</pre></div>
</div>
<p>К сожалению, это представление не очень информативно. И было бы лучше, если бы
отображалась информация о том, какой именно адрес представляет этот экземпляр.
За отображение информации при применении функции str, отвечает специальный метод __str__ -
как аргумент метод ожидает только экземпляр и должен возвращать строку</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">IPAddress</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;IPAddress: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">ip2</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.2.2.2&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ip1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s1">&#39;IPAddress: 10.1.1.1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ip2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;IPAddress: 10.2.2.2&#39;</span>
</pre></div>
</div>
<p>Второе строковое представление, которое используется в объектах Python, отображается
при использовании функции repr, а также при добавлении объектов в контейнеры типа списков:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">ip_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">ip1</span><span class="p">,</span> <span class="n">ip2</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">ip_addresses</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">IPAddress</span> <span class="n">at</span> <span class="mh">0xb4e40c8c</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">IPAddress</span> <span class="n">at</span> <span class="mh">0xb1bc46ac</span><span class="o">&gt;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">ip1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="s1">&#39;&lt;__main__.IPAddress object at 0xb4e40c8c&gt;&#39;</span>
</pre></div>
</div>
<p>За это отображение отвечает метод __repr__, он тоже должен возвращать строку,
но при этом принято, чтобы метод возвращал строку, скопировав которую, можно
получить экземпляр класса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">IPAddress</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;IPAddress: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;IPAddress(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">ip2</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.2.2.2&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">ip_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">ip1</span><span class="p">,</span> <span class="n">ip2</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">ip_addresses</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="p">[</span><span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">),</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.2.2.2&#39;</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">repr</span><span class="p">(</span><span class="n">ip1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="s2">&quot;IPAddress(&#39;10.1.1.1&#39;)&quot;</span>
</pre></div>
</div>
</div>
<span id="document-book/23_oop_special_methods/add_method"></span><div class="section" id="id1">
<h4>Поддержка арифметических операторов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>За поддержку арифметических операций также отвечают специальные методы,
например, за операцию сложения отвечает метод __add__:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</pre></div>
</div>
<p>Добавим к классу IPAddress поддержку суммирования с числами, но чтобы
не усложнять реализацию метода, воспользуемся возможностями модуля ipaddress</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">ipaddress</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">ipaddress1</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="n">ipaddress1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">167837953</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="mi">167837953</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Класс IPAddress с методом __add__:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">IPAddress</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;IPAddress: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;IPAddress(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">ip_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">))</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">sum_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">ip_int</span> <span class="o">+</span> <span class="n">other</span><span class="p">))</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">IPAddress</span><span class="p">(</span><span class="n">sum_ip_str</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Переменная ip_int ссылается на значение исходного адреса в десятичном формате.
а sum_ip_str это строка с IP-адресом полученным в результате сложения двух чисел.
Как правило, желательно чтобы операция суммирования возвращала экземпляр того же
класса, поэтому в последней строке метода создается экземпляр класса IPAddress
и ему как аргумент передается строка с итоговым адресом.</p>
<p>Теперь экземпляры класса IPAddress должны поддерживать операцию сложения с числом.
В результате мы получаем новый экземпляр класса IPAddress.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">+</span> <span class="mi">5</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.6&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Так как внутри метода используется модуль ipaddress, а он поддерживает создание
IP-адреса только из десятичного числа, надо ограничить метод на работу только с
данными типа int. Если же второй элемент был объектом другого типа, надо
сгенерировать исключение. Исключение и сообщение об ошибке возьмем из аналогичной ошибки
функции ipaddress.ip_address:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">a1</span> <span class="o">+</span> <span class="mi">4</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">IPv4Address</span><span class="p">(</span><span class="s1">&#39;10.1.1.5&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">a1</span> <span class="o">+</span> <span class="mf">4.0</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">a0a045adedc5</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">a1</span> <span class="o">+</span> <span class="mf">4.0</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">unsupported</span> <span class="n">operand</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="o">+</span><span class="p">:</span> <span class="s1">&#39;IPv4Address&#39;</span> <span class="ow">and</span> <span class="s1">&#39;float&#39;</span>
</pre></div>
</div>
<p>Теперь класс IPAddress выглядит так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">IPAddress</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;IPAddress: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;IPAddress(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>             <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsupported operand type(s) for +:&quot;</span>
    <span class="o">...</span><span class="p">:</span>                             <span class="sa">f</span><span class="s2">&quot; &#39;IPAddress&#39; and &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">ip_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">sum_ip_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">ip_int</span> <span class="o">+</span> <span class="n">other</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">IPAddress</span><span class="p">(</span><span class="n">sum_ip_str</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Если второй операнд не является экзепляром класса int, генерируется исключение TypeError.
В исключении выводится информация, что суммирование не поддерживается между экземплярами
класса IPAddress и экземпляром класса операнда. Имя класса получено из самого класса,
после обращения к type: <code class="docutils literal notranslate"><span class="pre">type(other).__name__</span></code>.</p>
<p>Проверка суммирования с десятичным числом и генерации ошибки:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">+</span> <span class="mi">5</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.6&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">+</span> <span class="mf">5.0</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="mf">5e619</span><span class="n">f8dc37a</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">ip1</span> <span class="o">+</span> <span class="mf">5.0</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">77</span><span class="n">b43bc64757</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
     <span class="mi">11</span>     <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
     <span class="mi">12</span>         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<span class="o">---&gt;</span> <span class="mi">13</span>             <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsupported operand type(s) for +:&quot;</span>
     <span class="mi">14</span>                             <span class="sa">f</span><span class="s2">&quot; &#39;IPAddress&#39; and &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
     <span class="mi">15</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">unsupported</span> <span class="n">operand</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="o">+</span><span class="p">:</span> <span class="s1">&#39;IPAddress&#39;</span> <span class="ow">and</span> <span class="s1">&#39;float&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="n">c5ce818f55d8</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">ip1</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">77</span><span class="n">b43bc64757</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
     <span class="mi">11</span>     <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
     <span class="mi">12</span>         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<span class="o">---&gt;</span> <span class="mi">13</span>             <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsupported operand type(s) for +:&quot;</span>
     <span class="mi">14</span>                             <span class="sa">f</span><span class="s2">&quot; &#39;IPAddress&#39; and &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
     <span class="mi">15</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">unsupported</span> <span class="n">operand</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="o">+</span><span class="p">:</span> <span class="s1">&#39;IPAddress&#39;</span> <span class="ow">and</span> <span class="s1">&#39;str&#39;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">См.также</p>
<p class="last">Руководство по специальным методам (англ) <a class="reference external" href="https://rszalski.github.io/magicmethods/#numeric">Numeric magic methods</a></p>
</div>
</div>
<span id="document-book/23_oop_special_methods/protocols"></span><div class="section" id="id1">
<h4>Протоколы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Специальные методы отвечают не только за поддержку операций типа сложение, сравнение,
но и за поддержку протоколов.
Протокол - это набор методов, которые должны быть реализованы в объекте,
чтобы он поддерживал определенное поведение. Например, в Python есть такие протоколы: итерации,
менеджер контекста, контейнеры и другие. После создания в объекте определенных методов,
объект будет вести себя как встроенный и использовать интерфейс понятный всем,
кто пишет на Python.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last"><a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes">Таблица с абстрактных классов в которой описаны какие методы должны присутствовать у объекта, чтобы он поддерживал определенный протокол</a></p>
</div>
<div class="toctree-wrapper compound">
<span id="document-book/23_oop_special_methods/iterable_iterator"></span><div class="section" id="id1">
<h5>Протокол итерации<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p><strong>Итерируемый объект (iterable)</strong> - это объект, который способен возвращать элементы по одному.
Для Python это любой объект у которого есть метод <code class="docutils literal notranslate"><span class="pre">__iter__</span></code> или метод <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>.
Если у объекта есть метод __iter__, итерируемый объект превращается в итератор вызовом <code class="docutils literal notranslate"><span class="pre">iter(name)</span></code>,
где name - имя итерируемого объекта. Если метода __iter__ нет, Python перебирает элементы используя __getitem__.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Items</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Вызываю __getitem__&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>


<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">iterable_1</span> <span class="o">=</span> <span class="n">Items</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">iterable_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iterable_1</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;&gt;&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="mi">1</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="mi">2</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="mi">3</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="mi">4</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">iterable_1</span><span class="p">))</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Если у объекта есть  метод __iter__ (который обязан возвращать итератор), при переборе значений используется он:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Items</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Вызываю __getitem__&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Вызываю __iter__&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>


<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">iterable_1</span> <span class="o">=</span> <span class="n">Items</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iterable_1</span><span class="p">:</span>
     <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;&gt;&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
     <span class="o">...</span><span class="p">:</span>
<span class="n">Вызываю</span> <span class="fm">__iter__</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="mi">3</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="mi">4</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">iterable_1</span><span class="p">))</span>
<span class="n">Вызываю</span> <span class="fm">__iter__</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>В Python за получение итератора отвечает функция iter():</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">lista</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">iter</span><span class="p">(</span><span class="n">lista</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">list_iterator</span> <span class="n">at</span> <span class="mh">0xb4ede28c</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Функция <code class="docutils literal notranslate"><span class="pre">iter</span></code> отработает на любом объекте, у которого есть метод __iter__ или метод __getitem__.
Метод __iter__ возвращает итератор. Если этого метода нет, функция iter() проверяет, нет ли метода __getitem__ - метода, который позволяет получать элементы по индексу.
Если метод __getitem__ есть, элементы будут перебираться по индексу (начиная с 0).</p>
<p><strong>Итератор (iterator)</strong> - это объект, который возвращает свои элементы по одному за раз.
С точки зрения Python - это любой объект, у которого есть метод __next__. Этот метод возвращает следующий элемент, если он есть, или возвращает исключение StopIteration, когда элементы закончились.
Кроме того, итератор запоминает, на каком объекте он остановился в последнюю итерацию.
Также у каждого итератора присутствует метод __iter__ - то есть, любой итератор является итерируемым объектом. Этот метод возвращает сам итератор.</p>
<p>Пример создания итератора из списка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">lista</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">i</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">lista</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь можно использовать функцию next(), которая вызывает метод __next__, чтобы взять следующий элемент:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mi">2</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="o">------------------------------------------------------------</span>
<span class="ne">StopIteration</span>              <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="n">bed2471d02c1</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="ne">StopIteration</span><span class="p">:</span>
</pre></div>
</div>
<p>После того, как элементы закончились, возвращается исключение StopIteration.
Для того, чтобы итератор снова начал возвращать элементы, его надо заново создать.
Аналогичные действия выполяются, когда цикл for проходится по списку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lista</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
</pre></div>
</div>
<p>Когда мы перебираем элементы списка, к списку сначала применяется функция iter(),
чтобы создать итератор, а затем вызывается его метод __next__ до тех пор, пока не возникнет исключение StopIteration.</p>
<p>Пример функции my_for, которая работает с любым итерируемым объектом
и имитирует работу встроенной функции for:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_for</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Есть __iter__&#39;</span><span class="p">)</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="s2">&quot;__getitem__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Нет __iter__, но есть __getitem__&#39;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">iterable</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">break</span>
</pre></div>
</div>
<p>Проверка работы функции на объекте у которого есть метод __iter__:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">my_for</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">Есть</span> <span class="fm">__iter__</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>
</pre></div>
</div>
<p>Проверка работы функции на объекте у которого нет метода __iter__, но есть __getitem__:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Items</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Вызываю __getitem__&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>


<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">iterable_1</span> <span class="o">=</span> <span class="n">Items</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">my_for</span><span class="p">(</span><span class="n">iterable_1</span><span class="p">)</span>
<span class="n">Нет</span> <span class="fm">__iter__</span><span class="p">,</span> <span class="n">но</span> <span class="n">есть</span> <span class="fm">__getitem__</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="mi">1</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="mi">2</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="mi">3</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="mi">4</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
<span class="mi">5</span>
<span class="n">Вызываю</span> <span class="fm">__getitem__</span>
</pre></div>
</div>
<div class="section" id="id2">
<h6>Создание итератора<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h6>
<p>Пример класса Network:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">ipaddress</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span> <span class="k">class</span> <span class="nc">Network</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">network</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">subnet</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">subnet</span><span class="o">.</span><span class="n">hosts</span><span class="p">()]</span>
</pre></div>
</div>
<p>Пример создания экземпляра класса Network:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">net1</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s1">&#39;10.1.1.192/30&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">net1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">Network</span> <span class="n">at</span> <span class="mh">0xb3124a6c</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">net1</span><span class="o">.</span><span class="n">addresses</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.193&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.194&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">net1</span><span class="o">.</span><span class="n">network</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;10.1.1.192/30&#39;</span>
</pre></div>
</div>
<p>Создаем итератор из класса Network:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Network</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">network</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">subnet</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">subnet</span><span class="o">.</span><span class="n">hosts</span><span class="p">()]</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Вызываю __iter__&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">self</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Вызываю __next__&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addresses</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>             <span class="n">current_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addresses</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span>
    <span class="o">...</span><span class="p">:</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="o">...</span><span class="p">:</span>             <span class="k">return</span> <span class="n">current_address</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">else</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>             <span class="k">raise</span> <span class="ne">StopIteration</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Метод __iter__ в итераторе должен возвращать сам объект, поэтому в методе
указано <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">self</span></code>, а метод __next__ возвращает элементы по одному и генерирует
исключение StopIteration, когда элементы закончились.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">net1</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s1">&#39;10.1.1.192/30&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">net1</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">Вызываю</span> <span class="fm">__iter__</span>
<span class="n">Вызываю</span> <span class="fm">__next__</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.193</span>
<span class="n">Вызываю</span> <span class="fm">__next__</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.194</span>
<span class="n">Вызываю</span> <span class="fm">__next__</span>
</pre></div>
</div>
<p>Чаще всего, итератор это одноразовый объект и перебрав элементы, мы уже не можем это сделать второй раз:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">net1</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">Вызываю</span> <span class="fm">__iter__</span>
<span class="n">Вызываю</span> <span class="fm">__next__</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h6>Создание итерируемого объекта<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h6>
<p>Очень часто классу достаточно быть итерируемым объектом и не обязательно быть итератором.
Если объект будет итерируемым, его можно использовать в цикле for,
функциях map, filter, sorted, enumerate и других. Также, как правило, объект проще сделать итерируемым, чем итератором.</p>
<p>Для того чтобы класс Network создавал итерируемые объекты, надо чтобы в классе был метод
__iter__ (__next__ не нужен) и чтобы метод возвращал итератор.
Так как в данном случае, Network перебирает адреса, которые находятся в списке self.addresses,
самый просто вариант возвращать итератор, это вернуть <code class="docutils literal notranslate"><span class="pre">iter(self.addresses)</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Network</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">network</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">subnet</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">subnet</span><span class="o">.</span><span class="n">hosts</span><span class="p">()]</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Теперь все экземпляры класса Network будут итерируемыми объектами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">net1</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s1">&#39;10.1.1.192/30&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">net1</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.193</span>
<span class="mf">10.1</span><span class="o">.</span><span class="mf">1.194</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/23_oop_special_methods/sequence_protocol"></span><div class="section" id="id1">
<h5>Протокол последовательности<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>В самом базовом варианте, протокол последовательности (sequence) включает
два метода: __len__ и __getitem__. В более полном варианте также методы:
__contains__, __iter__, __reversed__, index и count. Если последовательность изменяема,
добавляются еще несколько методов.</p>
<p>Добавим методы __len__ и __getitem__ к классу Network:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Network</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">network</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">subnet</span> <span class="o">=</span> <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_network</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">subnet</span><span class="o">.</span><span class="n">hosts</span><span class="p">()]</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addresses</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addresses</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Метод __len__ вызывается функцией len:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">net1</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s1">&#39;10.1.1.192/30&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">len</span><span class="p">(</span><span class="n">net1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">2</span>
</pre></div>
</div>
<p>А метод __getitem__ при обращении по индексу таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">net1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;10.1.1.193&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">net1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;10.1.1.194&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">net1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;10.1.1.194&#39;</span>
</pre></div>
</div>
<p>Метод __getitem__ отвечает не только обращение по индексу, но и за срезы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">net1</span> <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="s1">&#39;10.1.1.192/28&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">net1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;10.1.1.193&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">net1</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;10.1.1.196&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.197&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.198&#39;</span><span class="p">,</span> <span class="s1">&#39;10.1.1.199&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">net1</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;10.1.1.196&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.1.1.197&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.1.1.198&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.1.1.199&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.1.1.200&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.1.1.201&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.1.1.202&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.1.1.203&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.1.1.204&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.1.1.205&#39;</span><span class="p">,</span>
 <span class="s1">&#39;10.1.1.206&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Так как в данном случае, внутри метода __getitem__ используется список,
ошибки отрабатывают корректно автоматически:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">net1</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">IndexError</span>                                <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">09</span><span class="n">ca84e34cb6</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">net1</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">bc213b4a03ca</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
     <span class="mi">12</span>
     <span class="mi">13</span>     <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="o">---&gt;</span> <span class="mi">14</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addresses</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
     <span class="mi">15</span>

<span class="ne">IndexError</span><span class="p">:</span> <span class="nb">list</span> <span class="n">index</span> <span class="n">out</span> <span class="n">of</span> <span class="nb">range</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">net1</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">facd90673864</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">net1</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">bc213b4a03ca</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
     <span class="mi">12</span>
     <span class="mi">13</span>     <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="o">---&gt;</span> <span class="mi">14</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addresses</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
     <span class="mi">15</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="nb">list</span> <span class="n">indices</span> <span class="n">must</span> <span class="n">be</span> <span class="n">integers</span> <span class="ow">or</span> <span class="n">slices</span><span class="p">,</span> <span class="ow">not</span> <span class="nb">str</span>
</pre></div>
</div>
<p>Реализация остальных методов протокола последовательности вынесена в задания раздела:</p>
<ul class="simple">
<li>__contains__ - этот метод отвечает за проверку наличия элемента в
последовательности <code class="docutils literal notranslate"><span class="pre">'10.1.1.198'</span> <span class="pre">in</span> <span class="pre">net1</span></code>. Если в объекте не определен этот метод,
наличие элемента проверяется перебором элементов с помощью __iter__, а если и его нет
перевором индексов с __getitem__.</li>
<li>__reversed__ - используется встроенной функцией reversed. Этот метод как правило,
лучше не создавать и полагаться на то, что функция reversed при отсутствии
метода __reversed__ будет использовать методы __len__ и __getitem__.</li>
<li>index - возвращает индекс первого элемента, значение которого равно указаному.
Работает полностью аналогично методу index в списках и кортежах.</li>
<li>count - возвращает количество значений. Работает полностью аналогично методу
count в списках и кортежах.</li>
</ul>
</div>
<span id="document-book/23_oop_special_methods/context_manager"></span><div class="section" id="id1">
<h5>Менеджер контекста<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Менеджер контекста позволяет выполнять указанные действия в начале и в
конце блока with. За работу менеджера контекста отвечают два метода:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">__enter__(self)</span></code> - указывает, что надо сделать в начале блока with. Значение, которое
возвращает метод, присваивается переменной после as.</li>
<li><code class="docutils literal notranslate"><span class="pre">__exit__(self,</span> <span class="pre">exc_type,</span> <span class="pre">exc_value,</span> <span class="pre">traceback)</span></code> - указывает, что надо сделать в
конце блока with или при его прерывании. Если внутри блока возникло исключение,
exc_type, exc_value, traceback будут содержать информацию об исключении, если
исключения не было, они будут равны None.</li>
</ul>
<p>Примеры использования менеджера контекста:</p>
<ul class="simple">
<li>открытие/закрытие файла</li>
<li>открытие/закрытие сессии SSH/Telnet</li>
<li>работа с транзакциями в БД</li>
</ul>
<p>Класс CiscoSSH использует paramiko для подключения к оборудованию:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CiscoSSH</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">disable_paging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
        <span class="n">client</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>

        <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">hostname</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
            <span class="n">look_for_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">allow_agent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">invoke_shell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;enable</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">enable</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">disable_paging</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;terminal length 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>Пример использования класса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">CiscoSSH</span><span class="p">(</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;sh clock</span><span class="se">\r\n</span><span class="s1">*12:58:47.523 UTC Sun Jul 28 2019</span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh ip int br&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;sh ip int br</span><span class="se">\r\n</span><span class="s1">Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\r\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/2                19.1.1.1        YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3                192.168.230.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Loopback0                  4.4.4.4         YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Loopback90                 90.1.1.1        YES manual up                    up      </span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>
</pre></div>
</div>
<p>Для того чтобы класс поддерживал работу в менеджере контекста, надо добавить методы
__enter__ и __exit__:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CiscoSSH</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">disable_paging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Метод __init__&#39;</span><span class="p">)</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
        <span class="n">client</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>

        <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">hostname</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
            <span class="n">look_for_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">allow_agent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">invoke_shell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;enable</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">enable</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">disable_paging</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;terminal length 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Метод __enter__&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Метод __exit__&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>Пример использования класса в менеджере контекста:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="k">with</span> <span class="n">CiscoSSH</span><span class="p">(</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r1</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh clock&#39;</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">Метод</span> <span class="fm">__init__</span>
<span class="n">Метод</span> <span class="fm">__enter__</span>
<span class="n">sh</span> <span class="n">clock</span>
<span class="o">*</span><span class="mi">13</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">50.677</span> <span class="n">UTC</span> <span class="n">Sun</span> <span class="n">Jul</span> <span class="mi">28</span> <span class="mi">2019</span>
<span class="n">R1</span><span class="c1">#</span>
<span class="n">Метод</span> <span class="fm">__exit__</span>
</pre></div>
</div>
<p>Даже если внутри блока возникнет исключение, метод __exit__ выполняется:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="k">with</span> <span class="n">CiscoSSH</span><span class="p">(</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r1</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">result</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">Метод</span> <span class="fm">__init__</span>
<span class="n">Метод</span> <span class="fm">__enter__</span>
<span class="n">Метод</span> <span class="fm">__exit__</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">18</span><span class="o">-</span><span class="n">b9ff1fa74be2</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">1</span> <span class="k">with</span> <span class="n">CiscoSSH</span><span class="p">(</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r1</span><span class="p">:</span>
      <span class="mi">2</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
<span class="o">----&gt;</span> <span class="mi">3</span>     <span class="n">result</span> <span class="o">/</span> <span class="mi">2</span>
      <span class="mi">4</span>

<span class="ne">TypeError</span><span class="p">:</span> <span class="n">unsupported</span> <span class="n">operand</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="o">/</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span> <span class="ow">and</span> <span class="s1">&#39;int&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-exercises/23_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 23.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>В этом задании необходимо создать класс IPAddress.</p>
<p>При создании экземпляра класса, как аргумент передается IP-адрес и маска,
а также должна выполняться проверка корректности адреса и маски:</p>
<p>Адрес считается корректно заданным, если он:</p>
<blockquote>
<div><ul class="simple">
<li>состоит из 4 чисел разделенных точкой</li>
<li>каждое число в диапазоне от 0 до 255</li>
</ul>
</div></blockquote>
<p>Маска считается корректной, если это число в диапазоне от 8 до 32 включительно</p>
<p>Если маска или адрес не прошли проверку, необходимо сгенерировать исключение ValueError с соответствующим текстом (вывод ниже).</p>
<p>Также, при создании класса, должны быть созданы две переменных экземпляра: ip и mask, в которых содержатся адрес и маска, соответственно.</p>
<p>Пример создания экземпляра класса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1/24&#39;</span><span class="p">)</span>

<span class="n">Атрибуты</span> <span class="n">ip</span> <span class="n">и</span> <span class="n">mask</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1/24&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">ip1</span><span class="o">.</span><span class="n">ip</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;10.1.1.1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">ip1</span><span class="o">.</span><span class="n">mask</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">24</span>
</pre></div>
</div>
<p>Проверка корректности адреса (traceback сокращен)</p>
<p>Проверка корректности маски (traceback сокращен)</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1/240&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="o">...</span>
<span class="ne">ValueError</span><span class="p">:</span> <span class="n">Incorrect</span> <span class="n">mask</span>
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 23.1a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать и изменить класс IPAddress из задания 23.1.</p>
<p>Добавить два строковых представления для экземпляров класса IPAddress.
Как дожны выглядеть строковые представления, надо определить из вывода ниже:</p>
<p>Создание экземпляра</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">ip1</span> <span class="o">=</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1/24&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ip1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;IP address 10.1.1.1/24&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">ip1</span><span class="p">)</span>
<span class="n">IP</span> <span class="n">address</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">1.1</span><span class="o">/</span><span class="mi">24</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">ip1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1/24&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">ip_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">ip_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ip1</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">ip_list</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="p">[</span><span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1/24&#39;</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">ip_list</span><span class="p">)</span>
<span class="p">[</span><span class="n">IPAddress</span><span class="p">(</span><span class="s1">&#39;10.1.1.1/24&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Задание 23.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать класс CiscoTelnet из любого задания 22.2x и добавить классу поддержку
работы в менеджере контекста.
При выходе из блока менеджера контекста должно закрываться соединение.</p>
<p>Пример работы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">r1_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>     <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco&#39;</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_23_2</span> <span class="kn">import</span> <span class="n">CiscoTelnet</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="k">with</span> <span class="n">CiscoTelnet</span><span class="p">(</span><span class="o">**</span><span class="n">r1_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">r1</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh clock&#39;</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">sh</span> <span class="n">clock</span>
<span class="o">*</span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">20.244</span> <span class="n">UTC</span> <span class="n">Sat</span> <span class="n">Apr</span> <span class="mi">6</span> <span class="mi">2019</span>
<span class="n">R1</span><span class="c1">#</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="k">with</span> <span class="n">CiscoTelnet</span><span class="p">(</span><span class="o">**</span><span class="n">r1_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">r1</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh clock&#39;</span><span class="p">))</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Возникла ошибка&#39;</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">sh</span> <span class="n">clock</span>
<span class="o">*</span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mf">38.828</span> <span class="n">UTC</span> <span class="n">Sat</span> <span class="n">Apr</span> <span class="mi">6</span> <span class="mi">2019</span>
<span class="n">R1</span><span class="c1">#</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span>                                <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">17</span><span class="o">-</span><span class="n">f3141be7c129</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">1</span> <span class="k">with</span> <span class="n">CiscoTelnet</span><span class="p">(</span><span class="o">**</span><span class="n">r1_params</span><span class="p">)</span> <span class="k">as</span> <span class="n">r1</span><span class="p">:</span>
      <span class="mi">2</span>     <span class="nb">print</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh clock&#39;</span><span class="p">))</span>
<span class="o">----&gt;</span> <span class="mi">3</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Возникла ошибка&#39;</span><span class="p">)</span>
      <span class="mi">4</span>

<span class="ne">ValueError</span><span class="p">:</span> <span class="n">Возникла</span> <span class="n">ошибка</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Задание 23.3<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать и изменить класс Topology из задания 22.1x.</p>
<p>Добавить метод, который позволит выполнять сложение двух экземпляров класса Topology.
В результате сложения должен возвращаться новый экземпляр класса Topology.</p>
<p>Создание двух топологий:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">Topology</span><span class="p">(</span><span class="n">topology_example</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">t1</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
<span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">topology_example2</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/4&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R7&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
                             <span class="p">(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/6&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R9&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">Topology</span><span class="p">(</span><span class="n">topology_example2</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">t2</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/4&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R7&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/6&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R9&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Суммирование топологий:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">t3</span> <span class="o">=</span> <span class="n">t1</span><span class="o">+</span><span class="n">t2</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">t3</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
<span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/4&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R7&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/6&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R9&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Проверка, что исходные топологии не изменились</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">t1</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span>
<span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">t2</span><span class="o">.</span><span class="n">topology</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="p">{(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/4&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R7&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/6&#39;</span><span class="p">):</span> <span class="p">(</span><span class="s1">&#39;R9&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Задание 23.3a<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>В этом задании надо сделать так, чтобы экземпляры класса Topology были итерируемыми объектами.
Основу класса Topology можно взять из любого задания 22.1x или задания 23.3.</p>
<p>После создания экземпляра класса, экземпляр должен работать как итерируемый объект.
На каждой итерации должен возвращаться кортеж, который описывает одно соединение.</p>
<p>Пример работы класса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">top</span> <span class="o">=</span> <span class="n">Topology</span><span class="p">(</span><span class="n">topology_example</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">top</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
<span class="p">((</span><span class="s1">&#39;R1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">))</span>
<span class="p">((</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">))</span>
<span class="p">((</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;SW2&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/11&#39;</span><span class="p">))</span>
<span class="p">((</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;SW1&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/3&#39;</span><span class="p">))</span>
<span class="p">((</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;R4&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">))</span>
<span class="p">((</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;R5&#39;</span><span class="p">,</span> <span class="s1">&#39;Eth0/0&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Проверить работу класса.</p>
</div>
</div>
</div>
</div>
<span id="document-book/24_oop_inheritance/index"></span><div class="section" id="oop-inheritance-index">
<span id="id1"></span><h3>24. Наследование<a class="headerlink" href="#oop-inheritance-index" title="Ссылка на этот заголовок">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-book/24_oop_inheritance/inheritance"></span><div class="section" id="id1">
<h4>Основы наследования<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Наследование позволяет создавать новые классы на основе существующих.
Различают дочерний и родительские классы: дочерний класс наследует родительский.
При наследовании, дочерний класс наследует все методы и атрибуты родительского класса.</p>
<p>Пример класса ConnectSSH, который выполняет подключение по SSH с помощью paramiko:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">paramiko</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="k">class</span> <span class="nc">ConnectSSH</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_MAX_READ</span> <span class="o">=</span> <span class="mi">10000</span>

        <span class="n">client</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
        <span class="n">client</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>

        <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">hostname</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
            <span class="n">look_for_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">allow_agent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">invoke_shell</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_READ</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">send_show_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_READ</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">send_config_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commands</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="n">commands</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_READ</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>Этот класс будет использоваться как основа для классов, которые отвечают за подключение
к устройствам разных вендоров. Например, класс CiscoSSH будет отвечать за подключение
к устройствам Cisco будет наследовать класс ConnectSSH.</p>
<p>Синтаксис наследования:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CiscoSSH</span><span class="p">(</span><span class="n">ConnectSSH</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>После этого в классе CiscoSSH доступны все методы и атрибуты класса ConnectSSH:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">CiscoSSH</span><span class="p">(</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">ip</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;192.168.100.1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">_MAX_READ</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="mi">10000</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh ip int br&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;sh ip int br</span><span class="se">\r\n</span><span class="s1">Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\r\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/2                19.1.1.1        YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Ethernet0/3                192.168.230.1   YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Loopback0                  4.4.4.4         YES NVRAM  up                    up      </span><span class="se">\r\n</span><span class="s1">Loopback33                 3.3.3.3         YES manual up                    up      </span><span class="se">\r\n</span><span class="s1">Loopback90                 90.1.1.1        YES manual up                    up      </span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>



<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;enable&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;enable</span><span class="se">\r\n</span><span class="s1">Password: &#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;cisco&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_config_commands</span><span class="p">([</span><span class="s1">&#39;conf t&#39;</span><span class="p">,</span> <span class="s1">&#39;int loopback 33&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>                          <span class="s1">&#39;ip address 3.3.3.3 255.255.255.255&#39;</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="s1">&#39;conf t</span><span class="se">\r\n</span><span class="s1">Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\r\n</span><span class="s1">R1(config)#int loopback 33</span><span class="se">\r\n</span><span class="s1">R1(config-if)#ip address 3.3.3.3 255.255.255.255</span><span class="se">\r\n</span><span class="s1">R1(config-if)#end</span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>
</pre></div>
</div>
<p>После наследования всех методов родительского класса, дочерний класс может:</p>
<ul class="simple">
<li>оставить их без изменения</li>
<li>полностью переписать их</li>
<li>дополнить метод</li>
<li>добавить свои методы</li>
</ul>
<p>В классе CiscoSSH надо создать метод __init__ и добавить к нему параметры:</p>
<ul class="simple">
<li>enable_password - пароль enable</li>
<li>disable_paging - отвечает за включение/отключение постраничного вывода команд</li>
</ul>
<p>Метод __init__ можно создать полностью с нуля, однако базовая логика подключения по SSH
будет одинаковая в ConnectSSH и CiscoSSH, поэтому лучше добавить необходимые параметры,
а для подключения, вызвать метод __init__ у класса ConnectSSH.
Есть несколько вариантов вызова родительского метода, например, все эти варианты вызовут
метод send_show_command родительского класса из дочернего класса CiscoSSH:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">command_result</span> <span class="o">=</span> <span class="n">ConnectSSH</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
<span class="n">command_result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CiscoSSH</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="n">command_result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>
</div>
<p>Первый вариант <code class="docutils literal notranslate"><span class="pre">ConnectSSH.send_show_command</span></code> явно указывает имя родительского
класса - это самый понятный вариант для восприятия, однако его минус в том, что
при смене имени родительского класса, имя надо будет менять во всех местах, где
вызывались методы родительского класса. Также у этого варианта есть минусы, при
использовании множественного наследования.
Второй и третий вариант по сути равнозначны, но третий короче, поэтому мы будем
использовать его.</p>
<p>Класс CiscoSSH с методом __init__:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CiscoSSH</span><span class="p">(</span><span class="n">ConnectSSH</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enable_password</span><span class="p">,</span>
                 <span class="n">disable_paging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;enable</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">enable_password</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">disable_paging</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;terminal length 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_READ</span><span class="p">)</span>
</pre></div>
</div>
<p>Метод __init__ в классе CiscoSSH добавил параметры enable_password и disable_paging,
и использует их соответственно для перехода в режим enable и отключения постраничного вывода.
Пример подключения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">CiscoSSH</span><span class="p">(</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh clock&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;sh clock</span><span class="se">\r\n</span><span class="s1">*11:30:50.280 UTC Mon Aug 5 2019</span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>
</pre></div>
</div>
<p>Теперь при подключении также выполняется переход в режим enable и по умолчанию отключен
paging, так что можно попробовать выполнить длинную команду, например sh run.</p>
<p>Еще один метод, который стоит доработать - метод send_config_commands: так как
класс CiscoSSH предназначен для работы с Cisco, можно в добавить в него переход
в конфигурационный режим перед командами и выход после.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CiscoSSH</span><span class="p">(</span><span class="n">ConnectSSH</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enable_password</span><span class="p">,</span>
                 <span class="n">disable_paging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;enable</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">enable_password</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">disable_paging</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;terminal length 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_READ</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">config_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;conf t</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_READ</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">exit_config_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssh</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MAX_READ</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">send_config_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commands</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_mode</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">send_config_commands</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_config_mode</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>Пример использования метода send_config_commands:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">CiscoSSH</span><span class="p">(</span><span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="s1">&#39;cisco&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_config_commands</span><span class="p">([</span><span class="s1">&#39;interface loopback 33&#39;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">:</span>                          <span class="s1">&#39;ip address 3.3.3.3 255.255.255.255&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="s1">&#39;conf t</span><span class="se">\r\n</span><span class="s1">Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\r\n</span><span class="s1">R1(config)#interface loopback 33</span><span class="se">\r\n</span><span class="s1">R1(config-if)#ip address 3.3.3.3 255.255.255.255</span><span class="se">\r\n</span><span class="s1">R1(config-if)#end</span><span class="se">\r\n</span><span class="s1">R1#&#39;</span>
</pre></div>
</div>
</div>
<span id="document-exercises/24_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Все задания и вспомогательные файлы можно скачать в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/">репозитории</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Начиная с раздела «4. Типы данных в Python» для проверки заданий
есть автоматические тесты.  Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.
Проверка заданий выполняется с помощью утилиты pyneng. Подробнее
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">о том как работать с утилитой pyneng</span></a>.</p>
</div>
<div class="section" id="id2">
<h5>Задание 24.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать класс CiscoSSH, который наследует класс BaseSSH из файла base_connect_class.py.</p>
<p>Создать метод __init__ в классе CiscoSSH таким образом, чтобы после подключения по SSH выполнялся переход в режим enable.</p>
<p>Для этого в методе __init__ должен сначала вызываться метод __init__ класса ConnectSSH, а затем выполняться переход в режим enable.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_24_1</span> <span class="kn">import</span> <span class="n">CiscoSSH</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">CiscoSSH</span><span class="p">(</span><span class="o">**</span><span class="n">device_params</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh ip int br&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/2                190.16.200.1    YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3                192.168.230.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up      &#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 24.1a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать и дополнить класс CiscoSSH из задания 24.1.</p>
<p>Перед подключением по SSH необходимо проверить если ли в словаре с параметрами
подключения такие параметры: username, password, secret.
Если какого-то параметра нет, запросить значение у пользователя, а затем выполнять
подключение. Если все параметры есть, выполнить подключение.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_24_1a</span> <span class="kn">import</span> <span class="n">CiscoSSH</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">device_params</span> <span class="o">=</span> <span class="p">{</span>
   <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;device_type&#39;</span><span class="p">:</span> <span class="s1">&#39;cisco_ios&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>         <span class="s1">&#39;host&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">CiscoSSH</span><span class="p">(</span><span class="o">**</span><span class="n">device_params</span><span class="p">)</span>
<span class="n">Введите</span> <span class="n">имя</span> <span class="n">пользователя</span><span class="p">:</span> <span class="n">cisco</span>
<span class="n">Введите</span> <span class="n">пароль</span><span class="p">:</span> <span class="n">cisco</span>
<span class="n">Введите</span> <span class="n">пароль</span> <span class="n">для</span> <span class="n">режима</span> <span class="n">enable</span><span class="p">:</span> <span class="n">cisco</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_show_command</span><span class="p">(</span><span class="s1">&#39;sh ip int br&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/2                190.16.200.1    YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3                192.168.230.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up      &#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Задание 24.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Создать класс MyNetmiko, который наследует класс CiscoIosSSH из netmiko.</p>
<p>Переписать метод __init__ в классе MyNetmiko таким образом, чтобы после подключения по SSH выполнялся переход в режим enable.</p>
<p>Для этого в методе __init__ должен сначала вызываться метод __init__ класса CiscoIosBase, а затем выполнялся переход в режим enable.</p>
<p>Проверить, что в классе MyNetmiko доступны методы send_command и send_config_set
(они наследуются автоматически, это только для проверки).</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_24_2</span> <span class="kn">import</span> <span class="n">MyNetmiko</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">MyNetmiko</span><span class="p">(</span><span class="o">**</span><span class="n">device_params</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s1">&#39;sh ip int br&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/2                190.16.200.1    YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3                192.168.230.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up      &#39;</span>
</pre></div>
</div>
<p>Импорт класса CiscoIosSSH:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">netmiko.cisco.cisco_ios</span> <span class="kn">import</span> <span class="n">CiscoIosSSH</span>


<span class="n">device_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;device_type&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco_ios&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.100.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;secret&quot;</span><span class="p">:</span> <span class="s2">&quot;cisco&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Задание 24.2a<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать и дополнить класс MyNetmiko из задания 24.2.</p>
<p>Добавить метод _check_error_in_command, который выполняет проверку на такие ошибки:</p>
<ul class="simple">
<li>Invalid input detected</li>
<li>Incomplete command</li>
<li>Ambiguous command</li>
</ul>
<p>Метод ожидает как аргумент команду и вывод команды.
Если в выводе не обнаружена ошибка, метод ничего не возвращает.
Если в выводе найдена ошибка, метод генерирует исключение ErrorInCommand с сообщением о том какая ошибка была обнаружена, на каком устройстве и в какой команде.</p>
<p>Переписать метод send_command netmiko, добавив в него проверку на ошибки.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_24_2a</span> <span class="kn">import</span> <span class="n">MyNetmiko</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">MyNetmiko</span><span class="p">(</span><span class="o">**</span><span class="n">device_params</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s1">&#39;sh ip int br&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/2                190.16.200.1    YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3                192.168.230.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up      &#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s1">&#39;sh ip br&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="n">ErrorInCommand</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="n">c60b31812fd</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s1">&#39;sh ip br&#39;</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">ErrorInCommand</span><span class="p">:</span> <span class="n">При</span> <span class="n">выполнении</span> <span class="n">команды</span> <span class="s2">&quot;sh ip br&quot;</span> <span class="n">на</span> <span class="n">устройстве</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="n">возникла</span> <span class="n">ошибка</span> <span class="s2">&quot;Invalid input detected at &#39;^&#39; marker.&quot;</span>
</pre></div>
</div>
<p>Исключение ErrorInCommand:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ErrorInCommand</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Исключение генерируется, если при выполнении команды на оборудовании, возникла ошибка.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="b">
<h5>Задание 24.2b<a class="headerlink" href="#b" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать класс MyNetmiko из задания 24.2a.</p>
<p>Дополнить функционал метода send_config_set netmiko и добавить в него проверку на ошибки с помощью метода _check_error_in_command.</p>
<p>Метод send_config_set должен отправлять команды по одной и проверять каждую на ошибки.
Если при выполнении команд не обнаружены ошибки, метод send_config_set возвращает вывод команд.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_24_2b</span> <span class="kn">import</span> <span class="n">MyNetmiko</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">MyNetmiko</span><span class="p">(</span><span class="o">**</span><span class="n">device_params</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_config_set</span><span class="p">(</span><span class="s1">&#39;lo&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="n">ErrorInCommand</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mf">8e491</span><span class="n">f78b235</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_config_set</span><span class="p">(</span><span class="s1">&#39;lo&#39;</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">ErrorInCommand</span><span class="p">:</span> <span class="n">При</span> <span class="n">выполнении</span> <span class="n">команды</span> <span class="s2">&quot;lo&quot;</span> <span class="n">на</span> <span class="n">устройстве</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="n">возникла</span> <span class="n">ошибка</span> <span class="s2">&quot;Incomplete command.&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="c">
<h5>Задание 24.2c<a class="headerlink" href="#c" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать класс MyNetmiko из задания 24.2b.
Проверить, что метод send_command кроме команду, принимает еще и дополнительные
аргументы, например, strip_command.</p>
<p>Если возникает ошибка, переделать метод таким образом, чтобы он принимал
любые аргументы, которые поддерживает netmiko.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_24_2c</span> <span class="kn">import</span> <span class="n">MyNetmiko</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">MyNetmiko</span><span class="p">(</span><span class="o">**</span><span class="n">device_params</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s1">&#39;sh ip int br&#39;</span><span class="p">,</span> <span class="n">strip_command</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;sh ip int br</span><span class="se">\n</span><span class="s1">Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/2                190.16.200.1    YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3                192.168.230.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up      &#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s1">&#39;sh ip int br&#39;</span><span class="p">,</span> <span class="n">strip_command</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;Interface                  IP-Address      OK? Method Status                Protocol</span><span class="se">\n</span><span class="s1">Ethernet0/0                192.168.100.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/1                192.168.200.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/2                190.16.200.1    YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3                192.168.230.1   YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.100            10.100.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.200            10.200.0.1      YES NVRAM  up                    up      </span><span class="se">\n</span><span class="s1">Ethernet0/3.300            10.30.0.1       YES NVRAM  up                    up      &#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="d">
<h5>Задание 24.2d<a class="headerlink" href="#d" title="Ссылка на этот заголовок">¶</a></h5>
<p>Скопировать класс MyNetmiko из задания 24.2c или задания 24.2b.</p>
<p>Добавить параметр ignore_errors в метод send_config_set.
Если передано истинное значение, не надо выполнять проверку на ошибки и метод должен работать точно так же как метод send_config_set в netmiko.
Если значение ложное, ошибки должны проверяться.</p>
<p>По умолчанию ошибки должны игнорироваться.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">task_24_2d</span> <span class="kn">import</span> <span class="n">MyNetmiko</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">MyNetmiko</span><span class="p">(</span><span class="o">**</span><span class="n">device_params</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_config_set</span><span class="p">(</span><span class="s1">&#39;lo&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="s1">&#39;config term</span><span class="se">\n</span><span class="s1">Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\n</span><span class="s1">R1(config)#lo</span><span class="se">\n</span><span class="s1">% Incomplete command.</span><span class="se">\n\n</span><span class="s1">R1(config)#end</span><span class="se">\n</span><span class="s1">R1#&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_config_set</span><span class="p">(</span><span class="s1">&#39;lo&#39;</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s1">&#39;config term</span><span class="se">\n</span><span class="s1">Enter configuration commands, one per line.  End with CNTL/Z.</span><span class="se">\n</span><span class="s1">R1(config)#lo</span><span class="se">\n</span><span class="s1">% Incomplete command.</span><span class="se">\n\n</span><span class="s1">R1(config)#end</span><span class="se">\n</span><span class="s1">R1#&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_config_set</span><span class="p">(</span><span class="s1">&#39;lo&#39;</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="n">ErrorInCommand</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="mi">704</span><span class="n">f2e8d1886</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">r1</span><span class="o">.</span><span class="n">send_config_set</span><span class="p">(</span><span class="s1">&#39;lo&#39;</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="o">...</span>
<span class="n">ErrorInCommand</span><span class="p">:</span> <span class="n">При</span> <span class="n">выполнении</span> <span class="n">команды</span> <span class="s2">&quot;lo&quot;</span> <span class="n">на</span> <span class="n">устройстве</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.1</span> <span class="n">возникла</span> <span class="n">ошибка</span> <span class="s2">&quot;Incomplete command.&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/Part_VII"></span><div class="section" id="vii">
<h2>VII. Работа с базами данных<a class="headerlink" href="#vii" title="Ссылка на этот заголовок">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/25_db/index"></span><div class="section" id="db-index">
<span id="id1"></span><h3>25. Работа с базами данных<a class="headerlink" href="#db-index" title="Ссылка на этот заголовок">¶</a></h3>
<p>Использование баз данных - это еще один способ хранения информации.
Базы данных полезны не только в хранении информации. Используя СУБД,
можно делать срезы информации по различным параметрам.</p>
<p><strong>База данных (БД)</strong> - это данные, которые хранятся в соответствии с
определенной схемой. В этой схеме каким-то образом описаны соотношения
между данными.</p>
<p><strong>Язык БД (лингвистические средства)</strong> - используется для описания
структуры БД, управления данными (добавление, изменение, удаление,
получение), управления правами доступа к БД и ее объектам, управления
транзакциями.</p>
<p><strong>Система управления базами данных (СУБД)</strong> - это программные средства,
которые дают возможность управлять БД. СУБД должны поддерживать
соответствующий язык (языки) для управления БД.</p>
<div class="toctree-wrapper compound">
<span id="document-book/25_db/sql"></span><div class="section" id="sql">
<h4>SQL<a class="headerlink" href="#sql" title="Ссылка на этот заголовок">¶</a></h4>
<p><strong>SQL (structured query language)</strong> - используется для описания
структуры БД, управления данными (добавление, изменение, удаление,
получение), управления правами доступа к БД и ее объектам, управления
транзакциями.</p>
<p>Язык SQL подразделяется на такие категории:</p>
<ul class="simple">
<li>DDL (Data Definition Language) - язык описания данных</li>
<li>DML (Data Manipulation Language) - язык манипулирования данными</li>
<li>DCL (Data Control Language) - язык определения доступа к данным</li>
<li>TCL (Transaction Control Language) - язык управления транзакциями</li>
</ul>
<p>В каждой категории есть свои операторы (перечислены не все операторы):</p>
<ul class="simple">
<li>DDL<ul>
<li>CREATE - создание новой таблицы, СУБД, схемы</li>
<li>ALTER - изменение существующей таблицы, колонки</li>
<li>DROP - удаление существующих объектов из СУБД</li>
</ul>
</li>
<li>DML<ul>
<li>SELECT - выбор данных</li>
<li>INSERT - добавление новых данных</li>
<li>UPDATE - обновление существующих данных</li>
<li>DELETE - удаление данных</li>
</ul>
</li>
<li>DCL<ul>
<li>GRANT - предоставление пользователям разрешения на чтение/запись определенных объектов в СУБД</li>
<li>REVOKE - отзыв ранее предоставленных разрешений</li>
</ul>
</li>
<li>TCL<ul>
<li>COMMIT - применение транзакции</li>
<li>ROLLBACK - откат всех изменений, сделанных в текущей транзакции</li>
</ul>
</li>
</ul>
<div class="section" id="sql-python">
<h5>SQL и Python<a class="headerlink" href="#sql-python" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для работы с реляционной СУБД в Python можно использовать два подхода:</p>
<ul class="simple">
<li>работать с библиотекой, которая соответствует конкретной СУБД,
и использовать для работы с БД язык SQL. Например, для работы с SQLite используется модуль sqlite3</li>
<li>работать с <a class="reference external" href="http://xgu.ru/wiki/ORM">ORM</a>, которая использует
объектно-ориентированный подход для работы с БД. Например, SQLAlchemy</li>
</ul>
</div>
</div>
<span id="document-book/25_db/sqlite"></span><div class="section" id="sqlite">
<h4>SQLite<a class="headerlink" href="#sqlite" title="Ссылка на этот заголовок">¶</a></h4>
<p><a class="reference external" href="http://xgu.ru/wiki/SQLite">SQLite</a> — встраиваемая в процесс
реализация SQL-машины.
SQLite часто используется как встроенная СУБД в приложениях.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Слово SQL-сервер здесь не используем, потому что как таковой сервер
там не нужен — весь функционал, который встраивается в SQL-сервер,
реализован внутри библиотеки (и, соответственно, внутри программы,
которая её использует).</p>
</div>
<div class="section" id="sqlite-cli">
<h5>SQLite CLI<a class="headerlink" href="#sqlite-cli" title="Ссылка на этот заголовок">¶</a></h5>
<p>В комплекте поставки SQLite идёт также утилита для работы с SQLite в
командной строке. Утилита представлена в виде исполняемого файла sqlite3
(sqlite3.exe для Windows), и с ее помощью можно вручную выполнять
команды SQL.</p>
<p>С помощью этой утилиты очень удобно проверять правильность команд SQL, а
также в целом знакомиться с языком SQL.</p>
<p>Попробуем с помощью этой утилиты разобраться с базовыми командами SQL,
которые понадобятся для работы с БД.</p>
<p>Для начала разберемся, как создавать БД.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Если вы используете Linux или Mac OS, то, скорее всего, sqlite3
установлен. Если вы используете Windows, то можно скачать sqlite3
<a class="reference external" href="http://www.sqlite.org/download.html">тут</a>.</p>
</div>
<p>Для того, чтобы создать БД (или открыть уже созданную), надо просто
вызвать sqlite3 таким образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sqlite3 testDB.db
SQLite version 3.8.7.1 2014-10-29 13:59:56
Enter &quot;.help&quot; for usage hints.
sqlite&gt;
</pre></div>
</div>
<p>Внутри sqlite3 можно выполнять команды SQL или так называемые
метакоманды (или dot-команды).</p>
<p>К метакомандам относятся несколько специальных команд для работы с
SQLite. Они относятся только к утилите sqlite3, а не к SQL языку. В
конце этих команд <code class="docutils literal notranslate"><span class="pre">;</span></code> ставить не нужно.</p>
<p>Примеры метакоманд:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">.help</span></code> - подсказка со списком всех метакоманд</li>
<li><code class="docutils literal notranslate"><span class="pre">.exit</span></code> или <code class="docutils literal notranslate"><span class="pre">.quit</span></code> - выход из сессии sqlite3</li>
<li><code class="docutils literal notranslate"><span class="pre">.databases</span></code> - показывает присоединенные БД</li>
<li><code class="docutils literal notranslate"><span class="pre">.tables</span></code> - показывает доступные таблицы</li>
</ul>
<p>Примеры выполнения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sqlite&gt; .help
.backup ?DB? FILE      Backup DB (default &quot;main&quot;) to FILE
.bail ON|OFF           Stop after hitting an error.  Default OFF
.databases             List names and files of attached databases
...

sqlite&gt; .databases
seq  name      file
---  --------  ----------------------------------
0    main      /home/nata/py_for_ne/db/db_article/testDB.db
</pre></div>
</div>
</div>
<div class="section" id="litecli">
<h5>litecli<a class="headerlink" href="#litecli" title="Ссылка на этот заголовок">¶</a></h5>
<p>У стандартного CLI-интерфейса SQLite есть несколько недостатков:</p>
<ul class="simple">
<li>нет автодополнения команд</li>
<li>нет подсказок</li>
<li>не всегда отображается все содержимое столбца</li>
</ul>
<p>Все эти недостатки исправлены в  <a class="reference external" href="https://github.com/dbcli/litecli">litecli</a>.
Поэтому лучше использовать его.</p>
<p>Установка litecli:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install litecli
</pre></div>
</div>
<p>Открыть базу данных в litecli:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ litecli example.db
Version: 1.0.0
Mail: https://groups.google.com/forum/#!forum/litecli-users
Github: https://github.com/dbcli/litecli
example.db&gt;
</pre></div>
</div>
</div>
</div>
<span id="document-book/25_db/sql_basics"></span><div class="section" id="sql-sqlite3-cli">
<h4>Основы SQL (в sqlite3 CLI)<a class="headerlink" href="#sql-sqlite3-cli" title="Ссылка на этот заголовок">¶</a></h4>
<p>В этом разделе рассматривается синтаксис языка SQL.</p>
<p>Если вы знакомы с базовым синтаксисом SQL, этот раздел можно пропустить
и сразу перейти к разделу <a class="reference internal" href="contents.html#sqlite3-index"><span class="std std-ref">Модуль sqlite3</span></a></p>
<div class="toctree-wrapper compound">
<span id="document-book/25_db/create"></span><div class="section" id="create">
<h5>CREATE<a class="headerlink" href="#create" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор CREATE позволяет создавать таблицы.</p>
<p>Сначала подключимся к базе данных или создадим ее с помощью litecli:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ litecli new_db.db
Version: 1.0.0
Mail: https://groups.google.com/forum/#!forum/litecli-users
Github: https://github.com/dbcli/litecli
new_db.db&gt;
</pre></div>
</div>
<p>Создадим таблицу switch, в которой хранится информация о коммутаторах:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">table</span> <span class="n">switch</span> <span class="p">(</span><span class="n">mac</span> <span class="n">text</span> <span class="ow">not</span> <span class="n">NULL</span> <span class="n">primary</span> <span class="n">key</span><span class="p">,</span> <span class="n">hostname</span> <span class="n">text</span><span class="p">,</span> <span class="n">model</span> <span class="n">text</span><span class="p">,</span> <span class="n">location</span> <span class="n">text</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.010</span><span class="n">s</span>
</pre></div>
</div>
<p>В данном примере мы описали таблицу switch: определили, какие поля будут
в таблице, и значения какого типа будут в них находиться.</p>
<p>Кроме того, поле mac является первичным ключом. Это автоматически
значит, что:</p>
<ul class="simple">
<li>поле должно быть уникальным</li>
<li>в нём не может находиться значение NULL (в SQLite это надо задавать явно)</li>
</ul>
<p>В этом примере это вполне логично, так как MAC-адрес должен быть
уникальным.</p>
<p>На данный момент записей в таблице нет, есть только ее определение.
Просмотреть определение можно такой командой:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">schema</span> <span class="n">switch</span>
<span class="o">+-----------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">sql</span>                                                                                           <span class="o">|</span>
<span class="o">+-----------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">switch</span> <span class="p">(</span><span class="n">mac</span> <span class="n">text</span> <span class="ow">not</span> <span class="n">NULL</span> <span class="n">primary</span> <span class="n">key</span><span class="p">,</span> <span class="n">hostname</span> <span class="n">text</span><span class="p">,</span> <span class="n">model</span> <span class="n">text</span><span class="p">,</span> <span class="n">location</span> <span class="n">text</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+-----------------------------------------------------------------------------------------------+</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.037</span><span class="n">s</span>
</pre></div>
</div>
</div>
<span id="document-book/25_db/drop"></span><div class="section" id="drop">
<h5>DROP<a class="headerlink" href="#drop" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор DROP удаляет таблицу вместе со схемой и всеми данными.</p>
<p>Удалить таблицу можно так:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span>new_db.db&gt; DROP table switch;
You&#39;re about to run a destructive command.
Do you want to proceed? (y/n): y
Your call!
Query OK, 0 rows affected
Time: 0.009s
</pre></div>
</div>
</div>
<span id="document-book/25_db/insert"></span><div class="section" id="insert">
<h5>INSERT<a class="headerlink" href="#insert" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор INSERT используется для добавления данных в таблицу.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p>Если таблица была удалена на предыдущем шаге, надо ее создать:</p>
<div class="code sql last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">table</span> <span class="n">switch</span> <span class="p">(</span><span class="n">mac</span> <span class="n">text</span> <span class="ow">not</span> <span class="n">NULL</span> <span class="n">primary</span> <span class="n">key</span><span class="p">,</span> <span class="n">hostname</span> <span class="n">text</span><span class="p">,</span> <span class="n">model</span> <span class="n">text</span><span class="p">,</span> <span class="n">location</span> <span class="n">text</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.010</span><span class="n">s</span>
</pre></div>
</div>
</div>
<p>Есть несколько вариантов добавления записей, в зависимости от того, все
ли поля будут заполнены, и будут ли они идти по порядку определения
полей или нет.</p>
<p>Если указываются значения для всех полей, добавить запись можно таким
образом (порядок полей должен соблюдаться):</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">into</span> <span class="n">switch</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0010.A1AA.C1CC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.008</span><span class="n">s</span>
</pre></div>
</div>
<p>Если нужно указать не все поля или указать их в произвольном порядке,
используется такая запись:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">into</span> <span class="n">switch</span> <span class="p">(</span><span class="n">mac</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">hostname</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0020.A2AA.C2CC&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3850&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.009</span><span class="n">s</span>
</pre></div>
</div>
</div>
<span id="document-book/25_db/select"></span><div class="section" id="select">
<h5>SELECT<a class="headerlink" href="#select" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор SELECT позволяет запрашивать информацию в таблице.</p>
<p>Например:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">A1AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="mi">2</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.033</span><span class="n">s</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span></code> означает, что нужно вывести все поля таблицы. Следом
указывается, из какой таблицы запрашиваются данные: <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">switch</span></code>.</p>
<p>Таким образом можно указывать конкретные столбцы, которые нужно вывести и в каком порядке:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">model</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------+----------------+------------+</span>
<span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span>
<span class="o">+----------+----------------+------------+</span>
<span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="mf">0010.</span><span class="n">A1AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span>
<span class="o">+----------+----------------+------------+</span>
<span class="mi">2</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.033</span><span class="n">s</span>
</pre></div>
</div>
</div>
<span id="document-book/25_db/where"></span><div class="section" id="where">
<h5>WHERE<a class="headerlink" href="#where" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор WHERE используется для уточнения запроса. С помощью этого
оператора можно указывать определенные условия, по которым отбираются
данные. Если условие выполнено, возвращается соответствующее значение из
таблицы, если нет - не возвращается.</p>
<p>Сейчас в таблице switch всего две записи:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">A1AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="mi">2</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.033</span><span class="n">s</span>
</pre></div>
</div>
<p>Чтобы в таблице было больше записей, надо создать еще несколько строк. В
litecli есть команда source, которая позволяет загружать команды SQL
из файла.</p>
<p>Для добавления записей заготовлен файл add_rows_to_testdb.txt:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">into</span> <span class="n">switch</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0030.A3AA.C1CC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">);</span>
<span class="n">INSERT</span> <span class="n">into</span> <span class="n">switch</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0040.A4AA.C2CC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3850&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">);</span>
<span class="n">INSERT</span> <span class="n">into</span> <span class="n">switch</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0050.A5AA.C3CC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw5&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3850&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">);</span>
<span class="n">INSERT</span> <span class="n">into</span> <span class="n">switch</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0060.A6AA.C4CC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw6&#39;</span><span class="p">,</span> <span class="s1">&#39;C3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">);</span>
<span class="n">INSERT</span> <span class="n">into</span> <span class="n">switch</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0070.A7AA.C5CC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw7&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3650&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Для загрузки команд из файла надо выполнить команду:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">source</span> <span class="n">add_rows_to_testdb</span><span class="o">.</span><span class="n">txt</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.023</span><span class="n">s</span>

<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.002</span><span class="n">s</span>

<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.003</span><span class="n">s</span>

<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.002</span><span class="n">s</span>

<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.002</span><span class="n">s</span>
</pre></div>
</div>
<p>Теперь таблица switch выглядит так:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">A1AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.040</span><span class="n">s</span>
</pre></div>
</div>
<p>С помощью оператора WHERE можно показать только те коммутаторы, модель
которых 3850:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">WHERE</span> <span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;Cisco 3850&#39;</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="mi">3</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.033</span><span class="n">s</span>
</pre></div>
</div>
<p>Оператор WHERE позволяет указывать не только конкретное значение поля.
Если добавить к нему оператор LIKE, можно указывать шаблон поля.</p>
<p>LIKE с помощью символов <code class="docutils literal notranslate"><span class="pre">_</span></code> и <code class="docutils literal notranslate"><span class="pre">%</span></code> указывает, на что должно быть
похоже значение:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">_</span></code> - обозначает один символ или число</li>
<li><code class="docutils literal notranslate"><span class="pre">%</span></code> - обозначает ноль, один или много символов</li>
</ul>
<p>Например, если поле model записано в разном формате, с помощью
предыдущего запроса не получится вывести нужные коммутаторы.</p>
<p>Например, у коммутатора sw6 поле model записано в таком формате: C3750,
а у коммутаторов sw1 и sw3 в таком: Cisco 3750.</p>
<p>В таком варианте запрос с оператором WHERE не покажет sw6:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">WHERE</span> <span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">A1AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="mi">2</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.037</span><span class="n">s</span>
</pre></div>
</div>
<p>Если вместе с оператором WHERE использовать оператор <code class="docutils literal notranslate"><span class="pre">LIKE</span></code>:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">WHERE</span> <span class="n">model</span> <span class="n">LIKE</span> <span class="s1">&#39;%3750&#39;</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">A1AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+</span>
<span class="mi">3</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.040</span><span class="n">s</span>
</pre></div>
</div>
</div>
<span id="document-book/25_db/alter"></span><div class="section" id="alter">
<h5>ALTER<a class="headerlink" href="#alter" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор ALTER позволяет менять существующую таблицу: добавлять новые
колонки или переименовывать таблицу.</p>
<p>Добавим в таблицу новые поля:</p>
<ul class="simple">
<li>mngmt_ip - IP-адрес коммутатора в менеджмент VLAN</li>
<li>mngmt_vid - VLAN ID (номер VLAN) для менеджмент VLAN</li>
</ul>
<p>Добавление записей с помощью команды ALTER:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span>new_db.db&gt; ALTER table switch ADD COLUMN mngmt_ip text;
You&#39;re about to run a destructive command.
Do you want to proceed? (y/n): y
Your call!
Query OK, 0 rows affected
Time: 0.009s

new_db.db&gt; ALTER table switch ADD COLUMN mngmt_vid integer;
You&#39;re about to run a destructive command.
Do you want to proceed? (y/n): y
Your call!
Query OK, 0 rows affected
Time: 0.010s
</pre></div>
</div>
<p>Теперь таблица выглядит так (новые поля установлены в значение NULL):</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+----------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span> <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+----------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">A1AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>   <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>   <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>   <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>   <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>   <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>   <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>   <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+----------+-----------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.034</span><span class="n">s</span>
</pre></div>
</div>
</div>
<span id="document-book/25_db/update"></span><div class="section" id="update">
<h5>UPDATE<a class="headerlink" href="#update" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор UPDATE используется для изменения существующей записи таблицы.</p>
<p>Обычно, UPDATE используется вместе с оператором WHERE, чтобы уточнить,
какую именно запись необходимо изменить.</p>
<p>С помощью UPDATE можно заполнить новые столбцы в таблице.</p>
<p>Например, добавить IP-адрес для коммутатора sw1:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">UPDATE</span> <span class="n">switch</span> <span class="nb">set</span> <span class="n">mngmt_ip</span> <span class="o">=</span> <span class="s1">&#39;10.255.1.1&#39;</span> <span class="n">WHERE</span> <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw1&#39;</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.009</span><span class="n">s</span>
</pre></div>
</div>
<p>Теперь таблица выглядит так:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">A1AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.035</span><span class="n">s</span>
</pre></div>
</div>
<p>Аналогичным образом можно изменить и номер VLAN:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">UPDATE</span> <span class="n">switch</span> <span class="nb">set</span> <span class="n">mngmt_vid</span> <span class="o">=</span> <span class="mi">255</span> <span class="n">WHERE</span> <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw1&#39;</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.009</span><span class="n">s</span>

<span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">A1AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.037</span><span class="n">s</span>
</pre></div>
</div>
<p>Можно изменить несколько полей за раз:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">UPDATE</span> <span class="n">switch</span> <span class="nb">set</span> <span class="n">mngmt_ip</span> <span class="o">=</span> <span class="s1">&#39;10.255.1.2&#39;</span><span class="p">,</span> <span class="n">mngmt_vid</span> <span class="o">=</span> <span class="mi">255</span> <span class="n">WHERE</span> <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw2&#39;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.009</span><span class="n">s</span>

<span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">A1AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>     <span class="o">|</span> <span class="o">&lt;</span><span class="n">null</span><span class="o">&gt;</span>    <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.033</span><span class="n">s</span>
</pre></div>
</div>
<p>Чтобы не заполнять поля mngmt_ip и mngmt_vid вручную, заполним
остальное из файла update_fields_in_testdb.txt (команда <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">update_fields_in_testdb.txt</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">switch</span> <span class="nb">set</span> <span class="n">mngmt_ip</span> <span class="o">=</span> <span class="s1">&#39;10.255.1.3&#39;</span><span class="p">,</span> <span class="n">mngmt_vid</span> <span class="o">=</span> <span class="mi">255</span> <span class="n">WHERE</span> <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw3&#39;</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="n">switch</span> <span class="nb">set</span> <span class="n">mngmt_ip</span> <span class="o">=</span> <span class="s1">&#39;10.255.1.4&#39;</span><span class="p">,</span> <span class="n">mngmt_vid</span> <span class="o">=</span> <span class="mi">255</span> <span class="n">WHERE</span> <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw4&#39;</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="n">switch</span> <span class="nb">set</span> <span class="n">mngmt_ip</span> <span class="o">=</span> <span class="s1">&#39;10.255.1.5&#39;</span><span class="p">,</span> <span class="n">mngmt_vid</span> <span class="o">=</span> <span class="mi">255</span> <span class="n">WHERE</span> <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw5&#39;</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="n">switch</span> <span class="nb">set</span> <span class="n">mngmt_ip</span> <span class="o">=</span> <span class="s1">&#39;10.255.1.6&#39;</span><span class="p">,</span> <span class="n">mngmt_vid</span> <span class="o">=</span> <span class="mi">255</span> <span class="n">WHERE</span> <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw6&#39;</span><span class="p">;</span>
<span class="n">UPDATE</span> <span class="n">switch</span> <span class="nb">set</span> <span class="n">mngmt_ip</span> <span class="o">=</span> <span class="s1">&#39;10.255.1.7&#39;</span><span class="p">,</span> <span class="n">mngmt_vid</span> <span class="o">=</span> <span class="mi">255</span> <span class="n">WHERE</span> <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw7&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>После загрузки команд таблица выглядит так:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">A1AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.7</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.038</span><span class="n">s</span>
</pre></div>
</div>
<p>Теперь предположим, что sw1 был заменен с модели 3750 на модель 3850.
Соответственно, изменилось не только поле модель, но и поле MAC-адрес.</p>
<p>Внесение изменений:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">UPDATE</span> <span class="n">switch</span> <span class="nb">set</span> <span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;Cisco 3850&#39;</span><span class="p">,</span> <span class="n">mac</span> <span class="o">=</span> <span class="s1">&#39;0010.D1DD.E1EE&#39;</span> <span class="n">WHERE</span> <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;sw1&#39;</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.009</span><span class="n">s</span>
</pre></div>
</div>
<p>Результат будет таким:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.7</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.049</span><span class="n">s</span>
</pre></div>
</div>
</div>
<span id="document-book/25_db/replace"></span><div class="section" id="replace">
<h5>REPLACE<a class="headerlink" href="#replace" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор REPLACE используется для добавления или замены данных в
таблице.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Оператор REPLACE может поддерживаться не во всех СУБД.</p>
</div>
<p>Когда возникает нарушение условия уникальности поля, выражение с
оператором REPLACE:</p>
<ul class="simple">
<li>удаляет существующую строку, которая вызвала нарушение</li>
<li>добавляет новую строку</li>
</ul>
<p>Пример нарушения правила уникальности:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">switch</span> <span class="n">VALUES</span> <span class="p">(</span><span class="s1">&#39;0030.A3AA.C1CC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3850&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.1.3&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<span class="n">UNIQUE</span> <span class="n">constraint</span> <span class="n">failed</span><span class="p">:</span> <span class="n">switch</span><span class="o">.</span><span class="n">mac</span>
</pre></div>
</div>
<p>У выражения REPLACE есть два вида:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">INSERT</span> <span class="n">OR</span> <span class="n">REPLACE</span> <span class="n">INTO</span> <span class="n">switch</span> <span class="n">VALUES</span> <span class="p">(</span><span class="s1">&#39;0030.A3AA.C1CC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3850&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.1.3&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.010</span><span class="n">s</span>
</pre></div>
</div>
<p>Или более короткий вариант:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">REPLACE</span> <span class="n">INTO</span> <span class="n">switch</span> <span class="n">VALUES</span> <span class="p">(</span><span class="s1">&#39;0030.A3AA.C1CC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3850&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.1.3&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.009</span><span class="n">s</span>
</pre></div>
</div>
<p>Результатом любой из этих команд будет замена модели коммутатора sw3:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.7</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
</pre></div>
</div>
<p>В данном случае MAC-адрес в новой записи совпадает с уже существующей,
поэтому происходит замена.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Если были указаны не все поля, в новой записи будут только те поля,
которые были указаны. Это связано с тем, что REPLACE сначала удаляет
существующую запись.</p>
</div>
<p>При добавлении записи, для которой не возникает нарушения уникальности
поля, REPLACE работает как обычный INSERT:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">REPLACE</span> <span class="n">INTO</span> <span class="n">switch</span> <span class="n">VALUES</span> <span class="p">(</span><span class="s1">&#39;0080.A8AA.C8CC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw8&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3850&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">,</span> <span class="s1">&#39;10.255.1.8&#39;</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.009</span><span class="n">s</span>

<span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.7</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0080.</span><span class="n">A8AA</span><span class="o">.</span><span class="n">C8CC</span> <span class="o">|</span> <span class="n">sw8</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.8</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">8</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.034</span><span class="n">s</span>
</pre></div>
</div>
</div>
<span id="document-book/25_db/delete"></span><div class="section" id="delete">
<h5>DELETE<a class="headerlink" href="#delete" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор DELETE используется для удаления записей.
Как правило, он используется вместе с оператором WHERE.</p>
<p>Например, таблица switch выглядит так:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.7</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0080.</span><span class="n">A8AA</span><span class="o">.</span><span class="n">C8CC</span> <span class="o">|</span> <span class="n">sw8</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.8</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">8</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.033</span><span class="n">s</span>
</pre></div>
</div>
<p>Удаление информации про коммутатор sw8 выполняется таким образом:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span>new_db.db&gt; DELETE from switch where hostname = &#39;sw8&#39;;
You&#39;re about to run a destructive command.
Do you want to proceed? (y/n): y
Your call!
Query OK, 1 row affected
Time: 0.008s
</pre></div>
</div>
<p>Теперь в таблице нет строки с коммутатором sw8:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.7</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.039</span><span class="n">s</span>
</pre></div>
</div>
</div>
<span id="document-book/25_db/order_by"></span><div class="section" id="order-by">
<h5>ORDER BY<a class="headerlink" href="#order-by" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор ORDER BY используется для сортировки вывода по определенному
полю, по возрастанию или убыванию. Для этого он добавляется к оператору
SELECT.</p>
<p>Если выполнить простой запрос SELECT, вывод будет таким:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.7</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.039</span><span class="n">s</span>
</pre></div>
</div>
<p>С помощью оператора ORDER BY можно вывести записи в таблице switch,
отсортировав их по имени коммутаторов:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">hostname</span> <span class="n">ASC</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.7</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.034</span><span class="n">s</span>
</pre></div>
</div>
<p>По умолчанию сортировка выполняется по возрастанию, поэтому в запросе
можно было не указывать параметр ASC:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">hostname</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.7</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.034</span><span class="n">s</span>
</pre></div>
</div>
<p>Сортировка по IP-адресу по убыванию:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">mngmt_ip</span> <span class="n">DESC</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.7</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">7</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.034</span><span class="n">s</span>
</pre></div>
</div>
</div>
<span id="document-book/25_db/and_or_not_in"></span><div class="section" id="and">
<h5>AND<a class="headerlink" href="#and" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор AND позволяет группировать несколько условий:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">where</span> <span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;Cisco 3850&#39;</span> <span class="ow">and</span> <span class="n">mngmt_ip</span> <span class="n">LIKE</span> <span class="s1">&#39;10.255.%&#39;</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">5</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.034</span><span class="n">s</span>
</pre></div>
</div>
</div>
<div class="section" id="or">
<h5>OR<a class="headerlink" href="#or" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор OR:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">where</span> <span class="n">model</span> <span class="n">LIKE</span> <span class="s1">&#39;%3750&#39;</span> <span class="ow">or</span> <span class="n">model</span> <span class="n">LIKE</span> <span class="s1">&#39;%3850&#39;</span><span class="p">;</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span>      <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">6</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.046</span><span class="n">s</span>
</pre></div>
</div>
</div>
<div class="section" id="in">
<h5>IN<a class="headerlink" href="#in" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор IN:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">where</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;C3750&#39;</span><span class="p">);</span>
<span class="o">+----------------+----------+-------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span> <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+-------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0060.</span><span class="n">A6AA</span><span class="o">.</span><span class="n">C4CC</span> <span class="o">|</span> <span class="n">sw6</span>      <span class="o">|</span> <span class="n">C3750</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.6</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+-------+-------------------+------------+-----------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.034</span><span class="n">s</span>
</pre></div>
</div>
</div>
<div class="section" id="not">
<h5>NOT<a class="headerlink" href="#not" title="Ссылка на этот заголовок">¶</a></h5>
<p>Оператор NOT:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_db</span><span class="o">.</span><span class="n">db</span><span class="o">&gt;</span> <span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">where</span> <span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;C3750&#39;</span><span class="p">);</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="n">mac</span>            <span class="o">|</span> <span class="n">hostname</span> <span class="o">|</span> <span class="n">model</span>      <span class="o">|</span> <span class="n">location</span>          <span class="o">|</span> <span class="n">mngmt_ip</span>   <span class="o">|</span> <span class="n">mngmt_vid</span> <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="o">|</span> <span class="mf">0010.</span><span class="n">D1DD</span><span class="o">.</span><span class="n">E1EE</span> <span class="o">|</span> <span class="n">sw1</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.1</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0020.</span><span class="n">A2AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw2</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.2</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0040.</span><span class="n">A4AA</span><span class="o">.</span><span class="n">C2CC</span> <span class="o">|</span> <span class="n">sw4</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.4</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0050.</span><span class="n">A5AA</span><span class="o">.</span><span class="n">C3CC</span> <span class="o">|</span> <span class="n">sw5</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.5</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0070.</span><span class="n">A7AA</span><span class="o">.</span><span class="n">C5CC</span> <span class="o">|</span> <span class="n">sw7</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3650</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.7</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">0030.</span><span class="n">A3AA</span><span class="o">.</span><span class="n">C1CC</span> <span class="o">|</span> <span class="n">sw3</span>      <span class="o">|</span> <span class="n">Cisco</span> <span class="mi">3850</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Green</span> <span class="n">Str</span> <span class="o">|</span> <span class="mf">10.255</span><span class="o">.</span><span class="mf">1.3</span> <span class="o">|</span> <span class="mi">255</span>       <span class="o">|</span>
<span class="o">+----------------+----------+------------+-------------------+------------+-----------+</span>
<span class="mi">6</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span>
<span class="n">Time</span><span class="p">:</span> <span class="mf">0.037</span><span class="n">s</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-book/25_db/sqlite3"></span><div class="section" id="sqlite3">
<span id="sqlite3-index"></span><h4>Модуль sqlite3<a class="headerlink" href="#sqlite3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для работы с SQLite в Python используется модуль sqlite3.</p>
<p>Объект <strong>Connection</strong> - это подключение к конкретной БД. Можно сказать,
что этот объект представляет БД.</p>
<p>Пример создания подключения:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;dhcp_snooping.db&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>После создания соединения надо создать объект Cursor - это основной
способ работы с БД.</p>
<p>Создается курсор из соединения с БД:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;dhcp_snooping.db&#39;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
<div class="toctree-wrapper compound">
<span id="document-book/25_db/sqlite3_execute"></span><div class="section" id="sql">
<h5>Выполнение команд SQL<a class="headerlink" href="#sql" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для выполнения команд SQL в модуле есть несколько методов:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">execute</span></code> - метод для выполнения одного выражения SQL</li>
<li><code class="docutils literal notranslate"><span class="pre">executemany</span></code> - метод позволяет выполнить одно выражение SQL для
последовательности параметров (или для итератора)</li>
<li><code class="docutils literal notranslate"><span class="pre">executescript</span></code> - метод позволяет выполнить несколько выражений SQL за один раз</li>
</ul>
<div class="section" id="execute">
<h6>Метод execute<a class="headerlink" href="#execute" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод execute позволяет выполнить одну команду SQL.</p>
<p>Сначала надо создать соединение и курсор:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;sw_inventory.db&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
<p>Создание таблицы switch с помощью метода execute:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;create table switch (mac text not NULL primary key, hostname text, model text, location text)&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">Cursor</span> <span class="n">at</span> <span class="mh">0x1085be880</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Выражения SQL могут быть параметризированы - вместо данных можно
подставлять специальные значения. За счет этого можно использовать одну
и ту же команду SQL для передачи разных данных.</p>
<p>Например, таблицу switch нужно заполнить данными из списка data:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;0000.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;0000.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;0011.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Для этого можно использовать запрос вида:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;INSERT into switch values (?, ?, ?, ?)&quot;</span>
</pre></div>
</div>
<p>Знаки вопроса в команде используются для подстановки данных, которые
будут передаваться методу execute.</p>
<p>Теперь можно передать данные таким образом:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>Второй аргумент, который передается методу execute, должен быть
кортежем. Если нужно передать кортеж с одним элементом, используется
запись <code class="docutils literal notranslate"><span class="pre">(value,</span> <span class="pre">)</span></code>.</p>
<p>Чтобы изменения были применены, нужно выполнить commit (обратите
внимание, что метод commit вызывается у соединения):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>Теперь при запросе из командной строки sqlite3, можно увидеть эти
строки в таблице switch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ litecli sw_inventory.db
Version: 1.0.0
Mail: https://groups.google.com/forum/#!forum/litecli-users
Github: https://github.com/dbcli/litecli
sw_inventory.db&gt; SELECT * from switch;
+----------------+----------+------------+-------------------+
| mac            | hostname | model      | location          |
+----------------+----------+------------+-------------------+
| 0000.AAAA.CCCC | sw1      | Cisco 3750 | London, Green Str |
| 0000.BBBB.CCCC | sw2      | Cisco 3780 | London, Green Str |
| 0000.AAAA.DDDD | sw3      | Cisco 2960 | London, Green Str |
| 0011.AAAA.CCCC | sw4      | Cisco 3750 | London, Green Str |
+----------------+----------+------------+-------------------+
4 rows in set
Time: 0.039s
sw_inventory.db&gt;
</pre></div>
</div>
</div>
<div class="section" id="executemany">
<h6>Метод executemany<a class="headerlink" href="#executemany" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод executemany позволяет выполнить одну команду SQL для
последовательности параметров (или для итератора).</p>
<p>С помощью метода executemany в таблицу switch можно добавить аналогичный
список данных одной командой.</p>
<p>Например, в таблицу switch надо добавить данные из списка data2:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">data2</span> <span class="o">=</span> <span class="p">[</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;0000.1111.0001&#39;</span><span class="p">,</span> <span class="s1">&#39;sw5&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;0000.1111.0002&#39;</span><span class="p">,</span> <span class="s1">&#39;sw6&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;0000.1111.0003&#39;</span><span class="p">,</span> <span class="s1">&#39;sw7&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;0000.1111.0004&#39;</span><span class="p">,</span> <span class="s1">&#39;sw8&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Для этого нужно использовать аналогичный запрос вида:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;INSERT into switch values (?, ?, ?, ?)&quot;</span>
</pre></div>
</div>
<p>Теперь можно передать данные методу executemany:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">data2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">Cursor</span> <span class="n">at</span> <span class="mh">0x10ee5e810</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>После выполнения commit данные доступны в таблице:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ litecli sw_inventory.db
Version: 1.0.0
Mail: https://groups.google.com/forum/#!forum/litecli-users
Github: https://github.com/dbcli/litecli
sw_inventory.db&gt; SELECT * from switch;
+----------------+----------+------------+-------------------+
| mac            | hostname | model      | location          |
+----------------+----------+------------+-------------------+
| 0000.AAAA.CCCC | sw1      | Cisco 3750 | London, Green Str |
| 0000.BBBB.CCCC | sw2      | Cisco 3780 | London, Green Str |
| 0000.AAAA.DDDD | sw3      | Cisco 2960 | London, Green Str |
| 0011.AAAA.CCCC | sw4      | Cisco 3750 | London, Green Str |
| 0000.1111.0001 | sw5      | Cisco 3750 | London, Green Str |
| 0000.1111.0002 | sw6      | Cisco 3750 | London, Green Str |
| 0000.1111.0003 | sw7      | Cisco 3750 | London, Green Str |
| 0000.1111.0004 | sw8      | Cisco 3750 | London, Green Str |
+----------------+----------+------------+-------------------+
8 rows in set
Time: 0.034s
</pre></div>
</div>
<p>Метод executemany подставил соответствующие кортежи в команду SQL, и все
данные добавились в таблицу.</p>
</div>
<div class="section" id="executescript">
<h6>Метод executescript<a class="headerlink" href="#executescript" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод executescript позволяет выполнить несколько выражений SQL за один
раз.</p>
<p>Особенно удобно использовать этот метод при создании таблиц:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;new_db.db&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    ...:     create table switches(</span>
<span class="s1">    ...:         hostname     text not NULL primary key,</span>
<span class="s1">    ...:         location     text</span>
<span class="s1">    ...:     );</span>
<span class="s1">    ...:</span>
<span class="s1">    ...:     create table dhcp(</span>
<span class="s1">    ...:         mac          text not NULL primary key,</span>
<span class="s1">    ...:         ip           text,</span>
<span class="s1">    ...:         vlan         text,</span>
<span class="s1">    ...:         interface    text,</span>
<span class="s1">    ...:         switch       text not null references switches(hostname)</span>
<span class="s1">    ...:     );</span>
<span class="s1">    ...: &#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">Cursor</span> <span class="n">at</span> <span class="mh">0x10efd67a0</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/25_db/sqlite3_fetch"></span><div class="section" id="id1">
<h5>Получение результатов запроса<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для получения результатов запроса в sqlite3 есть несколько способов:</p>
<ul class="simple">
<li>использование методов <code class="docutils literal notranslate"><span class="pre">fetch</span></code> - в зависимости от метода
возвращаются одна, несколько или все строки</li>
<li>использование курсора как итератора - возвращается итератор</li>
</ul>
<div class="section" id="fetchone">
<h6>Метод fetchone<a class="headerlink" href="#fetchone" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод fetchone возвращает одну строку данных.</p>
<p>Пример получения информации из базы данных sw_inventory.db:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;sw_inventory.db&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from switch&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">Cursor</span> <span class="n">at</span> <span class="mh">0x104eda810</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;0000.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Обратите внимание, что хотя запрос SQL подразумевает, что запрашивалось
всё содержимое таблицы, метод fetchone вернул только одну строку.</p>
<p>Если повторно вызвать метод, он вернет следующую строку:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">())</span>
<span class="p">(</span><span class="s1">&#39;0000.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Аналогичным образом метод будет возвращать следующие строки. После
обработки всех строк метод начинает возвращать None.</p>
<p>За счет этого метод можно использовать в цикле, например, так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from switch&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">Cursor</span> <span class="n">at</span> <span class="mh">0x104eda810</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">next_row</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">next_row</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">next_row</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">break</span>
   <span class="o">...</span><span class="p">:</span>
<span class="p">(</span><span class="s1">&#39;0000.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0011.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0001&#39;</span><span class="p">,</span> <span class="s1">&#39;sw5&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0002&#39;</span><span class="p">,</span> <span class="s1">&#39;sw6&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0003&#39;</span><span class="p">,</span> <span class="s1">&#39;sw7&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0004&#39;</span><span class="p">,</span> <span class="s1">&#39;sw8&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="fetchmany">
<h6>Метод fetchmany<a class="headerlink" href="#fetchmany" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод fetchmany возвращает список строк данных.</p>
<p>Синтаксис метода:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">([</span><span class="n">size</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="n">arraysize</span><span class="p">])</span>
</pre></div>
</div>
<p>С помощью параметра size можно указывать, какое количество строк
возвращается. По умолчанию параметр size равен значению
cursor.arraysize:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">arraysize</span><span class="p">)</span>
<span class="mi">1</span>
</pre></div>
</div>
<p>Например, таким образом можно возвращать по три строки из запроса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from switch&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">Cursor</span> <span class="n">at</span> <span class="mh">0x104eda810</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">three_rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchmany</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">three_rows</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="n">pprint</span><span class="p">(</span><span class="n">three_rows</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">break</span>
    <span class="o">...</span><span class="p">:</span>
<span class="p">[(</span><span class="s1">&#39;0000.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>
<span class="p">[(</span><span class="s1">&#39;0011.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.1111.0001&#39;</span><span class="p">,</span> <span class="s1">&#39;sw5&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.1111.0002&#39;</span><span class="p">,</span> <span class="s1">&#39;sw6&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>
<span class="p">[(</span><span class="s1">&#39;0000.1111.0003&#39;</span><span class="p">,</span> <span class="s1">&#39;sw7&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.1111.0004&#39;</span><span class="p">,</span> <span class="s1">&#39;sw8&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Метод выдает нужное количество строк, а если строк осталось меньше, чем
параметр size, то оставшиеся строки.</p>
</div>
<div class="section" id="fetchall">
<h6>Метод fetchall<a class="headerlink" href="#fetchall" title="Ссылка на этот заголовок">¶</a></h6>
<p>Метод fetchall возвращает все строки в виде списка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from switch&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">Cursor</span> <span class="n">at</span> <span class="mh">0x104eda810</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span>
<span class="p">[(</span><span class="s1">&#39;0000.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0011.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.1111.0001&#39;</span><span class="p">,</span> <span class="s1">&#39;sw5&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.1111.0002&#39;</span><span class="p">,</span> <span class="s1">&#39;sw6&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.1111.0003&#39;</span><span class="p">,</span> <span class="s1">&#39;sw7&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.1111.0004&#39;</span><span class="p">,</span> <span class="s1">&#39;sw8&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Важный аспект работы метода - он возвращает все оставшиеся строки.</p>
<p>То есть, если до метода fetchall использовался, например, метод
fetchone, то метод fetchall вернет оставшиеся строки запроса:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from switch&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">Cursor</span> <span class="n">at</span> <span class="mh">0x104eda810</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;0000.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;0000.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span>
<span class="p">[(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0011.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.1111.0001&#39;</span><span class="p">,</span> <span class="s1">&#39;sw5&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.1111.0002&#39;</span><span class="p">,</span> <span class="s1">&#39;sw6&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.1111.0003&#39;</span><span class="p">,</span> <span class="s1">&#39;sw7&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;0000.1111.0004&#39;</span><span class="p">,</span> <span class="s1">&#39;sw8&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Метод fetchmany в этом аспекте работает аналогично.</p>
</div>
</div>
<span id="document-book/25_db/sqlite3_cursor_as_iterator"></span><div class="section" id="cursor">
<h5>Cursor как итератор<a class="headerlink" href="#cursor" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если нужно построчно обрабатывать результирующие строки, лучше
использовать курсор как итератор. При этом не нужно использовать методы
fetch.</p>
<p>При использовании методов execute возвращается курсор. А, так как курсор
можно использовать как итератор, можно использовать его, например, в
цикле for:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from switch&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="p">(</span><span class="s1">&#39;0000.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0011.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0001&#39;</span><span class="p">,</span> <span class="s1">&#39;sw5&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0002&#39;</span><span class="p">,</span> <span class="s1">&#39;sw6&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0003&#39;</span><span class="p">,</span> <span class="s1">&#39;sw7&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0004&#39;</span><span class="p">,</span> <span class="s1">&#39;sw8&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Аналогичный вариант отработает и без присваивания переменной:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from switch&#39;</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="p">(</span><span class="s1">&#39;0000.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0011.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0001&#39;</span><span class="p">,</span> <span class="s1">&#39;sw5&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0002&#39;</span><span class="p">,</span> <span class="s1">&#39;sw6&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0003&#39;</span><span class="p">,</span> <span class="s1">&#39;sw7&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s1">&#39;0000.1111.0004&#39;</span><span class="p">,</span> <span class="s1">&#39;sw8&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<span id="document-book/25_db/sqlite3_connection_without_cursor"></span><div class="section" id="sqlite3">
<h5>Использование модуля sqlite3 без явного создания курсора<a class="headerlink" href="#sqlite3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Методы execute доступны и в объекте Connection, и в объекте Cursor, а
методы fetch доступны только в объекте Cursor.</p>
<p>При использовании методов execute с объектом Connection курсор
возвращается как результат выполнения метода execute. Его можно
использовать как итератор и получать данные без методов fetch.
За счет этого при работе с модулем sqlite3 можно не создавать курсор.</p>
<p>Пример итогового скрипта (файл create_sw_inventory_ver1.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;0000.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;0000.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;0011.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>


<span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;sw_inventory2.db&#39;</span><span class="p">)</span>

<span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;create table switch</span>
<span class="s1">            (mac text not NULL primary key, hostname text, model text, location text)&#39;&#39;&#39;</span>
            <span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;INSERT into switch values (?, ?, ?, ?)&#39;</span>
<span class="n">con</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from switch&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Результат выполнения будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python create_sw_inventory_ver1.py
(&#39;0000.AAAA.CCCC&#39;, &#39;sw1&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;)
(&#39;0000.BBBB.CCCC&#39;, &#39;sw2&#39;, &#39;Cisco 3780&#39;, &#39;London, Green Str&#39;)
(&#39;0000.AAAA.DDDD&#39;, &#39;sw3&#39;, &#39;Cisco 2960&#39;, &#39;London, Green Str&#39;)
(&#39;0011.AAAA.CCCC&#39;, &#39;sw4&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;)
</pre></div>
</div>
</div>
<span id="document-book/25_db/sqlite3_exception"></span><div class="section" id="id1">
<h5>Обработка исключений<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Посмотрим на пример использования метода execute при возникновении
ошибки.</p>
<p>В таблице switch поле mac должно быть уникальным. И, если попытаться
записать пересекающийся MAC-адрес, возникнет ошибка:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;sw_inventory2.db&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;INSERT into switch values (&#39;0000.AAAA.DDDD&#39;, &#39;sw7&#39;, &#39;Cisco 2960&#39;, &#39;London, Green Str&#39;)&quot;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="o">------------------------------------------------------------</span>
<span class="n">IntegrityError</span>             <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">56</span><span class="o">-</span><span class="n">ad34d83a8a84</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

<span class="n">IntegrityError</span><span class="p">:</span> <span class="n">UNIQUE</span> <span class="n">constraint</span> <span class="n">failed</span><span class="p">:</span> <span class="n">switch</span><span class="o">.</span><span class="n">mac</span>
</pre></div>
</div>
<p>Соответственно, можно перехватить исключение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="k">try</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span> <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error occurred: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>
<span class="n">Error</span> <span class="n">occurred</span><span class="p">:</span>  <span class="n">UNIQUE</span> <span class="n">constraint</span> <span class="n">failed</span><span class="p">:</span> <span class="n">switch</span><span class="o">.</span><span class="n">mac</span>
</pre></div>
</div>
<p>Обратите внимание, что надо перехватывать исключение
sqlite3.IntegrityError, а не IntegrityError.</p>
</div>
<span id="document-book/25_db/sqlite3_context_manager"></span><div class="section" id="connection">
<h5>Connection как менеджер контекста<a class="headerlink" href="#connection" title="Ссылка на этот заголовок">¶</a></h5>
<p>После выполнения операций изменения должны быть сохранены (надо
выполнить <code class="docutils literal notranslate"><span class="pre">commit</span></code>, а затем можно закрыть соединение, если оно
больше не нужно.</p>
<p>Python позволяет использовать объект Connection как менеджер контекста.
В таком случае не нужно явно делать commit.</p>
<p>При этом:</p>
<ul class="simple">
<li>при возникновении исключения, транзакция автоматически откатывается</li>
<li>если исключения не было, автоматически выполняется commit</li>
</ul>
<p>Пример использования соединения с базой данных как менеджера контекстов
(create_sw_inventory_ver2.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;0000.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;0000.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;0011.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>


<span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;sw_inventory3.db&#39;</span><span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;create table switch</span>
<span class="s1">               (mac text not NULL primary key, hostname text, model text, location text)&#39;&#39;&#39;</span>
            <span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;INSERT into switch values (?, ?, ?, ?)&#39;</span>
        <span class="n">con</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Возникла ошибка: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from switch&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Обратите внимание, что хотя транзакция будет откатываться при
возникновении исключения, само исключение всё равно надо перехватывать.</p>
<p>Для проверки этого функционала надо записать в таблицу данные, в которых
MAC-адрес повторяется. Но прежде, чтобы не повторять части кода, лучше
разнести код в файле create_sw_inventory_ver2.py по функциям (файл
create_sw_inventory_ver2_functions.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;0000.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;0000.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw2&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw3&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;0011.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw4&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">create_connection</span><span class="p">(</span><span class="n">db_name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Функция создает соединение с БД db_name</span>
<span class="sd">    и возвращает его</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">connection</span>


<span class="k">def</span> <span class="nf">write_data_to_db</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Функция ожидает аргументы:</span>
<span class="sd">     * connection - соединение с БД</span>
<span class="sd">     * query - запрос, который нужно выполнить</span>
<span class="sd">     * data - данные, которые надо передать в виде списка кортежей</span>

<span class="sd">    Функция пытается записать все данные из списка data.</span>
<span class="sd">    Если данные удалось записать успешно, изменения сохраняются в БД</span>
<span class="sd">    и функция возвращает True.</span>
<span class="sd">    Если в процессе записи возникла ошибка, транзакция откатывается</span>
<span class="sd">    и функция возвращает False.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Возникла ошибка: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Запись данных прошла успешно&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">get_all_from_db</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Функция ожидает аргументы:</span>
<span class="sd">     * connection - соединение с БД</span>
<span class="sd">     * query - запрос, который нужно выполнить</span>

<span class="sd">    Функция возвращает данные полученные из БД.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">(</span><span class="s1">&#39;sw_inventory3.db&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Создание таблицы...&#39;</span><span class="p">)</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;create table switch</span>
<span class="s1">                (mac text primary key, hostname text, model text, location text)&#39;&#39;&#39;</span>
    <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>

    <span class="n">query_insert</span> <span class="o">=</span> <span class="s1">&#39;INSERT into switch values (?, ?, ?, ?)&#39;</span>
    <span class="n">query_get_all</span> <span class="o">=</span> <span class="s1">&#39;SELECT * from switch&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Запись данных в БД:&#39;</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">write_data_to_db</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">query_insert</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Проверка содержимого БД&#39;</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">get_all_from_db</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">query_get_all</span><span class="p">))</span>

    <span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Результат выполнения скрипта выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python create_sw_inventory_ver2_functions.py
Создание таблицы...
Запись данных в БД:
[(&#39;0000.AAAA.CCCC&#39;, &#39;sw1&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.BBBB.CCCC&#39;, &#39;sw2&#39;, &#39;Cisco 3780&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.AAAA.DDDD&#39;, &#39;sw3&#39;, &#39;Cisco 2960&#39;, &#39;London, Green Str&#39;),
 (&#39;0011.AAAA.CCCC&#39;, &#39;sw4&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;)]
Запись данных прошла успешно

Проверка содержимого БД
[(&#39;0000.AAAA.CCCC&#39;, &#39;sw1&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.BBBB.CCCC&#39;, &#39;sw2&#39;, &#39;Cisco 3780&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.AAAA.DDDD&#39;, &#39;sw3&#39;, &#39;Cisco 2960&#39;, &#39;London, Green Str&#39;),
 (&#39;0011.AAAA.CCCC&#39;, &#39;sw4&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;)]
</pre></div>
</div>
<p>Теперь проверим, как функция write_data_to_db отработает при наличии
одинаковых MAC-адресов в данных.</p>
<p>В файле create_sw_inventory_ver3.py используются функции из файла
create_sw_inventory_ver2_functions.py и подразумевается, что скрипт
будет запускаться после записи предыдущих данных:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">create_sw_inventory_ver2_functions</span> <span class="k">as</span> <span class="nn">dbf</span>

<span class="c1">#MAC-адрес sw7 совпадает с MAC-адресом коммутатора sw3 в списке data</span>
<span class="n">data2</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;0055.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw5&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;0066.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw6&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw7&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;0088.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw8&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>

<span class="n">con</span> <span class="o">=</span> <span class="n">dbf</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="s1">&#39;sw_inventory3.db&#39;</span><span class="p">)</span>

<span class="n">query_insert</span> <span class="o">=</span> <span class="s2">&quot;INSERT into switch values (?, ?, ?, ?)&quot;</span>
<span class="n">query_get_all</span> <span class="o">=</span> <span class="s2">&quot;SELECT * from switch&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Проверка текущего содержимого БД&quot;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">dbf</span><span class="o">.</span><span class="n">get_all_from_db</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">query_get_all</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Попытка записать данные с повторяющимся MAC-адресом:&quot;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
<span class="n">dbf</span><span class="o">.</span><span class="n">write_data_to_db</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">query_insert</span><span class="p">,</span> <span class="n">data2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Проверка содержимого БД&quot;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">dbf</span><span class="o">.</span><span class="n">get_all_from_db</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">query_get_all</span><span class="p">))</span>

<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>В списке data2 у коммутатора sw7 MAC-адрес совпадает с уже существующим
в БД коммутатором sw3.</p>
<p>Результат выполнения скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python create_sw_inventory_ver3.py

Проверка текущего содержимого БД
[(&#39;0000.AAAA.CCCC&#39;, &#39;sw1&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.BBBB.CCCC&#39;, &#39;sw2&#39;, &#39;Cisco 3780&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.AAAA.DDDD&#39;, &#39;sw3&#39;, &#39;Cisco 2960&#39;, &#39;London, Green Str&#39;),
 (&#39;0011.AAAA.CCCC&#39;, &#39;sw4&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;)]
------------------------------------------------------------
Попытка записать данные с повторяющимся MAC-адресом:
[(&#39;0055.AAAA.CCCC&#39;, &#39;sw5&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;),
 (&#39;0066.BBBB.CCCC&#39;, &#39;sw6&#39;, &#39;Cisco 3780&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.AAAA.DDDD&#39;, &#39;sw7&#39;, &#39;Cisco 2960&#39;, &#39;London, Green Str&#39;),
 (&#39;0088.AAAA.CCCC&#39;, &#39;sw8&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;)]
Error occurred:  UNIQUE constraint failed: switch.mac

Проверка содержимого БД
[(&#39;0000.AAAA.CCCC&#39;, &#39;sw1&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.BBBB.CCCC&#39;, &#39;sw2&#39;, &#39;Cisco 3780&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.AAAA.DDDD&#39;, &#39;sw3&#39;, &#39;Cisco 2960&#39;, &#39;London, Green Str&#39;),
 (&#39;0011.AAAA.CCCC&#39;, &#39;sw4&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;)]
</pre></div>
</div>
<p>Обратите внимание, что содержимое таблицы switch до и после добавления
информации одинаково. Это значит, что не записалась ни одна строка из
списка data2.</p>
<p>Так получилось из-за того, что используется метод executemany, и в
пределах одной транзакции мы пытаемся записать все 4 строки. Если
возникает ошибка с одной из них - откатываются все изменения.</p>
<p>Иногда это именно то поведение, которое нужно. Если же надо, чтобы
игнорировались только строки с ошибками, надо использовать метод execute
и записывать каждую строку отдельно.</p>
<p>В файле create_sw_inventory_ver4.py создана функция
write_rows_to_db, которая уже по очереди пишет данные и, если
возникла ошибка, то только изменения для конкретных данных откатываются:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">create_sw_inventory_ver2_functions</span> <span class="k">as</span> <span class="nn">dbf</span>

<span class="c1">#MAC-адрес sw7 совпадает с MAC-адресом коммутатора sw3 в списке data</span>
<span class="n">data2</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;0055.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw5&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;0066.BBBB.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw6&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3780&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;0000.AAAA.DDDD&#39;</span><span class="p">,</span> <span class="s1">&#39;sw7&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 2960&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;0088.AAAA.CCCC&#39;</span><span class="p">,</span> <span class="s1">&#39;sw8&#39;</span><span class="p">,</span> <span class="s1">&#39;Cisco 3750&#39;</span><span class="p">,</span> <span class="s1">&#39;London, Green Str&#39;</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">write_rows_to_db</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Функция ожидает аргументы:</span>
<span class="sd">     * connection - соединение с БД</span>
<span class="sd">     * query - запрос, который нужно выполнить</span>
<span class="sd">     * data - данные, которые надо передать в виде списка кортежей</span>

<span class="sd">    Функция пытается записать поочереди кортежи из списка data.</span>
<span class="sd">    Если кортеж удалось записать успешно, изменения сохраняются в БД.</span>
<span class="sd">    Если в процессе записи кортежа возникла ошибка, транзакция откатывается.</span>

<span class="sd">    Флаг verbose контролирует то, будут ли выведены сообщения об удачной</span>
<span class="sd">    или неудачной записи кортежа.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;При записи данных &#39;</span><span class="si">{}</span><span class="s2">&#39; возникла ошибка&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Запись данных &#39;</span><span class="si">{}</span><span class="s2">&#39; прошла успешно&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)))</span>


<span class="n">con</span> <span class="o">=</span> <span class="n">dbf</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="s1">&#39;sw_inventory3.db&#39;</span><span class="p">)</span>

<span class="n">query_insert</span> <span class="o">=</span> <span class="s1">&#39;INSERT into switch values (?, ?, ?, ?)&#39;</span>
<span class="n">query_get_all</span> <span class="o">=</span> <span class="s1">&#39;SELECT * from switch&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Проверка текущего содержимого БД&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">dbf</span><span class="o">.</span><span class="n">get_all_from_db</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">query_get_all</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Попытка записать данные с повторяющимся MAC-адресом:&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
<span class="n">write_rows_to_db</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">query_insert</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Проверка содержимого БД&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">dbf</span><span class="o">.</span><span class="n">get_all_from_db</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">query_get_all</span><span class="p">))</span>

<span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Теперь результат выполнения будет таким (пропущен только sw7):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python create_sw_inventory_ver4.py

Проверка текущего содержимого БД
[(&#39;0000.AAAA.CCCC&#39;, &#39;sw1&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.BBBB.CCCC&#39;, &#39;sw2&#39;, &#39;Cisco 3780&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.AAAA.DDDD&#39;, &#39;sw3&#39;, &#39;Cisco 2960&#39;, &#39;London, Green Str&#39;),
 (&#39;0011.AAAA.CCCC&#39;, &#39;sw4&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;)]
------------------------------------------------------------
Попытка записать данные с повторяющимся MAC-адресом:
[(&#39;0055.AAAA.CCCC&#39;, &#39;sw5&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;),
 (&#39;0066.BBBB.CCCC&#39;, &#39;sw6&#39;, &#39;Cisco 3780&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.AAAA.DDDD&#39;, &#39;sw7&#39;, &#39;Cisco 2960&#39;, &#39;London, Green Str&#39;),
 (&#39;0088.AAAA.CCCC&#39;, &#39;sw8&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;)]
Запись данных &quot;0055.AAAA.CCCC, sw5, Cisco 3750, London, Green Str&quot; прошла успешно
Запись данных &quot;0066.BBBB.CCCC, sw6, Cisco 3780, London, Green Str&quot; прошла успешно
При записи данных &quot;0000.AAAA.DDDD, sw7, Cisco 2960, London, Green Str&quot; возникла ошибка
Запись данных &quot;0088.AAAA.CCCC, sw8, Cisco 3750, London, Green Str&quot; прошла успешно

Проверка содержимого БД
[(&#39;0000.AAAA.CCCC&#39;, &#39;sw1&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.BBBB.CCCC&#39;, &#39;sw2&#39;, &#39;Cisco 3780&#39;, &#39;London, Green Str&#39;),
 (&#39;0000.AAAA.DDDD&#39;, &#39;sw3&#39;, &#39;Cisco 2960&#39;, &#39;London, Green Str&#39;),
 (&#39;0011.AAAA.CCCC&#39;, &#39;sw4&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;),
 (&#39;0055.AAAA.CCCC&#39;, &#39;sw5&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;),
 (&#39;0066.BBBB.CCCC&#39;, &#39;sw6&#39;, &#39;Cisco 3780&#39;, &#39;London, Green Str&#39;),
 (&#39;0088.AAAA.CCCC&#39;, &#39;sw8&#39;, &#39;Cisco 3750&#39;, &#39;London, Green Str&#39;)]
</pre></div>
</div>
</div>
<span id="document-book/25_db/example_sqlite"></span><div class="section" id="sqlite">
<h5>Пример использования SQLite<a class="headerlink" href="#sqlite" title="Ссылка на этот заголовок">¶</a></h5>
<p>В 15 разделе был пример разбора
вывода команды show ip dhcp snooping binding. На выходе мы получили
информацию о параметрах подключенных устройств (interface, IP, MAC,
VLAN).</p>
<p>В таком варианте можно посмотреть только все подключенные устройства к
коммутатору. Если же нужно узнать на основании одного из параметров
другие, то в таком виде это не очень удобно.</p>
<p>Например, если нужно по IP-адресу получить информацию о том, к какому
интерфейсу подключен компьютер, какой у него MAC-адрес и в каком он
VLAN, то по выводу скрипта это сделать не очень просто и, главное, не
очень удобно.</p>
<p>Запишем информацию, полученную из вывода sh ip dhcp snooping binding в
SQLite. Это позволит делать запросы по любому параметру и получать
недостающие.
Для этого примера достаточно создать одну таблицу, где будет храниться
информация.</p>
<p>Определение таблицы прописано в отдельном файле
dhcp_snooping_schema.sql и выглядит так:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">table</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span> <span class="n">dhcp</span> <span class="p">(</span>
    <span class="n">mac</span>          <span class="n">text</span> <span class="ow">not</span> <span class="n">NULL</span> <span class="n">primary</span> <span class="n">key</span><span class="p">,</span>
    <span class="n">ip</span>           <span class="n">text</span><span class="p">,</span>
    <span class="n">vlan</span>         <span class="n">text</span><span class="p">,</span>
    <span class="n">interface</span>    <span class="n">text</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Для всех полей определен тип данных «текст».</p>
<p>MAC-адрес является первичным ключом нашей таблицы, что вполне логично,
так как MAC-адрес должен быть уникальным.</p>
<p>Кроме того, используется выражение <code class="docutils literal notranslate"><span class="pre">create</span> <span class="pre">table</span> <span class="pre">if</span> <span class="pre">not</span> <span class="pre">exists</span></code> -
SQLite создаст таблицу только в том случае, если она не существует.</p>
<p>Теперь надо создать файл БД, подключиться к базе данных и создать
таблицу (файл create_sqlite_ver1.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;dhcp_snooping.db&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating schema...&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;dhcp_snooping_schema.sql&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>

<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Комментарии к файлу:</p>
<ul class="simple">
<li>при выполнении строки <code class="docutils literal notranslate"><span class="pre">conn</span> <span class="pre">=</span> <span class="pre">sqlite3.connect('dhcp_snooping.db')</span></code>:<ul>
<li>создается файл dhcp_snooping.db, если его нет</li>
<li>создается объект Connection</li>
</ul>
</li>
<li>в БД создается таблица (если ее не было) на основании команд, которые указаны в файле dhcp_snooping_schema.sql:<ul>
<li>открывается файл dhcp_snooping_schema.sql</li>
<li><code class="docutils literal notranslate"><span class="pre">schema</span> <span class="pre">=</span> <span class="pre">f.read()</span></code> - весь файл считывается в одну строку</li>
<li><code class="docutils literal notranslate"><span class="pre">conn.executescript(schema)</span></code> - метод executescript позволяет выполнять команды SQL, которые прописаны в файле</li>
</ul>
</li>
</ul>
<p>Выполнение скрипта:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python create_sqlite_ver1.py
Creating schema...
Done
</pre></div>
</div>
<p>В результате должен быть создан файл БД и таблица dhcp.</p>
<p>Проверить, что таблица создалась, можно с помощью утилиты sqlite3,
которая позволяет выполнять запросы прямо в командной строке.</p>
<p>Список созданных таблиц выводится таким образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sqlite3 dhcp_snooping.db &quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39;&quot;
dhcp
</pre></div>
</div>
<p>Теперь нужно записать информацию из вывода команды sh ip dhcp snooping
binding в таблицу (файл dhcp_snooping.txt):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MacAddress</span>          <span class="n">IpAddress</span>        <span class="n">Lease</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>  <span class="n">Type</span>           <span class="n">VLAN</span>  <span class="n">Interface</span>
<span class="o">------------------</span>  <span class="o">---------------</span>  <span class="o">----------</span>  <span class="o">-------------</span>  <span class="o">----</span>  <span class="o">--------------------</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BB</span><span class="p">:</span><span class="mi">3</span><span class="n">D</span><span class="p">:</span><span class="n">D6</span><span class="p">:</span><span class="mi">58</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.2</span>        <span class="mi">86250</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">10</span>    <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="n">A3</span><span class="p">:</span><span class="mi">3</span><span class="n">E</span><span class="p">:</span><span class="mi">5</span><span class="n">B</span><span class="p">:</span><span class="mi">69</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">5.2</span>         <span class="mi">63951</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">5</span>     <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">10</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="n">B3</span><span class="p">:</span><span class="mi">7</span><span class="n">E</span><span class="p">:</span><span class="mi">9</span><span class="n">B</span><span class="p">:</span><span class="mi">60</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">5.4</span>         <span class="mi">63253</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">5</span>     <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">9</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.6</span>        <span class="mi">76260</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">10</span>    <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">3</span>
<span class="n">Total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">bindings</span><span class="p">:</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Во второй версии скрипта сначала вывод в файле dhcp_snooping.txt
обрабатывается регулярными выражениями, а затем записи добавляются в БД
(файл create_sqlite_ver2.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\S+) +(\S+) +\d+ +\S+ +(\d+) +(\S+)&#39;</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;dhcp_snooping.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;dhcp_snooping.db&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating schema...&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;dhcp_snooping_schema.sql&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inserting DHCP Snooping data&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">conn</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;insert into dhcp (mac, ip, vlan, interface)</span>
<span class="s1">                       values (?, ?, ?, ?)&#39;&#39;&#39;</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error occured: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Пока что файл БД каждый раз надо удалять, так как скрипт пытается
его создать при каждом запуске.</p>
</div>
<p>Комментарии к скрипту:</p>
<ul class="simple">
<li>в регулярном выражении, которое проходится по выводу
команды sh ip dhcp snooping binding, используются не именованные
группы, как в примере раздела <a class="reference external" href="../14_regex/4a_group_example.md">Регулярные выражения</a>, а нумерованные<ul>
<li>группы созданы только для тех элементов, которые нас интересуют</li>
</ul>
</li>
<li>result - это список, в котором хранится результат обработки вывода команды<ul>
<li>но теперь тут не словари, а кортежи с результатами</li>
<li>это нужно для того, чтобы их можно было сразу передавать на запись в БД</li>
</ul>
</li>
<li>Перебираем в полученном списке кортежей элементы</li>
<li>В этом скрипте используется еще один вариант записи в БД<ul>
<li>строка query описывает запрос. Но вместо значений
указываются знаки вопроса. Такой вариант записи запроса
позволяет динамически подставлять значение полей</li>
<li>затем методу execute передается строка запроса и кортеж row, где находятся значения</li>
</ul>
</li>
</ul>
<p>Выполняем скрипт:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python create_sqlite_ver2.py
Creating schema...
Done
Inserting DHCP Snooping data
</pre></div>
</div>
<p>Проверим, что данные записались:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sqlite3 dhcp_snooping.db &quot;select * from dhcp&quot;
-- Loading resources from /home/vagrant/.sqliterc

mac                ip          vlan        interface
-----------------  ----------  ----------  ---------------
00:09:BB:3D:D6:58  10.1.10.2   10          FastEthernet0/1
00:04:A3:3E:5B:69  10.1.5.2    5           FastEthernet0/1
00:05:B3:7E:9B:60  10.1.5.4    5           FastEthernet0/9
00:09:BC:3F:A6:50  10.1.10.6   10          FastEthernet0/3
</pre></div>
</div>
<p>Теперь попробуем запросить по определенному параметру:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sqlite3 dhcp_snooping.db &quot;select * from dhcp where ip = &#39;10.1.5.2&#39;&quot;
-- Loading resources from /home/vagrant/.sqliterc

mac                ip          vlan        interface
-----------------  ----------  ----------  ----------------
00:04:A3:3E:5B:69  10.1.5.2    5           FastEthernet0/10
</pre></div>
</div>
<p>То есть, теперь на основании одного параметра можно получать остальные.</p>
<p>Переделаем скрипт таким образом, чтобы в нём была проверка на наличие
файла dhcp_snooping.db. Если файл БД есть, то не надо создавать
таблицу, считаем, что она уже создана.</p>
<p>Файл create_sqlite_ver3.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">data_filename</span> <span class="o">=</span> <span class="s1">&#39;dhcp_snooping.txt&#39;</span>
<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;dhcp_snooping.db&#39;</span>
<span class="n">schema_filename</span> <span class="o">=</span> <span class="s1">&#39;dhcp_snooping_schema.sql&#39;</span>

<span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\S+) +(\S+) +\d+ +\S+ +(\d+) +(\S+)&#39;</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;dhcp_snooping.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>

<span class="n">db_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">db_exists</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating schema...&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Database exists, assume dhcp table does, too.&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inserting DHCP Snooping data&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">conn</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;insert into dhcp (mac, ip, vlan, interface)</span>
<span class="s1">                       values (?, ?, ?, ?)&#39;&#39;&#39;</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error occured: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Теперь есть проверка наличия файла БД, и файл dhcp_snooping.db будет
создаваться только в том случае, если его нет. Данные также записываются
только в том случае, если не создан файл dhcp_snooping.db.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Разделение процесса создания таблицы и заполнения ее данными
вынесено в задания к разделу.</p>
</div>
<p>Если файла нет (предварительно его удалить):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rm dhcp_snooping.db
$ python create_sqlite_ver3.py
Creating schema...
Done
Inserting DHCP Snooping data
</pre></div>
</div>
<p>Проверим. В случае, если файл уже есть, но данные не записаны:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rm dhcp_snooping.db

$ python create_sqlite_ver1.py
Creating schema...
Done
$ python create_sqlite_ver3.py
Database exists, assume dhcp table does, too.
Inserting DHCP Snooping data
</pre></div>
</div>
<p>Если есть и БД и данные:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python create_sqlite_ver3.py
Database exists, assume dhcp table does, too.
Inserting DHCP Snooping data
Error occurred:  UNIQUE constraint failed: dhcp.mac
Error occurred:  UNIQUE constraint failed: dhcp.mac
Error occurred:  UNIQUE constraint failed: dhcp.mac
Error occurred:  UNIQUE constraint failed: dhcp.mac
</pre></div>
</div>
<p>Теперь делаем отдельный скрипт, который занимается отправкой запросов в
БД и выводом результатов. Он должен:</p>
<ul class="simple">
<li>ожидать от пользователя ввода параметров:<ul>
<li>имя параметра</li>
<li>значение параметра</li>
</ul>
</li>
<li>делать нормальный вывод данных по запросу</li>
</ul>
<p>Файл get_data_ver1.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;dhcp_snooping.db&#39;</span>

<span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mac&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan&#39;</span><span class="p">,</span> <span class="s1">&#39;interface&#39;</span><span class="p">]</span>
<span class="n">keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span>

<span class="c1">#Позволяет далее обращаться к данным в колонках, по имени колонки</span>
<span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Detailed information for host(s) with&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;select * from dhcp where </span><span class="si">{}</span><span class="s1"> = ?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">))</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:12}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
<p>Комментарии к скрипту:</p>
<ul>
<li><p class="first">из аргументов, которые передали скрипту, считываются параметры key, value</p>
<ul class="simple">
<li>из списка keys удаляется выбранный ключ. Таким образом,
в списке остаются только те параметры, которые нужно вывести</li>
</ul>
</li>
<li><p class="first">подключаемся к БД</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">conn.row_factory</span> <span class="pre">=</span> <span class="pre">sqlite3.Row</span></code> - позволяет далее обращаться к данным в колонках по имени колонки</li>
</ul>
</li>
<li><p class="first">из БД выбираются те строки, в которых ключ равен указанному значению</p>
<ul class="simple">
<li>в SQL значения можно подставлять через знак вопроса, но нельзя подставлять
имя столбца. Поэтому имя столбца подставляется через форматирование
строк, а значение - штатным средством SQL.</li>
<li>Обратите внимание на <code class="docutils literal notranslate"><span class="pre">(value,)</span></code> - таким образом передается кортеж с одним элементом</li>
</ul>
</li>
<li><p class="first">Полученная информация выводится на стандартный поток вывода:
* перебираем полученные результаты и выводим только те поля, названия</p>
<blockquote>
<div><p>которых находятся в списке keys</p>
</div></blockquote>
</li>
</ul>
<p>Проверим работу скрипта.</p>
<p>Показать параметры хоста с IP 10.1.10.2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python get_data_ver1.py ip 10.1.10.2

Detailed information for host(s) with ip 10.1.10.2
----------------------------------------
mac         : 00:09:BB:3D:D6:58
vlan        : 10
interface   : FastEthernet0/1
----------------------------------------
</pre></div>
</div>
<p>Показать хосты в VLAN 10:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python get_data_ver1.py vlan 10

Detailed information for host(s) with vlan 10
----------------------------------------
mac         : 00:09:BB:3D:D6:58
ip          : 10.1.10.2
interface   : FastEthernet0/1
----------------------------------------
mac         : 00:07:BC:3F:A6:50
ip          : 10.1.10.6
interface   : FastEthernet0/3
----------------------------------------
</pre></div>
</div>
<p>Вторая версия скрипта для получения данных с небольшими улучшениями:</p>
<ul class="simple">
<li>Вместо форматирования строк используется словарь, в котором описаны
запросы, соответствующие каждому ключу.</li>
<li>Выполняется проверка ключа, который был выбран</li>
<li>Для получения заголовков всех столбцов, который
соответствуют запросу, используется метод keys()</li>
</ul>
<p>Файл get_data_ver2.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">db_filename</span> <span class="o">=</span> <span class="s1">&#39;dhcp_snooping.db&#39;</span>

<span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;vlan&#39;</span><span class="p">:</span> <span class="s1">&#39;select mac, ip, interface from dhcp where vlan = ?&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mac&#39;</span><span class="p">:</span> <span class="s1">&#39;select vlan, ip, interface from dhcp where mac = ?&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="s1">&#39;select vlan, mac, interface from dhcp where ip = ?&#39;</span><span class="p">,</span>
    <span class="s1">&#39;interface&#39;</span><span class="p">:</span> <span class="s1">&#39;select vlan, mac, ip from dhcp where interface = ?&#39;</span>
<span class="p">}</span>

<span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">keys</span> <span class="o">=</span> <span class="n">query_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Enter key from </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">)))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_filename</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Detailed information for host(s) with&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="n">query_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">))</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">row_name</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:12}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_name</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">row_name</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
<p>В этом скрипте есть несколько недостатков:</p>
<ul class="simple">
<li>не проверяется количество аргументов, которые передаются скрипту</li>
<li>хотелось бы собирать информацию с разных коммутаторов. А для этого надо добавить поле,
которое указывает, на каком коммутаторе была найдена запись</li>
</ul>
<p>Кроме того, многое нужно доработать в скрипте, который создает БД и
записывает данные.</p>
<p>Все доработки будут выполняться в заданиях этого раздела.</p>
</div>
</div>
</div>
<span id="document-book/25_db/further_reading"></span><div class="section" id="id1">
<h4>Дополнительные материалы<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.sqlitetutorial.net/">SQLite Tutorial</a> - подробное
описание SQLite</li>
<li><a class="reference external" href="https://docs.python.org/3/library/sqlite3.html">Документация модуля
sqlite3</a></li>
<li><a class="reference external" href="https://pymotw.com/3/sqlite3/index.html">sqlite3 на сайте PyMOTW</a></li>
</ul>
<p>Статьи:</p>
<ul class="simple">
<li><a class="reference external" href="http://sebastianraschka.com/Articles/2014_sqlite_in_python_tutorial.html">A thorough guide to SQLite database operations in
Python</a></li>
</ul>
</div>
<span id="document-exercises/25_exercises"></span><div class="section" id="id1">
<h4>Задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Для заданий 25 раздела нет тестов!</p>
</div>
<div class="section" id="id2">
<h5>Задание 25.1<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для заданий 25 раздела нет тестов!</p>
<p>Необходимо создать два скрипта:</p>
<ol class="arabic simple">
<li>create_db.py</li>
<li>add_data.py</li>
</ol>
<p>Код в скриптах должен быть разбит на функции.
Какие именно функции и как разделить код, надо решить самостоятельно.
Часть кода может быть глобальной.</p>
<ol class="arabic simple">
<li>create_db.py - в этот скрипт должна быть вынесена функциональность по созданию БД:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>должна выполняться проверка наличия файла БД</li>
<li>если файла нет, согласно описанию схемы БД в файле dhcp_snooping_schema.sql, должна быть создана БД</li>
<li>имя файла бд - dhcp_snooping.db</li>
</ul>
</div></blockquote>
<p>В БД должно быть две таблицы (схема описана в файле dhcp_snooping_schema.sql):</p>
<blockquote>
<div><ul class="simple">
<li>switches - в ней находятся данные о коммутаторах</li>
<li>dhcp - тут хранится информация полученная из вывода sh ip dhcp snooping binding</li>
</ul>
</div></blockquote>
<p>Пример выполнения скрипта, когда файла dhcp_snooping.db нет:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python create_db.py
Создаю базу данных...
</pre></div>
</div>
<p>После создания файла:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python create_db.py
База данных существует
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>add_data.py - с помощью этого скрипта, выполняется добавление данных в БД. Скрипт должен добавлять данные из вывода sh ip dhcp snooping binding и информацию о коммутаторах</li>
</ol>
<p>Соответственно, в файле add_data.py должны быть две части:</p>
<ul class="simple">
<li>информация о коммутаторах добавляется в таблицу switches<ul>
<li>данные о коммутаторах, находятся в файле switches.yml</li>
</ul>
</li>
<li>информация на основании вывода sh ip dhcp snooping binding добавляется в таблицу dhcp<ul>
<li>вывод с трёх коммутаторов: файлы sw1_dhcp_snooping.txt, sw2_dhcp_snooping.txt, sw3_dhcp_snooping.txt</li>
<li>так как таблица dhcp изменилась, и в ней теперь присутствует поле switch, его нужно также заполнять. Имя коммутатора определяется по имени файла с данными</li>
</ul>
</li>
</ul>
<p>Пример выполнения скрипта, когда база данных еще не создана:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python add_data.py
База данных не существует. Перед добавлением данных, ее надо создать
</pre></div>
</div>
<p>Пример выполнения скрипта первый раз, после создания базы данных:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python add_data.py
Добавляю данные в таблицу switches...
Добавляю данные в таблицу dhcp...
</pre></div>
</div>
<p>Пример выполнения скрипта, после того как данные были добавлены в таблицу (порядок добавления данных может быть произвольным, но сообщения должны выводиться аналогично выводу ниже):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python add_data.py
Добавляю данные в таблицу switches...
При добавлении данных: (&#39;sw1&#39;, &#39;London, 21 New Globe Walk&#39;) Возникла ошибка: UNIQUE constraint failed: switches.hostname
При добавлении данных: (&#39;sw2&#39;, &#39;London, 21 New Globe Walk&#39;) Возникла ошибка: UNIQUE constraint failed: switches.hostname
При добавлении данных: (&#39;sw3&#39;, &#39;London, 21 New Globe Walk&#39;) Возникла ошибка: UNIQUE constraint failed: switches.hostname
Добавляю данные в таблицу dhcp...
При добавлении данных: (&#39;00:09:BB:3D:D6:58&#39;, &#39;10.1.10.2&#39;, &#39;10&#39;, &#39;FastEthernet0/1&#39;, &#39;sw1&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:04:A3:3E:5B:69&#39;, &#39;10.1.5.2&#39;, &#39;5&#39;, &#39;FastEthernet0/10&#39;, &#39;sw1&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:05:B3:7E:9B:60&#39;, &#39;10.1.5.4&#39;, &#39;5&#39;, &#39;FastEthernet0/9&#39;, &#39;sw1&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:07:BC:3F:A6:50&#39;, &#39;10.1.10.6&#39;, &#39;10&#39;, &#39;FastEthernet0/3&#39;, &#39;sw1&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:09:BC:3F:A6:50&#39;, &#39;192.168.100.100&#39;, &#39;1&#39;, &#39;FastEthernet0/7&#39;, &#39;sw1&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:E9:BC:3F:A6:50&#39;, &#39;100.1.1.6&#39;, &#39;3&#39;, &#39;FastEthernet0/20&#39;, &#39;sw3&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:E9:22:11:A6:50&#39;, &#39;100.1.1.7&#39;, &#39;3&#39;, &#39;FastEthernet0/21&#39;, &#39;sw3&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:A9:BB:3D:D6:58&#39;, &#39;10.1.10.20&#39;, &#39;10&#39;, &#39;FastEthernet0/7&#39;, &#39;sw2&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:B4:A3:3E:5B:69&#39;, &#39;10.1.5.20&#39;, &#39;5&#39;, &#39;FastEthernet0/5&#39;, &#39;sw2&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:C5:B3:7E:9B:60&#39;, &#39;10.1.5.40&#39;, &#39;5&#39;, &#39;FastEthernet0/9&#39;, &#39;sw2&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:A9:BC:3F:A6:50&#39;, &#39;10.1.10.60&#39;, &#39;20&#39;, &#39;FastEthernet0/2&#39;, &#39;sw2&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
</pre></div>
</div>
<p>Оба скрипта вызываются без аргументов.</p>
</div>
<div class="section" id="id3">
<h5>Задание 25.2<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для заданий 25 раздела нет тестов!</p>
<p>В этом задании необходимо создать скрипт get_data.py.</p>
<p>Код в скрипте должен быть разбит на функции.
Какие именно функции и как разделить код, надо решить самостоятельно.
Часть кода может быть глобальной.</p>
<p>Скрипту могут передаваться аргументы и, в зависимости от аргументов, надо выводить разную информацию. Если скрипт вызван:</p>
<ul class="simple">
<li>без аргументов, вывести всё содержимое таблицы dhcp</li>
<li>с двумя аргументами, вывести информацию из таблицы dhcp, которая соответствует полю и значению</li>
<li>с любым другим количеством аргументов, вывести сообщение, что скрипт поддерживает только два или ноль аргументов</li>
</ul>
<p>Файл БД можно скопировать из задания 25.1.</p>
<p>Примеры вывода для разного количества и значений аргументов:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python get_data.py
В таблице dhcp такие записи:
-----------------  ---------------  --  ----------------  ---
00:09:BB:3D:D6:58  10.1.10.2        10  FastEthernet0/1   sw1
00:04:A3:3E:5B:69  10.1.5.2          5  FastEthernet0/10  sw1
00:05:B3:7E:9B:60  10.1.5.4          5  FastEthernet0/9   sw1
00:07:BC:3F:A6:50  10.1.10.6        10  FastEthernet0/3   sw1
00:09:BC:3F:A6:50  192.168.100.100   1  FastEthernet0/7   sw1
00:E9:BC:3F:A6:50  100.1.1.6         3  FastEthernet0/20  sw3
00:E9:22:11:A6:50  100.1.1.7         3  FastEthernet0/21  sw3
00:A9:BB:3D:D6:58  10.1.10.20       10  FastEthernet0/7   sw2
00:B4:A3:3E:5B:69  10.1.5.20         5  FastEthernet0/5   sw2
00:C5:B3:7E:9B:60  10.1.5.40         5  FastEthernet0/9   sw2
00:A9:BC:3F:A6:50  10.1.10.60       20  FastEthernet0/2   sw2
-----------------  ---------------  --  ----------------  ---

$ python get_data.py vlan 10

Информация об устройствах с такими параметрами: vlan 10
-----------------  ----------  --  ---------------  ---
00:09:BB:3D:D6:58  10.1.10.2   10  FastEthernet0/1  sw1
00:07:BC:3F:A6:50  10.1.10.6   10  FastEthernet0/3  sw1
00:A9:BB:3D:D6:58  10.1.10.20  10  FastEthernet0/7  sw2
-----------------  ----------  --  ---------------  ---

$ python get_data.py ip 10.1.10.2

Информация об устройствах с такими параметрами: ip 10.1.10.2
-----------------  ---------  --  ---------------  ---
00:09:BB:3D:D6:58  10.1.10.2  10  FastEthernet0/1  sw1
-----------------  ---------  --  ---------------  ---

$ python get_data.py vln 10
Данный параметр не поддерживается.
Допустимые значения параметров: mac, ip, vlan, interface, switch

$ python get_data.py ip vlan 10
Пожалуйста, введите два или ноль аргументов
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Задание 25.3<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для заданий 25 раздела нет тестов!</p>
<p>В прошлых заданиях информация добавлялась в пустую БД.
В этом задании, разбирается ситуация, когда в БД уже есть информация.</p>
<p>Скопируйте скрипт add_data.py из задания 25.1 и попробуйте выполнить его повторно, на существующей БД.
Должен быть такой вывод:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python add_data.py
Добавляю данные в таблицу switches...
При добавлении данных: (&#39;sw1&#39;, &#39;London, 21 New Globe Walk&#39;) Возникла ошибка: UNIQUE constraint failed: switches.hostname
При добавлении данных: (&#39;sw2&#39;, &#39;London, 21 New Globe Walk&#39;) Возникла ошибка: UNIQUE constraint failed: switches.hostname
При добавлении данных: (&#39;sw3&#39;, &#39;London, 21 New Globe Walk&#39;) Возникла ошибка: UNIQUE constraint failed: switches.hostname
Добавляю данные в таблицу dhcp...
При добавлении данных: (&#39;00:09:BB:3D:D6:58&#39;, &#39;10.1.10.2&#39;, &#39;10&#39;, &#39;FastEthernet0/1&#39;, &#39;sw1&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:04:A3:3E:5B:69&#39;, &#39;10.1.5.2&#39;, &#39;5&#39;, &#39;FastEthernet0/10&#39;, &#39;sw1&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:05:B3:7E:9B:60&#39;, &#39;10.1.5.4&#39;, &#39;5&#39;, &#39;FastEthernet0/9&#39;, &#39;sw1&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:07:BC:3F:A6:50&#39;, &#39;10.1.10.6&#39;, &#39;10&#39;, &#39;FastEthernet0/3&#39;, &#39;sw1&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
При добавлении данных: (&#39;00:09:BC:3F:A6:50&#39;, &#39;192.168.100.100&#39;, &#39;1&#39;, &#39;FastEthernet0/7&#39;, &#39;sw1&#39;) Возникла ошибка: UNIQUE constraint failed: dhcp.mac
... (вывод сокращен)
</pre></div>
</div>
<p>При создании схемы БД, было явно указано, что поле MAC-адрес, должно быть уникальным.
Поэтому, при добавлении записи с таким же MAC-адресом, возникает исключение (ошибка).
В задании 25.1 исключение обрабатывается и выводится сообщение на стандартный поток вывода.</p>
<p>В этом задании считается, что информация периодически считывается с коммутаторов и записывается в файлы.
После этого, информацию из файлов надо перенести в базу данных.
При этом, в новых данных могут быть изменения: MAC пропал, MAC перешел на другой порт/vlan, появился новый MAC и тп.</p>
<p>В этом задании в таблице dhcp надо создать новое поле active, которое будет указывать является ли запись актуальной.
Новая схема БД находится в файле dhcp_snooping_schema.sql</p>
<p>Поле active должно принимать такие значения:</p>
<ul class="simple">
<li>0 - означает False. Используется для того, чтобы отметить запись как неактивную</li>
<li>1 - True. Используется чтобы указать, что запись активна</li>
</ul>
<p>Каждый раз, когда информация из файлов с выводом DHCP snooping добавляется заново,
надо пометить все существующие записи (для данного коммутатора), как неактивные (active = 0).
Затем можно обновлять информацию и пометить новые записи, как активные (active = 1).</p>
<p>Таким образом, в БД останутся и старые записи, для MAC-адресов, которые сейчас не активны,
и появится обновленная информация для активных адресов.</p>
<p>Например, в таблице dhcp такие записи:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mac</span>                <span class="n">ip</span>          <span class="n">vlan</span>        <span class="n">interface</span>         <span class="n">switch</span>      <span class="n">active</span>
<span class="o">-----------------</span>  <span class="o">----------</span>  <span class="o">----------</span>  <span class="o">----------------</span>  <span class="o">----------</span>  <span class="o">----------</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BB</span><span class="p">:</span><span class="mi">3</span><span class="n">D</span><span class="p">:</span><span class="n">D6</span><span class="p">:</span><span class="mi">58</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.2</span>   <span class="mi">10</span>          <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>   <span class="n">sw1</span>         <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="n">A3</span><span class="p">:</span><span class="mi">3</span><span class="n">E</span><span class="p">:</span><span class="mi">5</span><span class="n">B</span><span class="p">:</span><span class="mi">69</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">5.2</span>    <span class="mi">5</span>           <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">10</span>  <span class="n">sw1</span>         <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="n">B3</span><span class="p">:</span><span class="mi">7</span><span class="n">E</span><span class="p">:</span><span class="mi">9</span><span class="n">B</span><span class="p">:</span><span class="mi">60</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">5.4</span>    <span class="mi">5</span>           <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">9</span>   <span class="n">sw1</span>         <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.6</span>   <span class="mi">10</span>          <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">3</span>   <span class="n">sw1</span>         <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mi">10</span>  <span class="mi">1</span>           <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">7</span>   <span class="n">sw1</span>         <span class="mi">1</span>
</pre></div>
</div>
<p>И надо добавить такую информацию из файла:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MacAddress</span>          <span class="n">IpAddress</span>        <span class="n">Lease</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>  <span class="n">Type</span>           <span class="n">VLAN</span>  <span class="n">Interface</span>
<span class="o">------------------</span>  <span class="o">---------------</span>  <span class="o">----------</span>  <span class="o">-------------</span>  <span class="o">----</span>  <span class="o">--------------------</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BB</span><span class="p">:</span><span class="mi">3</span><span class="n">D</span><span class="p">:</span><span class="n">D6</span><span class="p">:</span><span class="mi">58</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.2</span>        <span class="mi">86250</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">10</span>    <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="n">A3</span><span class="p">:</span><span class="mi">3</span><span class="n">E</span><span class="p">:</span><span class="mi">5</span><span class="n">B</span><span class="p">:</span><span class="mi">69</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">15.2</span>        <span class="mi">63951</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">15</span>    <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">15</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="n">B3</span><span class="p">:</span><span class="mi">7</span><span class="n">E</span><span class="p">:</span><span class="mi">9</span><span class="n">B</span><span class="p">:</span><span class="mi">60</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">5.4</span>         <span class="mi">63253</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">5</span>     <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">9</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>   <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.6</span>        <span class="mi">76260</span>       <span class="n">dhcp</span><span class="o">-</span><span class="n">snooping</span>   <span class="mi">10</span>    <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">5</span>
</pre></div>
</div>
<p>После добавления данных таблица должна выглядеть так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mac</span>                <span class="n">ip</span>               <span class="n">vlan</span>        <span class="n">interface</span>         <span class="n">switch</span>      <span class="n">active</span>
<span class="o">-----------------</span>  <span class="o">---------------</span>  <span class="o">----------</span>  <span class="o">---------------</span>   <span class="o">----------</span>  <span class="o">----------</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.100</span>  <span class="mi">1</span>           <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">7</span>   <span class="n">sw1</span>         <span class="mi">0</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BB</span><span class="p">:</span><span class="mi">3</span><span class="n">D</span><span class="p">:</span><span class="n">D6</span><span class="p">:</span><span class="mi">58</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.2</span>        <span class="mi">10</span>          <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>   <span class="n">sw1</span>         <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="n">A3</span><span class="p">:</span><span class="mi">3</span><span class="n">E</span><span class="p">:</span><span class="mi">5</span><span class="n">B</span><span class="p">:</span><span class="mi">69</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">15.2</span>        <span class="mi">15</span>          <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">15</span>  <span class="n">sw1</span>         <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="n">B3</span><span class="p">:</span><span class="mi">7</span><span class="n">E</span><span class="p">:</span><span class="mi">9</span><span class="n">B</span><span class="p">:</span><span class="mi">60</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">5.4</span>         <span class="mi">5</span>           <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">9</span>   <span class="n">sw1</span>         <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.6</span>        <span class="mi">10</span>          <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">5</span>   <span class="n">sw1</span>         <span class="mi">1</span>
</pre></div>
</div>
<p>Новая информация должна перезаписывать предыдущую:</p>
<ul class="simple">
<li>MAC 00:04:A3:3E:5B:69 перешел на другой порт и попал в другой интерфейс и получил другой адрес</li>
<li>MAC 00:07:BC:3F:A6:50 перешел на другой порт</li>
</ul>
<p>Если какого-то MAC-адреса нет в новом файле, его надо оставить в бд со значением active = 0: MAC-адреса 00:09:BC:3F:A6:50 нет в новой информации (выключили комп).</p>
<p>Измените скрипт add_data.py таким образом, чтобы выполнялись новые условия и заполнялось поле active.</p>
<p>Код в скрипте должен быть разбит на функции.
Какие именно функции и как разделить код, надо решить самостоятельно.
Часть кода может быть глобальной.</p>
<p>&gt; Для проверки корректности запроса SQL, можно выполнить его в командной строке, с помощью утилиты sqlite3.</p>
<p>Для проверки задания и работы нового поля, сначала добавьте в бд информацию из файлов sw*_dhcp_snooping.txt,
а потом добавьте информацию из файлов new_data/sw*_dhcp_snooping.txt</p>
<p>Данные должны выглядеть так (порядок строк может быть любым)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----------------</span>  <span class="o">---------------</span>  <span class="o">--</span>  <span class="o">----------------</span>  <span class="o">---</span>  <span class="o">-</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.100</span>   <span class="mi">1</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">7</span>   <span class="n">sw1</span>  <span class="mi">0</span>
<span class="mi">00</span><span class="p">:</span><span class="n">C5</span><span class="p">:</span><span class="n">B3</span><span class="p">:</span><span class="mi">7</span><span class="n">E</span><span class="p">:</span><span class="mi">9</span><span class="n">B</span><span class="p">:</span><span class="mi">60</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">5.40</span>         <span class="mi">5</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">9</span>   <span class="n">sw2</span>  <span class="mi">0</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BB</span><span class="p">:</span><span class="mi">3</span><span class="n">D</span><span class="p">:</span><span class="n">D6</span><span class="p">:</span><span class="mi">58</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.2</span>        <span class="mi">10</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>   <span class="n">sw1</span>  <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="n">A3</span><span class="p">:</span><span class="mi">3</span><span class="n">E</span><span class="p">:</span><span class="mi">5</span><span class="n">B</span><span class="p">:</span><span class="mi">69</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">15.2</span>        <span class="mi">15</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">15</span>  <span class="n">sw1</span>  <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="n">B3</span><span class="p">:</span><span class="mi">7</span><span class="n">E</span><span class="p">:</span><span class="mi">9</span><span class="n">B</span><span class="p">:</span><span class="mi">60</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">5.4</span>          <span class="mi">5</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">9</span>   <span class="n">sw1</span>  <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.6</span>        <span class="mi">10</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">5</span>   <span class="n">sw1</span>  <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="n">E9</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>  <span class="mf">100.1</span><span class="o">.</span><span class="mf">1.6</span>         <span class="mi">3</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">20</span>  <span class="n">sw3</span>  <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="n">E9</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>  <span class="mf">100.1</span><span class="o">.</span><span class="mf">1.7</span>         <span class="mi">3</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">21</span>  <span class="n">sw3</span>  <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="n">A9</span><span class="p">:</span><span class="n">BB</span><span class="p">:</span><span class="mi">3</span><span class="n">D</span><span class="p">:</span><span class="n">D6</span><span class="p">:</span><span class="mi">58</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.20</span>       <span class="mi">10</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">7</span>   <span class="n">sw2</span>  <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="n">B4</span><span class="p">:</span><span class="n">A3</span><span class="p">:</span><span class="mi">3</span><span class="n">E</span><span class="p">:</span><span class="mi">5</span><span class="n">B</span><span class="p">:</span><span class="mi">69</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">5.20</span>         <span class="mi">5</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">5</span>   <span class="n">sw2</span>  <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="n">A9</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.65</span>       <span class="mi">20</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">2</span>   <span class="n">sw2</span>  <span class="mi">1</span>
<span class="mi">00</span><span class="p">:</span><span class="n">A9</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>  <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.77</span>       <span class="mi">10</span>  <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">4</span>   <span class="n">sw2</span>  <span class="mi">1</span>
<span class="o">-----------------</span>  <span class="o">---------------</span>  <span class="o">--</span>  <span class="o">----------------</span>  <span class="o">---</span>  <span class="o">-</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Задание 25.4<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для заданий 25 раздела нет тестов!</p>
<p>Скопировать файл get_data из задания 25.2.
Добавить в скрипт поддержку столбца active, который мы добавили в задании 25.3.</p>
<p>Теперь, при запросе информации, сначала должны отображаться активные записи,
а затем, неактивные. Если неактивных записей нет, не отображать заголовок «Неактивные записи».</p>
<p>Примеры выполнения итогового скрипта</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python get_data.py
В таблице dhcp такие записи:

Активные записи:

-----------------  ----------  --  ----------------  ---  -
00:09:BB:3D:D6:58  10.1.10.2   10  FastEthernet0/1   sw1  1
00:04:A3:3E:5B:69  10.1.15.2   15  FastEthernet0/15  sw1  1
00:05:B3:7E:9B:60  10.1.5.4     5  FastEthernet0/9   sw1  1
00:07:BC:3F:A6:50  10.1.10.6   10  FastEthernet0/5   sw1  1
00:E9:BC:3F:A6:50  100.1.1.6    3  FastEthernet0/20  sw3  1
00:E9:22:11:A6:50  100.1.1.7    3  FastEthernet0/21  sw3  1
00:A9:BB:3D:D6:58  10.1.10.20  10  FastEthernet0/7   sw2  1
00:B4:A3:3E:5B:69  10.1.5.20    5  FastEthernet0/5   sw2  1
00:A9:BC:3F:A6:50  10.1.10.65  20  FastEthernet0/2   sw2  1
00:A9:33:44:A6:50  10.1.10.77  10  FastEthernet0/4   sw2  1
-----------------  ----------  --  ----------------  ---  -

Неактивные записи:

-----------------  ---------------  -  ---------------  ---  -
00:09:BC:3F:A6:50  192.168.100.100  1  FastEthernet0/7  sw1  0
00:C5:B3:7E:9B:60  10.1.5.40        5  FastEthernet0/9  sw2  0
-----------------  ---------------  -  ---------------  ---  -

$ python get_data.py vlan 5

Информация об устройствах с такими параметрами: vlan 5

Активные записи:

-----------------  ---------  -  ---------------  ---  -
00:05:B3:7E:9B:60  10.1.5.4   5  FastEthernet0/9  sw1  1
00:B4:A3:3E:5B:69  10.1.5.20  5  FastEthernet0/5  sw2  1
-----------------  ---------  -  ---------------  ---  -

Неактивные записи:

-----------------  ---------  -  ---------------  ---  -
00:C5:B3:7E:9B:60  10.1.5.40  5  FastEthernet0/9  sw2  0
-----------------  ---------  -  ---------------  ---  -


$ python get_data.py vlan 10

Информация об устройствах с такими параметрами: vlan 10

Активные записи:

-----------------  ----------  --  ---------------  ---  -
00:09:BB:3D:D6:58  10.1.10.2   10  FastEthernet0/1  sw1  1
00:07:BC:3F:A6:50  10.1.10.6   10  FastEthernet0/5  sw1  1
00:A9:BB:3D:D6:58  10.1.10.20  10  FastEthernet0/7  sw2  1
00:A9:33:44:A6:50  10.1.10.77  10  FastEthernet0/4  sw2  1
-----------------  ----------  --  ---------------  ---  -
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>Задание 25.5<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для заданий 25 раздела нет тестов!</p>
<p>После выполнения заданий 25.1 - 25.5 в БД остается информация о неактивных записях.
И, если какой-то MAC-адрес не появлялся в новых записях, запись с ним,
может остаться в БД навсегда.</p>
<p>И, хотя это может быть полезно, чтобы посмотреть, где MAC-адрес находился в последний раз,
постоянно хранить эту информацию не очень полезно.</p>
<p>Например, если запись в БД уже больше месяца, то её можно удалить.</p>
<p>Для того, чтобы сделать такой критерий, нужно ввести новое поле,
в которое будет записываться последнее время добавления записи.</p>
<p>Новое поле называется last_active и в нем должна находиться строка,
в формате: YYYY-MM-DD HH:MM:SS.</p>
<p>В этом задании необходимо:</p>
<ul class="simple">
<li>изменить, соответственно, таблицу dhcp и добавить новое поле.<ul>
<li>таблицу можно поменять из cli sqlite, но файл dhcp_snooping_schema.sql тоже необходимо изменить</li>
</ul>
</li>
<li>изменить скрипт add_data.py, чтобы он добавлял к каждой записи время</li>
</ul>
<p>Получить строку со временем и датой, в указанном формате, можно с помощью функции datetime в запросе SQL.
Синтаксис использования такой:</p>
<div class="code sql highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="n">insert</span> <span class="n">into</span> <span class="n">dhcp</span> <span class="p">(</span><span class="n">mac</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">switch</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">last_active</span><span class="p">)</span>
   <span class="o">...&gt;</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;00:09:BC:3F:A6:50&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.100.100&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;FastEthernet0/7&#39;</span><span class="p">,</span> <span class="s1">&#39;sw1&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>То есть вместо значения, которое записывается в базу данных, надо указать datetime(„now“).</p>
<p>После этой команды в базе данных появится такая запись:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mac</span>                <span class="n">ip</span>               <span class="n">vlan</span>   <span class="n">interface</span>        <span class="n">switch</span>   <span class="n">active</span>   <span class="n">last_active</span>
<span class="o">-----------------</span>  <span class="o">---------------</span>  <span class="o">-----</span>  <span class="o">---------------</span>  <span class="o">-------</span>  <span class="o">-------</span>  <span class="o">-------------------</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BC</span><span class="p">:</span><span class="mi">3</span><span class="n">F</span><span class="p">:</span><span class="n">A6</span><span class="p">:</span><span class="mi">50</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">100.100</span>  <span class="mi">1</span>      <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">7</span>  <span class="n">sw1</span>      <span class="mi">0</span>        <span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">08</span> <span class="mi">11</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">56</span>
</pre></div>
</div>
</div>
<div class="section" id="a">
<h5>Задание 25.5a<a class="headerlink" href="#a" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для заданий 25 раздела нет тестов!</p>
<p>После выполнения задания 25.5, в таблице dhcp есть новое поле last_active.</p>
<p>Обновите скрипт add_data.py, таким образом, чтобы он удалял все записи,
которые были активными более 7 дней назад.</p>
<p>Для того, чтобы получить такие записи, можно просто вручную обновить поле last_active в некоторых записях и поставить время 7 или более дней.</p>
<p>В файле задания описан пример работы с объектами модуля datetime.
Показано как получить дату 7 дней назад. С этой датой надо будет сравнивать время last_active.</p>
<p>Обратите внимание, что строки с датой, которые пишутся в БД, можно сравнивать между собой.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">datetime</span>

<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">week_ago</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="c1">#print(now)</span>
<span class="c1">#print(week_ago)</span>
<span class="c1">#print(now &gt; week_ago)</span>
<span class="c1">#print(str(now) &gt; str(week_ago))</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h5>Задание 25.6<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для заданий 25 раздела нет тестов!</p>
<p>В этом задании выложен файл parse_dhcp_snooping.py.
В файле parse_dhcp_snooping.py нельзя ничего менять.</p>
<p>В файле созданы несколько функций и описаны аргументы командной строки,
которые принимает файл.</p>
<p>Есть поддержка аргументов для выполнения всех действий, которые,
в предыдущих заданиях, выполнялись в файлах create_db.py, add_data.py и get_data.py.</p>
<p>В файле parse_dhcp_snooping.py есть такая строка:
import parse_dhcp_snooping_functions as pds</p>
<p>И задача этого задания в том, чтобы создать все необходимые функции,
в файле parse_dhcp_snooping_functions.py на основе информации в файле parse_dhcp_snooping.py.</p>
<p>Из файла parse_dhcp_snooping.py, необходимо определить:</p>
<ul class="simple">
<li>какие функции должны быть в файле parse_dhcp_snooping_functions.py</li>
<li>какие параметры создать в этих функциях</li>
</ul>
<p>Необходимо создать соответствующие функции и перенести в них функционал,
который описан в предыдущих заданиях.</p>
<p>Вся необходимая информация, присутствует в функциях create, add, get,
в файле parse_dhcp_snooping.py.</p>
<p>Для того, чтобы было проще начать, попробуйте создать необходимые функции в файле
parse_dhcp_snooping_functions.py и просто выведите аргументы функций, используя print.</p>
<p>Потом, можно создать функции, которые запрашивают информацию из БД
(базу данных можно скопировать из предыдущих заданий).</p>
<p>Можно создавать любые вспомогательные функции в файле parse_dhcp_snooping_functions.py,
а не только те, которые вызываются из файла parse_dhcp_snooping.py.</p>
<p>Проверьте все операции:</p>
<ul class="simple">
<li>создание БД</li>
<li>добавление информации о коммутаторах</li>
<li>добавление информации на основании вывода sh ip dhcp snooping binding из файлов</li>
<li>выборку информации из БД (по параметру и всю информацию)</li>
</ul>
<p>Чтобы было проще понять, как будет выглядеть вызов скрипта,
ниже несколько примеров.
В примерах показывается вариант, когда в базе данных есть поля active и last_active,
но можно также использовать вариант без этих полей.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_dhcp_snooping.py get -h
usage: parse_dhcp_snooping.py get [-h] [--db DB_FILE]
                                  [-k {mac,ip,vlan,interface,switch}]
                                  [-v VALUE] [-a]

optional arguments:
  -h, --help            show this help message and exit
  --db DB_FILE          имя БД
  -k {mac,ip,vlan,interface,switch}
                        параметр для поиска записей
  -v VALUE              значение параметра
  -a                    показать все содержимое БД


$ python parse_dhcp_snooping.py add -h
usage: parse_dhcp_snooping.py add [-h] [--db DB_FILE] [-s]
                                  filename [filename ...]

positional arguments:
  filename      файл(ы), которые надо добавить

optional arguments:
  -h, --help    show this help message and exit
  --db DB_FILE  имя БД
  -s            если флаг установлен, добавлять данные коммутаторов, иначе -
                DHCP записи


$ python parse_dhcp_snooping.py add -h
usage: parse_dhcp_snooping.py add [-h] [--db DB_FILE] [-s]
                                  filename [filename ...]

positional arguments:
  filename      файл(ы), которые надо добавить

optional arguments:
  -h, --help    show this help message and exit
  --db DB_FILE  имя БД
  -s            если флаг установлен, добавлять данные коммутаторов, иначе
                добавлять DHCP записи


$ python parse_dhcp_snooping.py get -h
usage: parse_dhcp_snooping.py get [-h] [--db DB_FILE]
                                  [-k {mac,ip,vlan,interface,switch}]
                                  [-v VALUE] [-a]

optional arguments:
  -h, --help            show this help message and exit
  --db DB_FILE          имя БД
  -k {mac,ip,vlan,interface,switch}
                        параметр для поиска записей
  -v VALUE              значение параметра
  -a                    показать все содержимое БД


$ python parse_dhcp_snooping.py create_db
Создаю БД dhcp_snooping.db со схемой dhcp_snooping_schema.sql
Создаю базу данных...


$ python parse_dhcp_snooping.py add sw[1-3]_dhcp_snooping.txt
Читаю информацию из файлов
sw1_dhcp_snooping.txt, sw2_dhcp_snooping.txt, sw3_dhcp_snooping.txt

Добавляю данные по DHCP записях в dhcp_snooping.db


$ python parse_dhcp_snooping.py add -s switches.yml
Добавляю данные о коммутаторах

$ python parse_dhcp_snooping.py get
В таблице dhcp такие записи:

Активные записи:

-----------------  ---------------  --  ----------------  ---  -  -------------------
00:09:BB:3D:D6:58  10.1.10.2        10  FastEthernet0/1   sw1  1  2019-03-08 16:47:52
00:04:A3:3E:5B:69  10.1.5.2          5  FastEthernet0/10  sw1  1  2019-03-08 16:47:52
00:05:B3:7E:9B:60  10.1.5.4          5  FastEthernet0/9   sw1  1  2019-03-08 16:47:52
00:07:BC:3F:A6:50  10.1.10.6        10  FastEthernet0/3   sw1  1  2019-03-08 16:47:52
00:09:BC:3F:A6:50  192.168.100.100   1  FastEthernet0/7   sw1  1  2019-03-08 16:47:52
00:A9:BB:3D:D6:58  10.1.10.20       10  FastEthernet0/7   sw2  1  2019-03-08 16:47:52
00:B4:A3:3E:5B:69  10.1.5.20         5  FastEthernet0/5   sw2  1  2019-03-08 16:47:52
00:C5:B3:7E:9B:60  10.1.5.40         5  FastEthernet0/9   sw2  1  2019-03-08 16:47:52
00:A9:BC:3F:A6:50  10.1.10.60       20  FastEthernet0/2   sw2  1  2019-03-08 16:47:52
00:E9:BC:3F:A6:50  100.1.1.6         3  FastEthernet0/20  sw3  1  2019-03-08 16:47:52
-----------------  ---------------  --  ----------------  ---  -  -------------------


$ python parse_dhcp_snooping.py get -k vlan -v 10
Данные из БД: dhcp_snooping.db
Информация об устройствах с такими параметрами: vlan 10

Активные записи:

-----------------  ----------  --  ---------------  ---  -  -------------------
00:09:BB:3D:D6:58  10.1.10.2   10  FastEthernet0/1  sw1  1  2019-03-08 16:47:52
00:07:BC:3F:A6:50  10.1.10.6   10  FastEthernet0/3  sw1  1  2019-03-08 16:47:52
00:A9:BB:3D:D6:58  10.1.10.20  10  FastEthernet0/7  sw2  1  2019-03-08 16:47:52
-----------------  ----------  --  ---------------  ---  -  -------------------


$ python parse_dhcp_snooping.py get -k vln -v 10
usage: parse_dhcp_snooping.py get [-h] [--db DB_FILE]
                                  [-k {mac,ip,vlan,interface,switch}]
                                  [-v VALUE] [-a]
parse_dhcp_snooping.py get: error: argument -k: invalid choice: &#39;vln&#39; (choose from &#39;mac&#39;, &#39;ip&#39;, &#39;vlan&#39;, &#39;interface&#39;, &#39;switch&#39;)
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-book/Part_VIII"></span><div class="section" id="viii">
<h2>VIII. Дополнительная информация<a class="headerlink" href="#viii" title="Ссылка на этот заголовок">¶</a></h2>
<p>В этом разделе собрана информация, которая не вошла в основные разделы
книги, но которая, тем не менее, может быть полезна.</p>
<div class="toctree-wrapper compound">
<span id="document-book/additional_info/argparse"></span><div class="section" id="argparse">
<h3>Модуль argparse<a class="headerlink" href="#argparse" title="Ссылка на этот заголовок">¶</a></h3>
<p>argparse - это модуль для обработки аргументов командной строки.
Примеры того, что позволяет делать модуль:</p>
<ul class="simple">
<li>создавать аргументы и опции, с которыми может вызываться скрипт</li>
<li>указывать типы аргументов, значения по умолчанию</li>
<li>указывать, какие действия соответствуют аргументам</li>
<li>выполнять вызов функции при указании аргумента</li>
<li>отображать сообщения с подсказками по использованию скрипта</li>
</ul>
<p>argparse не единственный модуль для обработки аргументов командной
строки.
И даже не единственный такой модуль в стандартной библиотеке.</p>
<p>В книге рассматривается только argparse, но кроме него стоит обратить внимание на
те модули, которые не входят в стандартную библиотеку Python.
Например, <a class="reference external" href="https://click.palletsprojects.com/">click</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last"><a class="reference external" href="https://realpython.com/blog/python/comparing-python-command-line-parsing-libraries-argparse-docopt-click/">Хорошая
статья</a>,
которая сравнивает разные модули обработки аргументов командной
строки (рассматриваются argparse, click и docopt).</p>
</div>
<p>Пример скрипта ping_function.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">argparse</span>


<span class="k">def</span> <span class="nf">ping_ip</span><span class="p">(</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ping IP address and return tuple:</span>
<span class="sd">    On success: (return code = 0, command output)</span>
<span class="sd">    On failure: (return code, error output (stderr))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;ping -c </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> -n </span><span class="si">{</span><span class="n">ip_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">reply</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">reply</span><span class="o">.</span><span class="n">stdout</span> <span class="o">+</span> <span class="n">reply</span><span class="o">.</span><span class="n">stderr</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Ping script&quot;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-a&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;ip&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="n">rc</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ping_ip</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>Создание парсера:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">parser</span> <span class="pre">=</span> <span class="pre">argparse.ArgumentParser(description='Ping</span> <span class="pre">script')</span></code></li>
</ul>
<p>Добавление аргументов:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">parser.add_argument('-a',</span> <span class="pre">dest=&quot;ip&quot;)</span></code><ul>
<li>аргумент, который передается после опции <code class="docutils literal notranslate"><span class="pre">-a</span></code>, сохранится в
переменную <code class="docutils literal notranslate"><span class="pre">ip</span></code></li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">parser.add_argument('-c',</span> <span class="pre">dest=&quot;count&quot;,</span> <span class="pre">default=2,</span> <span class="pre">type=int)</span></code><ul>
<li>аргумент, который передается после опции <code class="docutils literal notranslate"><span class="pre">-c</span></code>, будет сохранен в
переменную <code class="docutils literal notranslate"><span class="pre">count</span></code>, но прежде будет конвертирован в число. Если
аргумент не был указан, по умолчанию будет значение 2</li>
</ul>
</li>
</ul>
<p>Строка <code class="docutils literal notranslate"><span class="pre">args</span> <span class="pre">=</span> <span class="pre">parser.parse_args()</span></code> указывается после того, как
определены все аргументы.
После её выполнения в переменной <code class="docutils literal notranslate"><span class="pre">args</span></code> содержатся все аргументы,
которые были переданы скрипту.
К ним можно обращаться, используя синтаксис <code class="docutils literal notranslate"><span class="pre">args.ip</span></code>.</p>
<p>Попробуем вызвать скрипт с разными аргументами.
Если переданы оба аргумента:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python ping_function.py -a 8.8.8.8 -c 5
Namespace(count=5, ip=&#39;8.8.8.8&#39;)
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: icmp_seq=0 ttl=48 time=48.673 ms
64 bytes from 8.8.8.8: icmp_seq=1 ttl=48 time=49.902 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=48 time=48.696 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=48 time=50.040 ms
64 bytes from 8.8.8.8: icmp_seq=4 ttl=48 time=48.831 ms

--- 8.8.8.8 ping statistics ---
5 packets transmitted, 5 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 48.673/49.228/50.040/0.610 ms

Namespace - это объект, который возвращает метод parse\_args()
</pre></div>
</div>
<p>Передаем только IP-адрес:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python ping_function.py -a 8.8.8.8
Namespace(count=2, ip=&#39;8.8.8.8&#39;)
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: icmp_seq=0 ttl=48 time=48.563 ms
64 bytes from 8.8.8.8: icmp_seq=1 ttl=48 time=49.616 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 48.563/49.090/49.616/0.526 ms
</pre></div>
</div>
<p>Вызов скрипта без аргументов:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python ping_function.py
Namespace(count=2, ip=None)
Traceback (most recent call last):
  File &quot;ping_function.py&quot;, line 31, in &lt;module&gt;
    rc, message = ping_ip( args.ip, args.count )
  File &quot;ping_function.py&quot;, line 16, in ping_ip
    stderr=temp)
  File &quot;/usr/local/lib/python3.6/subprocess.py&quot;, line 336, in check_output
    **kwargs).stdout
  File &quot;/usr/local/lib/python3.6/subprocess.py&quot;, line 403, in run
    with Popen(*popenargs, **kwargs) as process:
  File &quot;/usr/local/lib/python3.6/subprocess.py&quot;, line 707, in __init__
    restore_signals, start_new_session)
  File &quot;/usr/local/lib/python3.6/subprocess.py&quot;, line 1260, in _execute_child
    restore_signals, start_new_session, preexec_fn)
TypeError: expected str, bytes or os.PathLike object, not NoneType
</pre></div>
</div>
<p>Если бы функция была вызвана без аргументов, когда не используется
argparse, возникла бы ошибка, что не все аргументы указаны.</p>
<p>Из-за argparse, фактически аргумент передается, только он равен
<code class="docutils literal notranslate"><span class="pre">None</span></code>.
Это видно в строке <code class="docutils literal notranslate"><span class="pre">Namespace(count=2,</span> <span class="pre">ip=None)</span></code>.</p>
<p>В таком скрипте IP-адрес необходимо указывать всегда.
И в argparse можно указать, что аргумент является обязательным.
Для этого надо изменить опцию <code class="docutils literal notranslate"><span class="pre">-a</span></code>: добавить в конце <code class="docutils literal notranslate"><span class="pre">required=True</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;ip&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь, если вызвать скрипт без аргументов, вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python ping_function.py
usage: ping_function.py [-h] -a IP [-c COUNT]
ping_function.py: error: the following arguments are required: -a
</pre></div>
</div>
<p>Теперь отображается понятное сообщение, что надо указать обязательный
аргумент, и подсказка usage.</p>
<p>Также, благодаря argparse, доступен help:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python ping_function.py -h
usage: ping_function.py [-h] -a IP [-c COUNT]

Ping script

optional arguments:
  -h, --help  show this help message and exit
  -a IP
  -c COUNT
</pre></div>
</div>
<p>Обратите внимание, что в сообщении все опции находятся в секции
<code class="docutils literal notranslate"><span class="pre">optional</span> <span class="pre">arguments</span></code>.
argparse сам определяет, что указаны опции, так как они начинаются с
<code class="docutils literal notranslate"><span class="pre">-</span></code> и в имени только одна буква.</p>
<p>Зададим IP-адрес как позиционный аргумент.
Файл ping_function_ver2.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="k">def</span> <span class="nf">ping_ip</span><span class="p">(</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ping IP address and return tuple:</span>
<span class="sd">    On success: (return code = 0, command output)</span>
<span class="sd">    On failure: (return code, error output (stderr))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;ping -c </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> -n </span><span class="si">{</span><span class="n">ip_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">reply</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">reply</span><span class="o">.</span><span class="n">stdout</span> <span class="o">+</span> <span class="n">reply</span><span class="o">.</span><span class="n">stderr</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Ping script&quot;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;IP or name to ping&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of packets&quot;</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="n">rc</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ping_ip</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь вместо указания опции <code class="docutils literal notranslate"><span class="pre">-a</span></code>, можно просто передать IP-адрес.
Он будет автоматически сохранен в переменной <code class="docutils literal notranslate"><span class="pre">host</span></code>.
И автоматически считается обязательным.
То есть, теперь не нужно указывать <code class="docutils literal notranslate"><span class="pre">required=True</span></code> и <code class="docutils literal notranslate"><span class="pre">dest=&quot;ip&quot;</span></code>.</p>
<p>Кроме того, в скрипте указаны сообщения, которые будут выводиться при
вызове help.
Теперь вызов скрипта выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python ping_function_ver2.py 8.8.8.8 -c 2
Namespace(host=&#39;8.8.8.8&#39;, count=2)
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: icmp_seq=0 ttl=48 time=49.203 ms
64 bytes from 8.8.8.8: icmp_seq=1 ttl=48 time=51.764 ms

--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 49.203/50.484/51.764/1.280 ms
</pre></div>
</div>
<p>А сообщение help так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python ping_function_ver2.py -h
usage: ping_function_ver2.py [-h] [-c COUNT] host

Ping script

positional arguments:
  host        IP or name to ping

optional arguments:
  -h, --help  show this help message and exit
  -c COUNT    Number of packets
</pre></div>
</div>
<div class="section" id="id1">
<h4>Вложенные парсеры<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Рассмотрим один из способов организации более сложной иерархии
аргументов.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Этот пример покажет больше возможностей argparse, но они этим не
ограничиваются, поэтому, если вы будете использовать argparse,
обязательно посмотрите <a class="reference external" href="https://docs.python.org/3/library/argparse.html">документацию
модуля</a> или
<a class="reference external" href="https://pymotw.com/3/argparse/">статью на PyMOTW</a>.</p>
</div>
<p>Файл parse_dhcp_snooping.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="c1"># Default values:</span>
<span class="n">DFLT_DB_NAME</span> <span class="o">=</span> <span class="s1">&#39;dhcp_snooping.db&#39;</span>
<span class="n">DFLT_DB_SCHEMA</span> <span class="o">=</span> <span class="s1">&#39;dhcp_snooping_schema.sql&#39;</span>


<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating DB </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with DB schema </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">schema</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">sw_true</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding switch data to database&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading info from file(s) </span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Adding data to db </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">db_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">key</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Geting data from DB: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">db_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request data for host(s) with </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">key</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please give two or zero args</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">show_subparser_help</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Showing </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">db_file</span><span class="si">}</span><span class="s2"> content...&quot;</span><span class="p">)</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;subcommands&#39;</span><span class="p">,</span>
                                   <span class="n">description</span><span class="o">=</span><span class="s1">&#39;valid subcommands&#39;</span><span class="p">,</span>
                                   <span class="n">help</span><span class="o">=</span><span class="s1">&#39;description&#39;</span><span class="p">)</span>


<span class="n">create_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;create_db&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;create new db&#39;</span><span class="p">)</span>
<span class="n">create_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;db-filename&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                           <span class="n">default</span><span class="o">=</span><span class="n">DFLT_DB_NAME</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;db filename&#39;</span><span class="p">)</span>
<span class="n">create_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;schema&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">DFLT_DB_SCHEMA</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;db schema filename&#39;</span><span class="p">)</span>
<span class="n">create_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">create</span><span class="p">)</span>


<span class="n">add_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;add data to db&#39;</span><span class="p">)</span>
<span class="n">add_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;file(s) to add to db&#39;</span><span class="p">)</span>
<span class="n">add_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--db&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;db_file&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">DFLT_DB_NAME</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;db name&#39;</span><span class="p">)</span>
<span class="n">add_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;sw_true&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;add switch data if set, else add normal data&#39;</span><span class="p">)</span>
<span class="n">add_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">add</span><span class="p">)</span>


<span class="n">get_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;get data from db&#39;</span><span class="p">)</span>
<span class="n">get_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--db&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;db_file&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">DFLT_DB_NAME</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;db name&#39;</span><span class="p">)</span>
<span class="n">get_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;key&quot;</span><span class="p">,</span>
                        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mac&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan&#39;</span><span class="p">,</span> <span class="s1">&#39;interface&#39;</span><span class="p">,</span> <span class="s1">&#39;switch&#39;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;host key (parameter) to search&#39;</span><span class="p">)</span>
<span class="n">get_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;value of key&#39;</span><span class="p">)</span>
<span class="n">get_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;show db content&#39;</span><span class="p">)</span>
<span class="n">get_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">get</span><span class="p">)</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_usage</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь создается не только парсер, как в прошлом примере, но и
вложенные парсеры.
Вложенные парсеры будут отображаться как команды.
Фактически, они будут использоваться как обязательные аргументы.</p>
<p>С помощью вложенных парсеров создается иерархия аргументов и опций.
Аргументы, которые добавлены во вложенный парсер, будут доступны как
аргументы этого парсера.
Например, в этой части создан вложенный парсер create_db, и к нему
добавлена опция <code class="docutils literal notranslate"><span class="pre">-n</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;create_db&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;create new db&#39;</span><span class="p">)</span>
<span class="n">create_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">DFLT_DB_NAME</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;db filename&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Синтаксис создания вложенных парсеров и добавления к ним аргументов
одинаков:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">&#39;create_db&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;create new db&#39;</span><span class="p">)</span>
<span class="n">create_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;db-filename&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                           <span class="n">default</span><span class="o">=</span><span class="n">DFLT_DB_NAME</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;db filename&#39;</span><span class="p">)</span>
<span class="n">create_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;schema&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">DFLT_DB_SCHEMA</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;db schema filename&#39;</span><span class="p">)</span>
<span class="n">create_parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">create</span><span class="p">)</span>
</pre></div>
</div>
<p>Метод <code class="docutils literal notranslate"><span class="pre">add_argument</span></code> добавляет аргумент.
Тут синтаксис точно такой же, как и без использования вложенных
парсеров.</p>
<p>В строке <code class="docutils literal notranslate"><span class="pre">create_parser.set_defaults(func=create)</span></code> указывается, что
при вызове парсера create_parser будет вызвана функция create.</p>
<p>Функция create получает как аргумент все аргументы, которые были
переданы.
И внутри функции можно обращаться к нужным:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating DB </span><span class="si">{}</span><span class="s2"> with DB schema </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">schema</span><span class="p">)))</span>
</pre></div>
</div>
<p>Если вызвать help для этого скрипта, вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_dhcp_snooping.py -h
usage: parse_dhcp_snooping.py [-h] {create_db,add,get} ...

optional arguments:
  -h, --help           show this help message and exit

subcommands:
  valid subcommands

  {create_db,add,get}  description
    create_db          create new db
    add                add data to db
    get                get data from db
</pre></div>
</div>
<p>Обратите внимание, что каждый вложенный парсер, который создан в
скрипте, отображается как команда в подсказке usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">parse_dhcp_snooping</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">{</span><span class="n">create_db</span><span class="p">,</span><span class="n">add</span><span class="p">,</span><span class="n">get</span><span class="p">}</span> <span class="o">...</span>
</pre></div>
</div>
<p>У каждого вложенного парсера теперь есть свой help:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_dhcp_snooping.py create_db -h
usage: parse_dhcp_snooping.py create_db [-h] [-n db-filename] [-s SCHEMA]

optional arguments:
  -h, --help      show this help message and exit
  -n db-filename  db filename
  -s SCHEMA       db schema filename
</pre></div>
</div>
<p>Кроме вложенных парсеров, в этом примере также есть несколько новых
возможностей argparse.</p>
<div class="section" id="metavar">
<h5><code class="docutils literal notranslate"><span class="pre">metavar</span></code><a class="headerlink" href="#metavar" title="Ссылка на этот заголовок">¶</a></h5>
<p>В парсере create_parser используется новый аргумент - <code class="docutils literal notranslate"><span class="pre">metavar</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;db-filename&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                           <span class="n">default</span><span class="o">=</span><span class="n">DFLT_DB_NAME</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;db filename&#39;</span><span class="p">)</span>
<span class="n">create_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;schema&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">DFLT_DB_SCHEMA</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;db schema filename&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Аргумент <code class="docutils literal notranslate"><span class="pre">metavar</span></code> позволяет указывать имя аргумента для вывода в
сообщении usage и help:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_dhcp_snooping.py create_db -h
usage: parse_dhcp_snooping.py create_db [-h] [-n db-filename] [-s SCHEMA]

optional arguments:
  -h, --help      show this help message and exit
  -n db-filename  db filename
  -s SCHEMA       db schema filename
</pre></div>
</div>
<p>Посмотрите на разницу между опциями <code class="docutils literal notranslate"><span class="pre">-n</span></code> и <code class="docutils literal notranslate"><span class="pre">-s</span></code>:</p>
<ul class="simple">
<li>после опции <code class="docutils literal notranslate"><span class="pre">-n</span></code> и в usage, и в help указывается имя, которое
указано в параметре metavar</li>
<li>после опции <code class="docutils literal notranslate"><span class="pre">-s</span></code> указывается имя переменной, в которую сохраняется
значение</li>
</ul>
</div>
<div class="section" id="nargs">
<h5><code class="docutils literal notranslate"><span class="pre">nargs</span></code><a class="headerlink" href="#nargs" title="Ссылка на этот заголовок">¶</a></h5>
<p>В парсере add_parser используется <code class="docutils literal notranslate"><span class="pre">nargs</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">add_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;file(s) to add to db&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Параметр <code class="docutils literal notranslate"><span class="pre">nargs</span></code> позволяет указать, что в этот аргумент должно попасть
определенное количество элементов.
В этом случае все аргументы, которые были переданы скрипту после имени
аргумента <code class="docutils literal notranslate"><span class="pre">filename</span></code>, попадут в список nargs, но должен быть передан хотя бы один аргумент.</p>
<p>Сообщение help в таком случае выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_dhcp_snooping.py add -h
usage: parse_dhcp_snooping.py add [-h] [--db DB_FILE] [-s]
                                  filename [filename ...]

positional arguments:
  filename      file(s) to add to db

optional arguments:
  -h, --help    show this help message and exit
  --db DB_FILE  db name
  -s            add switch data if set, else add normal data
</pre></div>
</div>
<p>Если передать несколько файлов, они попадут в список.
А так как функция add просто выводит имена файлов, вывод получится
таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_dhcp_snooping.py add filename test1.txt test2.txt
Reading info from file(s)
filename, test1.txt, test2.txt

Adding data to db dhcp_snooping.db
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">nargs</span></code> поддерживает такие значения:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">N</span></code> - должно быть указанное количество аргументов. Аргументы будут
в списке (даже если указан 1)</li>
<li><code class="docutils literal notranslate"><span class="pre">?</span></code> - 0 или 1 аргумент</li>
<li><code class="docutils literal notranslate"><span class="pre">*</span></code> - все аргументы попадут в список</li>
<li><code class="docutils literal notranslate"><span class="pre">+</span></code> - все аргументы попадут в список, но должен быть передан хотя
бы один аргумент</li>
</ul>
</div>
<div class="section" id="choices">
<h5><code class="docutils literal notranslate"><span class="pre">choices</span></code><a class="headerlink" href="#choices" title="Ссылка на этот заголовок">¶</a></h5>
<p>В парсере get_parser используется <code class="docutils literal notranslate"><span class="pre">choices</span></code>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">get_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;key&quot;</span><span class="p">,</span>
                        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mac&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">,</span> <span class="s1">&#39;vlan&#39;</span><span class="p">,</span> <span class="s1">&#39;interface&#39;</span><span class="p">,</span> <span class="s1">&#39;switch&#39;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;host key (parameter) to search&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Для некоторых аргументов важно, чтобы значение было выбрано только из
определенных вариантов.
В таких случаях можно указывать <code class="docutils literal notranslate"><span class="pre">choices</span></code>.</p>
<p>Для этого парсера help выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_dhcp_snooping.py get -h
usage: parse_dhcp_snooping.py get [-h] [--db DB_FILE]
                                  [-k {mac,ip,vlan,interface,switch}]
                                  [-v VALUE] [-a]

optional arguments:
  -h, --help            show this help message and exit
  --db DB_FILE          db name
  -k {mac,ip,vlan,interface,switch}
                        host key (parameter) to search
  -v VALUE              value of key
  -a                    show db content
</pre></div>
</div>
<p>А если выбрать неправильный вариант:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python parse_dhcp_snooping.py get -k test
usage: parse_dhcp_snooping.py get [-h] [--db DB_FILE]
                                  [-k {mac,ip,vlan,interface,switch}]
                                  [-v VALUE] [-a]
parse_dhcp_snooping.py get: error: argument -k: invalid choice: &#39;test&#39; (choose from &#39;mac&#39;, &#39;ip&#39;, &#39;vlan&#39;, &#39;interface&#39;, &#39;switch&#39;)

В данном примере важно указать варианты на выбор, так как затем на
основании выбранного варианта генерируется SQL-запрос. И, благодаря
``choices``, нет возможности указать какой-то параметр, кроме
разрешенных.
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Импорт парсера<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>В файле parse_dhcp_snooping.py последние две строки будут выполняться
только в том случае, если скрипт был вызван как основной.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>А значит, если импортировать файл, эти строки не будут вызваны.</p>
<p>Попробуем импортировать парсер в другой файл (файл call_pds.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">parse_dhcp_snooping</span> <span class="kn">import</span> <span class="n">parser</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>Вызов сообщения help:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python call_pds.py -h
usage: call_pds.py [-h] {create_db,add,get} ...

optional arguments:
  -h, --help           show this help message and exit

subcommands:
  valid subcommands

  {create_db,add,get}  description
    create_db          create new db
    add                add data to db
    get                get data from db
</pre></div>
</div>
<p>Вызов аргумента:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python call_pds.py add test.txt test2.txt
Reading info from file(s)
test.txt, test2.txt

Adding data to db dhcp_snooping.db
</pre></div>
</div>
<p>Всё работает без проблем.</p>
</div>
<div class="section" id="id3">
<h5>Передача аргументов вручную<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Последняя особенность argparse - возможность передавать аргументы
вручную.</p>
<p>Аргументы можно передать как список при вызове метода <code class="docutils literal notranslate"><span class="pre">parse_args()</span></code>
(файл call_pds2.py):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span>from parse_dhcp_snooping import parser, get

args = parser.parse_args(&#39;add test.txt test2.txt&#39;.split())
args.func(args)

Необходимо использовать метод ``split()``, так как метод ``parse_args()``
ожидает список аргументов.
</pre></div>
</div>
<p>Результат будет таким же, как если бы скрипт был вызван с аргументами:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python call_pds2.py
Reading info from file(s)
test.txt, test2.txt

Adding data to db dhcp_snooping.db
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-book/additional_info/old_str_formatting"></span><div class="section" id="id1">
<h3>Форматирование строк с оператором <code class="docutils literal notranslate"><span class="pre">%</span></code><a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h3>
<p>Пример использования оператора %:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s2">&quot;interface FastEthernet0/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s1">&#39;1&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;interface FastEthernet0/1&#39;</span>
</pre></div>
</div>
<p>В старом синтаксисе форматирования строк используются такие обозначения:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">%s</span></code> - строка или любой другой объект в котором есть строковое представление</li>
<li><code class="docutils literal notranslate"><span class="pre">%d</span></code> - integer</li>
<li><code class="docutils literal notranslate"><span class="pre">%f</span></code> - float</li>
</ul>
<p>Вывести данные столбцами одинаковой ширины по 15 символов с
выравниванием по правой стороне:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">intf</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;aabb.cc80.7000&#39;</span><span class="p">,</span> <span class="s1">&#39;Gi0/1&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%15s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2"> </span><span class="si">%15s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">intf</span><span class="p">))</span>
            <span class="mi">100</span>  <span class="n">aabb</span><span class="o">.</span><span class="n">cc80</span><span class="o">.</span><span class="mi">7000</span>           <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
<p>Выравнивание по левой стороне:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%-15s</span><span class="s2"> </span><span class="si">%-15s</span><span class="s2"> </span><span class="si">%-15s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vlan</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">intf</span><span class="p">))</span>
<span class="mi">100</span>             <span class="n">aabb</span><span class="o">.</span><span class="n">cc80</span><span class="o">.</span><span class="mi">7000</span>  <span class="n">Gi0</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
<p>С помощью форматирования строк можно также влиять на отображение чисел.</p>
<p>Например, можно указать, сколько цифр после запятой выводить:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">10.0</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
<span class="mf">3.333</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">У форматирования строк есть ещё много возможностей. Хорошие примеры
и объяснения двух вариантов форматирования строк можно найти
<a class="reference external" href="https://pyformat.info/">тут</a>.</p>
</div>
</div>
<span id="document-book/additional_info/naming_conventions/README"></span><div class="section" id="id1">
<h3>Соглашение об именах<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h3>
<p>В Python есть определенные соглашения об именовании объектов.</p>
<p>В целом, лучше придерживаться этих соглашений. Однако, если в
определенной библиотеке или модуле используются другие соглашения, то
стоит придерживаться того стиля, который используется в них.</p>
<blockquote>
<div>В этом разделе описаны не все правила. Подробнее можно почитать в
документе PEP8 на
<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">английском</a> или на
<a class="reference external" href="http://pep8.ru/doc/pep8/">русском</a>.</div></blockquote>
<div class="section" id="id2">
<h4>Имена переменных<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Имена переменных не должны пересекаться с операторами и названиями
модулей или других зарезервированных значений.</p>
<p>Имена переменных обычно пишутся полностью большими или маленькими
буквами. В пределах одного скрипта/модуля/пакета лучше придерживаться
одного из вариантов.</p>
<p>Если переменные - константы для модуля, то лучше использовать имена,
написанные заглавными буквами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DB_NAME</span> <span class="o">=</span> <span class="s1">&#39;dhcp_snooping.db&#39;</span>
<span class="n">TESTING</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Для обычных переменных лучше использовать имена в нижнем регистре:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db_name</span> <span class="o">=</span> <span class="s1">&#39;dhcp_snooping.db&#39;</span>
<span class="n">testing</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>Имена модулей и пакетов<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Имена модулей и пакетов задаются маленькими буквами.</p>
<p>Модули могут использовать подчеркивания между словами для того, чтобы
имена были более понятными. Для пакетов лучше выбирать короткие имена.</p>
</div>
<div class="section" id="id4">
<h4>Имена функций<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Имена функций задаются маленькими буквами, с подчеркиваниями между
словами.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ignore_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">ignore</span><span class="p">):</span>

    <span class="n">ignore_command</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">ignore_command</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>Имена классов<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<p>Имена классов задаются словами с заглавными буквами, без пробелов.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CiscoSwitch</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">vendor</span><span class="o">=</span><span class="s1">&#39;cisco&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;3750&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vendor</span> <span class="o">=</span> <span class="n">vendor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<span id="document-book/additional_info/naming_conventions/underscore_names"></span><div class="section" id="id1">
<h3>Подчеркивание в именах<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h3>
<p>В Python подчеркивание в начале или в конце имени указывает на
специальные имена. Чаще всего это всего лишь договоренность, но иногда
это действительно влияет на поведение объекта.</p>
<div class="section" id="id2">
<h4>Подчеркивание как имя<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python одно подчеркивание используется для обозначения того, что
данные просто выбрасываются.</p>
<p>Например, если из строки line надо получить MAC-адрес, IP-адрес, VLAN и
интерфейс и отбросить остальные поля, можно использовать такой вариант:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;00:09:BB:3D:D6:58  10.1.10.2 86250   dhcp-snooping   10  FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">mac</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">intf</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">mac</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">intf</span><span class="p">)</span>
<span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="n">BB</span><span class="p">:</span><span class="mi">3</span><span class="n">D</span><span class="p">:</span><span class="n">D6</span><span class="p">:</span><span class="mi">58</span> <span class="mf">10.1</span><span class="o">.</span><span class="mf">10.2</span> <span class="mi">10</span> <span class="n">FastEthernet0</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
<p>Такая запись говорит о том, что нам не нужны третий и четвертый
элементы.</p>
<p>Можно сделать так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">mac</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">lease</span><span class="p">,</span> <span class="n">entry_type</span><span class="p">,</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">intf</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
<p>Но тогда может быть непонятно, почему переменные lease и entry_type не
используются дальше. Если понятней использовать имена, то лучше назвать
переменные именами вроде ignored.</p>
<p>Аналогичный прием может использоваться, когда переменная цикла не нужна:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="id3">
<h5>Подчеркивание в интерпретаторе<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>В интерпретаторе python и ipython подчеркивание используется для
получения результата последнего выражения</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">_</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="n">_</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">a</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Одно подчеркивание<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
</div>
<div class="section" id="id5">
<h5>Одно подчеркивание перед именем<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Одно подчеркивание перед именем указывает, что имя используется как
внутреннее.</p>
<p>Например, если одно подчеркивание указано в имени функции или метода,
это означает, что этот объект является внутренней особенностью
реализации и не стоит его использовать напрямую.</p>
<p>Но, кроме того, при импорте вида <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code> не будут
импортироваться объекты, которые начинаются с подчеркивания.</p>
<p>Например, в файле example.py такие переменные и функции:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db_name</span> <span class="o">=</span> <span class="s1">&#39;dhcp_snooping.db&#39;</span>
<span class="n">_path</span> <span class="o">=</span> <span class="s1">&#39;/home/nata/pyneng/&#39;</span>


<span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">arg</span>


<span class="k">def</span> <span class="nf">_func2</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">arg</span>
</pre></div>
</div>
<p>Если импортировать все объекты из модуля, то те, которые начинаются с
подчеркивания, не будут импортированы:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">example</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">db_name</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;dhcp_snooping.db&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">_path</span>
<span class="o">...</span>
<span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;_path&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">func1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">_func2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="o">...</span>
<span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;_func2&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>Одно подчеркивание после имени<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Одно подчеркивание после имени используется в том случае, когда имя
объекта или параметра пересекается со встроенными именами.</p>
<p>Пример:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;00:09:BB:3D:D6:58  10.1.10.2 86250   dhcp-snooping   10  FastEthernet0/1&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">mac</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">lease</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">vlan</span><span class="p">,</span> <span class="n">intf</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h4>Два подчеркивания<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h4>
</div>
<div class="section" id="id8">
<h4>Два подчеркивания перед именем<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h4>
<p>Два подчеркивания перед именем метода используются не просто как
договоренность. Такие имена трансформируются в формат «имя класса + имя
метода». Это позволяет создавать уникальные методы и атрибуты классов.</p>
<blockquote>
<div>Такое преобразование выполняется только в том случае, если в конце
менее двух подчеркиваний или нет подчеркиваний.</div></blockquote>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Switch</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">__quantity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">__configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">pass</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">(</span><span class="n">Switch</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;_Switch__configure&#39;</span><span class="p">,</span> <span class="s1">&#39;_Switch__quantity&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>Хотя методы создавались без приставки <code class="docutils literal notranslate"><span class="pre">_Switch</span></code>, она была добавлена.</p>
<p>Если создать подкласс, то метод <code class="docutils literal notranslate"><span class="pre">__configure</span></code> не перепишет метод
родительского класса Switch:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">CiscoSwitch</span><span class="p">(</span><span class="n">Switch</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">__quantity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">__configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">pass</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="nb">dir</span><span class="p">(</span><span class="n">CiscoSwitch</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;_CiscoSwitch__configure&#39;</span><span class="p">,</span> <span class="s1">&#39;_CiscoSwitch__quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;_Switch__configure&#39;</span><span class="p">,</span> <span class="s1">&#39;_Switch__quantity&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4>Два подчеркивания перед и после имени<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h4>
<p>Таким образом обозначаются специальные переменные и методы.</p>
<p>Например, в модуле Python есть такие специальные переменные:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">__name__</span></code> - эта переменная равна строке <code class="docutils literal notranslate"><span class="pre">__main__</span></code>, когда скрипт запускается напрямую, и равна имени модуля, когда импортируется</li>
<li><code class="docutils literal notranslate"><span class="pre">__file__</span></code> - эта переменная равна имени скрипта, который был запущен напрямую, и равна полному пути к модулю, когда он импортируется</li>
</ul>
<p>Переменная <code class="docutils literal notranslate"><span class="pre">__name__</span></code> чаще всего используется, чтобы указать, что
определенная часть кода должна выполняться, только когда модуль
выполняется напрямую:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>А переменная <code class="docutils literal notranslate"><span class="pre">__file__</span></code> может быть полезна в определении текущего пути
к файлу скрипта:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;__file__&#39;</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</pre></div>
</div>
<p>Вывод будет таким:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="vm">__file__</span> <span class="n">example2</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">example2</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Кроме того, таким образом в Python обозначаются специальные методы. Эти
методы вызываются при использовании функций и операторов Python и
позволяют реализовать определенный функционал.</p>
<p>Как правило, такие методы не нужно вызывать напрямую. Но, например, при
создании своего класса может понадобиться описать такой метод, чтобы
объект поддерживал какие-то операции в Python.</p>
<p>Например, для того, чтобы можно было получить длину объекта, он должен
поддерживать метод <code class="docutils literal notranslate"><span class="pre">__len__</span></code>.</p>
<p>Ещё один специальный метод <code class="docutils literal notranslate"><span class="pre">__str__</span></code> вызывается, когда используется
оператор print или вызывается функция str(). Если необходимо, чтобы при
этом отображение было в определенном виде, надо создать этот метод в
классе:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Switch</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">__configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">pass</span>
    <span class="o">...</span><span class="p">:</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="s1">&#39;Switch </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">sw1</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">sw1</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;sw1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">print</span> <span class="n">sw1</span>
<span class="n">Switch</span> <span class="n">sw1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="nb">str</span><span class="p">(</span><span class="n">sw1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="s1">&#39;Switch sw1&#39;</span>
</pre></div>
</div>
<p>Таких специальных методов в Python очень много. Несколько полезных
ссылок, где можно почитать про конкретный метод:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3.6/reference/datamodel.html#specialnames">документация</a></li>
<li><a class="reference external" href="http://www.diveintopython3.net/special-method-names.html">Dive Into Python 3</a></li>
</ul>
</div>
</div>
<span id="document-book/additional_info/py2_vs_py3"></span><div class="section" id="python-2-7-python-3-6">
<h3>Отличия Python 2.7 и Python 3.6<a class="headerlink" href="#python-2-7-python-3-6" title="Ссылка на этот заголовок">¶</a></h3>
<div class="section" id="unicode">
<h4><a class="reference external" href="../16_unicode/">Unicode</a><a class="headerlink" href="#unicode" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python 2.7 было два типа строк: str и unicode:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">line2</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;тест&#39;</span>
</pre></div>
</div>
<p>В Python 3 строка - это тип str, но, кроме этого, в Python 3 появился
тип bytes:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;тест&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xd1\x82\xd0\xb5\xd1\x81\xd1\x82</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">byte_str</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;test&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="print">
<h4><a class="reference external" href="../10_useful_functions/print.html">Функция print</a><a class="headerlink" href="#print" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python 2.7 print был оператором:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nb">print</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span>
<span class="mi">1</span> <span class="n">test</span>
</pre></div>
</div>
<p>В Python 3 <a class="reference external" href="../10_useful_functions/print.md">print - функция</a>:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="mi">1</span> <span class="n">test</span>
</pre></div>
</div>
<p>В Python 2.7 можно брать аргументы в скобки, но от этого print не
становится функцией и, кроме того, print возвращает другой результат
(кортеж):</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>В Python 3, использование синтаксиса Python 2.7 приведет к ошибке:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">print</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;ipython-input-2-328abb6b105d&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
    <span class="nb">print</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span>
          <span class="o">^</span>
<span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">Missing</span> <span class="n">parentheses</span> <span class="ow">in</span> <span class="n">call</span> <span class="n">to</span> <span class="s1">&#39;print&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="input-raw-input">
<h4><a class="reference external" href="../05_basic_scripts/2_user_input.html">input вместо raw_input</a><a class="headerlink" href="#input-raw-input" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python 2.7 для получения информации от пользователя в виде строки
использовалась функция raw_input:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">number</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s1">&#39;Number: &#39;</span><span class="p">)</span>
<span class="n">Number</span><span class="p">:</span> <span class="mi">55</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">number</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;55&#39;</span>
</pre></div>
</div>
<p>В Python 3 используется input:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">number</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Number: &#39;</span><span class="p">)</span>
<span class="n">Number</span><span class="p">:</span> <span class="mi">55</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">number</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="s1">&#39;55&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="range-xrange">
<h4><a class="reference external" href="../10_useful_functions/range.html">range вместо xrange</a><a class="headerlink" href="#range-xrange" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python 2.7 были две функции</p>
<ul class="simple">
<li>range - возвращает список</li>
<li>xrange - возвращает итератор</li>
</ul>
<p>Пример range и xrange в Python 2.7:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>В Python 3 есть только функция range, и она возвращает итератор:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h4><a class="reference external" href="../04_data_structures/6a_dict_methods.html">Методы словарей</a><a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Несколько изменений произошло в методах словарей.</p>
<div class="section" id="dict-keys-values-items">
<h5>dict.keys(), values(), items()<a class="headerlink" href="#dict-keys-values-items" title="Ссылка на этот заголовок">¶</a></h5>
<p>Методы keys(), values(), items() в Python 3 возвращают «views» вместо
списков. Особенность view заключается в том, что они меняются вместе с
изменением словаря. И фактически они лишь дают способ посмотреть на
соответствующие объекты, но не создают их копию.</p>
<p>В Python 3 нет методов:</p>
<ul class="simple">
<li>viewitems, viewkeys, viewvalues</li>
<li>iteritems, iterkeys, itervalues</li>
</ul>
<p>Для сравнения, методы словаря в Python 2.7:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">300</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">d</span><span class="o">.</span>
    <span class="n">d</span><span class="o">.</span><span class="n">clear</span>      <span class="n">d</span><span class="o">.</span><span class="n">get</span>        <span class="n">d</span><span class="o">.</span><span class="n">iteritems</span>  <span class="n">d</span><span class="o">.</span><span class="n">keys</span>       <span class="n">d</span><span class="o">.</span><span class="n">setdefault</span> <span class="n">d</span><span class="o">.</span><span class="n">viewitems</span>
    <span class="n">d</span><span class="o">.</span><span class="n">copy</span>       <span class="n">d</span><span class="o">.</span><span class="n">has_key</span>    <span class="n">d</span><span class="o">.</span><span class="n">iterkeys</span>   <span class="n">d</span><span class="o">.</span><span class="n">pop</span>        <span class="n">d</span><span class="o">.</span><span class="n">update</span>     <span class="n">d</span><span class="o">.</span><span class="n">viewkeys</span>
    <span class="n">d</span><span class="o">.</span><span class="n">fromkeys</span>   <span class="n">d</span><span class="o">.</span><span class="n">items</span>      <span class="n">d</span><span class="o">.</span><span class="n">itervalues</span> <span class="n">d</span><span class="o">.</span><span class="n">popitem</span>    <span class="n">d</span><span class="o">.</span><span class="n">values</span>     <span class="n">d</span><span class="o">.</span><span class="n">viewvalues</span>
</pre></div>
</div>
<p>И в Python 3:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">300</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">d</span><span class="o">.</span>
           <span class="n">clear</span><span class="p">()</span>      <span class="n">get</span><span class="p">()</span>        <span class="n">pop</span><span class="p">()</span>        <span class="n">update</span><span class="p">()</span>
           <span class="n">copy</span><span class="p">()</span>       <span class="n">items</span><span class="p">()</span>      <span class="n">popitem</span><span class="p">()</span>    <span class="n">values</span><span class="p">()</span>
           <span class="n">fromkeys</span><span class="p">()</span>   <span class="n">keys</span><span class="p">()</span>       <span class="n">setdefault</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h4><a class="reference external" href="../08_python_basic_examples/variable_unpacking.html">Распаковка переменных</a><a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python 3 появилась возможность использовать <code class="docutils literal notranslate"><span class="pre">*</span></code> при распаковке
переменных:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">a</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">b</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">c</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="mi">5</span>
</pre></div>
</div>
<p>В Python 2.7 этот синтаксис не поддерживается:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;ipython-input-10-e3f57143ffb4&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
    <span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
       <span class="o">^</span>
<span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">syntax</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4><a class="reference external" href="../10_useful_functions/">Итератор вместо списка</a><a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python 2.7 map, filter и zip возвращали список:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">300</span><span class="p">)]</span>
</pre></div>
</div>
<p>В Python 3 они возвращают итератор:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="o">&lt;</span><span class="nb">map</span> <span class="n">at</span> <span class="mh">0xb4ee3fec</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="o">&lt;</span><span class="nb">filter</span> <span class="n">at</span> <span class="mh">0xb448c68c</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="o">&lt;</span><span class="nb">zip</span> <span class="n">at</span> <span class="mh">0xb4efc1ec</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="subprocess-run">
<h4><a class="reference external" href="../12_useful_modules/subprocess.html">subprocess.run</a><a class="headerlink" href="#subprocess-run" title="Ссылка на этот заголовок">¶</a></h4>
<p>В версии Python 3.5 в модуле subprocess появилась новая функция - run.
Она предоставляет более удобный интерфейс для работы с модулем и
получения вывода команд.</p>
<p>Соответственно, вместо функций call и check_output используется функция
run, но функции call и check_output остались.</p>
</div>
<div class="section" id="jinja2">
<h4>Jinja2<a class="headerlink" href="#jinja2" title="Ссылка на этот заголовок">¶</a></h4>
<p>В модуле Jinja2 больше не нужно использовать такой код, так как
кодировка по умолчанию и так utf-8:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>В самих шаблонах, как и в Python, изменились методы словарей. Тут,
аналогично, вместо iteritems надо использовать items.</p>
</div>
<div class="section" id="pexpect-telnetlib-paramiko">
<h4>Модули pexpect, telnetlib, paramiko<a class="headerlink" href="#pexpect-telnetlib-paramiko" title="Ссылка на этот заголовок">¶</a></h4>
<p>Модули pexpect, telnetlib, paramiko отправляют и получают байты, поэтому
надо делать encode/decode соответственно.</p>
<p>В netmiko эта конвертация выполняется автоматически.</p>
</div>
<div class="section" id="id4">
<h4>Мелочи<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<ul class="simple">
<li>Название модуля Queue сменилось на queue</li>
<li>С версии Python 3.6 объект csv.DictReader возвращает OrderedDict
вместо обычного словаря.</li>
</ul>
</div>
<div class="section" id="id5">
<h4>Дополнительная информация<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<p>Ниже приведены ссылки на ресурсы с информацией об изменениях в Python 3.</p>
<p>Документация:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3.0/whatsnew/3.0.html">What’s New In Python
3.0</a></li>
<li><a class="reference external" href="https://wiki.python.org/moin/Python2orPython3">Should I use Python 2 or Python 3 for my development
activity?</a></li>
</ul>
<p>Статьи:</p>
<ul class="simple">
<li><a class="reference external" href="http://sebastianraschka.com/Articles/2014_python_2_3_key_diff.html">The key differences between Python 2.7.x and Python 3.x with
examples</a></li>
<li><a class="reference external" href="http://python3porting.com/">Supporting Python 3: An in-depth
guide</a></li>
</ul>
</div>
</div>
<span id="document-book/additional_info/pyneng"></span><div class="section" id="pyneng">
<span id="additional-info-pyneng"></span><h3>Проверка заданий с помощью утилиты pyneng<a class="headerlink" href="#pyneng" title="Ссылка на этот заголовок">¶</a></h3>
<p>Начиная с раздела «4. Типы данных в Python» для проверки заданий
используются автоматические тесты. Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.</p>
<p>Помимо перечисленных выше положительных моментов, в тестах также можно
посмотреть какой итоговый результат нужен: прояснить структуру данных и
мелочи, которые могут влиять на результат.</p>
<p>Для запуска тестов используется <code class="docutils literal notranslate"><span class="pre">pyneng.py</span></code> - скрипт, который находится в
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises">репозитории заданий</a>.</p>
<div class="section" id="id1">
<h4>Где решать задания<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Задания надо выполнять в подготовленных файлах.
Например, в разделе 04_data_structures есть задание 4.3. Чтобы выполнить его надо открыть
файл exercises/04_data_structures/task_4_3.py и выполнять задание прямо в этом файле после описания задания.</p>
<p>Это важно потому что тесты привязаны к тому, что задания выполняются в определенных файлах и в определенной
структуре каталогов.
Кроме того, что задания надо делать в подготовленных файлах, обязательно скопировать себе весь
каталог exercises (а еще лучше весь репозиторий pyneng-examples-exercises), так как тесты
зависят от файлов в каталоге exercises, не только от файлов в каталоге конкретных заданий.</p>
</div>
<div class="section" id="id2">
<h4>Установка скрипта pyneng<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для начала, его надо установить, чтобы не надо было каждый раз писать <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">pyneng.py</span></code>.</p>
<p>Для установки скрипта, в репозитории должны находиться файлы
<a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/blob/master/pyneng.py">pyneng.py</a>
и <a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises/blob/master/setup.py">setup.py</a>.
Если репозиторий создавался после 28 января 2021 из шаблона pyneng-examples-exercises, эти файлы находится
в корне репозитория. Иначе, их надо скопировать в свой репозиторий самостоятельно.</p>
<p>Надо перейти в свой репозиторий, например (пишите имя своего репозитория):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">my_repo</span><span class="o">/</span>
</pre></div>
</div>
<p>Затем внутри репозитория дать команду</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</pre></div>
</div>
<p>Это установит модуль и даст возможность вызывать его в любом каталоге по слову pyneng.</p>
</div>
<div class="section" id="id3">
<h4>Скрипт pyneng<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Этапы работы с заданиями:</p>
<ol class="arabic simple">
<li>Выполнение заданий</li>
<li>Проверка, что задание отрабатывает как нужно <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">task_4_2.py</span></code> или запуск скрипта в редакторе/IDE</li>
<li>Проверка заданий тестами <code class="docutils literal notranslate"><span class="pre">pyneng</span> <span class="pre">1-5</span></code></li>
<li>Если тесты проходят, смотрим варианты решения <code class="docutils literal notranslate"><span class="pre">pyneng</span> <span class="pre">1-5</span> <span class="pre">-a</span></code></li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Второй шаг очень важен, потому что на этом этапе намного проще найти ошибки в синтаксисе
и подобные проблемы с работой скрипта, чем при запуске кода через тест на 3 этапе.</p>
</div>
<p>Скрипт упрощает запуск тестов, так как не надо указывать никакие параметры,
по умолчанию вывод настроен на подробный и запускается с плагином pytest-clarity,
который улучшает diff при отличиях в решении и правильном решении.
Также скрываются некоторые вещи, например, warning которые показывает pytest,
чтобы не отвлекать от задачи.</p>
<p>Тесты по-прежнему можно <a class="reference internal" href="contents.html#additional-info-pytest"><span class="std std-ref">запускать с помощью pytest</span></a>,
если вы уже к нему привыкли или ранее использовали.
Скрипт pyneng всего лишь обертка вокруг запуска pytest.</p>
<p>Вторая часть работы скрипта - копирование вариантов решения заданий. Эта часть сделана для удобства,
чтобы не надо было искать ответы и задумана так, что сначала задание должно пройти
тест и только после этого <code class="docutils literal notranslate"><span class="pre">pyneng</span> <span class="pre">-a</span></code> отработает и покажет ответы (скопирует их в текущий каталог).
Для копирования ответов, скрипт клонирует репозиторий ответов в домашний каталог пользователя,
копирует нужные ответы и удаляет репозиторий ответов.</p>
</div>
<div class="section" id="id4">
<h4>Проверка заданий тестами<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>После выполнения задания, его надо проверить с помощью тестов.
Для запуска тестов, надо вызвать pyneng в каталоге заданий.
Например, если вы делаете 4 раздел заданий, надо находиться в каталоге exercises/04_data_structures/
и запустить pyneng одним из способов, в зависимости от того какие задания на проверять.</p>
<p>Запуск проверки всех заданий текущего раздела:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyneng</span>
</pre></div>
</div>
<p>Запуск тестов для задания 4.1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyneng</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Запуск тестов для заданий 4.1, 4.2, 4.3:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyneng</span> <span class="mi">1</span><span class="o">-</span><span class="mi">3</span>
</pre></div>
</div>
<p>Если есть задания с буквами, например, в 7 разделе, можно запускать так,
чтобы запустить проверку для заданий 7.2a, 7.2b (надо находиться в каталоге 07_files):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyneng</span> <span class="mi">2</span><span class="n">a</span><span class="o">-</span><span class="n">b</span>
</pre></div>
</div>
<p>или так, чтобы запустить все задания 7.2x с буквами и без:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyneng</span> <span class="mi">2</span><span class="o">*</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>Получение ответов<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если задания проходят тесты, можно посмотреть варианты решения заданий.</p>
<p>Для этого к предыдущим вариантам команды надо добавить <code class="docutils literal notranslate"><span class="pre">-a</span></code>.
Такой вызов значит запустить тесты для заданий 1 и 2 и скопировать ответы, если тесты прошли:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyneng</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
<p>Тогда для указанных заданий запустятся тесты и для тех заданий из них,
которые прошли тесты, скопируются ответы в файлы answer_task_x.py в текущем каталоге.</p>
</div>
<div class="section" id="id6">
<h4>Вывод pyneng<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h4>
<div class="section" id="warning">
<h5>Warning<a class="headerlink" href="#warning" title="Ссылка на этот заголовок">¶</a></h5>
<p>В конце вывода теста часто написано «1 warning». Это можно игнорировать, предупреждения в основном связаны с работой
каких-то модулей и скрыты чтобы не отвлекать от заданий.</p>
</div>
<div class="section" id="id7">
<h5>Тесты прошли успешно<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h5>
<div class="figure">
<img alt="https://raw.githubusercontent.com/pyneng/pyneng.github.io/master/assets/images/ptest_output_5.png" src="https://raw.githubusercontent.com/pyneng/pyneng.github.io/master/assets/images/ptest_output_5.png" />
</div>
</div>
<div class="section" id="id8">
<h5>Тесты не прошли<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h5>
<p>Когда какие-то тесты не прошли, в выводе показываются отличия между тем как должен выглядеть вывод и какой
вывод был получен.</p>
<p>Отличия показываются как Left и Right, к сожалению тут нет такого что зеленым выделен правильный вариант,
а красным неправильный, надо смотреть по ситуации. Каждый раз при выводе отличий, перед ними есть строка вида:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">correct_stdout</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>
</div>
<p>В этом случае Left это правильный вывод, right вывод задания:</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/pyneng/pyneng.github.io/master/assets/images/ptest_output_1.png" src="https://raw.githubusercontent.com/pyneng/pyneng.github.io/master/assets/images/ptest_output_1.png" />
</div>
<p>или так:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">return_value</span> <span class="o">==</span> <span class="n">correct_return_value</span>
</pre></div>
</div>
<p>В этом случае Right это правильный вывод, Left вывод задания:</p>
<div class="figure">
<img alt="https://raw.githubusercontent.com/pyneng/pyneng.github.io/master/assets/images/ptest_output_2.png" src="https://raw.githubusercontent.com/pyneng/pyneng.github.io/master/assets/images/ptest_output_2.png" />
</div>
</div>
</div>
</div>
<span id="document-book/additional_info/pytest"></span><div class="section" id="pytest">
<span id="additional-info-pytest"></span><h3>Проверка заданий с помощью pytest<a class="headerlink" href="#pytest" title="Ссылка на этот заголовок">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Для проверки заданий тестами появилась новая утилита
<a class="reference internal" href="contents.html#additional-info-pyneng"><span class="std std-ref">pyneng</span></a>. Она упрощает работу с тестами.</p>
</div>
<p>Начиная с раздела «4. Типы данных в Python» для проверки заданий
используются автоматические тесты. Они помогают проверить все ли
соответствует поставленной задаче, а также дают обратный отклик по тому,
что не соответствует задаче. Как правило, после первого периода
адаптации к тестам, становится проще делать задания с тестами.</p>
<p>Помимо перечисленных выше положительных моментов, в тестах также можно
посмотреть какой итоговый результат нужен: прояснить структуру данных и
мелочи, которые могут влиять на результат.</p>
<p>Для запуска тестов используется pytest - фреймворк для написания тестов.</p>
<p>Перед запуском тестов надо установить такие модули:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pytest</span><span class="o">-</span><span class="n">clarity</span> <span class="n">pyyaml</span>
</pre></div>
</div>
<p>Для корректной работы тестов, надо скопировать себе не только каталог заданий
одного раздела, а весь каталог exercises из <a class="reference external" href="https://github.com/natenka/pyneng-examples-exercises">репозитория с заданиями</a>.
А лучше создать себе копию репозитория с заданиями, как написано <a class="reference external" href="https://pyneng.readthedocs.io/ru/latest/book/02_git_github/git_github_changes.html">тут</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last"><a class="reference external" href="https://youtu.be/TI6-vFFV9lk">Запись лекции по использованию pytest для проверки
заданий</a></p>
</div>
<div class="toctree-wrapper compound">
<span id="document-book/additional_info/pytest_basics"></span><div class="section" id="pytest">
<h4>Основы pytest<a class="headerlink" href="#pytest" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для начала надо установить pytest и pyyaml:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pytest</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">pyyaml</span>
</pre></div>
</div>
<p>Хотя на курсе не надо будет писать тесты, чтобы их понимать, стоит
посмотреть на пример теста. Например, есть следующий код с функцией
check_ip:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipaddress</span>


<span class="k">def</span> <span class="nf">check_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">check_ip</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Function result:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Функция check_ip проверяет является ли аргумент, который ей передали,
IP-адресом. Пример вызова функции с разными аргументами:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">ipaddress</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">check_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">try</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">True</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
   <span class="o">...</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">check_ip</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">check_ip</span><span class="p">(</span><span class="s1">&#39;10.1.&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">check_ip</span><span class="p">(</span><span class="s1">&#39;a.a.a.a&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">check_ip</span><span class="p">(</span><span class="s1">&#39;500.1.1.1&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Теперь необходимо написать тест для функции check_ip. Тест должен
проверять, что при передаче корректного адреса, функция возвращает True,
а при передаче неправильного аргумента - False.</p>
<p>Чтобы упростиь задачу, тест можно написать в том же файле. В pytest,
тестом может быть обычная функция, с именем, которое начинается на
<a href="#id2"><span class="problematic" id="id3">test_</span></a>. Внутри функции надо написать условия, которые проверяются. В
pytest это делается с помощью assert.</p>
<div class="section" id="assert">
<h5>assert<a class="headerlink" href="#assert" title="Ссылка на этот заголовок">¶</a></h5>
<p>assert ничего не делает, если выражение, которое написано после него
истинное и генерирует исключение, если выражение ложное:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="k">assert</span> <span class="mi">5</span> <span class="o">&gt;</span> <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="k">assert</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="k">assert</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">9</span><span class="o">-</span><span class="mf">1956288e2</span><span class="n">d8e</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="k">assert</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>

<span class="ne">AssertionError</span><span class="p">:</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="k">assert</span> <span class="mi">5</span> <span class="o">&lt;</span> <span class="mi">1</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">b224d03aab2f</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="k">assert</span> <span class="mi">5</span> <span class="o">&lt;</span> <span class="mi">1</span>

<span class="ne">AssertionError</span><span class="p">:</span>
</pre></div>
</div>
<p>После assert и выражения можно писать сообщение. Если сообщение есть,
оно выводится в исключении:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="k">assert</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;а нет в списке&quot;</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">7</span><span class="n">a8f87272a54</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="k">assert</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;а нет в списке&quot;</span>

<span class="ne">AssertionError</span><span class="p">:</span> <span class="n">а</span> <span class="n">нет</span> <span class="n">в</span> <span class="n">списке</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h5>Пример теста<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>pytest использует assert, чтобы указать какие условия должны
выполняться, чтобы тест считался пройденным.</p>
<p>В pytest тест можно написать как обычную функцию, но имя функции должно
начинаться с <a href="#id4"><span class="problematic" id="id5">test_</span></a>. Ниже написан тест test_check_ip, который
проверяет работу функции check_ip, передав ей два значения: правильный
адрес и неправильный, а также после каждой проверки написано сообщение:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipaddress</span>


<span class="k">def</span> <span class="nf">check_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">test_check_ip</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">check_ip</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;При правильном IP, функция должна возвращать True&#39;</span>
    <span class="k">assert</span> <span class="n">check_ip</span><span class="p">(</span><span class="s1">&#39;500.1.1.1&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;Если адрес неправильный, функция должна возвращать False&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">check_ip</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Function result:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>Код записан в файл check_ip_functions.py. Теперь надо разобраться как
вызывать тесты. Самый простой вариант, написать слово pytest. В этом
случае, pytest автоматически обнаружит тесты в текущем каталоге. Однако,
у pytest есть определенные правила, не только по названию функцию, но и
по названию файлов с тестами - имена файлов также должны начинаться на
<a href="#id6"><span class="problematic" id="id7">test_</span></a>. Если правила соблюдаются, pytest автоматически найдет тесты,
если нет - надо указать файл с тестами.</p>
<p>В случае с примером выше, надо будет вызвать такую команду:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pytest check_ip_functions.py
========================= test session starts ==========================
platform linux -- Python 3.7.3, pytest-4.6.2, py-1.5.2, pluggy-0.12.0
rootdir: /home/vagrant/repos/general/pyneng.github.io/code_examples/pytest
collected 1 item

check_ip_functions.py .                                          [100%]

======================= 1 passed in 0.02 seconds =======================
</pre></div>
</div>
<p>По умолчанию, если тесты проходят, каждый тест (функция test_check_ip)
отмечается точкой. Так как в данном случае тест только один - функция
test_check_ip, после имени check_ip_functions.py стоит точка, а
также ниже написано, что 1 тест прошел.</p>
<p>Теперь, допустим, что функция работает неправильно и всегда возвращает
False (напишите return False в самом начале функции). В этом случае,
выполнение теста будет выглядеть так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pytest check_ip_functions.py
========================= test session starts ==========================
platform linux -- Python 3.6.3, pytest-4.6.2, py-1.5.2, pluggy-0.12.0
rootdir: /home/vagrant/repos/general/pyneng.github.io/code_examples/pytest
collected 1 item

check_ip_functions.py F                                          [100%]

=============================== FAILURES ===============================
____________________________ test_check_ip _____________________________

    def test_check_ip():
&gt;       assert check_ip(&#39;10.1.1.1&#39;) == True, &#39;При правильном IP, функция должна возвращать True&#39;
E       AssertionError: При правильном IP, функция должна возвращать True
E       assert False == True
E        +  where False = check_ip(&#39;10.1.1.1&#39;)

check_ip_functions.py:14: AssertionError
======================= 1 failed in 0.06 seconds =======================
</pre></div>
</div>
<p>Если тест не проходит, pytest выводит более подробную информацию и
показывает в каком месте что-то пошло не так. В данном случае, при
выполении строки <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">check_ip('10.1.1.1')</span> <span class="pre">==</span> <span class="pre">True</span></code>, выражение не
дало истинный результат, поэтому было сгенерировано исключение.</p>
<p>Ниже, pytest показывает, что именно он сравнивал:
<code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">False</span> <span class="pre">==</span> <span class="pre">True</span></code> и уточняет, что False - это
<code class="docutils literal notranslate"><span class="pre">check_ip('10.1.1.1')</span></code>. Посмотрев на вывод, можно заподозрить, что с
функцией check_ip что-то не так, так как она возвращает False на
правильном адресе.</p>
<p>Чаще всего, тесты пишутся в отдельных файлах. Для данного примера тест
всего один, но он все равно вынесен в отдельный файл.</p>
<p>Файл test_check_ip_function.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">check_ip_functions</span> <span class="kn">import</span> <span class="n">check_ip</span>


<span class="k">def</span> <span class="nf">test_check_ip</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">check_ip</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;При правильном IP, функция должна возвращать True&#39;</span>
    <span class="k">assert</span> <span class="n">check_ip</span><span class="p">(</span><span class="s1">&#39;500.1.1.1&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;Если адрес неправильный, функция должна возвращать False&#39;</span>
</pre></div>
</div>
<p>Файл check_ip_functions.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipaddress</span>


<span class="k">def</span> <span class="nf">check_ip</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
    <span class="c1">#return False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ipaddress</span><span class="o">.</span><span class="n">ip_address</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">check_ip</span><span class="p">(</span><span class="s1">&#39;10.1.1.1&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Function result:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>В таком случае, тест можно запустить не указывая файл:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pytest
================= test session starts ========================
platform linux -- Python 3.6.3, pytest-4.6.2, py-1.5.2, pluggy-0.12.0
rootdir: /home/vagrant/repos/general/pyneng.github.io/code_examples/pytest
collected 1 item

test_check_ip_function.py .                              [100%]

================= 1 passed in 0.02 seconds ====================
</pre></div>
</div>
</div>
</div>
<span id="document-book/additional_info/pytest_pyneng"></span><div class="section" id="pytest">
<h4>Особенности использования pytest для проверки заданий<a class="headerlink" href="#pytest" title="Ссылка на этот заголовок">¶</a></h4>
<p>На курсе pytest используется, в первую очередь, для самопроверки
заданий. Однако, эта проверка не является опциональной - задание
считается сделанным, когда оно соблюдает все указанные пункты и проходит
тесты. Со своей стороны, я тоже сначала проверяю задания автоматическими
тестами, а затем уже смотрю код, пишу комментарии, если нужно и
показываю вариант решения.</p>
<p>Поначалу тесты требуют усилий, но через пару разделов, они будут
помогать в решении заданий.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Тесты, которые написаны для заданий курса, не
являются эталоном или best practice написания тестов. Тесты написаны
с максимальным упором на понятность и многие вещи принято делать
по-другому.</p>
</div>
<p>При решении заданий, особенно, когда есть сомнения по поводу итогового
формата данных, которые должны быть получены, лучше посмтреть в тест.
Например, если задание task_9_1.py, то соответствующий тест будет в
файле test_task_9_1.py.</p>
<p>Пример теста test_task_9_1.py:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">task_9_1</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">common_functions</span> <span class="kn">import</span> <span class="n">check_function_exists</span><span class="p">,</span> <span class="n">check_function_params</span>


<span class="c1"># Проверяет создана ли функция generate_access_config в задании task_9_1</span>
<span class="k">def</span> <span class="nf">test_function_created</span><span class="p">():</span>
    <span class="n">check_function_exists</span><span class="p">(</span><span class="n">task_9_1</span><span class="p">,</span> <span class="s1">&#39;generate_access_config&#39;</span><span class="p">)</span>

<span class="c1"># Проверяет параметры функции</span>
<span class="k">def</span> <span class="nf">test_function_params</span><span class="p">():</span>
    <span class="n">check_function_params</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="n">task_9_1</span><span class="o">.</span><span class="n">generate_access_config</span><span class="p">,</span>
                          <span class="n">param_count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">param_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;intf_vlan_mapping&#39;</span><span class="p">,</span> <span class="s1">&#39;access_template&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">test_function_return_value</span><span class="p">():</span>
    <span class="n">access_vlans_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;FastEthernet0/12&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s1">&#39;FastEthernet0/14&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
        <span class="s1">&#39;FastEthernet0/16&#39;</span><span class="p">:</span> <span class="mi">17</span>
    <span class="p">}</span>
    <span class="n">template_access_mode</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span> <span class="s1">&#39;switchport access vlan&#39;</span><span class="p">,</span>
        <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span> <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
        <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span>
    <span class="p">]</span>
    <span class="n">correct_return_value</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;interface FastEthernet0/12&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;switchport access vlan 10&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;interface FastEthernet0/14&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;switchport access vlan 11&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;interface FastEthernet0/16&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;switchport mode access&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;switchport access vlan 17&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;switchport nonegotiate&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;spanning-tree portfast&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;spanning-tree bpduguard enable&#39;</span><span class="p">]</span>

    <span class="n">return_value</span> <span class="o">=</span> <span class="n">task_9_1</span><span class="o">.</span><span class="n">generate_access_config</span><span class="p">(</span><span class="n">access_vlans_mapping</span><span class="p">,</span> <span class="n">template_access_mode</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">return_value</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Функция ничего не возвращает&quot;</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">return_value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">,</span> <span class="s2">&quot;Функция должна возвращать список&quot;</span>
    <span class="k">assert</span> <span class="n">return_value</span> <span class="o">==</span> <span class="n">correct_return_value</span><span class="p">,</span> <span class="s2">&quot;Функция возвращает неправильное значение&quot;</span>
</pre></div>
</div>
<p>Обратите внимание на переменную correct_return_value - в этой
переменной содержится итоговый список, который должна возвращать функция
generate_access_config. Поэтому, если, к примеру, по мере выполнения
задания, возник вопрос надо ли добавлять пробелы перед командами или
перевод строки в конце, можно посмотреть в тесте, что именно требуется в
результате. А также сверить свой вывод, с выводом в переменной
correct_return_value.</p>
<div class="section" id="id1">
<h5>Как запускать тесты для проверки заданий<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Самое главное, это откуда надо запускать тесты: все тесты надо запускать
из каталога с заданиями раздела. Например, в
разделе 09_functions, такая структура каталога с заданиями:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[~/repos/pyneng-7/pyneng-online-may-aug-2019/exercises/09_functions]
vagrant: [master|✔]
$ tree
.

├── config_r1.txt
├── config_sw1.txt
├── config_sw2.txt
├── conftest.py
├── task_9_1a.py
├── task_9_1.py
├── task_9_2a.py
├── task_9_2.py
├── task_9_3a.py
├── task_9_3.py
├── task_9_4.py
├── test_task_9_1a.py
├── test_task_9_1.py
├── test_task_9_2a.py
├── test_task_9_2.py
├── test_task_9_3a.py
├── test_task_9_3.py
└── test_task_9_4.py
</pre></div>
</div>
<p>Запускать тесты, в этом случае, надо из каталога 09_functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[~/repos/pyneng-7/pyneng-online-may-aug-2019/exercises/09_functions]
vagrant: [master|✔]
$ pytest test_task_9_1.py
========================= test session starts ==========================
platform linux -- Python 3.7.3, pytest-4.6.2, py-1.5.2, pluggy-0.12.0
rootdir: /home/vagrant/repos/pyneng-7/pyneng-online-may-aug-2019/exercises/09_functions
collected 3 items

test_task_9_1.py ...                                       [100%]
...
</pre></div>
</div>
</div>
<div class="section" id="conftest-py">
<h5>conftest.py<a class="headerlink" href="#conftest-py" title="Ссылка на этот заголовок">¶</a></h5>
<p>К тестами относится и файл conftest.py - это
специальный файл, в котором можно писать функции (а точнее фикстуры)
общие для раных тестов. Например, в этот файл вынесены функции, которые
подключаются по SSH/Telnet к оборудованию.</p>
</div>
<div class="section" id="pytest-ini">
<h5>pytest.ini<a class="headerlink" href="#pytest-ini" title="Ссылка на этот заголовок">¶</a></h5>
<p>Это конфигурационный файл pytest. В нем можно настроить аргументы вызова
pytest. Например, если вы хотите всегда вызывать pytest с -vv, надо
написать в pytest.ini:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">pytest</span><span class="p">]</span>
<span class="n">addopts</span> <span class="o">=</span> <span class="o">-</span><span class="n">vv</span>
</pre></div>
</div>
<p>В подготовленном файле pytest.ini находится такая строка:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">addopts</span> <span class="o">=</span> <span class="o">-</span><span class="n">vv</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">hints</span>
</pre></div>
</div>
<p>Это параметр, который нужен модулю pytest-clarity, он описывается ниже.</p>
</div>
<div class="section" id="id2">
<h5>Полезные команды<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Запуск одного теста:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pytest test_task_9_1.py
</pre></div>
</div>
<p>Запуск одного теста с более подробным выводом информации (показывает
diff между данными в тесте и тем, что получено из функции):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pytest test_task_9_1.py -vv
</pre></div>
</div>
<p>Запуск всех тестов одного раздела:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[~/repos/pyneng-7/pyneng-online-may-aug-2019/exercises/09_functions]
vagrant: [master|✔]
$ pytest
======================= test session starts ========================
platform linux -- Python 3.6.3, pytest-4.6.2, py-1.5.2, pluggy-0.12.0
rootdir: /home/vagrant/repos/pyneng-7/pyneng-online-may-aug-2019/exercises/09_functions
collected 21 items

test_task_9_1.py ..F                                   [ 14%]
test_task_9_1a.py FFF                                  [ 28%]
test_task_9_2.py FFF                                   [ 42%]
test_task_9_2a.py FFF                                  [ 57%]
test_task_9_3.py FFF                                   [ 71%]
test_task_9_3a.py FFF                                  [ 85%]
test_task_9_4.py FFF                                   [100%]

...
</pre></div>
</div>
<p>Запуск всех тестов одного раздела с отображением сообщений об ошибках в
одну строку:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pytest --tb=line
</pre></div>
</div>
</div>
</div>
<div class="section" id="pytest-clarity">
<h4>pytest-clarity<a class="headerlink" href="#pytest-clarity" title="Ссылка на этот заголовок">¶</a></h4>
<p>Плагин pytest-clarity улучшает отображение отличий необходимого
результата с решением задания.</p>
<p>Установка:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pytest</span><span class="o">-</span><span class="n">clarity</span>
</pre></div>
</div>
<p>Плагин pytest-clarity отрабатывает только в том случае, когда тест
вызывается с флагом <code class="docutils literal notranslate"><span class="pre">-vv</span></code>. Также по умолчанию у него довольно объемный
вывод, поэтому лучше вызывать его с аргументом <code class="docutils literal notranslate"><span class="pre">--no-hints</span></code> (эта опция прописана в подготовленном репозитории в файле pytest.ini):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pytest test_task_9_3.py -vv --no-hints
======================= test session starts ========================

test_task_9_3.py::test_function_created PASSED               [ 33%]
test_task_9_3.py::test_function_params PASSED                [ 66%]
test_task_9_3.py::test_function_return_value FAILED          [100%]

======================== FAILURES ==================================
__________ test_function_return_value ______________________________

...
        access, trunk = return_value
&gt;       assert (
            return_value == correct_return_value
        ), &quot;Функция возвращает неправильное значение&quot;
E       AssertionError: Функция возвращает неправильное значение
E       assert left == right failed.
E         Showing unified diff (L=left, R=right):
E
E          L ({&#39;FastEthernet0/0&#39;: &#39;10&#39;,
E          R ({&#39;FastEthernet0/0&#39;: 10,
E          L   &#39;FastEthernet0/2&#39;: &#39;20&#39;,
E          R   &#39;FastEthernet0/2&#39;: 20,
E          L   &#39;FastEthernet1/0&#39;: &#39;20&#39;,
E          R   &#39;FastEthernet1/0&#39;: 20,
E          L   &#39;FastEthernet1/1&#39;: &#39;30&#39;},
E          R   &#39;FastEthernet1/1&#39;: 30},
E            {&#39;FastEthernet0/1&#39;: [100, 200],
E             &#39;FastEthernet0/3&#39;: [100, 300, 400, 500, 600],
E             &#39;FastEthernet1/2&#39;: [400, 500, 600]})

test_task_9_3.py:59: AssertionError
</pre></div>
</div>
<p>Так как агументы <code class="docutils literal notranslate"><span class="pre">-vv</span></code> и <code class="docutils literal notranslate"><span class="pre">--no-hints</span></code> надо постоянно передавать,
можно записать их в pytest.ini:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">pytest</span><span class="p">]</span>
<span class="n">addopts</span> <span class="o">=</span> <span class="o">-</span><span class="n">vv</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">hints</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-resources/README"></span><div class="section" id="id1">
<h2>Продолжение обучения<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h2>
<p>Как правило, информацию тяжело усвоить с первого раза. Особенно, новую
информацию.</p>
<p>Если делать практические задания и пометки, в ходе изучения, то усвоится
намного больше информации, чем, если просто читать книгу. Но, скорее
всего, в каком-то виде, надо будет читать о той же информации несколько
раз.</p>
<p>Книга дает лишь основы Python и поэтому надо обязательно продолжать
учиться и повторять уже пройденные темы и изучать новое. И тут есть
множество вариантов:</p>
<ul>
<li><p class="first">автоматизировать что-то в работе</p>
</li>
<li><p class="first">изучать дальше Python для автоматизации работы с сетью</p>
</li>
<li><p class="first">изучать Python без привязки к сетевому оборудованию</p>
<blockquote>
<div><p>Тут ресурсы перечислены выборочно, с учетом того, что вы уже
прочитали книгу. Но, кроме этого, я сделала <a class="reference external" href="https://natenka.github.io/pyneng-resources/">подборку
ресурсов</a> в которой
можно найти и другие материалы.</p>
</div></blockquote>
</li>
</ul>
<div class="section" id="id2">
<h3>Написание скриптов для автоматизации рабочих процессов<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h3>
<p>Скорее всего, после прочтения книги, появятся идеи, что можно
автоматизировать на работе. Это отличный вариант, так как на реальной
задаче всегда проще учиться и изучать новое. Но лучше не ограничиваться
только рабочими задачами и изучать Python дальше.</p>
<p>Python позволяет делать достаточно многое обладая только базовыми
знаниями. Поэтому не всегда рабочие задачи позволят принципиально
повысить уровень знаний или подтолкнуть к этому, но зная Python лучше,
те же задачи можно решать, как правило, намного
проще. Поэтому лучше не останавливаться и учиться дальше.</p>
<p>Ниже описаны ресурсы с привязкой к сетевому оборудованию и в целом по
Python. В зависимости от того, по каким материалам вы лучше учитесь,
можно выбрать книги или видео курсы из списка</p>
</div>
<div class="section" id="python">
<h3>Python для автоматизации работы с сетевым оборудованием<a class="headerlink" href="#python" title="Ссылка на этот заголовок">¶</a></h3>
<p>Книги:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.amazon.com/Network-Programmability-Automation-Next-Generation-Engineer/dp/1491931256">Network Programmability and Automation: Skills for the
Next-Generation Network
Engineer</a></li>
<li><a class="reference external" href="https://www.packtpub.com/networking-and-servers/mastering-python-networking">Mastering Python Networking (Eric
Chou)</a>
- отчасти перекликается с тем, что рассматривалось в этой книге, но в
ней есть и много новых тем. Плюс, рассматриваются примеры не только
на оборудовании Cisco, но Juniper и Arista.</li>
</ul>
<p>Блоги - позволят быть в курсе новостей в этой сфере:</p>
<ul class="simple">
<li><a class="reference external" href="https://pynet.twb-tech.com/">Kirk Byers</a></li>
<li><a class="reference external" href="http://jedelman.com/">Jason Edelman</a></li>
<li><a class="reference external" href="https://keepingitclassless.net/">Matt Oswalt</a></li>
<li><a class="reference external" href="http://networkop.co.uk/">Michael Kashin</a></li>
<li><a class="reference external" href="https://codingnetworker.com/">Henry Ölsner</a></li>
<li><a class="reference external" href="https://thepacketgeek.com/">Mat Wood</a></li>
</ul>
<p>У Packet Pushers достаточно часто выходят подкасты об автоматизации:</p>
<ul class="simple">
<li><a class="reference external" href="http://packetpushers.net/podcast/podcasts/show-176-intro-to-python-automation-for-network-engineers/">Show 176 – Intro To Python &amp; Automation For Network
Engineers</a></li>
<li><a class="reference external" href="http://packetpushers.net/podcast/podcasts/show-198-kirk-byers-network-automation-python-ansible/">Show 198 – Kirk Byers On Network Automation With Python &amp;
Ansible</a></li>
<li><a class="reference external" href="http://packetpushers.net/podcast/podcasts/show-270-design-build-9-automation-python-netmiko/">Show 270: Design &amp; Build 9: Automation With Python And
Netmiko</a></li>
<li><a class="reference external" href="http://packetpushers.net/podcast/podcasts/show-332-dont-believe-programming-hype/">Show 332: Don’t Believe The Programming
Hype</a></li>
<li><a class="reference external" href="http://packetpushers.net/podcast/podcasts/show-333-orchestration-vs-automation/">Show 333: Automation &amp; Orchestration In
Networking</a></li>
<li><a class="reference external" href="http://packetpushers.net/podcast/podcasts/pq-show-99-netmiko-napalm-network-automation/">PQ Show 99: Netmiko &amp; NAPALM For Network
Automation</a></li>
</ul>
<p>Проекты:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/mpenning/ciscoconfparse">CiscoConfParse</a> -
библиотека, которая парсит конфигурации типа Cisco IOS. С ее помощью
можно: проверять существующие конфигурации
маршрутизаторов/коммутаторов, получать определенную часть
конфигурации, изменять конфигурацию</li>
<li><a class="reference external" href="https://github.com/napalm-automation/napalm">NAPALM</a> - NAPALM
(Network Automation and Programmability Abstraction Layer with
Multivendor support) это библиотека, которая позволяет работать с
сетевым оборудованием разных вендоров, используя унифицированный API</li>
<li><a class="reference external" href="https://getnoc.com/">NOC Project</a> - NOC is
the scalable, high-performance and open-source OSS system for ISP,
service and content providers</li>
<li><a class="reference external" href="https://github.com/kennethreitz/requests">Requests</a> - библиотека
для работы с HTTP</li>
<li><a class="reference external" href="https://saltstack.com/">SaltStack</a> - аналог Ansible</li>
<li><a class="reference external" href="https://github.com/secdev/scapy">Scapy</a> - сетевая утилита,
которая позволяет манипулировать сетевыми пакетами</li>
<li><a class="reference external" href="https://stackstorm.com/">StackStorm</a> - StackStorm is event-driven
automation commonly used for auto-remediation, security responses,
facilitated troubleshooting, complex deployments, and more</li>
<li><a class="reference external" href="https://github.com/selfuryon/netdev">netdev</a></li>
<li><a class="reference external" href="https://github.com/nornir-automation/nornir">Nornir</a></li>
<li><a class="reference external" href="https://github.com/afourmy/eNMS">eNMS</a></li>
</ul>
</div>
<div class="section" id="id3">
<h3>Python без привязки к сетевому оборудованию<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h3>
<div class="section" id="id4">
<h4>Книги<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Основы:</p>
<ul class="simple">
<li><a class="reference external" href="https://greenteapress.com/wp/think-python-2e/">Think Python</a> - хорошая книга по основам Python. В книге есть задания.</li>
<li><a class="reference external" href="https://www.amazon.com/Python-Crash-Course-Hands-Project-Based-ebook/dp/B018UXJ9RI/">Python Crash Course: A Hands-On, Project-Based Introduction to Programming</a> - книга по основам Python. Половина книги посвящена «стандартному» описанию основ Python, а во второй половине эти основы используются для проектов. В книге есть задания.</li>
<li><a class="reference external" href="https://automatetheboringstuff.com/">Automate the Boring Stuff with Python</a>. <a class="reference external" href="https://www.ozon.ru/context/detail/id/137673590/">На русском</a> -  в этой книге можно найти много идей по автоматизации ежедневной работы. Тут рассматриваются такие темы: работа с файлами PDF, Excel, Word, отправка писем, работа с картинками, работа в веб</li>
</ul>
<p>Среднего/продвинутого уровня:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.amazon.com/Python-Tricks-Buffet-Awesome-Features-ebook/dp/B0785Q7GSY">Python Tricks</a> - отличный вариант для 2-3 книги по Python. В книге описываются различные аспекты Python и то как правильно использовать. Книга достаточно новая (конец 2017 года), в ней рассматривается Python 3.</li>
<li><a class="reference external" href="https://www.amazon.com/Effective-Python-Specific-Software-Development-ebook-dp-B00TKGY0GU/dp/B00TKGY0GU/">Effective Python: 59 Specific Ways to Write Better Python (Effective Software Development Series)</a> - книга полезных советов как лучше писать код. В конце 2019 года <a class="reference external" href="https://www.amazon.com/Effective-Python-Specific-Software-Development/dp/0134853989/">планируется выход второго издания книги</a>.</li>
<li><a class="reference external" href="http://diveintopython3.problemsolving.io/">Dive Into Python 3</a> - коротко рассматриваются основы Python, а затем более продвинутые темы: closure, генераторы, тесты и так далее. Книга 2009 года, но рассматриваюется Python 3 и 99% тем остались без изменений.</li>
<li><a class="reference external" href="https://runestone.academy/runestone/static/pythonds/index.html">Problem Solving with Algorithms and Data Structures using Python</a> - отличная книга по структурам данных и алгоритмам. Много примеров и домашних заданий. <a class="reference external" href="http://aliev.me/runestone/">На русском</a></li>
<li><a class="reference external" href="https://www.amazon.com/gp/product/1491946008/">Fluent Python</a> - отличная книга по более продвинутым темам. Даже те темы, которые устарели в текущей версии Python (asyncio) стоит прочитать ради прекрасного объяснения темы.</li>
<li><a class="reference external" href="https://www.amazon.com/gp/product/1449340377/">Python Cookbook</a> - отличная книга рецептов. Рассматривается огромное количество сценариев с решениями и пояснением.</li>
</ul>
</div>
<div class="section" id="id5">
<h4>Курсы<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://www.edx.org/course/introduction-computer-science-mitx-6-00-1x-9">MITx - 6.00.1x Introduction to Computer Science and Programming
Using
Python</a>
- очень хороший курс по Python. Отличный вариант для продолжения
обучения после книги. В нём вы и повторите пройденный материал по
основам Python, но под другим углом и узнаете много нового. В курсе
много практических заданий и он достаточно интенсивный.</li>
<li><a class="reference external" href="https://www.youtube.com/playlist?list=PLlb7e2G7aSpTTNp7HBYzCBByaE1h54ruW">Python от Computer Science
Center</a>
- отличные видеолекции по Python. Тут есть и немного основ и более
продвинутые темы</li>
<li><a class="reference external" href="https://training.talkpython.fm/courses/all">Курсы от Talk Python</a></li>
</ul>
</div>
<div class="section" id="id6">
<h4>Сайты с задачами<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://codechalleng.es/bites/">Bites of Py</a></li>
<li><a class="reference external" href="https://www.hackerrank.com/">HackerRank</a> - на этом сайте задачи
разбиты по областям: алгоритмы, регулярные выражения, базы данных и
другие. Но есть и базовые задачи</li>
<li><a class="reference external" href="https://checkio.org/">CheckIO - online game for Python and JavaScript
coders</a></li>
</ul>
</div>
<div class="section" id="id7">
<h4>Подкасты<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h4>
<p>Подкасты позволят в целом расширить кругозор и получить представление о
разных проектах, модулях и библиотеках Python:</p>
<ul class="simple">
<li><a class="reference external" href="https://talkpython.fm/">Talk Python To Me</a></li>
<li><a class="reference external" href="https://www.fullstackpython.com/best-python-podcasts.html">Best Python
Podcasts</a></li>
</ul>
</div>
<div class="section" id="id8">
<h4>Документация<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h4>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/index.html">Официальная документация
Python</a></li>
<li><a class="reference external" href="https://pymotw.com/3/index.html">Python Module of the Week</a></li>
<li><a class="reference external" href="https://github.com/mattharrison/Tiny-Python-3.6-Notebook/blob/master/python.rst">Tiny-Python-3.6-Notebook</a>
- Отличная шпаргалка по Python 3.6</li>
</ul>
</div>
</div>
</div>
<span id="document-testimonials"></span><div class="section" id="testimonials">
<span id="id1"></span><h2>Отзывы читателей книги и слушателей курса<a class="headerlink" href="#testimonials" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="id2">
<h3>Ян Коробов<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h3>
<p>Курс Python для сетевых инженеров.</p>
<p>Вот и пролетели 3 месяца с первого занятия и пора писать отзыв. Как
только я услышал про этот курс и что его ведет та самая Наташа
Самойленко, я подумал вот оно! Как было бы здорово у нее поучится и
ожидания оправдались на 200%!</p>
<p>Как и многих, кто вообще не занимался раньше программированием, перед
курсом меня еще одолевали сомнения, а смогу ли я? Наверное, надо хорошо
знать математику, итд. Все стереотипы быстро развеиваются. На деле
программирование под руководством Наташи превращается в увлекательное,
затягивающее дело. Серьезно, как по мне так это очень весело! Но это не
значит, что Вас ждет легкая прогулка, сразу советую работать на максимум
и делать все задания. Результат прямо пропорционален затраченным
усилиям. На курсе попадаешь в атмосферу разработчика, подготовлены все
необходимые инструменты для этого. Интенсивность курса средняя. Очень
много практики и заданий в контексте сетевого администрирования. Как по
мне так отличная структура, Одна, две лекции в неделю, остальная неделя
на практические задания. В slack всегда можно рассчитывать на помощь
Наташи по заданиям и конечно заряд мотивации на неделю обеспечен;)
Иногда в чате можно встретить таких “монстров” как Эмиль Гарипов! Помимо
этого, огромное количество дополнительного материала (помимо лекций,
заданий и книги) И так, незаметно для себя ты уже между делом пишешь код
что бы получить словарь из Английской книги потому что тебе не хватает
словарного запаса. Или опрашиваешь 1000-и устройств, складывая результат
в базу, применяешь шаблоны jinja, конфигурируешь, пишешь playbook в
Ansible. И Наташа не может и не хочет стоять на месте поэтому появились
дополнительные занятия после курса по ООП, что невероятно расширяет ваши
возможности.</p>
<p>Что бы чему-то научиться нужно идти к лучшим, людям страстно одержимым
своим делом, на наше счастье Наташа одинаково увлечена и
программированием, и желанием научить нас, огромное тебе спасибо за
это!!!</p>
</div>
<div class="section" id="id3">
<h3><a class="reference external" href="http://peter-on-tractor.blogspot.ru/2017/12/python-for-network-engineers.html">Сергей Забабурин</a><a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h3>
<p>Осталось три темы и я закончу воркшоп «Питон для сетевых инженеров» от
Наташи Самойленко. Курс шел с сентября по ноябрь, 13 недель.</p>
<p>Я как всегда отжег: оплатил, ничего не делал и начал заниматься, когда
группа прошла половину. Однако, начав, уже не смог оторваться и топлю до
финала. Наташа, если вдруг не знаете, написала чуть меньше чем весь
сетевой раздел XGU.ru , автоматизировала проект CCIE за год и написала
для него первую «большую лабу». Послушать ее чарующий голос можно в
клубе 256-TTL</p>
<p>В курсе сам Python, базы SQL, форматы YAML, JSON, шаблоны Jinja2 и,
конечно, Ansible. 50 часов видео и 114 заданий для самостоятельной
работы.</p>
<p>Почему этот курс?</p>
<p>Во-первых он продуман и оснащен всем необходимым инструментарием. Книга,
лекции, записи лекций, домашние задания, тесты на повторение, графики
«кто сдал а кто еще ЛОЛ» и конечно чатик, где всегда помогут а Наташа не
спит вовсе.</p>
<p>Во-вторых это атмосфера. Шутки-прибаутки на лекциях.В чатике тебе не
дадут решение сразу но заглумят в нужном направлении. Если вы когда то в
общаге готовились к сессии, то должны понять. Что важно для меня -
Наташа профессионал и очень увлеченный человек. Это подкупает в начале и
очень поддерживает весь курс. Письма с ее фирменным «Все отлично! Но вот
можно еще так и вот так и еще 3 другими способами….» ждешь как
праздника.</p>
<p>В третьих Наташа коварна. Пройденные темы интервально повторяются в
заданиях в разных вариациях, сами задания для каждой темы усложняются от
номера к номеру, обрастая проверками, функционалом и проч. Например у
вас позади остались базовые структуры данных, функции и форматы данных.
И сейчас у вас подключение к оборудованию через netmiko. Что проще - два
метода. Рано радуетесь - задание будет таким: возьмите файлик YAML с
параметрами устройств, напишите пару функций, которые проходят по
оборудованию из этого YAML и вводят команды. Сделайте скрипт таким,
чтобы команды можно было ввести как угодно: поштучно или файлом или
списком . Заодно проверьте ошибки (вдруг у вас командочка кривая) и на
выходе сделайте два словаря в которых вложенные словари для команд
которые прошли и которые нет. И не забудьте использовать регулярки)</p>
<p>И наконец, что действительно важно. Наташа заявляет: питон это просто и
после курса вы будете его использовать в повседневной работе. Так и
происходит. Начиная с азов и включая серьезные вещи (например потоки,
производительность кода) шаг за шагом она выращивает в участнике навыки
и знания с которыми можно идти и работать. Это курс для практиков,
примеры из реальной жизни, материал подобран и сверстан так, что все
нужное и всего достаточно. Если Вам требуется эффективно, в понятные
сроки и за умеренную плату (сейчас это 250$) закрыть вопрос с питоном -
то вам сюда: natenka.github.io/pyneng-online</p>
<p>ЗЫ: Если вам не нужно быстро и вы ходите как я два года сидеть и
сожалеть на тему «как плохо не уметь писать скрипты для Juniper» то
совсем даром на сайте выложена книга и Git c примерами и готовыми
виртуалками для самостоятельных штудий.</p>
</div>
<div class="section" id="id4">
<h3>Александр Романов<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h3>
<p>Когда у меня стали отнимать слишком много времени рутинные задачи. Когда
коэффициент подошёл к восьмидесяти процентам я понял что нужно что то
менять. Я пробовал изучать сам , но из за недостатка времени у меня не
получалось. И в один прекрасный день я натолкнулся на курс который
предлагала Наташа Самойленко. С первых занятий я понял что этот курс ни
в какой сравнение с теми которые у меня бывали раньше. Имея большой опыт
в администрировании сетей показывала подходящие примеры для быстрейшего
усвоения нами материалов и применения их в работе. И всегда старалась
консультировать и отвечать на вопросы в отличии от других преподавателей
на курсах которых я проходил ранее. Думаю этот курс прочно займет первое
место среди всех курсов которые я проходил (наверное пока Наташа не
выпустит что то новое). Думаю после этого запатентовать бренд Natasha
Samoylenko как будущий сертификат качества.</p>
</div>
<div class="section" id="id5">
<h3>Денис Карпушин<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h3>
<p>Все что вы хотели знать о Python, но боялись спросить.</p>
<p>Основная проблема самостоятельного обучения это дисциплина. Сложно себя
организовать и заставить вообще что-то делать, тем более довести все до
конца. Я записался на курс что бы была мотивация и оформленная программа
обучения.</p>
<p>Все обучение построено в очень удобной форме, и каждый найдет для себя
подходящий вариант. Доступны живые лекции, записи, книга,
непосредственно общение с преподавателем. Можно комбинировать как вам
удобно, чтобы обучение было в радость. Атмосфера почти домашная (Спасибо
Наташе).</p>
<p>Не имея никакого опыта в программировании за пару месяцев начал
использовать Python для решения рабочих задач. Сложно представить что-то
лучше этого курса если вы решили начать изучать программирование. Буду
скучать по беседам, домашке, лекциям, и завидовать тем кому только
предстоит всё это испытать.</p>
</div>
<div class="section" id="id6">
<h3><a class="reference external" href="https://www.linkedin.com/in/%D0%B5%D0%B2%D0%B3%D0%B5%D0%BD%D0%B8%D0%B9-%D0%BE%D0%B2%D1%87%D0%B8%D0%BD%D0%BD%D0%B8%D0%BA%D0%BE%D0%B2-bb8151131/">Евгений Овчинников</a><a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h3>
<p>В октябре 2016 года я решил стать программистом и начал учиться. Покупал
платные курсы от одного очень навязчивого своей рекламой
образовательного российского интернет-ресурса. После нескольких месяцев
обучения стало понятно, что прогресс хоть и есть, но довольно скромный.</p>
<p>Ключевой проблемой было то, что изучаемые материалы либо были слабо
применимы к моей работе (инженер техподдерки в небольшом провайдере),
либо неприменимы совсем. Оставалось только время в вечернее время и
выходные дни. Постепенно я уставал и терял мотивацию что-то делать.
Самовнушение не помогало. Вероятно я ошибся с выбором направления
(веб-разработка), или не сумел выделить нормальное количество времени на
самостоятельную работу. На все это накладывалась сильная загруженность
на новой работе - необходимо было быстро усваивать массу материала. К
лету 2017 процесс стал совсем - я пытался что-то делать, но уже не было
сил и желания. Пройдя примерно половину курса по специальности
Веб-разработчик я понял, что больше не хочу этим заниматься и забил.
Было грустно</p>
<p>Затем увидел на linkmeup.ru объявление о курсе «Питон для сетевых
инженеров». Почитал описание курса и понял, что такой подход (ориентация
на сетевую сферу) может резко увеличить мои шансы на успех. Ведь я
изучаю язык программирования, который могу применить как раз на своем
рабочем месте. Мне нужно опрашивать сетевое оборудование? Нужно. Мне
нужно массово менять конфигурации? Нужно (хотя пока не решаюсь это
делать скриптами, страшно). Вот тебе Python, товарищ! Бери и пользуйся.</p>
<p>Тааак. Что у нас с вакансиями по Питону? Да их куча! Кроме чисто
программистских вакансий есть те же самые сетевые инженеры со знанием
Питона, сетевые администраторы со знанием Питона… Даже научный
сотрудник со знанием Питона на момент написание этих строк куда-то
требуется. Читатель мой, ты понимаешь, что это означает? Научившись
основам Питона и начав применять их на практике, ты еще не становишься
программистом, но ты резко увеличиваешь количество доступных тебе
вакансий. Твоя ценность на рынке труда существенно повышается.</p>
<p>В конце августа начались занятия. Наташа очень аккуратно подводила нас к
мысли, что Питона бояться не надо. Что она за нас уже все инструменты
подготовила. Что на сайте курса есть расписание курса, ссылки на задания
по курсу, ссылки на материалы по занятиям в книге, ссылки на презентации
по курсу, ссылки на репозиторий курса, ссылки на статьи о правильном
обучении, ссылки на полезные ссылки в интернете… В общем студенту
осталось только сесть перед монитором в назначенное время. Которое
Наташа обозначила в календаре Google и предложила всем себе его
добавить.</p>
<p>После многих лекций студентам рассылаются тесты, которые позволяют
быстро проверить, что ты запомнил из нового материала. Это очень
приятный и неожиданный для меня момент. Он еще раз показывает, насколько
Наташа серьезно готовилась к проведению занятий.</p>
<p>Домашняя работа. Тут Наташа тоже подошла необычно: есть необходимый
минимум заданий, которые нужно выполнить для получения сертификата. И
есть максимум, который студенты делают по желанию. В любом случае
практика программирования у студентов набирается достаточно большой. А
уж если вы осилите максимум, то честь вам и почет! Я пока еще не осилил.
Надежда тает с каждым днем, но пока есть :)</p>
<p>Теперь о том, что не понравилось. Часть материала можно было бы серьезно
сократить. Я бы это сделал с разделами про параллельное подключение к
оборудованию и материалами про Ансибл. Параллельное подключение довольно
сложно идет для новичка. Я заснул в самом начале раздела и почти не
просыпался до конца. Вроде как тема важная, но настолько мозг еще к
такому материалу не готов, что он просто его игнорирует. Во время лекции
я открывал вкладки в браузере, серфил, слушал музыку и иногда запускал
видеоролики. В общем, вел себя как типичный студент, который пришел на
лекцию чисто для галочки.</p>
<p>Ансибл. Он интересен, но я против его присутствия на курсе
программирования. Изучение программирования забирает очень много
времени. Это время нужно использовать по-максимуму. Мы же часть этого
времени отбираем на изучение инструмента для работы с сетями. Пусть этот
инструмент написан на Питоне, но работать на Ансибле это не
программирование. Это работать на ПО, которое само по себе нужно
изучать. Мы же пришли изучать язык программирования.</p>
<p>Все остальные материалы мне понравились. Может быть надо можно углубить
Jinja и TextFSM. Материала по ним немало, но мне показалось, что можно
сделать побольше, т.к. шаблонизация в современном программировании очень
важная вещь.</p>
<p>Трехмесячный курс по Питону закончился и сейчас в моей жизни происходит
следующее: я поговорил с начальником отдела и получил задание, связанное
с настройкой и допиливанием модуля на Питоне для нашей системы
мониторинга. То есть я не просто сотрудник техподдержки, который умеет
настраивать сетевое оборудование. Я теперь могу делать новые задачи,
получать новый опыт и добавлять в «Избранное» много интересных вакансий.
Слава великому Питону!</p>
<p>ЗЫ. Курсы с того образовательного портала надо бы пройти до конца -
оплачено ведь. Но так неохота и лень 😔</p>
</div>
<div class="section" id="id7">
<h3>Олег Востриков<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h3>
<p>Курс «Python для сетевых инженеров» подкупает обилием примеров, понятных
сетевым инженерам. Т.е. название не маркетинговый ход, а отвечает
содержанию. Материал подобран и скомпонован очень удачно, что позволит
любому сетевику, независимо от уровня навыков программирования, начать
погружение в Python и перейти от азов к решению реальных задач.</p>
<p>Лично мне курс пришелся как нельзя кстати, уже к середине курса я начал
пытаться автоматизировать рабочие задачи. К окончанию курса это вылилось
в настройку десятков тысяч устройств. Думаю не трудно представить,
сколько времени потребовалось бы, чтобы повторить это вручную.</p>
<p>Отдельное спасибо Наташе за попытку привить слушателям «чистописание»
кода и дополнительные варианты решенных задач, это помогает расширить
кругозор и улучшить код как с эстетической, так и с практической точки
зрения.</p>
</div>
<div class="section" id="id8">
<h3><a class="reference external" href="https://www.linkedin.com/in/garipov/">Эмиль Гарипов</a><a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h3>
<p>Чтобы понять почему именно этот курс и почему именно с Наташей мне надо
упомянуть о себе любимом. Я не разу не программист и никогда им не был.
Программисты всегда вызывали у меня уважение и долю здоровой зависти,
когда за пару часов работы могли реализовать все твои хотелки. У меня
всегда возникала ужас, когда дело касалось программирования в школе, в
университете или уже позже, когда я сам или с помощью других пытался
освоить азы программирования вплоть до того момента как Наташа
предложила пройти мне её курс.</p>
<p>Наташа особенный человек, человек - маяк, человек - наставник, который
берёт за руку и ведёт легко и не принужденно сквозь все дебри ужасного
для меня программирования. Здесь можно прыгнуть, здесь обойти, а здесь и
вовсе отбросить. И что особенно меня поражает в Наташе, так это то, что
она никогда не оставит без внимания ни один маломальский вопрос, всегда
ответит, да ещё и с комментариями и различными вариантами ответов. И
курс у неё выстроен также, как выложенная прямая красивая тропинка, но с
препятсвиями ввиде интересных практических заданий, чтобы было весело и
не скучно осваивать азы программирования. Кроме всего прочего в курсе
даже учтены практически все инструменты для работы именно для
начинающих. Первым занятием идёт подробное объяснение, как все
устанавливать и начать работать. Для меня это оказалось чуть ли не самым
важным, потому что до этого я никогда не сталкивался ни с гитом, ни с
виртуальными окружением, ни со средой программирования.</p>
<p>Скажу честно, этот курс заставил мои мозги напрячься, но я давно не
получал такого удовлетворения от процесса и самое главное избавился от
фобии программирования. Рекомендую пройти этот курс и если есть какие-то
сомнения, отбросить их, вы не только сможете, но и получите массу
удовольствия.</p>
</div>
<div class="section" id="id9">
<h3>Илья про книгу<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h3>
<p>Благодаря курсу Python для сетевых инженеров от Наташи Самойленко, я
захотел сменить квалификацию на девелопера, уже успешно решил ряд
рутинных рабочих задач, постоянно надоедавших своим однообразием. Все
начиналось с простой статьи на xgu.ru, но потом это стало чем то
большим.</p>
<p>Простота и грациозность описания автоматизации процессов Наташи
Самойленко позволила мне открыть дверь в ранее недоступный модный
«DevOps». В связи с этим, помимо развития своих профессиональных
навыков, я так же получил значительный бонус на рынке труда в виде
дополнительных знаний. Мне как человеку который изучал немного Delphi в
университете, да и то не достаточно глубоко, было довольно интересно и
увлекательно разбираться с новой для меня стязей. Подача материала
крайне «легка» для восприятия, и наглядна. Хорошие и полезные в
ежедневной работе примеры.</p>
<p>Спасибо Наташе за отличный курс</p>
</div>
<div class="section" id="id10">
<h3><a class="reference external" href="https://www.linkedin.com/in/aleksei-kirillov-20a7b3a9/">Алексей Кириллов</a> про онлайн курс<a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h3>
<p>Об этом курсе я узнал совершенно случайно. Наташа предложила моему
непосредственному начальнику прочитать данный курс для подчиненных
инженеров. Перед нашим отделом как раз стояла актуальная задача
тестирования оборудования. После непродолжительного согласования мы
приступили к обучению.</p>
<p>Для большинства из нас это было первое знакомство с python. Но благодаря
отличной подаче материала, а так же заданиям с разным уровнем сложности,
обучение проходило весьма интересно и продуктивно. К сожалению, не все
темы нашли применение в нашей работе, но главная цель была достигнута -
мы начали создавать систему автоматизированного тестирования. Причем эти
знания пригодились не только для одной конкретной задачи, но также
позволили решить множество рутинных задач. А из некоторых скриптов
выросли отдельные проекты.</p>
<p>Дело за малым - интересом. Подход, предлагаемый Наташей помогает не
лезть в дебри программирования, а дает инструмент для автоматизации (а
кто не хочет иметь больше свободного времени:) ), который легок в
понимании человеку, который до этого работал только с сетями. До этого
курса я пытался изучать python по популярным книгам в интернете, но
каждый раз это быстро заканчивалось из-за скучности и непонимания как я
могу это применить. В курсе же практически на каждую тему есть задачи,
по которым вы видите практическое применение того или иного объекта
языка.</p>
</div>
<div class="section" id="id11">
<h3>Слава Скороход про онлайн курс<a class="headerlink" href="#id11" title="Ссылка на этот заголовок">¶</a></h3>
<p>О курсе я узнал из группы linkmeup в соцсети. Движимый желанием
попрактиковаться в программировании под руководством такого уважаемого в
сетевых (и не только) кругах человека, как Наташа, записался на него, и
впоследствии не пожалел. Имел за плечами небольшой опыт программирования
на других языках, но с Python столкнулся впервые, что, впрочем, не
составило трудностей в его освоении, по большей части из-за качественной
подачи материала. Полагаю, что курс найдет интерес как у начинающих, так
и у сетевиков/разработчиков с определенным багажом знаний, так как темы
рассматриваются не только по верхам, но и с погружением в детали
реализации – например, про GIL я точно не ожидал услышать</p>
<p>Считаю удачным подход с демонстрацией конкретных, «живых» сетевых, а не
абстрактных примеров. Хоть мне и кажется, что важно в первую очередь
понимание концепции, а область ее применения со временем подскажут
рабочие задачи, но, когда видишь реальные приложения того или иного
модуля – это может дополнительно направить мысль в продуктивное русло.</p>
<p>После курса в сознании очень четко выстраивается картина того, куда еще
расти и на какие темы стоит обратить внимание. Область применения
средств автоматизации не просто обширна, а необъятна, и всегда есть, что
еще изучить, но если вы хотели познакомиться с Python или автоматизацией
в целом, но не знали, откуда подступиться – настоятельно рекомендую</p>
<p>В заключение хочу поблагодарить Наташу за проделанную работу. Это очень
качественный слой информации на просторах рунета, который совершенно
определенно может помочь как минимум избавиться от рутинных задач на
текущем месте работы, а как максимум – может даже стать первым шагом на
пути к смене квалификации.</p>
</div>
<div class="section" id="id12">
<h3><a class="reference external" href="https://www.linkedin.com/in/marat-sibgatulin-8398529/">Марат Сибгатулин</a> про онлайн курс<a class="headerlink" href="#id12" title="Ссылка на этот заголовок">¶</a></h3>
<p>Не могу сказать, что Python ворвался в мои трудовые будни и окрасил их в
жёлтый и синий. Всё-таки прямого применения скриптингу в моей сфере я не
вижу. Нет, это было, скорее, очередное необходимое расширение зоны
незнания.</p>
<p>Что действительно изменило мир - это регулярные выражения. Теперь,
открывая 50 мегабайт текстовых логов в Notepad++, я надеюсь, что
придётся придумать регулярку похитрее, чтобы извлечь максимум
релевантных строк. Да и фильтрация вывода в консоли стала более гибкой и
функциональной.</p>
<p>За это спасибо лабораторкам в курсе и тестам после лекции, где задач на
регулярные выражения было с избытком. Вообще практика построена очень
удачным образом - она опирается на то, что было в лекциях, но добавляет
существенные детали. Получается, что выполняя задания, не только
практикуешь известную теорию, но и с неожиданной стороны видишь то, что
казалось понятным. Лабораторки с изюминкой.</p>
<p>Лекции тоже важны. Несмотря на то, что они чётко идут по галавам книги,
в них огромное количество отступлений, комментариев и фирменного
наташиного юмора.</p>
<p>Один совет: не стесняйтесь задавать вопросы. Лектору очень важно
понимать, что аудитория, тем более онлайн, следит за ним.</p>
</div>
<div class="section" id="id13">
<h3>Кирилл Плетнёв про книгу<a class="headerlink" href="#id13" title="Ссылка на этот заголовок">¶</a></h3>
<p>Последние годы ни один настоящий сетевой инженер не мог не заметить
звучащих тут и там таких»страшных» слов, как Network Automation, Network
Programmability и Software Defined Networking. Для себя я давно решил,
что нужно вливаться в струю не потому что, как часто говорят: «вы
устареете и не будете востребованы»; я думаю, «классический сетевой
инженер» никуда не денется; но потому что, если вы любите свою
профессию, работать в современных реалиях и с современными инструментами
- всегда очень интересно и приятно.</p>
<p>Не имея ни малейшего опыта программирования и послушав много мнений, я
выбрал Python за то, что это язык общего назначения (т.е. применяется
для решения самых разнообразных задач), он зрелый, хорошо
поддерживается, имеет огромное комьюнити и как следствие очень много
учебных материалов. Код Python легко пишется и читается, а подключение
внешних библиотек обеспечивает представление результатов в любом
желаемом формате. Также Python предпочитается многими вендорами сетевого
оборудования, которых включают Python API в некоторые версии своих
операционных систем. Узнав, что Наташа Самойленко написала книгу и
сделала онлайн-курс «Python для сетевых инженеров», я решил, что это
будет отправной точкой в моём путешествии в мир Network Programmability.</p>
<p>Книга замечательно написана и любое предложение или абзац закреплены
практическими примерами, что, как мне кажется, является наилучшим
форматом обучающего материала для технаря. И примеров этих много, очень.
Материал закрепляется особенно хорошо благодаря заданиям к каждой главе,
которые всегда заставляют, подперев лицо кулаком, серьёзно подумать над
стратегией решения. Большое разнообразие заданий довольно быстро учит
стараться писать код красиво (насколько это возможно для новичка), а в
Python это означает гибко и эффективно.</p>
<p>Уже по прошествии 6-и глав (а это буквально пару недель занятий) , мне
подвернулись две рабочих задачи, которые были решены в кратчайшие сроки:</p>
<ol class="arabic simple">
<li>Перенос конфигурации NAT для более 1500 трансляций с Cisco IOS на
FortiGate (т.е. абсолютно другой формат конфига).</li>
<li>И проверка работы системы фильтрации web-запросов.</li>
</ol>
<p>Не знаю, сколько бы я колупался в Notepad++ в первом случае или
выборочно открывал странички из присланного заказчиком списка, но
благодаря Python и конкретно курсу Наташи, каждая из задач была решена
менее, чем за день. Перед тем, как взяться за курс, я и представить не
мог, насколько Python удобен и прост в освоении.</p>
<p>В комплекте с курсом идёт тёплый приём в команде в Slack, где всегда
можно спросить совета или поделиться своими наработками.</p>
<p>В 1001-й раз хочу поблагодарить Наташу за её замечательный и нужный
труд, ежедневную помощь и ангельское терпение к моим «грязным» решениям
=) Ни один мой вопрос не остался без ответа!</p>
<p>Разумеется один курс и 2 месяца вашей жизни не сделают из вас Киану
Ривза в Python, но его более чем достаточно, чтобы понять, какие
возможности он может вам дать. И как по мне, это безумно интересно =)</p>
</div>
<div class="section" id="id14">
<h3>Алексей про книгу<a class="headerlink" href="#id14" title="Ссылка на этот заголовок">¶</a></h3>
<p>Я считаю, что это отличная книга, для людей которые направленны на
результат. Написанная инженером, для инженеров. Всё чётко и лаконично.
Прочёл главу и приступил к работе.</p>
<p>Очень много практики и это замечательно, если всю её делать, то вы
обязательно сможете закрепить весь пройденный материал. Что не мало
важно, практика может быть использована в реальной жизни и то, что вы
напишите, скорее всего можно будет использовать в реальной жизни для
реальных проектов.</p>
<p>Да, наверное, можно было бы или ещё меньше написать или наоборот «воды
налить», но я считаю, что человеку которому это нужно для конкретных
задач и который уже с чем-то подобным был знаком ранее это хороший
вариант и отличный старт познания Python’a. Для меня эта книга сейчас
как шпаргалка. Всего в голове не удержишь, а так я точно знаю, где и что
быстро найти.</p>
<p>Я не скажу, что я сразу кинулся всё автоматизировать, но определённое
количество задач я уже реализовал.</p>
<p>Спасибо большое Наташе за её труд и доступное изложение информации.</p>
</div>
</div>
<span id="document-download"></span><div class="section" id="pdf-epub">
<span id="download"></span><h2>Скачать PDF/Epub<a class="headerlink" href="#pdf-epub" title="Ссылка на этот заголовок">¶</a></h2>
<p>Нажмите в нижнем левом углу на «Read the Docs» и в открывшейся панели
нажмите PDF или Epub.</p>
<div class="figure">
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/natenka/PyNEng/master/images/download1.png"><img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/download1.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/download1.png" style="width: 400px;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/natenka/PyNEng/master/images/download2.png"><img alt="https://raw.githubusercontent.com/natenka/PyNEng/master/images/download2.png" src="https://raw.githubusercontent.com/natenka/PyNEng/master/images/download2.png" style="width: 400px;" /></a>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; <a href="https://natenka.github.io/thanks/"> 2015-2021, Natasha Samoylenko.</a>
      <span class="lastupdated">
        Обновлено: апр. 28, 2021.
      </span>
    <a href="https://pyneng.readthedocs.io/ru/latest/download.html">Скачать книгу.</a>
    </p>
  </div>
    
    
      Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

  <div role="contentinfo">
    <p>
    <span class="lastupdated">
    This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA-4.0</a>.
    </span>
    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/ru/latest/">latest</a></dd>
        
          <dd><a href="/ru/old_chapter_order/">old_chapter_order</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//pyneng.readthedocs.io/_/downloads/ru/latest/pdf/">pdf</a></dd>
        
          <dd><a href="//pyneng.readthedocs.io/_/downloads/ru/latest/htmlzip/">html</a></dd>
        
          <dd><a href="//pyneng.readthedocs.io/_/downloads/ru/latest/epub/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/pyneng/?fromdocs=pyneng">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/pyneng/?fromdocs=pyneng">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>